\documentclass[10pt,a4paper]{article}
\input{./preamble.tex}

\title{Modular Forms}
\begin{document}
\maketitle
\tableofcontents
\newpage
\setcounter{section}{-1}
\section{Introduction}
\textbf{Notation.} We will write $\H \coloneqq \{\tau \in \C: \Im(\tau) > 0\}$ for the complex upper half plane. This is acted on by two groups: \[GL_2(\R)^+ = \{g \in GL_2(\R): \det(g) > 0\} \geq SL_2(\Z) = \{g \in GL_2(\Z) : \det(g)=1\}\]
\begin{lemma}
  $GL_2(\R)^+$ acts on $\H$ by M\"obius transformations. This action is transitive.
\end{lemma}
\begin{proof}
  Let $\tau \in \H, g = \begin{pmatrix} a&b\\c&d\end{pmatrix} \in GL_2(\R)^+$. We then write $g\tau = \frac{a\tau+b}{c\tau+d}$. This is an action on $\C$ by theory about M\"obius transformations. To see that $g\tau \in \H$, we check:
  \[\Im(g\tau) = \frac{1}{2}(g\tau - \overline{g\tau}) = \det(g) \frac{\Im(\tau)}{|c\tau+d|^2}\]

  Now for transitivity, let $\tau = x+\im y \in \H$. Then $\tau = \begin{pmatrix}y&x\\0&1\end{pmatrix}\im$.
\end{proof}
\begin{definition}
  Let $k \in \Z$, and $f : \H \to \C\cup\{\infty\}$, and let $g \in GL_2(\R)^+$. Then we define $f|_k[g]:\H \to \C\cup\{\infty\}$ by the formula
  \[f|_k[g](\tau) = f(g\tau)\det(g)^{k-1}j(g, \tau)^{-k}\]
  where $j(g, \tau) = c\tau+d$.
\end{definition}
\begin{lemma}
  This defines a right actions of $GL_2(\R)^+$ on the set of functions $f:\H \to \C\cup\{\infty\}$.
\end{lemma}
\begin{proof}
  Suppose $g, h \in GL_2(\R)^+$. We need to show that $f|_k[gh] = (f|_k[g])|_k[h]$.
  \begin{align*}
    RHS(\tau) &= f|_k[g](h\tau)\det(h)^{k-1}j(h, \tau)^{-k}\\
    &= f(gh\tau)\det(g)^{k-1}j(g, h\tau)^{-k}j(h,\tau)^{-k}\det(h)^{k-1}\\
    LHS(\tau) &= f(gh\tau)\det(gh)^{k-1}j(gh,\tau)
  \end{align*}
  So we need to check that $j(g, h\tau)j(h,\tau) = j(gh,\tau)$.

  Note that if $g = \begin{pmatrix}a&b\\c&d\end{pmatrix}$, then $g\begin{pmatrix}\tau\\1\end{pmatrix} = \begin{pmatrix}a\tau+b\\c\tau+d\end{pmatrix} = j(g,\tau)\begin{pmatrix}g\tau\\1\end{pmatrix}$.

  So $gh\begin{pmatrix}\tau\\1\end{pmatrix} = j(gh,\tau)\begin{pmatrix}gh\tau\\1\end{pmatrix} = gj(h,\tau)\begin{pmatrix}h\tau\\1\end{pmatrix} = j(h,\tau)j(g,h\tau)\begin{pmatrix}gh\tau\\1\end{pmatrix}$.
\end{proof}
\begin{definition}
  Let $k \in \Z$, and let $\Gamma \leq SL_2(\Z)$ be a finite index subgroup. Then a meromorphic function $f:\H \to \C \cup\{\infty\}$ is called a weakly modular function of weight $k$ and level $\Gamma$ if it satisfies $\forall \gamma \in \Gamma, f|_k [\gamma] = f$.
\end{definition}

\textbf{Motivating Examples}
\begin{enumerate}
  \item Modular forms were first studied in the context of elliptic functions. Suppose that $E$ is an elliptic curve over $\C$, and let $\omega$ be a non-vanishing holomorphic differential on $E$. Then there's a unique holomorphic isomorphism of Riemann surfaces
  \[\C/\Lambda \xrightarrow[\psi]{\sim} E(\C)\]
  such that $\psi^{\ast}(\omega) = dz$. Here $\Lambda\subset\C$ is a lattice.

  $E$ can be defined by the equation $y^2=x^3-60G_4(\Lambda)x-140G_6(\Lambda)$ where $G_k(\Lambda) = \sum\limits_{\omega \in \Lambda\setminus\{0\}}\omega^{-k}$. This is absolutely convergent provided $k \geq 4$.

  If $\tau \in \H$, then we can write $\Lambda_\tau = \Z\tau \oplus \Z$. This is a lattice, and the functions $G_k(\tau) = G_k(\Lambda \tau)$ are examples of modular forms.

  \item If $f:\H \to \C$ is a modular form, then $f$ has a Fourier expansion $f(\tau) = \sum\limits_{n\geq 0}a_n e^{2\pi\im n\tau/h}$ for some natural number $h$, and complex numbers $a_n$. These Fourier coefficients often carry useful arithmetic information.

  For example, consider $\theta(\tau) = \sum\limits_{n \in \Z}e^{\pi\im n^2\tau}$. If $k \geq 2$ is an even integer, then $\theta^{2k}$ is a modular form of weight $k$. Its Fourier expansion is $\theta^{2k}(\tau) = \sum\limits_{n \geq1}r_{2k}(n)e^{\pi\im n \tau}$ where $r_{2k}(n)$ is the number of ways of writing $n = x_1^2 + \ldots x_{2k}^2$, where $x_i \in \Z$.

  By relating $\theta^{2k}$ to other modular forms with known Fourier series, we can then get information about the numbers $r_{2k}(n)$. For example, $r_4(n) = 8\sum\limits_{d|n, 4\nmid d} d$.

  \item Recall the Riemann zeta function $\zeta(s) = \sum_{n\geq 1}n^{-s}$. This function has some important properties:
  \begin{enumerate}[label=\alph*)]
    \item It has a meromorphic continuation to all of $\C$.
    \item It has a functional equation relating $\zeta(s)$ and $\zeta(1-s)$.
    \item It has a representation as an Euler product $\zeta(s) = \prod_{p}(1-p^{-s})^{-1}$.
  \end{enumerate}
  Any series $L(s) = \sum_{n\geq 1}a_n n^{-s}$ with $a_n \in \C$ which has properties analogous to these is called an $L$-function.

  For example, if $N \in \N$ and $\chi: (\Z/N\Z)^\times \to \C^\times$ is a character, we can define the Dirichlet $L$-function $L(\chi, s) = \sum_{(n,N)=1} \chi(n \mod N)n^{-s}$. These functions can be used to prove Dirichlet's theorem on primes in arithmetic progression.

  Modular forms can be used to construct $L$-functions with these properties. To find the right modular forms, we need to introduce Hecke operators.

  \item The Langlands programme predicts relations between objects ocurring in number theory and modular forms. This includes as a special case the Shimura-Taniyama-Weil conjecture, otherwise known as the modularity theorem. This asserts a bijection between elliptic curves over $\Q$ up to isogeny and certain modular forms, given by ($L$-function of elliptic curve) = ($L$-function of modular form).
\end{enumerate}
\section{Modular forms on $SL_2(\Z)$}
Recall the definition, for $f:\H \to \C, k \in \Z, g \in GL_2(\R)^+$, we have
\[f|_k[g](\tau) = \det(g)^{k-1}f(g\tau)j(g,\tau)^{-k}\]
We said $f$ is \emph{weakly modular of weight k and level $SL_2(\Z)$} if $f$ is meromorphic on $\H$ and, for all $\gamma \in SL_2(\Z)$, $f|_k[\gamma] = f$.

Note that $T = \begin{pmatrix}1&1\\0&1 \end{pmatrix} \in SL_2(\Z)$ satisfies $f|_k[T](\tau) = f(\tau+1)$. So if $f$ is a weakly modular function, then we can define a new function
\[\tilde{f}:\{q \in \C: 0<|q|<1\} \to \C; e^{2\pi\im\tau} \mapsto f(\tau)\]
This function $\tilde{f}$ is meromorphic, since $f$ is.
\begin{definition}
  We say that the weakly modular function $f$ is:
  \begin{itemize}
    \item meromorphic at $\infty$ if $\tilde{f}$ is meromorphic at 0.
    \item holomorphic at $\infty$ if $\tilde{f}$ is holomorphic at 0.
    \item vanishes at $\infty$ if $\tilde{f}$ is holomorphic and vanishes at 0.
  \end{itemize}
\end{definition}
If $f$ is meromorphic at $\infty$ then $\tilde{f}$ has a Laurent expansion $\tilde{f}(q) = \sum_{n \in \Z}a_nq^n$ valid in some region $\{0 <|q|< \epsilon\}$, where $a_n \in \C$ and $a_n = 0$ if $n<0$ and $|n|$ is sufficiently large.

We get a formula $f(\tau) = \sum_{n\in \Z}a_nq^n$ where $q = e^{2\pi\im\tau}$. This is valid in some region $\{\tau \in \H : \Im \tau > R\}$, and is called the $q$-expansion of $f$. Then $f$ is holomorphic at $\infty$ if and only if $a_n = 0$ when $n < 0$, and $f(\infty) = a_0$.
\begin{definition}
  Let $f$ be a weakly modular function of weight $k$ and level $SL_2(\Z)$. We say that $f$ is
  \begin{itemize}
    \item a \emph{modular function} if $f$ is meromorphic at $\infty$.
    \item a \emph{modular form} if $f$ is holomorphic in $\H$ and holomorphic at $\infty$.
    \item a \emph{cuspidal modular form} if $f$ is a modular form vanishing at $\infty$.
  \end{itemize}
  all with weight $k$ and level $SL_2(\Z)$.

  We write $M_k(SL_2(\Z))$ for the $\C$-vector space of modular forms of weight $k$ and level $SL_2(\Z)$. We write $S_k(SL_2(\Z))$ for the subspace of cuspidal modular forms.
\end{definition}
\textbf{Examples.} If $\tau \in \H$, then $\Lambda_\tau = \Z\tau \oplus \Z$. if $k \in \Z$, then we can define $G_k(\tau) = \sum\limits_{\omega \in \Lambda_\tau\setminus\{0\}}\omega^{-k}$.

If $\gamma = \begin{pmatrix}a&b\\c&d\end{pmatrix} \in SL_2(\Z)$, then $\Lambda_{\gamma \tau} = \Z\left(\frac{a\tau+b}{c\tau+d}\right)\oplus \Z = j(\gamma,\tau)^{-1}\Z(a\tau+b)\oplus \Z(c\tau+d) = j(\gamma,\tau)^{-1}\Lambda_\tau$.

Finally, we find $G_k|_k[\gamma](\tau) = G_k(\gamma\tau)j(\gamma,\tau)^{-k} = \sum\limits_{\omega \in \Lambda_{\gamma\tau}\setminus\{0\}}(\omega j(\gamma,\tau))^{-k} = \sum\limits_{\omega \in \Lambda_\tau\setminus\{0\}} \omega^{-k} = G_k(\tau)$.
\begin{proposition}
  Suppose $k \geq 4$ and $k$ is even. Then $G_k(\tau)$ converges absolutely and uniformly on compact subsets of $\H$. Moreover, $G_k(\tau)$ is holomorphic at $\infty$ and $G_k(\infty) = 2\zeta(k)$. In particular, $G_k \in M_k(SL_2(\Z))$.
\end{proposition}
\textbf{Remark.} We have $-I = \begin{pmatrix} -1&0\\0&-1 \end{pmatrix} \in SL_2(\Z)$ and $f|_k[-I] = f\cdot(-1)^k$, so if $k$ were odd then $f \equiv 0$, and hence $M_k(SL_2(\Z)) = 0$ when $k$ is odd.
\begin{proof}
  Fix $A \geq 1$. Define $\Omega_A = \{\tau \in \H : |\Re(|\tau)|\leq A, \Im(\tau) \geq \frac{1}{A}\}$. We'll show uniform convergence of $G_k$ in $\Omega_A$. Note that if $\tau \in \Omega_A$, then for any $x \in \R$, $|\tau+x| \geq \frac{1}{A}$, and $|\tau+x| \geq \frac{1}{2}|x|$ if $|x|\geq 2A$. Hence $|\tau+x| \geq \sup(1/A, 1/2A^2|x|) \geq \frac{1}{2A^2}\sup(1, |x|)$ for any $x \in \R$.

  If $\tau \in \Omega_A$, then:
  \begin{align*}
    \sum_{(m,n) \in \Z^2\setminus\{0\}} |m\tau+n|^{-k} &= \sum_{(m,n)} |m|^{-k}|\tau+n/m|^{-k} \\
    &\leq \sum_{(m,n)}\frac{|m|^{-k}}{(2A)^{-k}}\sum(1, |n/m|)^{-k}\\
    &= \sum_{(m,n)}(2A)^k \sup(|m|^{-k}, |n|^{-k})\\
    &= \sum_{r \in \N} (2A)^k r^k 8r = (2A)^k8\zeta(k-1)
  \end{align*}
  This shows absolute and uniform convergence.

  To show that $G_k$ is holomorphic at $\infty$ and $G_k(\infty) = 2\zeta(k)$, it's enough to show that
  \[\lim_{\tau\in\Omega_1, \Im\tau\to\infty} G_k(\tau) = 2\zeta(k)\]
  This limit equals $\sum\limits_{(m,n)}\lim\limits_{\Im\tau\to\infty}(m\tau+n)^{-k} = \sum\limits_{n\in \Z\setminus \{0\}}n^{-k} = 2\zeta(k)$, as all terms with $m \neq 0$ vanish.
\end{proof}
$G_k$ is an example of an \emph{Eisenstein series}.
\begin{definition}
  We define the \emph{normalised Eisenstein series} $E_k(\tau) = \frac{1}{2\zeta(k)}G_k(\tau) = 1 + \sum_{n\geq 1}a_nq^n$. We'll see that the $a_n$ are rational numbers of bounded denominators.
\end{definition}
\textbf{Remark.} If $f \in M_k(SL_2(\Z))$ and $g \in M_\ell(SL_2(\Z))$, then $fg \in M_{k+\ell}(SL_2(\Z))$. So $E_4^3, E_6^2 \in M_{12}(SL_2(\Z))$, and $E_4^3(\infty) = E_6^2(\infty)$, so $\Delta = \frac{E_4^3-E_6^2}{1728} \in S_{12}(SL_2(\Z))$. We'll see shortly that $\Delta = \sum_{n\geq 1} b_nq^n$ where $b_1 = 1, b_n \in \Z$ for all $n \geq 1$.

We now study a fundamental domain for the action of $SL_2(\Z)$ on $\H$. We will write $\Gamma(1) = SL_2(\Z)$, and $\overline{\Gamma(1)} = SL_2(\Z)/\angle{-I}$. This will make sense later.

We write \[\mathscr{F} = \{\tau \in \H : -\frac12 \leq \Re\tau \leq \frac12, |\tau|\geq 1\}\] and \[\mathscr{F}' = \{\tau \in \mathscr{F} : \Re \tau < 1/2, |\tau| = 1 \implies \Re\tau \leq 0\}\]
In the following diagram, $\mathscr{F}$ is all of the green + orange regions, whilst $\mathscr{F}'$ is just the green area. We also define $\rho\coloneqq \exp(2\pi\im/3)$
\begin{center}
  \begin{tikzpicture}
    \begin{axis}[
      xmin=-2.5, xmax=2.5,
      ymin=-0.5, ymax=2.5,
      axis lines=middle,
      axis equal,
      xtick={-4,-3,...,4},
      xticklabels = \empty,
      ytick={0,1,...,4},
      yticklabels = \empty,
      ]
      \draw (-1,0) arc (180:0:1);
      \draw[thick, green!80!black, fill=green!80!black, fill opacity=0.2] (-0.5,4.5) -- (-0.5,0.866) arc (120:60:1) -- (0.5,4.5) -- cycle;
      \draw[thick, orange] (0,1) arc (90:60:1) -- (0.5,4.5);
      \fill[green!80!black] (0,1) circle (0.3mm);
      \fill[green!80!black] (-0.5,0.866) circle (0.3mm);
      \node[left] at (-0.5,0.866) {$\rho$};
    \end{axis}
  \end{tikzpicture}
\end{center}
We have elements $T = \begin{pmatrix} 1&1\\0&1\end{pmatrix}$ and $S =\begin{pmatrix}0&-1\\1&0\end{pmatrix}\in \Gamma(1)$.
\begin{proposition}
  $\mathscr{F}$ is a fundamental domain for the action of $\overline{\Gamma(1)}$ on $\H$. More precisely, if $\tau\in\H$ there is $\gamma \in \overline{\Gamma(1)}$ such that $\gamma\tau \in \mathscr{F}$. If $\gamma \tau \in \mathscr{F}^\circ$, then $\gamma$ is unique. Moreover, each $\tau \in \H$ is $\overline{\Gamma(1)}$-conjugate to exactly one element of $\mathscr{F}'$.
\end{proposition}
\begin{proof}
  We first prove that any $\tau \in \H$ is $\overline{\Gamma(1)}$-conjugate to an element of $\mathscr{F}$. We proved earlier that if $\tau \in \H$ and $\gamma \in \Gamma(1)$, then $\Im \gamma(\tau) = \Im(\tau)/|c\tau+d|^2$.

  If $\tau \in \H$, then $\Lambda_\tau = \Z_\tau \oplus \Z$ is a lattice. So as $(c,d) \in \Z^2\setminus\{0\}$, the numbers $|c\tau+d|$ achieve a minimum. Consequently, the numbers $\Im \gamma(\tau)$ for $\gamma \in \Gamma(1)$ achieve a maximum. So \textsc{wlog} we may assume $\Im(\tau) \geq \Im(\gamma \tau)$ for all $\gamma \in \Gamma(1)$. Also \textsc{wlog} we may take $-\frac12 \leq \Re(\tau) \leq \frac12$.

  We then claim that these properties are sufficient for $\tau \in \mathscr{F}$. It is sufficient to show that $|\tau| \geq 1$. We have $\Im(S\tau) = \Im(\tau)/|\tau|^2 \leq \Im(\tau)$, and hence $|\tau|^2 \geq 1$, so we are done.
\end{proof}
We slightly strengthen this with the following proposition:
\begin{proposition}\hspace*{0cm}
  \begin{enumerate}
    \item For all $\tau \in \H$, there is a unique $\gamma \in \overline{\Gamma(1)}$ such that $\gamma \tau \in \mathscr{F}'.$
    \item If $\tau \in \mathscr{F}'$, then $\Stab_{\overline{\Gamma(1)}}(\tau) = \{I\}$, except $\Stab_{\overline{\Gamma(1)}}(\im) = \{I, S\}$ and $\Stab_{\overline{\Gamma(1)}}(\rho) = \{1,ST,(ST)^2\}$.
    \item $\overline{\Gamma(1)}$ is generated by $S$ and $T$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  To prove the first two parts, it's enough to show that:
  \begin{enumerate}[label=\alph*)]
    \item For all $\tau \in \H$, there is $\gamma \in \overline{\Gamma(1)}$ such that $\gamma\tau \in \mathscr{F}'$.
    \item For all $\tau, \tau' \in \mathscr{F}'$ and $\gamma \in \overline{\Gamma(1)}$, $\gamma\tau'=\tau \implies \tau'=\tau$ and either $\begin{cases} \gamma=1\\\tau=\im, \gamma=S\\\tau=\rho, \gamma=ST, (ST)^2\end{cases}$.
  \end{enumerate}
  a) was done above. For b), take $\tau,\tau' \in \mathscr{F}'$ such that $\tau' = \gamma\tau$. We have $\Im(\gamma\tau) = \Im(\tau)/|c\tau+d|^2$ where $\gamma = \begin{pmatrix}a&b\\c&d\end{pmatrix}$.

  Without loss of generality, we have $\Im(\tau') = \Im(\gamma\tau) \geq \Im(\tau)\implies |c\tau+d|\leq 1$.

  So $\Im(\tau) \geq \sqrt{3}/2 \implies |c\tau+d| \geq c\sqrt{3}/2$, and so $|c| \leq 1$, so we can assume $c = 1$ or $0$ (if $-1$, just multiply by $-I$, since we are in $\overline{\Gamma(1)} = \Gamma(1)/\angle{-I}$). We then split into cases:
  \begin{enumerate}
    \item $c = 0, \gamma = \begin{pmatrix}1&b\\0&1\end{pmatrix}$. This forces $\gamma = I, \tau=\tau'$.
    \item $c = 1, \gamma = \begin{pmatrix}a&b\\1&d\end{pmatrix}$. Now $|\tau+d| \leq 1$. Then $\tau \in \mathscr{F}' \implies$ either $d = 0, |\tau| = 1$, or $d = 1, \tau=\rho$.

    In the first case, $\gamma = \begin{pmatrix} a&-1\\1&0\end{pmatrix}$, and so $\gamma\tau = a-\frac1\tau$. We have $\Re(\tau), \Re(\Gamma(\tau)) = a - \Re(\tau)$ both in $[-1/2,0]$. The only possibilities are $\Re(\tau) = -\frac12, a = -1, \tau=\rho, \gamma=(ST)^2$ and $\Re(\tau) = 0, a = 0, \tau = \im, \gamma=S$.

    In the second case, $d = 1, \tau  = \rho, \gamma=\begin{pmatrix}a&b\\1&1\end{pmatrix}$. Then $\gamma\rho = \frac{a\rho+b}{\rho + 1}$. We have $\rho^2+\rho+1 = 0, \rho^2 = \rho{-1}$, so $\gamma\rho = -\rho(a\rho+b) = -a\rho^{-1}-b\rho$.

    We know that $|\rho + 1| = |\tau+d| = 1$, so $\Im(\gamma\rho) = \Im(\rho)/|\rho+1| = \Im(\rho)$. So $\gamma\rho = \rho$, as $\rho$ is the unique element of $\mathscr{F}'$ of smallest imaginary part, and hence $\rho = -a\rho^{-1}-b\rho\implies a=0, b = -1$, and so $\gamma = ST$.
  \end{enumerate}

  For part 3., lets take $G = \angle{S,T}$. For all $\tau \in \H$, there is $\gamma \in G$ with $\gamma \tau \in \mathscr{F}$. Why? Without loss of generality, we can assume that, for all $\gamma \in G, \Im(\gamma\tau) \leq \Im(\tau)$, and moreover that $-\frac12 \leq \Re(\tau)\leq \frac12$.

  This implies that $\tau \in \mathscr{F}$, as $\Im(S\tau) = \Im(\tau)/|\tau|^2 \leq \Im(\tau) \implies |\tau| \geq 1$.

  Choose $\tau \in \mathscr{F}^\circ$. Choose $\gamma \in \overline{\Gamma(1)}$. We'll show that $\gamma \in G$. Note that $\gamma\tau \in \H$, so there is $\delta \in G$ such that $\delta\gamma\tau \in \mathscr{F}$, so $\delta\gamma\tau \in \mathscr{F}^\circ$ and $\delta\gamma = I$, so $\delta =\gamma^{-1} \in G$.
\end{proof}
If $P \in \overline{\Gamma(1)} \diagdown \H$ (since $\overline{\Gamma(1)}$ acts on the left on $\H$, this is a left quotient. $P$ is a $\overline{\Gamma(1)}$-orbit, i.e. can be represented as $\overline{\Gamma(1)}\cdot \tau$ for some $\tau \in \H$), then we define $e_P = |\Stab_{\overline{\Gamma(1)}}(\tau)|$.

We've just shown that $e_P = 1$ except for $\begin{cases} e_{\overline{\Gamma(1)}\cdot \rho} = e_\rho = 3\\ e_{\overline{\Gamma(1)}\cdot \im} = e_\im = 2\end{cases}$.

Suppose that $f$ is a modular function of weight $k$ and level $SL_2(\Z)$. Then we define $v_P(f)$ to be the order of $f$ at $\tau$ (where $\tau$ is a representative for $P$).

Note that this independent of the specific choice of representative $\tau$ as, for any $\gamma \in \Gamma(1)$ we have $f(\gamma\tau)j(\gamma,\tau)^{-k} = f(\tau)$, and $j(\gamma,\tau)$ is holomorphic and non-vanishing.

We define $v_\infty(f) = \inf \{n\in\Z : a_n \neq 0\}$, where $f(\tau) = \sum_{n\in \Z} a_nq^n$ is the $q$-expansion of $f$. Equivalently, this is the order of $\tilde{f}$ at $q=0$.
\begin{theorem}
  Let $f$ be a modular function of weight $k$ and level $SL_2(\Z)$. Assume that $f\neq 0$. Then:
  \[v_\infty(f) + \sum_{P \in \overline{\Gamma(1)}\diagdown \H} \frac{1}{e_P}v_P(f) = \frac{k}{12}\]
\end{theorem}
\begin{proof}
  Let $U \subseteq \C$ be an open subset, and $\gamma \subseteq U$ a positively oriented simple closed contour, and $f:U \to \C$ a meromorphic function with no zeros or poles on $\gamma$. Then $\frac{1}{2\pi\im}\oint_\gamma\frac{df}{f} = \sum_{\tau \in \Int(\gamma)} v_\tau(f)$ - this is the argument principle.

  Let's first prove the theorem assuming that $f$ has no zeros or poles on the boundary of $\mathscr{F}$. Since $f$ is meromorphic at infinity, there exists a $R > 0$ such that $f$ has no zeros or poles on in $\{\tau \in \H:\Im(\tau) \geq R\}$.

  We consider the contour $\gamma = ABCDEA$:
  \begin{center}
    \begin{tikzpicture}
      \begin{axis}[
        xmin=-1.5, xmax=1.5,
        ymin=-0.5, ymax=2.5,
        xtick={-0.5,0,0.5},
        ytick=\empty,
        xticklabels={$-\frac12$,0,$\frac12$},
        %yticklabels=\empty,
        axis lines=middle,
        axis equal,
      ]
      \begin{scope}[
        thick,
        decoration={markings, mark=at position 0.5 with {\arrow{>}}}
      ]
        \draw[postaction={decorate}] (-0.5,2) -- (-0.5,0.866);
        \draw[postaction={decorate}] (-0.5,0.866) arc(120:60:1);
        \draw[postaction={decorate}] (0.5,0.866) -- (0.5,2);
        \draw[postaction={decorate}] (0.5,2) -- (-0.5,2);
      \end{scope}
      \node[left] at (-0.5,2) {$A$};
      \node[left] at (-0.5,0.866) {$B$};
      \node[above left] at (0,1) {$C$};
      \node[right] at (0.5,0.866) {$D$};
      \node[right] at (0.5,2) {$E$};
      \end{axis}
    \end{tikzpicture}
  \end{center}
  where $A = -\frac12 + \im R, B = \rho, C = \im, D = \rho + 1, E = \frac12 + \im R$.

  The argument principle gives $\frac{1}{2\pi\im}\oint_\gamma \frac{df}{f} = \sum_{\tau \in \Int(\mathscr{F})} v_\tau(f)$.

  We can break up the integral into the different segments AB, BC, CD, DE, and EA, and make some observations:
  \begin{itemize}
    \item $f(\tau) = f(\tau+1)$, so $\int_A^B \frac{df}{f} = \int_E^D \frac{df}{f} = -\int_D^E \frac{df}{f}$, so these paths cancel.
    \item The image of the path $EA$ under the map $\tau \mapsto e^{2\pi\im\tau}$ is a negatively oriented circle $c$ going around $q= 0$, so $\frac{1}{2\pi\im}\int_E^A \frac{df}{f} = \frac{1}{2\pi\im}\oint_c \frac{d\tilde{f}}{\tilde{f}} = -v_0(\tilde{f}) = -v_\infty(f)$.
    \item The path from $CD$ is the image of the path $CB$ under $S$. So $\frac{1}{2\pi\im}\int_D^C \frac{df}{f} = \frac{1}{2\pi\im}\int_B^C \frac{d(f\circ S)}{(f\circ S)}$. We have $f(S\tau) = f(\tau)\tau^k$, so $\frac{d(f\circ S)}{f\circ S} = \frac{kd\tau}{\tau} + \frac{df}{f}$.

    Hence this integral is $\frac{1}{2\pi\im}\int_B^C \frac{k}{\tau}d\tau + \int_B^C \frac{df}{f}$, and so we have:
    \[\frac{1}{2\pi\im}\int_B^C \frac{df}{f} + \frac{1}{2\pi\im}\int_C^D \frac{df}{f} = \frac{1}{2\pi\im}\int_C^B\frac{k}{\tau}d\tau = \frac{k}{12}\]
  \end{itemize}
  Putting this all together, we have:
  \[\frac{k}{12} - v_\infty(f) = \sum_{\tau \in \Int(\mathscr{F})} v_\tau(f)\]
  Since we're assuming all zeros and poles are in the interior and so have $e_P = 1$, adding in the $e_P$s for the result in the theorem doesn't change anything.

  If there are zeros or poles on the boundary of $\mathscr{F}$, then we need a modified contour. First suppose that $f$ has a zero or pole on the lines $AB$ and $DE$, but nowhere else. Then we use the contour $\gamma'$:
  \begin{center}
    \begin{tikzpicture}
      \begin{axis}[
        xmin=-1.5, xmax=1.5,
        ymin=-0.5, ymax=2.5,
        xtick={-0.5,0,0.5},
        ytick=\empty,
        xticklabels={$-\frac12$,0,$\frac12$},
        %yticklabels=\empty,
        axis lines=middle,
        axis equal,
      ]
      \node[left] (A) at (-0.5,2) {$A$};
      \node[left] (B) at (-0.5,0.866) {$B$};
      \node[above left] (C) at (0,1) {$C$};
      \node[right] (D) at (0.5,0.866) {$D$};
      \node[right] (E) at (0.5,2) {$E$};
      \node[burgundy, circle, draw, fill, minimum size=.5pt, inner sep=1pt] (P1) at (-0.5,1.5) {};
      \node[burgundy, circle, draw, fill, minimum size=.5pt, inner sep=1pt] (P2) at (0.5,1.5) {};
      \begin{scope}[
        thick,
        decoration={markings, mark=at position 0.5 with {\arrow{>}}}
      ]
        \draw[postaction={decorate}] (-0.5,2) -- (-0.5,1.55);
        \draw (-0.5,1.55) arc(90:270:0.05);
        \draw[postaction={decorate}] (-0.5,1.45) -- (-0.5,0.866);
        \draw[postaction={decorate}] (-0.5,0.866) arc(120:60:1);
        \draw[postaction={decorate}] (0.5,0.866) -- (0.5,1.45);
        \draw (0.5,1.55) arc(90:270:0.05);
        \draw[postaction={decorate}] (0.5,1.55) -- (0.5,2);
        \draw[postaction={decorate}] (0.5,2) -- (-0.5,2);
      \end{scope}
      \end{axis}
    \end{tikzpicture}
  \end{center}
  where the small semicircles are chosen so that they avoid all zeros or poles of $f$, noting that the zeros and poles of a meromorphic function are isolated, and so that $AB$ is mapped to $ED$ by $T$, in order to still have $\int_B^A \frac{df}{f} + \int_D^E \frac{df}{f} = 0$. The rest of the proof goes through as before. We can make a similar modification if $f$ has a zero/pole on $BC$.

  The remaining case is when $f$ has a zero or pole at $\rho$ or $\im$. In this case, we use the following observation: let $g: U \to \C$ be a meromorphic function defined in an open neighbourhood of $z=0$.

  We consider the paths $\gamma_\epsilon:[0,1] \to U$ given by $\gamma_\epsilon(t) = \epsilon e^{2\pi\im(\theta_0 + t\theta)}$. Then:
  \[\lim_{\epsilon \to 0} \frac{1}{2\pi\im} \int_{\gamma_\epsilon} \frac{dg}{g} = \frac{\theta}{2\pi}v_0(g)\]
  To show this, write $g(z) = z^nh(z)$ where $n = v_0(g)$ and $h(z)$ is holomorphic and non-vanishing at 0. Then
  \[\frac{1}{2\pi\im} \int_{\gamma_\epsilon} \frac{dg}{g} = \frac{1}{2\pi\im} \int_{\gamma_\epsilon} \frac{ndz}{z} + \frac{1}{2\pi\im}\int_{\gamma_\epsilon} \frac{dh}{h} \to \frac{\theta}{2\pi} + 0\]
  Now suppose that $f$ has zeros or poles at $\rho$ or $\im$, and at no other points on the boundary of $\mathscr{F}$. We consider a family of contours $\gamma_\epsilon$ given by replacing $\gamma$ at $B$, $C$, and $D$ by small arcs of radius $\epsilon$.
  \begin{center}
    \begin{tikzpicture}
      \begin{axis}[
        xmin=-1.5, xmax=1.5,
        ymin=-0.5, ymax=2.5,
        xtick={-0.5,0,0.5},
        ytick=\empty,
        xticklabels={$-\frac12$,0,$\frac12$},
        %yticklabels=\empty,
        axis lines=middle,
        axis equal,
      ]
      \begin{scope}[
        thick,
        decoration={markings, mark=at position 0.5 with {\arrow{>}}}
      ]
        \draw[postaction={decorate}] (-0.5,2) -- (-0.5,0.916);
        \draw (-0.5,0.916) arc(90:28.5:0.05);
        \draw[postaction={decorate}] (-0.456,0.890) arc(117.1:92.7:1);
        \draw (-0.05,0.999) arc(181.4:-1.4:0.05);
        \draw[postaction={decorate}] (0.05,0.999) arc(87.3:62.9:1);
        \draw (0.5,0.916) arc(90:151.5:0.05);
        \draw[postaction={decorate}] (0.5,0.916) -- (0.5,2);
        \draw[postaction={decorate}] (0.5,2) -- (-0.5,2);
      \end{scope}
      \node[left] at (-0.5,2) {$A$};
      \node[left] at (-0.5,0.916) {$B$};
      \node[below] at (-0.456,0.890) {$B'$};
      \node[above left] at (-0.05,0.999) {$C$};
      \node[above right] at (0.05,0.999) {$C'$};
      \node[below] at (0.456,0.890) {$D$};
      \node[right] at (0.5,0.916) {$D'$};
      \node[right] at (0.5,2) {$E$};
      \node[burgundy, circle, draw, fill, minimum size=.5pt, inner sep=1pt] (P1) at (-0.5,0.866) {};
      \node[burgundy, circle, draw, fill, minimum size=.5pt, inner sep=1pt] (P2) at (0,1) {};
      \node[burgundy, circle, draw, fill, minimum size=.5pt, inner sep=1pt] (P3) at (0.5,0.866) {};
      \end{axis}
    \end{tikzpicture}
  \end{center}
  Then the argument principle gives:
  \[\frac{1}{2\pi\im}\left[\int_A^B + \int_B^{B'} + \ldots + \int_E^A \frac{df}{f}\right] = \sum_{\tau \in \Int(\mathscr{F})} v_\tau(f)\]
  It's still the case that $\frac{1}{2\pi\im} \int_E^A \frac{df}{f} = -v_\infty(f)$, and that the paths $AB$ and $D'E$ cancel. It's also still the case that $\frac{1}{2\pi\im} \left[\int_{B'}^C + \int_{C'}^D \frac{df}{f}\right] = \frac{\alpha k}{2\pi}$, where $\alpha$ is the angle swept out by $CB'$, which tends to $k/12$ as $\epsilon\to 0$.

  We need to understand the remaining terms given by the paths $BB', CC', DD'$. Using our previous observation, we see that $\lim_{\epsilon \to 0} \frac{1}{2\pi\im}\int_B^{B'} \frac{df}{f} = -\frac16 v_\rho(f)$. Similarly, we have $\lim_{\epsilon \to 0}\frac{1}{2\pi\im} \int_C^{C'} \frac{df}{f} = -\frac12 v_\im(f), \lim_{\epsilon \to 0}\frac{1}{2\pi\im} \int_D^{D'} \frac{df}{f} = -\frac16 v_\rho(f)$.

  We finally obtain an identity:
  \[v_\infty(f) + \frac{1}{3}v_\rho(f) + \frac12 v_\im(f) + \sum_{\tau \in \Int(\mathscr{F})}v_\tau(f) = \frac{k}{12}\]
  giving the result.
\end{proof}
Let's now apply this to some examples. Take $k=4, f = E_4 \in M_4(SL_2(\Z))$. We get:
\[v_\infty(E_4) + \sum_{P \in \overline{\Gamma(1)}\diagdown \H}\frac{1}{e_P}v_P(E_4) = \frac{1}{3}\]
and so $v_\rho(E_4) = 1$ and $v_P(E_4) \neq 0$ for $P \neq \overline{\Gamma(1)}\cdot\rho$. i.e. $E_4$ has a simple zero at $\rho$ and no other zeros in $\mathscr{F}'$.

Now take $k= 6, f = E_6$. We get $LHS = \frac{1}{2}$, and so $v_\im(E_6) = 1, v_P(E_6) = 0$ for all $P \neq \overline{\Gamma(1)}\cdot \im$, i.e. $E_6$ has a simple zero at $\im$ and no other zeros in $\mathscr{F}'$.

We defined $\Delta = (E_4^3-E_6^2)/1728 \in S_{12}(SL_2(\Z))$. Then $\Delta(\im) = E_4(\im)^3/1728 \neq 0$, and so $\Delta$ is actually a non-zero cuspidal modular form. We apply our formula to $\Delta$, using that it is non-zero, and get
\[v_\infty(\Delta) + \sum_{P \in \overline{\Gamma(1)}} \frac{1}{e_P}v_P(\Delta) = 1\]
We know $\Delta$ is cuspidal so $v_\infty(\Delta) \geq 1$, hence $v_\infty(\Delta) = 1$ and $\Delta$ is non-vanishing in $\H$.

\begin{theorem}
  Let $k \in \Z$ be an even integer. Then:
  \begin{enumerate}
    \item If $k<0$ or $k=2$, then $M_k(SL_2(\Z)) = 0$ Moreover, $M_0(SL_2(\Z)) = \C$ (identified with the constant functions).
    \item If $4 \leq k \leq 10$ or $k=14$, then $M_k(SL_2(\Z)) = \C\cdot E_k$
    \item If $k \geq 0$, then multiplication by $\Delta$ induces an isomorphism $M_k(SL_2(\Z)) \xrightarrow{\sim} S_{k+12}(SL_2(\Z))$.
  \end{enumerate}
\end{theorem}
\begin{proof}
  We use the formula $v_\infty(f)+\sum_P \frac{1}{e_P}v_P(f) = \frac{k}{12}$, valid for any non-zero $f \in M_k(SL_2(\Z))$. If $k<0, LHS \geq 0, RHS < 0$ and so there are no such $f$.

  If $k=2, RHS = 1/6, LHS = a+b/2 + c/3$ where $a,b,c \in \Z_{\geq 0}\contr$.

  Suppose $f \in M_0(SL_2(\Z))$ and $f$ is not a scalar. Then there is $\lambda \in \C$ such that $f-\lambda$ is cuspidal and non-zero, so $v_\infty(f-\lambda) \geq 1$. But then $LHS > 0, RHS = 0$, and we have a contradiction. Hence $M_0(SL_2(\Z)) = \C$.

  Now suppose $f \in M_k(SL_2(\Z))$ and either $4 \leq k \leq 10$ or $k=14$. Then there is $\lambda \in \C$ such that $f-\lambda E_k \in S_k(SL_2(\Z))$. If $f-\lambda E_k \neq 0$, we get $v_\infty(f-\lambda E_k) + \sum_P \frac{1}{e_P}v_P(f-\lambda E_k) = \frac{k}{12}$. If $k < 12$, then $RHS < 1$ and $LHS \geq 1 \contr$. If $k = 14$, then we will use part 3 and 1 to show $S_{14}(SL_2(\Z)) = 0$, so $M_{14}(SL_2(\Z)) = \C E_{14}$.

  To prove the final part of the theorem, consider the described map $\times \Delta : M_k(SL_2(\Z)) \to S_{k+12}(SL_2(\Z))$. It's injective as $\Delta$ is non-vanishing in $\H$, so $f\Delta = g\Delta \implies f = g$. It's surjective as $\Delta$ is non-vanishing and $v_\infty(\Delta) = 1$. This means that, if $f \in S_{k+12}(SL_2(\Z))$ then $v_\infty(f/\Delta) = v_\infty(f)-1 \geq 0$, and so $f/\Delta \in M_k(SL_2(\Z))$.


\end{proof}
\begin{corollary}
  For any $k \in \Z, k \geq 0$ even, we have
  \[\dim_\C M_k(SL_2(\Z)) = \begin{cases} \floor{\frac{k}{12}}+1 & k \nequiv 2 \mod 12\\ \floor{\frac{k}{12}} & k \equiv 2 \mod 12\end{cases}\]
\end{corollary}
\begin{proof}
  The theorem shows this is true for $0 \leq k \leq 14$. We have $M_k(SL_2(\Z)) = \C E_k \oplus S_k(SL_2(\Z))$, just by subtracting a scalar multiple of $E_k$ to get a cusp form, and so $\dim_\C M_{k+12}(SL_2(\Z)) = 1+\dim_\C M_k(SL_2(\Z))$, and the result follows by induction.
\end{proof}
\begin{corollary}
  Let $k \geq 0$ be even. Then $M_k(SL_2(\Z))$ is spanned as a $\C$-vector space by the elements $E_4^a E_6^b$ where $a, b \in \Z_{\geq 0}$ and $4a+6b = k$.
\end{corollary}
\begin{proof}
  This holds when $k \leq 10$. We'll now show that if the corollary holds for $k$, then it holds for $k+12$. This will give the general case by induction.

  Choose $a, b \in \Z_{\geq 0}$ such that $4a+6b = k +12$. Then $E_4^a E_6^b \in M_{k+12}$ with leading term 1 in its $q$-expansion, so we have $M_{k+12}(SL_2(\Z)) = S_{k+12}(SL_2(\Z)) \oplus \C E_4^a E_6^b = \Delta M_{k}(SL_2(\Z)) \oplus \C E_4^aE_6^b$.

  Note that $\Delta = (E_4^3-E_6^2)/1728$, so the result follows.
\end{proof}
\begin{definition}
  We define $j:\H \to \C$ by the formula $j(\tau) = E_4^3(\tau)/\Delta(\tau)$. This is a modular function of weight 0 and level $SL_2(\Z)$.
\end{definition}
If $\tau \in \H$, then $j(\tau)$ is the $j$-invariant of the elliptic curve $E_\tau = \C/\Lambda_\tau$.
\begin{theorem}\hspace*{0cm}
  \begin{enumerate}
    \item $j$ is holomorphic in $\H$ and $v_\infty(j) = -1$.
    \item $j$ gives a bijection $\overline{\Gamma(1)}\diagdown \H \xrightarrow{\sim} \C$.
    \item Every modular function of weight $0$ and level $SL_2(\Z)$ is a rational function of $j$.
  \end{enumerate}
\end{theorem}
Later, we'll give $\overline{\Gamma(1)}\diagdown \H \sqcup \{\infty\}$ the structure of a compact Riemann surface. Part 3 of the above theorem says that $j$ gives an isomorphism from this surface to the Riemann sphere.
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item $j = E_4^3/\Delta$ is holomorphic in $\H$ as $\Delta$ is non-vanishing in $\H$. We have $v_\infty(E_k^3) = 0$ and $v_\infty(\Delta) = 1$, so $v_\infty(E_4^3/\Delta) = 0-1 = -1$.
    \item We need to show that for all $z \in \C$, there is a unique $\tau \in \H$ modulo $\overline{\Gamma(1)}$ such that $j(\tau) = z$, or equivalently, $E_4^3(\tau) - z\Delta(\tau) = 0$.

    We have $v_{\infty}(E_4^3-z\Delta) + \sum_P \frac{1}{e_P}v_P(E_4^3-z\Delta) = 1$. The first term is $0$, since the leading term of $E_4^3-z\Delta$ is 1. Then we have $a+ b/2 + c/3 = 1$ for $a,b,c \in \Z_{\geq 0}$. We see that there's exactly one $P$ such that $v_P(E_4^3-z\Delta) > 0$, and so have the desired statement.
    \item Let $f$ be a non-zero modular function of weight 0 and level $SL_2(\Z)$. Then we can multiply $f$ by terms of the form $j-j(\tau_0)$ to conclude that $f$ is holomorphic in $\H$. Then there exists $n \geq 0$ such that $\Delta^n f$ is holomorphic at $\infty$, and so $\Delta^n f \in M_{12n}(SL_2(\Z))$.

    To prove the theorem, it's enough to show that, if $4a+6b = 12$, then $E_4^aE_6^b/\Delta^n$ is a rational function of $j$.

    Note that, if $4a+6b = 12n$, then $2a+3b=6n$, so we can write $a = 3p, b = 2q$ for some $p, q \in \Z_{\geq 0}$, and then $p+q = n$. Hence $E_4^aE_6^b/\Delta^n = (E_4^3/\Delta)^p (E_6^2/\Delta)^q = j^p (E_6^2/\Delta)^q$. So it remains to show that $E_6^2/\Delta$ is a rational function of $j$.

    By definition, $\Delta = (E_4^3 - E_6^2)/1728$, and so $E_6^2/\Delta = E_4^3/\Delta - 1728 = j - 1728$.
  \end{enumerate}
\end{proof}
\begin{proposition}
  Let $k \geq 4$ be an even integer. Then the $q$-expansion of $G_k$ is
  \[G_k(\tau) = 2\zeta(k) + 2 \frac{(2\pi\im)^k}{(k-1)!}\sum_{n=1}^\infty \sigma_{k-1}(n)q^n\]
  where $\sigma_{k-1}(n)= \sum_{d|n}d^{k-1}$.
\end{proposition}
\begin{proof}
  We use the identity $\pi\cot(\pi\tau) = \frac{1}{\tau} + \sum_{n=1}^\infty \left(\frac{1}{\tau-n} + \frac{1}{\tau+n}\right)$ as holomorphic functions in $\H$. The RHS is absolutely convergent and uniformly convergent in compact subsets.

  Note that $\pi\cot(\pi\tau) = \pi\im \frac{e^{\im\pi\tau}+e^{-\im\pi\tau}}{e^{\im\pi\tau}-e^{-\im\pi\tau}} = \pi\im\frac{q+1}{q-1} = -\pi\im(1+q)(1+q+q^2+\ldots)$.

  So $-\pi\im-2\pi\im\sum_{n\geq 1}q^n = \frac{1}{\tau}+\sum_{n=1}^\infty \left(\frac{1}{\tau-n}+\frac{1}{\tau+n}\right)$. Differentiating $k-1$ times gives:
  \[-2\pi\im\sum_{n\geq 1}(2\pi\im)^{k-1}q^n = (-1)^{k-1}(k-1)! \left[\frac{1}{\tau^k}+\sum_{n=1}^\infty\left(\frac{1}{(\tau-n)^k} + \frac{1}{(\tau+n)^k}\right)\right] = (-1)^{k-1}(k-1)!\sum_{n\in\Z}(\tau+n)^{-k}\]
  Hence, after rearranging, we have:
  \[\sum_{n\in\Z}(\tau+n)^{-k} = \frac{(2\pi\im)^k}{(k-1)!}\sum_{n\geq 1}n^{k-1}q^n\]
  Applying this to $G_k(\tau)$, we have:
  \begin{align*}
    G_k(\tau) = \sum_{(m,n)\in \Z^2\setminus\{0\}}(m\tau+n)^{-k} &= 2\zeta(k) + 2\sum_{m\geq 1}\sum_{n\in\Z}(m\tau+n)^{-k}\\
    &= 2\zeta(k) + 2\frac{(2\pi\im)^k}{(k-1)!}\sum_{m,n\geq 1}n^{k-1}q^{nm}\\
    &=2 \zeta(k) + 2\frac{(2\pi\im)^k}{(k-1)!}\sum_{n\geq 1}\sigma_{k-1}(n)q^n
  \end{align*}
\end{proof}
\begin{corollary}
  $E_k(\tau)$ has $q$-expansion:
  \[E_k(\tau) = 1+\frac{(2\pi\im)^k}{(k-1)!\zeta(k)} \sum_{n\geq 1}\sigma_{k-1}(n)q^n\]
  In particular, the coefficients are rationals, and integers when $k=4$ or $6$, in which case:
  \[E_4(\tau) = 1 + 240\sum_{n\geq 1}\sigma_3(n)q^n; E_6(\tau) = 1-504\sum_{n\geq 1}\sigma_5(n)q^n\]
\end{corollary}
\begin{proof}
  Fact: when $k \in 2\Z_{>0}$, $\pi^k/\zeta(k)$ is a rational number. In particular, $\zeta(4) = \pi^4/90, \zeta(6) = \pi^6/945$. This gives the result.
\end{proof}
\begin{proposition}
  The $q$-expansion of $\Delta$ is $q + \sum_{n\geq 1}a_nq^n$ where $a_n \in \Z$ for all $n \geq 2$. The $q$-expansion of $j$ is $q^{-1} + \sum_{n\geq 0}b_nq^n$ where $b_n \in \Z$ for all $n\geq 0$.
\end{proposition}
\begin{proof}
  Since $j = E_4^3/\Delta$, it's enough to show that $\Delta$ has the claimed properties.

  By definition, $\Delta = (E_4^3 - E_6^2)/1728$. Write $E_4 = 1+240 U, E_6 = 1-504 V$, where $U, V$ are the sum parts of \textbf{1.14}.

  Then, expanding, $\Delta = \frac{5}{12}U + \frac{7}{12}V + P(U,V) = \frac{5}{12}(U-V)+(V+P(U,V))$ where $P \in \Z[U,V]$

  So we need to show that $\sigma_3(n) \equiv \sigma_5(n) \mod 12$ for all $n \in \N$. It would be enough to show that $n^3 \equiv n^5 \mod 3$ and $\mod 4$ for all $n \in \N$, which is true. This shows that $b_n \in \Z \forall n \geq 2$. It remains to show that the leading term of $\Delta$ is $q$. It's $\frac{3\cdot 240 + 2\cdot 504}{1728} = 1$.
\end{proof}
\begin{proposition}
  Let $k \geq 0$ be an even integer. Then there is a basis $f_1, \ldots, f_n$ for the space $S_k(SL_2(\Z))$ such that:
  \begin{enumerate}[label=\alph*)]
    \item If $f_i = \sum_{n\geq 1} a_n (f_i)q^n$, then $a_n(f_i) \in \Z$ for all $n \in \N$, $i=1,\ldots, N$.
    \item We have $a_n(f_i) = \delta_{in}$ if $1 \leq i, n \leq N$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  We can assume $S_k(SL_2(\Z)) \neq 0$. We write $k=12a + d$, where $4 \leq d \leq 14$. We know $\dim_{\C} S_k(SL_2(\Z)) = N = \floor{k/12}$ if $k \neq 2 \mod 12$, otherwise $\floor{k/12}-1$. Hence $a = N$.

  We then write $d = 4A+6B$ for some $A,B \in \Z_{\geq 0}$. We then introduce the modular forms $g_i = \Delta^i E_4^A E_6^B E_6^{2(N-i)}$ for $i =1, \ldots, N$.

  The $g_i$ are modular forms of weight $12i + 4A+6B + 12(N-i) = 12N+d = k$.

  The leading term in the $q$-expansion of $g_i$ is $q^i \cdot 1^A \cdot 1^b \cdot 1^{2(N-i)} = q^i$.

  All the numbers $a_n(g_i)$ for $n \in \N, i=1, \ldots, N$ are integers.

  So we have $g_1 = q + a_2(g_1)q^2 + \ldots$, $g_2 = 0+q^2 + a_3(g_2)q^3+\ldots$, and so on.

  Hence we can perform row reduction over $\Z$ to find modular forms $f_1, \ldots, f_n$ as in the statement of the proposition.
\end{proof}
\section{Hecke Operators and L-functions}
Hecke operators are endomorphisms of $S_k(SL_2(\Z))$ and $M_k(SL_2(\Z))$. They're indexed by $n \in \N$. The exist for rather abstract reasons.
\begin{definition}
  Let $G$ be a group, which may be infinite, and let $H \leq G$ be a subgroup. We say $(G,H)$ is a \emph{Hecke pair} if for all $g \in G$, the set $H\diagdown HgH$ is finite, where $HgH = \{h_1gh_2 : h_1, h_2 \in H\}$, acted on the right by $H$.
\end{definition}
\begin{lemma}
  Let $H \leq G$ be groups. Then if $g \in G$, there is a bijection:
  \[H \cap g^{-1}HG \diagdown H \to H\diagdown HgH\]
  In particular $(G,H)$ is a Hecke pair if and only if, for all $g \in G, [H:H\cap g^{-1}Hg] < \infty$.
\end{lemma}
\begin{proof}
  We first write down the map $H \to H \diagdown HgH$, given by $h \mapsto Hgh$. This map is surjective. We need to show that, if $h_1, h_2 \in H$, then $Hgh_1 = Hgh_2 \iff x \exists x \in H\cap g^{-1}Hg$ such that $h_1=xh_2$.

  But $Hgh_1 = Hgh_2 \iff \exists x \in H$ such that $xgh_1 = gh_2$, i.e. $h_1 = g^{-1}x^{-1}gh_2 \iff \exists y \in H\cap g^{-1}Hg$ such that $h_1 = yh_2$.

  To see this, note that if $h_1 = g^{-1}x^{-1}gh_2$, then $g^{-1}x^{-1}g \in H$, and $gg^{-1}x^{-1}gg^{-1} = x^{-1} \in H$. So if $y = g^{-1}x^{-1}g$, then $y \in H\cap g^{-1}Hg$, and $h_1 = yh_2$. On the other had, if there exists $y \in H\cap g^{-1}Hg$ such that $h_1 = yh_2$, then we can write $y = g^{-1}x^{-1}g$, where $x \in H$, and then $h_1 = g^{-1}x^{-1}gh_2$.
\end{proof}
\begin{definition}
  Let $(G,H)$ be a Hecke pair. Then the Hecke algebra $\mathcal{H}(G,H)$ is defined to be the set of all functions $f:G \to \C$ satisfying the conditions:
  \begin{enumerate}
    \item $\forall g\in G, h_1,h_2 \in H$, we have $f(h_1gh_2) = f(g)$.
    \item $f$ is nonzero on only finitely many elements $H$-double cosets.
  \end{enumerate}
  If $f_1, f_2 \in \mathcal{H}(G,H)$, then we define their product:
  \[(f_1 \cdot f_2)(g) = \sum_{i} f_1(gg_i^{-1})f_2(g_i)\]
  where $g_i$ is any set of representatives for the decomposition $G = \sqcup_i Hg_i$.
\end{definition}
\textbf{Remarks.}
\begin{enumerate}
  \item We can generalise this to the context where $G$ is a locally compact topological group.
  \item There is another natural definition for the product. The one we choose is well-adapted to right actions.
\end{enumerate}
\begin{lemma}
  The multiplication in $\mathcal{H}(G,H)$ is well-defined and associative. Moreover, $[H]$ is the unit element.
\end{lemma}
\textbf{Notation.} If $X \subset G$, then $[X]:G \to G$ is its characteristic function. So if $g \in G$, then $[HgH] \in \mathcal{H}(G,H)$.
\begin{proof}
  By definition, $(f_1\cdot f_2)(g) = \sum_{i}f_1(gg_i^{-1})f_2(g_i)$. We first check that this sum is finite. Note that we can write $f_1(g) = \sum_{x_i}\lambda_i [Hx_i H]$. Since $(G,H)$ is a Hecke pair, we can write $[Hx_iH] = \sum_j [Hy_{ij}]$, hence $f_1 = \sum_{i,j} \lambda_i [Hy_{ij}]$, where the sum is finite.

  Similarly, we can write $f_2 = \sum_{k,\ell}\mu_k [Hz_{k\ell}]$, where the sum is finite.

  So:
  \[(f_1\cdot f_2)(g) = \sum_{i,j,k\ell,r}\lambda_i \mu_k [Hy_{ij}](gg_r^{-1})[Hz_{k\ell}](g_r)\tag{$\ast$}\]
  We see this sum is finite since the non-zero terms have $g_r \in Hz_{k\ell}$, i.e. $Hz_{k\ell} = Hg_r$.

  We next check that $f_1\cdot f_2$ is independent of the choice of $g_i$. Any other choice is given by $h_i g_i$ for some elements $h_i \in H$.

  Then $(f_1\cdot f_2)(g) = \sum_{i} f_1(g(h_ig_i)^{-1})f_2(h_ig_i) = \sum_{i} f_1(gg_i^{-1}h_i^{-1})f_2(h_ig_i) = \sum_i f_1(gg_i^{-1})f_2(g_i)$.

  We next check that $f_1\cdot f_2$ is $H$-biinvariant. If $g \in G$, $h_1,h_2 \in H$, then:
  \[(f_1\cdot f_2)(h_1gh_2) = \sum_i f_1(h_1gh_2g_i^{-1})f_2(g_i) = \sum_i f_1(g(g_ih_2^{-1})^{-1})f_2(g_ih_2^{-1})\]
  Since $G = \sqcup_i Hg_i$, $G = \sqcup_{i} Hg_ih-2^{-1}$, this is equal to $(f_1\cdot f_2)(g)$

  We next check that $f_1\cdot f_2$ is supported on finitely many $H$-double cosets. It is enough to check that $f_1\cdot f_2$ is supported on finitely many right $H$-cosets.

  Using $(\ast)$ , we see that if $(f_1\cdot f_2)(g) \neq 0$, then there are $i,j,k,\ell, r$ such that $g_r \in Hz_{k\ell}$ and $gg_r^{-1}\in Hy_{ij}$, so there are $i,j,k,\ell$ such that $g \in Hy_{ij}Hz_{k\ell}$.

  Since $(G,H)$ is a Hecke pair, $Hy_{ij}Hz_{k\ell}$ is a union of finitely many $H$-right cosets. So we've shown that $f_1\cdot f_2 \in \mathcal{H}(G,H)$.

  We next show associativity. If $f_1, f_2, f_3 \in \mathcal{H}(G,H)$, then:
  \begin{align*}
    (f_1\cdot(f_2\cdot f_3))(g) &= \sum_i f_1(gg_i^{-1})(f_2\cdot f_3)(g_i) = \sum_{i,j} f_1(gg_i^{-1})f_2(g_ig_j^{-1})f_3(g_j)\\
    ((f_1\cdot f_2)\cdot f_3)(g) &= \sum_j (f_1\cdot f_2)(gg_j^{-1})f_3(g_j) = \sum_{i,j} f_1(gg_j^{-1}g_jg_i^{-1})f_2(g_ig_j^{-1})f_3(g_j)
  \end{align*}
  which are equal. Not that $G = \sqcup_i Hg_i \implies G = \sqcup_i Hg_ig_j^{-1}$.

  It remains to show that $[H]$ is the unit in $\mathcal{H}(G,H)$. We need to check just that $[H]\cdot f = f$ forall $f \in \mathcal{H}(G,H)$.
  \[([H]\cdot f)(g) = \sum_{i}[H](gg_i^{-1})f(g_i)\]
  Now note that $[H](gg_i^{-1}) \neq 0 \iff gg_i^{-1} \in H \iff Hg=Hg_i$, so this is equal to $f(g)$.
\end{proof}
\begin{definition}
  Let $V$ be a $\C$-vector space on which $G$ acts on the right by linear maps. The subspace of $H$-invariants is $V^H \coloneqq \{v \in V : \forall h \in H, vh = v\}$.
\end{definition}
\begin{proposition}
  Let $V$ be a $\C$-vector space on which $G$ acts on the right by $\C$-linear maps. Let $(G,H)$ be a Hecke pair. Then $V^H$ is a right $\mathcal{H}(G,H)$-module under the action $v\in V, f\in \mathcal{H}(G,H)$ gives
  \[ v\cdot f = \sum_{i} f(g_i)(v\cdot g_i)\]
  where $G = \bigsqcup_i Hg_i$.
\end{proposition}
\begin{proof}
  We first check $v \cdot f$ is a well defined element of $V$. The sum is finite, as $f(g_i)$ is non-zero for only finitely many elements $g_i$. If we choose different coset representative $h_i g_i$ with $h_i \in H$, then
  \[\sum_i f(h_ig_i)(c \cdot h_i g_i) = \sum_{i} f(g_i)(v\cdot g_i)\]
  as $v \in V^H$.

  We next check that $v\cdot f$ is in $V^H$. If $h \in H$, then:
  \[(v\cdot f)\cdot h = \sum_i f(g_i) vg_i h = \sum_i f(g_i h)vg_i h = v\cdot f\]
  since $g_i h$ is also a transversal of $G$ by $H$.

  We next need to check that, if $v \in V^H$ and $f_1, f_2 \in \mathcal{H}(G,H)$, then $v\cdot(f_1\cdot f_2) = (v\cdot f_1)\cdot f_2$. We compute:
  \begin{align*}
    LHS &= \sum_i (f_1 f_2)(g_i)(v\cdot g_i)\\
    &= \sum_i \sum_j f_1(g_i g_j^{-1})f_2(g_j)(v\cdot g_i)\\
    RHS &= \sum_j f_2(g_j)((v\cdot f_1)\cdot g_j)\\
    &= \sum_j \sum_i f_2(g_j)f_1(g_ig_j^{-1})(v\cdot g_ig_j^{-1}g_j)
  \end{align*}
  using that, for fixed $j$, $g_ig_j^{-1}$ is also a transversal.
\end{proof}
Now fix $k \in \Z$. Let $V_k = \{f:\H \to \C \text{ meromorphic}\}$, equipped with the weight $k$ action of $GL_2(\Q)^+ = GL_2(\Q) \cap GL_2(\R)^+$.
\begin{lemma}
  $(GL_2(\Q)^+, \Gamma(1))$ is a Hecke pair.
\end{lemma}
\begin{proof}
  If $N \in \N$, then we define $\Gamma(N) = \ker(SL_2(\Z)\to SL_2(\Z/N\Z))$. This is a finite index subgroup of $\Gamma(1)$. We need to check that, if $g \in GL_2(\Q)^+$, then $[\Gamma(1):\Gamma(1)\cap g^{-1}\Gamma(1)g]<\infty$.
  Fix $g \in GL_2(\Q)^+$. We can find $N \in \N$ such that $Ng$ and $Ng^{-1} \in M_2(\Z)$. Then:
  \[g\Gamma(N^2)g^{-1} \subset g(1+N^2 M_2(\Z))g^{-1} = 1+(Ng)M_2(\Z)(Ng^{-1}) \subset M_2(\Z)\]
  So $g \Gamma(N^2)g^{-1} \leq \Gamma(1)$, and hence $\Gamma(N^2) \leq g^{-1}\Gamma(1)g \cap \Gamma(1)$.
\end{proof}
Hence $V_k^{\Gamma(1)}$, the space of weakly modular functions of weight $k$ and level $\Gamma(1)$, is a $\mathcal{H}(GL_2(\Q)^+, \Gamma(1))$-module.
\begin{definition}
  For $n \in \N$, write $T_n$ for the endomorphism of $V_k^{\Gamma(1)}$ induced by the element $[X_n] \in \mathcal{H}(GL_2(\Q)^+, \Gamma(1))$, where $X_n = \{g \in M_2(\Z) : \det(g)=n\}$.
\end{definition}
\begin{lemma}
  The set $\Gamma(1)\diagdown X_n$ is finite, and a set of representatives is:
  \[\left\{\begin{pmatrix} a&b\\0& d \end{pmatrix}: a,d \in \N, ad = n, b \in \Z, 0\leq b < d\right\}\]
\end{lemma}
\begin{proof}
  If $\alpha \in X_n$, then $\Z^2 \alpha \leq \Z^2$ of index $\det(\alpha) = n$. There's a map:
  \[\Gamma(1)\diagdown X_n \to L_n \coloneqq \{\Lambda \leq \Z^2 : [\Z^2:\Lambda] = n\}\]
  given by $\alpha \mapsto \Z^2\alpha$. This map factors through the subgroup $\Gamma(1)$. We claim this map is bijective.

  It's surjective, since if $\Lambda \leq \Z^2$ has index $n$, then we can find $u,v \in \Lambda$ such that $\Lambda = \Z u \oplus \Z v$, and then $\Lambda = \Z^2 \alpha$, where $\alpha = \begin{pmatrix} u& u \\v &v \end{pmatrix}$. After possibly swapping $u, v$, we can assume that $\det(\alpha) = n$.

  It's injective since if $\alpha, \beta \in X_n$ and $\Z^2 \alpha = \Z^2 \beta$, then $\Z^2 = \Z^2 \beta \alpha^{-1}$. This forces $\beta \alpha^{-1} = \gamma \in SL_2(\Z)$, and so $\beta \equiv \alpha$ modulo $\Gamma(1)$.

  It remains to find a suitable $\alpha$ for each choice of $\Lambda \leq \Z^2$ of index $n$.

  Take $e_1, e_2$ to be the standard basis of $\Z^2$. Then $\Z e_2 \cap \Lambda \leq \Z e_2$ has finite index, say $d$. Then we have a short exact sequence:
  \[0 \to \Z e_2/(\Z e_2 \cap \Lambda) \to \Z^2/ \Lambda \to \Z^2 / (\Lambda+ \Z e_2) \to 0\]
  Suppose $\Z^2 / (\Lambda + \Z e_2) \cong \Z e_1/\Z e_1\cap(\Lambda + \Z e_2)$ has order $a$. Then $ad = n$.

  Note that $d \in \N$ is the least $d$ such that $d e_2 \in \Lambda$, and $a \in \N$ is the least $a$ such that $a e_1 \in \Lambda + \Z e_2$. $a \in \N$ is the least $a$ such that $a e_1 \in \Lambda + \Z e_2$. Equivalently, the least $a$ such that there exists $b \in \Z$ with $a e_1 + b e_2 \in \Lambda$. We can fix a choice of $b$ by requiring $0 \leq b < d$. There's a unique choice of $b$ with this property since, if $a e_1+  b e_2 \in \Lambda$ and $a e_1 + c e_2 \in \Lambda$ with $c > b$, then $(c-b)e_2 \in \Lambda$ which would be a contradiction if $c-b <d$.

  $\Lambda$ is thus generated by $(a, b)$ and $(0, d)$, and so $\Lambda = \Z^2 \alpha$ where $\alpha = \begin{pmatrix} a & b \\ 0 & d\end{pmatrix}$.
\end{proof}
\begin{proposition}
  Let $n \in \N$ and $f$ be a modular function of weight $k$ and level $SL_2(\Z)$ with $q$-expansion $f(\tau) = \sum_{m\in \Z}a_m q^m$. Then $T_n f$ is also a modular function with $q$-expansion $\sum_{m \in \Z} b_m q^m$, where $b_m = \sum_{a|(m,n)} a^{k-1}a_{mn/a^2}$.
\end{proposition}
\begin{proof}
  By definition, $T_n f = f \cdot [X_n] = \sum_{g \in \Gamma(1)\diagdown X_n} f|_k[g]$. More explicitly:
  \begin{align*}
    (T_n f)(\tau) &= \sum_{ad = n, 0 \leq b<c} f\left(\frac{a\tau+b}{d}\right)d^{-k}n^{k-1}\\
    &= n^{k-1}\sum_{m \in \Z} \sum_{ad = n} a_m \sum_{0 \leq b < d} e^{2\pi\im m\left(\frac{a\tau+b}{d}\right)}\\
    &= n^{k-1}\sum_{m \in \Z}\sum_{ad =n}a_m e^{2\pi\im\left(\frac{am\tau}{d}\right)}\sum_{0\leq b <d}e^{2\pi\im m b/d}
  \end{align*}
  Note that $\sum_{0\leq b <d} e^{2\pi\im mb/d} = \begin{cases} d & d|m \\0 & d\nmid m\end{cases}$. So we have:
  \begin{align*}
    (T_n f)(\tau) &= n^{k-1}\sum_{m\in \Z}\sum_{ad = n, d|m}d^{1-k}a_m e^{2\pi\im a m \tau/d}\\
    &= \sum_{ad = n}a^{k-1}\sum_{m\in\Z}a_{dm}e^{2\pi\im a m \tau}\\
    &= \sum_{m \in \Z}q^m \left(\sum_{a|(m,n)} a_{mn/a^2}a^{k-1}\right)
  \end{align*}
  It remains to show that $T_n f$ is a modular function. We need to check that $\sum_{a|(m,n)}a^{k-1}a_{nm/a^2} = 0$ when $m<0$ and $|m| \gg 0$.

  Call $a_{nm/a^2} = b_m$. Then suppose that there is $r \in \N$ such that $a_m =0$ whenever $m<-r$. If $b_m \neq 0$, then there is $a|(n,m)$ such that $a_{nm/a^2} \neq 0$, so $nm/a^2 \geq -r$, so $m \geq -ra^2/n$. Since $a|n$, we must have $a \leq n$, and hence $m \geq -rn$.
\end{proof}
\begin{corollary}
  $T_n$ preserves the spaces $M_k(SL_2(\Z))$ and $S_k(SL_2(\Z))$.
\end{corollary}
\begin{proof}
  If $f$ is a modular form then $f$ is holomorphic in $\H$ and $a_m = 0$ when $m < 0$. We know:
  \[T_n(f) = \sum_{\substack{ad = n\\0\leq b<d}} f|_k\left[\begin{pmatrix}a&b\\0&d\end{pmatrix}\right]\]
  And this is certainly holomorphic in $\H$.

  We need to check $b_m = 0$ if $m<0$. But $b_m$ is a sum of terms $a^{k-1}a_{mn/a^2}$ which are $0$ is $m<0$.

  If $f$ is also cuspidal, then $a_0 =0$, so $b_0 = \sum_{a|n}a^{k-1}a_0 = \sigma_{k-1}(n)a_0 = 0$.
\end{proof}
\begin{corollary}
  If $f$ is a modular function, then $a_0(T_n f) = \sigma_{k-1}(n)a_0(f)$, and $a_1(T_n f) = a_n(f)$.
\end{corollary}
\begin{lemma}
  Let $(G,H)$ be a Hecke pair. Let $f_1 = \sum_i \lambda_i [Hx_i]$ and $f_2 = \sum_j \mu_j [Hy_j]$ be elements of $\mathcal{H}(G,H)$.

  Then $f_1\cdot f_2 = \sum_{i,j} \lambda_i \mu_j [Hx_iy_j]$.
\end{lemma}
\begin{proof}
  \[(f_1 \cdot f_2)(g) = \sum_k f_1(gg_k^{-1})f_2(g_k) = \sum_{i,j,k} \lambda_i [Hx_i](gg_k^{-1})\mu_j [Hy_j](g_k)\]
  where $G = \bigsqcup_k Hg_k$.

  For each $j$, there is a unique $k(j)$ such that $g_{k(j)} \in Hy_j$. Then write $g_{k(j)} = h_j y_j$.

  Then $(f_1\cdot f_2)(g) = \sum_{i,j}\lambda_i \mu_j [Hx_i](gy_j^{-1}h_j^{-1}) = \sum_{i,j}\lambda_i \mu_j [Hx_i](gy_j^{-1}) = \sum_{i,j}\lambda_i \mu_j[Hx_iy_j](g)$.
\end{proof}
\begin{proposition}
  \begin{enumerate}
    \item If $n,m \in \N$ and $(n,m) =1$, then $T_n \circ T_m = T_{nm}$.
    \item Let $p, n \in \N$ with $p$ prime. Then $T_{p^n}\circ T_p = T_{p^{n+1}} + p^{k-1}T_{p^{n-1}}$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  Let $X_+ = \{g \in M_2(\Z) : \det(g) > 0\} = \bigsqcup_{n \in \N} X_n \subseteq GL_2(\Q)^+$.

  Let $\mathscr{L}_+ = \{\Lambda \subseteq \Z^2 \text{ of finite index}\} = \bigsqcup_{n \in \N} \mathscr{L}_n$.

  Last time we showed there is a bijection $SL_2(\Z)\diagdown X_n \to \mathscr{L}_n$ given by $\alpha \mapsto \Z^2\alpha$

  Hence there's a bijection $SL_2(\Z)\diagdown X_+ \to \mathscr{L}_+$.

  If $f \in \mathcal{H}(GL_2(\Q)^+, SL_2(\Z))$ is supported in $X_+$, then we can identify $f$ with a function $\varphi_f : \mathscr{L}_+ \to \C$ given by $\varphi_f(\Z^2 \alpha) = f(\alpha)$.

  Now fix $n, m \in \N$. We can write $[X_n] = \sum_i [SL_2(\Z)x_i]$ and $[X_m] = \sum_j [SL_2(\Z)y_j]$.

  Then $[X_n][X_m] = \sum_{i,j} [SL_2(\Z)x_iy_j]$.

  For fixed $j$, we have $\Z^2 \geq \Z^2y_j \geq \Z^2 x_iyj$, and the $\Z^2 x_iy_j$ are exactly the subgroups of $\Z^2 y_j$ of index $n$.

  For varying $i$ and $j$, the $\Z^2 x_iy_j$ are exactly the subgroups of $\Z^2$ of index $nm$, each $\Lambda$ appearing with multiplicity
  \[\#\{\Z^2 \geq \Lambda' \geq \Lambda | [\Z^2:\Lambda'] = m \text{ and }[\Lambda':\Lambda] = n\}\]
  When $(n,m) = 1$, each subgroup $\Lambda \leq \Z^2$ of index $nm$ has a unique $\Z^2 \geq \Lambda' \geq \Lambda$ such that $[\Z^2:\Lambda'] = m$ and $[\Lambda':\Lambda] = n$. We find $[X_n]\cdot [X_m] = [X_{nm}]$, hence $T_n\circ T_m = T_{nm}$.

  Now consider $p$ a prime and $n \in \N$. We want to compute $[X_p]\cdot [X_{p^n}] = f$. Then $f$ corresponds to $\varphi_f : \mathscr{L}_{p^{n+1}} \to \C$, given by $\varphi_f(\Lambda) = \#\{\Z^2\geq \Lambda'\geq \Lambda\}$, where $[\Z^2:\Lambda'] = p^n, [\Lambda':\Lambda] = p$.

  We compute $\varphi_f(\Lambda)$.
  \begin{itemize}
    \item[Case 1:] $\Z^2/\Lambda$ is cyclic. Then $\Z^2/\Lambda$ has a unique subgroup of order $p$, so $\varphi_f(\Lambda) = 1$.
    \item[Case 2:] $\Z^2/\Lambda \cong \Z/p^a\Z \oplus \Z/p^b\Z$ where $a,b \geq 1$ and $a+b = n+1$. Equivalently, $\Lambda \leq p\Z^2$. In this case $\Z^2/\Lambda$ has $p+1$ subgroups of order $p$, so $\varphi_f(\Lambda) = p+1$.
  \end{itemize}
  So $\varphi_f:\mathscr{L}_{p^{n+1}}\to \C$ is equal to $1 + p \delta_{\Lambda \leq p\Z^2}$.

  hence $[X_p]\cdot [X_{p^n}] = [X_{p^{n+1}}] + p[pX_{p^{n+1}}]$, and so $T_{p^n}\circ T_p = T_{p^{n+1}} + p \cdot p^{2k-2}\cdot p^{-k} T_{p^{n-1}} = T_{p^{n+1}}+p^{k-1}T_{p^{n-1}}$.
\end{proof}
\begin{corollary}
  \begin{enumerate}
    \item For all primes $p$, $T_{p^n}$ is a polynomial in $T_p$.
    \item For all $n,m \in\N$, $T_n$ and $T_m$ commute.
  \end{enumerate}
\end{corollary}
\begin{proof}
  \begin{enumerate}
    \item By induction on $n$, using the identity for $T_{p^{n+1}}$.
    \item We know that if $n = \prod_i p_i^{a_i}$, then $T_n = \prod_i T_{p_i^{a_i}}$. We also know that $T_{p^a}, T_{q^b}$ commute for any primes $p,q; a,b \in \N$.
  \end{enumerate}
\end{proof}
\begin{proposition}
  Let $k \geq 4$ be even. Then, for all $n \in \N$, $T_n E_k = \sigma_{k-1}(n)E_k$.
\end{proposition}
I.e., the $E_k$ are eigenvectors for the linear operators $T_n$, with eigenvalues $\sigma_{k-1}(n)$.

This has the consequence that, if we want to diagonalise the actions of $T_n$ on $M_k$, it's enough to diagonalise the actions of $T_n$ on $S_k$, because of the decomposition $M_K(SL_2(\Z)) = S_k(SL_2(\Z)) \oplus \C E_k$.
\begin{proof}
  To show $E_k$ is an eigenvector of $T_n$, it's enough to show it's an eigenvector of the $T_p$ where $p$ ranges over the primes.

  The eigenvalue is found to be $\sigma_{k-1}(n)$ be the identity $a_0(T_n E_k) = \sigma_{k-1}(n)a_0(E_k)$ (and $a_0(E_k) \neq 0$).

  Let $p$ be prime. We'll show $G_k$ is an eigenvector of $T_p$.
  \[(T_pG_k)(\tau) = \sum_{\substack{ad = p\\ 0\leq b < d}} G_k|_k\left[\begin{pmatrix}a&b\\0&d\end{pmatrix}\right] = \sum_{\substack{ad = p\\ 0\leq b < d}}\sum_{\substack{\omega \in \Lambda_{(a\tau+b)/d}\\ \omega \neq 0}}\omega^{-k}p^{k-1}d^{-k}\]
  where $\Lambda_\tau = \Z\tau \oplus \Z$.

  Note $\Lambda_{(a\tau+b)/d} \frac{1}{d}(\Z(a\tau+b)\oplus d\Z)$. These $\Z(a\tau+b)\oplus d\Z$ are precisely the subgroups of $\Lambda_\tau$ of index $p$, and hence:
  \[(T_p G_k)(\tau) = \sum_{\substack{ad = p\\ 0\leq b < d}} p^{k-1} \sum_{\substack{\omega \in \Lambda_{(a\tau+b)/d}\\\omega \neq 0}} (d\omega)^{-k} = \sum_{\substack{\Lambda' \leq \Lambda_\tau \\ [\Lambda_\tau:\Lambda']=p }} p^{k-1} \sum_{\omega \in \Lambda'\setminus\{0\}} \omega^{-k}\]

  Think of some $\omega \in \Lambda_\tau \setminus \{0\}$. How many $\Lambda' \leq \Lambda_\tau$ of index $p$ contain $\omega$?
  \begin{enumerate}
    \item[Case 1] $\omega \notin p\Lambda_\tau$. Then $\Lambda' = \Z_\omega +p\Lambda_\tau$ is the unique such subgroup.
    \item[Case 2] $\omega \in p\Lambda_\tau$. Then every such $\Lambda'\leq \Lambda_\tau$ contains $\omega$.
  \end{enumerate}
  Hence:
  \begin{align*}
    (T_pG_k)(\tau) &= p^{k-1}\left[\sum_{\omega \in \Lambda_\tau\setminus\{0\}} \omega^{-k} + \sum_{\omega \in p\Lambda_\tau \setminus\{0\}} p\omega^{-k} \right] \\
    &= p^{k-1}\left[G_k(\tau) + \sum_{\omega \in \Lambda_\tau \setminus\{0\}} p(p\omega)^{-k}\right]\\
    &= (1+p^{k-1})G_k(\tau)\\
    &= \sigma_{k-1}(p)G_k(\tau)
  \end{align*}
\end{proof}
Our focus now is on $S_k(SL_2(\Z))$.
\begin{lemma}\hspace*{0cm}
  \begin{enumerate}
    \item $\frac{dxdy}{y^2}$ where $\tau = x+\im y$ is a $GL_2(\R)^+$-invariant area form.
    \item If $f, g: \H \to \C$ are smooth and invariant under the weight $k$ action of a subgroup $G \leq GL_2(\R)^+$, then $\omega(f,g) = f(\tau)\overline{g(\tau)}y^k \frac{dydx}{y^2}$ satisfies $\alpha^{\ast}\omega(f,g) = \det(\alpha)^{2-k}\omega(f,g)$ for all $\alpha \in G$.
  \end{enumerate}
\end{lemma}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item $\tau = x+\im y, d\tau = dx+\im dy, d \bar{\tau} = dx-\im dy$, so $d\tau d\bar{\tau} = -2\im dxdy$

    If $g = \begin{pmatrix}a&b\\c&d \end{pmatrix} \in GL_2(\R)^+$, then
    \[g^\ast (d\tau) = d\frac{a\tau+b}{c\tau+d} = \frac{a(c\tau+d)-c(a\tau+d)}{(c\tau+d)^2}d\tau = \frac{\det(g)}{j(g\tau)^2}d\tau\]
    Hence $g^{\ast}\left(\frac{d\tau d\bar{\tau}}{y^2}\right) = \frac{\det(g)^2 d\tau d\bar{\tau}}{|j(g,\tau)^4|} = \left(\frac{\det(g) y}{|j(g\tau)|^2}\right)^{-2} = \frac{d\tau d\bar{\tau}}{y^2}$.
    \item Take $\alpha = \begin{pmatrix}a&b\\c&d \end{pmatrix} \in G$. Then $\alpha^\ast \omega(f,g) = f(\alpha \tau)\overline{g(\alpha\tau)}\Im(\alpha \tau)^k \frac{dxdy}{y^2}$.

    We know $f(\alpha \tau)j(\alpha, \tau)^{-k}\det(\alpha)^{k-1} = f(\tau)$, and similarly for $g$, so
    \[\alpha^{\ast}\omega(f,g) = \det(\alpha)^{2-k}\omega(f,g)\]
  \end{enumerate}
\end{proof}
So if $f, g$ are invariant under the weight $k$ action of $\Gamma(1)$, we have a $\Gamma(1)$-invariant area form $\omega(f,g)$.
\begin{definition}
  If $\varphi:\H \to \C$ is a $\Gamma(1)$-invariant function, then:
  \[\int_{\Gamma(1)\diagdown \H}\varphi \frac{dxdy}{y^2} = \int_{\mathscr{F}} \varphi \frac{dxdy}{y^2}\]
  when this integral is absolutely convergent.
\end{definition}
\begin{definition}
  Let $f, g\in S_k(\Gamma(1))$. Then we define
  \[\angle{f, g} = \int_{\Gamma(1)\diagdown \H} \omega(f,g)\]
\end{definition}
\begin{lemma}
  For any $f, g \in S_k(\Gamma(1))$, then integral defining $\angle{f,g}$ is absolutely convergent. This defines an inner product on the $\C$-vector space $S_k(\Gamma(1))$.
\end{lemma}
\begin{proof}
  It's enough to show that
  \begin{enumerate}
    \item $\int_{\Gamma(1)\diagdown \H} \frac{dxdy}{y^2} < \infty$
    \item If $f \in S_k(\Gamma(1))$, then $|f(\tau)|y^{k/2}$ is bounded in $\mathscr{F}$.
  \end{enumerate}
  To show (1), we observe that $\mathscr{F} \subseteq \{\tau \in \H: -\frac12 \leq \Re \tau \leq \frac12, \Im \tau \geq \frac12\}$, so:
  \[\int_{\Gamma(1)\diagdown \H}\frac{dxdy}{y^2} \leq \int_{x=-\frac12}^\frac12 \int_{y=\frac12}^\infty \frac{dxdy}{y^2} < \infty\]

  To show (2), we observe that $|f(\tau)|y^{k/2} \leq \sum_{n\geq 1}|a_n|e^{-2\pi ny}y^{k/2} \to 0$ as $y \to \infty$.

  Note - here we're using that $f$ is cuspidal. Then we have:
  \[\omega(f,g) = f(\tau)y^{k/2} \overline{g(\tau)}y^{k/2} \frac{dxdy}{y^2} \implies \angle{f,g} \text{ is absolutely convergent}\]
  If $\angle{f,f} = 0$, then $\int_{\Gamma(1)\diagdown \H}|f(\tau)|^2 y^k \frac{dxdy}{y^2} = 0 \implies f \equiv 0$, and so $\angle{\cdot,\cdot}$ is an inner product.
\end{proof}
\begin{definition}
  Suppose that $\Gamma \leq \Gamma(1)$ is a subgroup of finite index. Let $\varphi: \H \to \C$ be a smooth function, invariant under translation by $\Gamma$. Then we define
  \[\int_{\Gamma \diagdown \H} \varphi \frac{dxdy}{y^2} = \int_{\Gamma(1)\diagdown \H} \sum_{\gamma \in \Gamma \diagdown \Gamma(1)}(\varphi \circ \gamma)\frac{dxdy}{y^2}\]
\end{definition}
\begin{definition}
  Suppose $\Gamma \leq \Gamma(1)$ is a subgroup of $\Gamma(1)$ of finite index and let $f, g:\H \to \C$ be invariant under the weight $k$ action of $\Gamma$. Then we define
  \[\angle{f,g} = [\Gamma(1):\Gamma]^{-1} \int_{\Gamma \diagdown \H}\omega(f,g) = [\Gamma(1):\Gamma]\int_{\Gamma \diagdown \H}f \bar{g}y^{k}\frac{dxdy}{y^2}\]
  when this integral is absolutely convergent.
\end{definition}
\textbf{Remarks.}
\begin{enumerate}
  \item If $\Gamma' \leq \Gamma \leq \Gamma(1)$ is another finite index subgroup, then $\angle{f, g}$ defined using $\Gamma$ is the same as $\angle{f,g}$ defined using $\Gamma'$.
  \item If $f:\H \to \C$ is invariant under the weight $k$ action of $\Gamma(1)$, and $\alpha \in GL_2(\Q)^+$, then $f|_k(\alpha)$ is invariant under the weight $k$ action of the group $\alpha^{-1}\Gamma(1)\alpha \cap \Gamma(1)$, which has finite index in $\Gamma(1)$.
\end{enumerate}
\begin{proposition}
  Let $f, g:\H \to \C$ be smooth functions which are invariant under the weight $k$ action of $\Gamma(1)$. Then we have:
  \[\angle{f|_k[\alpha], g|_k[\alpha]} = \det(\alpha)^{k-2}\angle{f,g}\]
  whenever both sides of this equality are defined.
\end{proposition}
\begin{proof}
  \begin{align*}
    \angle{f|_k[\alpha], g|_k[\alpha]} &= \int_{\alpha^{-1}\Gamma(1)\alpha \cap \Gamma(1)\diagdown \H}f(\alpha\tau)j(\alpha,\tau)^{-k}\det(\alpha)^{k-1}\overline{g(\alpha\tau)j(\alpha,\tau)^{-k}}\det(\alpha)^{k-1}y^k \frac{dxdy}{y^2}\\
    &=\int_{\alpha^{-1}\Gamma(1)\alpha \cap \Gamma(1)\diagdown \H} f(\alpha\tau)g(\alpha\tau)|j(\alpha,\tau)|^{-2k}\det(\alpha)^{2k-2}y^k\frac{dxdy}{y^2}\\
  \end{align*}
  We have a bijection $\alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)\diagdown \H \xrightarrow{\alpha^{-1}} \Gamma(1)\cap\alpha^{-1}\Gamma(1)\alpha \diagdown \H$, as if $\gamma \in \alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)$ and $\tau \in \H$, then $\alpha^{-1}(\gamma\cdot \tau) = (\alpha^{-1}\gamma \alpha)\cdot(\alpha^{-1}\tau)$.

  So we may make a change of variables in the integral to get:
  \begin{align*}
    &=\int_{\alpha\Gamma(1)\alpha^{-1} \cap \Gamma(1)\diagdown \H}f(\tau)\overline{g(\tau)}|j(\alpha,\alpha^{-1}\tau)|^{-2k}\det(\alpha)^{2k-2}\Im(\alpha^{-1}\tau)^k \frac{dxdy}{y^2}\\
    &=\int_{\alpha\Gamma(1)\alpha^{-1} \cap \Gamma(1)\diagdown \H}f(\tau)\overline{g(\tau)}|j(\alpha,\alpha^{-1}\tau)|^{-2k}\det(\alpha)^{2k-2} \frac{\det(\alpha)^{-k}\Im(\tau)}{|j(\alpha^{-1}, \tau)|^{2k}}\frac{dxdy}{y^2}
  \end{align*}
  Note if $\alpha, \beta \in GL_2(\R)^+$, then $j(\alpha\beta, \tau) = j(\beta,\tau)j(\alpha,\beta\tau)$.
  \begin{align*}
    &= \int_{\alpha\Gamma(1)\alpha^{-1} \cap \Gamma(1)\diagdown \H}f(\tau)\overline{g(\tau)}\det(\alpha)^{k-2}\Im(\tau)\frac{dxdy}{y^2}\\
    &= \frac{\angle{f,g}\det(\alpha)^{k-2}}{[\Gamma(1):\alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)]^{-1}}
  \end{align*}
  The only thing left to do is to show that $[\Gamma(1):\Gamma(1)\cap\alpha^{-1}\Gamma(1)\alpha] = [\Gamma(1):\alpha\Gamma(1)\alpha^{-1}\cap\Gamma(1)]$.

  This is true since there is a bijective map  $\alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)\diagdown \H \xrightarrow{\alpha^{-1}} \Gamma(1)\cap\alpha^{-1}\Gamma(1)\alpha \diagdown \H$ which pulls $\frac{dxdy}{y^2}$ to $\frac{dxdy}{y^2}$.

  Hence
  \begin{align*}
    \int_{\Gamma(1)\diagdown \H} \frac{dxdy}{y^2} &= [\Gamma(1): \Gamma(1)\cap \alpha^{-1}\Gamma(1)\alpha] \int_{\Gamma(1)\cap \alpha^{-1}\Gamma(1)\alpha \diagdown \H}\frac{dxdy}{y^2}\\
    &= [\Gamma(1):\Gamma(1)\cap \alpha^{-1}\Gamma(1)\alpha]^{-1}\int_{\alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)\diagdown \H}\frac{dxdy}{y^2}\\
    &= \frac{[\Gamma(1):\Gamma(1)\cap \alpha\Gamma(1)\alpha^{-1}]}{[\Gamma(1):\Gamma(1)\cap \alpha^{-1}\Gamma(1)\alpha]}\int_{\alpha\Gamma(1)\alpha^{-1}\cap \Gamma(1)\diagdown \H}\frac{dxdy}{y^2}
  \end{align*}
  And since the integral is nonzero, we are done.
\end{proof}
\begin{proposition}
  For all $n \in \N$, the Hecke operator $T_n$ on $S_k(\Gamma(1))$ is self-adjoint with respect to the inner product $\angle{\cdot,\cdot}$.
\end{proposition}
\begin{proof}
  We need to show that, for all $f, g \in S_k(\Gamma(1))$, $\angle{T_n f,g} = \angle{f, T_n g}$. It's enough to do this for prime $n = p$.

  We claim we can find matrices $x_i \in X_p$ such that $X_p = \bigsqcup_i \Gamma(1)x_i = \bigsqcup_i \Gamma(1)px_i^{-1}$.

  Indeed, note that the adjugate map $\text{Adj}:X_p \to X_p$ is a bijection, as it preserves determinant. First choose representatives $a_i, b_i$ so that $X_p = \bigsqcup_i \Gamma(1)a_i = \bigsqcup_i b_i\Gamma(1)$.

  Since every matrix in $X_p$ has Smith normal form $\begin{pmatrix} p & 0 \\ 0 & 1 \end{pmatrix}$, so $X_p$ consists of a single $\Gamma(1)$-double coset.

  So we can choose $u_i, v_i \in \Gamma(1)$ such that $a_i a_i = b_i v_i = x_i$. Then $X_p = \bigsqcup_i \Gamma(1)x_i = \bigsqcup_i x_i \Gamma(1)$. Also $X_p = \text{Adj}(X_p) = \bigsqcup_i \gamma(1)p x_i^{-1}$.

  We then compute
  \begin{align*}
    \angle{T_p f, g} &= \angle{\sum_i f|_k[x_i], g} \\
    &= \sum_i \angle{f|_k[x_i],g} \\
    &= \sum_i \angle{f|_k[x_i]|_k[x_i^{-1}], g|_k [x_i^{-1}]} \\
    &= \sum_i \angle{f, g|_{k}[x_i^{-1}]}p^{k-2} \\
    &= \angle{f, \sum_i g|_k[px_i^{-1}]}\\
    &= \angle{f, T_p g}
  \end{align*}
\end{proof}
\begin{corollary}
  The operators $T_n$ on $S_k(\Gamma(1))$ can be simultaneously diagonalised. Their eigenvalues are real numbers.
\end{corollary}
\begin{proof}
  $T_n$ self-adjoint implies that $T_n$ are diagonalisable with real eigenvalues, and since they commute, they can be simultaneously diagonalised.
\end{proof}
\begin{definition}
  We say that $f \in M_k(\Gamma(1))$ is a normalised eigenform if $f$ is an eigenvector for all Hecke operators $T_n$ and $a_1(f) = 1$.
\end{definition}
\begin{lemma}
  If $f \in M_k(SL_2(\Z))$, then if $f$ is an eigenvector for all Hecke operators $T_n$ and $k > 0$, then there's a unique scalar multiple of $f$ which is a normalised eigenform.
\end{lemma}
\begin{proof}
  We have $a_n(f) = a_1(T_n(f))$. If $a_1(f) = 0$ and $T_n$ has eigenvalue $\alpha_n$ on $f$, then $a_n(f) = a_1(T_n(f)) = \alpha_n(a_1(f)) =0$, so $a_n(f) = 0$ for all $n \in \N$. Therefore $a_1(f) \neq 0$, and $f/a_1(f)$ is a normalised eigenform.
\end{proof}
We've seen $G_k(\tau) =2\zeta(k) + \frac{2(2\pi\im)^k}{(k-1)!}\sum_{n\geq 1}\sigma_{k-1}(n)q^n$ is an eigenvector for all Hecke generators $T_n$. The corresponding normalised eigenform is
\[\frac{(k-1)!G_k(\tau)}{2(2\pi\im)^k} = \frac{(k-1)!\zeta(k)}{(2\pi\im)^k} + \sum_{n\geq 1}\sigma_{k-1}(n)q^n\]
\begin{proposition}
  The eigenvalues of $T_n$ on $M_k(SL_2(\Z))$ are algebraic integers lying in a number field independent of $n$.
\end{proposition}
\begin{proof}
  We proved earlier that there's a basis $f_1, \ldots, f_N$ for $S_k(SL_2(|Z))$ such that
  \begin{enumerate}
    \item $\forall n \in \N, a_n(f_i)\in \Z$
    \item $a_j(f_i) =\delta_{ij}$
  \end{enumerate}
  Consequently, for any $f \in S_k(SL_2(\Z))$, we have $f=\sum_{i=1}^N a_i(f)f_i$.

  Now consider the matrix of $T_n$ with respect to this basis. We have $a_m(T_n f) = \sum_{a|(m,n)}a^{k-1}a_{mn/a^2}(f)$. So $T_n(f)$ has integer $q$-expansion coefficients if $f$ does. We see that the matrix of $T_n$ with respect to the basis $f_1, \ldots, f_N$ has integer entries. Hence the eigenvalues of $T_n$ are algebraic integers.

  If $f$ is a normalised eigenform, then $f = \sum_{i=1}^N a_i(f)f_i$, so the eigenvalues of $T_n$ on $f$ lie in the field generated by $a_1(f),\ldots, a_N(f)$.
\end{proof}
To any weight $k$, we can associate the sequences $(a_1(f_i), a_2(f_i), \ldots)$ of Hecke eigenvalues. Since the operators $T_n$ are polynomials in the $T_p$ for $p$ prime, it's equivalent to give the sequences $(a_p(f_i))_p$.

First examples arise when $S_k(SL_2(\Z))$ is 1-dimensional - this happens when $k=12,16,18,20,22,26$. When $k=12, \Delta$ is a normalised eigenform. Ramanujan proved that:
\[\Delta = q \prod_{n\geq 1}(1-q^n)^{24} = \sum_{n\geq 1}\tau(n) q^n\]
He conjectured that $\tau(nm) = \tau(n)\tau(m)$ whenever $n,m$ are coprime, and if $p$ is prime, then $\tau(p)\tau(p^n) = \tau(p^{n+1}) + p^{11}\tau(p^{n-1})$. These relations follow from $T_{nm} = T_nT_m$ and $T_p T_{p^n} = T_{p^{n+1}}+p^{k-1}T_{p^{n-1}}$.

In the case $k=24, \dim_{\C}S_k(SL_2(\Z)) > 1$. We know we can find a basis $g_1, g_2$ for $S_{24}(SL_2(\Z))$ such that $g_1 = q + O(q^3), g_2 = q^2 + O(q^3)$. Let's compute the matrix of $T_2$ with respect to this basis. We know $T_2(\sum_{n\geq 1}a_nq^n) = \sum_{n\geq 1}\left(\sum_{a|(2,n)}a^{k-1}a_{2n/a^2}\right)q^n$. In particular, $a_1(T_2(f)) = a_2(f)$, and $a_2(T_2(f)) = a_4(f) + 2^{23}a_1(f)$. So $T_2(f) = a_2(f)g_1 + (a_4(f)+2^{23}a_1(f))g_2$.

After a computation, we see that matrix of $T_2$ with respect to our chosen basis is $\begin{pmatrix} 0 & 1 \\ 20468736 & 1080 \end{pmatrix}$, which has eigenvalues $12(45 \pm \sqrt{144169})$. All of the eigenvalues of $T_n$ on $S_{24}(SL_2(\Z))$ will lie in $\Q(\sqrt{144169})$.

\begin{lemma}
  Let $p$ be a prime number. Then we have an identity of formal power series:
  \[1+\sum_{n\geq 1} \tau(p^n)X^n = (1-\tau(p)X+p^{11}X^2)^{-1}\]
\end{lemma}
\begin{proof}
  \begin{align*}
    \left(\sum_{\geq 0}\tau(p^n)X^n\right)(1-\tau(p) X + p^{11}X^2) &= 1+ \sum_{n \geq 1} \left(\tau(p^{n+2}) - \tau(p)\tau(p^{n+1})+p^{11} \tau(p^n)\right)X^{n+2}
  \end{align*}
  But we know $\tau(p)\tau(p^{n+1}) = \tau(p^{n+2}) + p^{11}\tau(p^n)$.
\end{proof}
We can write this generating function as $\frac{1}{(1-\alpha_p X)(1-\beta_p X)}$ where $\alpha_p, \beta_p$ are the roots of the polynomial $1-\tau(p)X + p^{11}X^2$, so $\alpha_p, \beta_p = \frac{-\tau(p)\pm \sqrt{\tau(p)^2-4p^{11}}}{2p^{11}}$.

There are two possibilities: $\tau(p^{2}) - 4p^{11} \leq 0$, in which case $\alpha_p, \beta_p$ are complex conjugates of absolute value $p^{11/2}$, or $\tau(p^2) > 4p^{11}$, and $\alpha_p, \beta_p$ are real numbers of distinct absolute values. Ramanujan conjectured that the first case always holds.
\begin{conjecture}[Ramanujan-Peterson]
  Let $f$ be a cuspidal normalised eigenform of weight $k$ and level $SL_2(\Z)$. Then for every prime $p$, we have $|a_p(f)| \leq 2p^{(k-1)/2}$.
\end{conjecture}
This conjecture is behind many applications of modular forms to number theory. Later in the course we'll prove the formula
\[r_{24}(p) = \frac{16}{691}\sigma_{11}(p) + \frac{33152}{691}\tau(p)\]
where $p$ is an odd prime and $r_{24}(n)$ is the number of ways of writing $n$ as a sum of 24 integer squares.

The Ramanujan-Peterson gives the estimate $r_{24}(p) = \frac{16}{691}p^{11} + O(p^{11/2})$.

Another reason for the importance of Hecke operators is the possibility of constructing $L$-functions. First recall the Riemann zeta function $\zeta(s) = \sum_{n\geq 1} n^{-s}$. It has the following properties:
\begin{enumerate}
  \item (Euler Product) $\zeta(s) = \prod_p (1-p^{-s})^{-1}$.
  \item (Analytic Continuation) $\zeta(s)$ has a meromorphic continuation to all of $\C$ with a simple pole at $s=1$ and no other poles.
  \item (Functional Equation) Let $\xi(s) = \pi^{-s/2}\Gamma(s/2)\zeta(s)$. Then $\xi(s) = \xi(1-s)$.
  \item (Special Values) The values of $\zeta(s)$ at integers should be related to arithmetic in some way.
\end{enumerate}
Recall: $\Gamma(s) = \int_{y=0}^\infty e^{-y}y^s \frac{dy}{y}$. This integral converges absolutely and uniformly in compact subsets of the right half plane $\Re(s) > 0$. Integration by parts gives $s\Gamma(s) = \Gamma(s+1)$, and so $\Gamma(s)$ can be continued meromorphically to $\C$.

A Dirichlet series $\sum_{n \geq 1}a_n n^{-s}$ with properties similar to 1,2,3 is called an \emph{L-function}. Further examples are given by the Dirichlet L-function $L(\chi, s) = \sum_{n\geq 1, (n,N)=1} \chi(n \mod N)n^{-s}$ where $\chi : (\Z/N\Z)^\times \to \C$ is a character.

\begin{definition}
  Let $f \in M_k(SL_2(\Z))$ be a non-zero modular form and let its $q$-expansion be $f(\tau) = \sum_{n\geq 0}a_n q^{n}$. The associated L-function is $L(f,s) = \sum_{n\geq 1} a_nn^{-s}$.
\end{definition}
For example, when $f$ is the normalised eigenform associated to $G_k$, we have $L(f,s) = \sum_{n\geq 1} \sigma_{k-1}(n)n^{-s} = \sum_{n,m \geq 1}m^{k-1}(mn)^{-s} = \zeta(s)\zeta(s+1-k)$.

In this case, there is a functional equation relating $L(f,s)$ and $L(f,k-s)$.

\begin{lemma}
  Let $f \in S_k(SL_2(\Z))$ be non-zero. Then $L(f,s)$ converges absolutely on the region $\Re(s) > k/2 + 1$.
\end{lemma}
\begin{proof}
  On the example sheet, we show $|a_n(f)| = O(n^{k/2})$, from which we have absolute convergence.
\end{proof}
\begin{theorem}
  Let $f \in S_k(SL_2(\Z))$ be a non-zero cuspidal modular form. Then:
  \begin{enumerate}
    \item $L(f,s)$ has an analytic continuation to $\C$.
    \item Let $\Lambda(f,s) = (2\pi)^{-s}\Gamma(s)L(f,s)$. Then $\Lambda(f,s)$ admits an analytic continuation to $\C$ and satisfies $\Lambda(f,s) = \im^k \Lambda(f, k-s)$.
  \end{enumerate}
\end{theorem}
\begin{proof}
  We define $F(s) = \int_0^\infty f(\im y) y^s \frac{dy}{y}$, the Mellin transform of $f(\im y)$. The function $F(s)$ converges absolutely in $\C$ and defines a holomorphic function there. We know that $|f(\im y)| = O(e^{-2\pi y})$ as $y \to \infty$. This shows that $\int_1^\infty f(\im y) y^s dy/y$ has the desired properties.

  We know $f(-1/\tau)\tau^{-k} = f(\tau)$ and hence $f(\im y) = f(\im/y)(\im y)^{-k}$. This shows that $|f(\im/y)| = |f(\im y) (\im y)^{k}| = O(e^{-\pi y})$ as $y \to \infty$, and so $\int_0^1 f(\im y) y^s  dy/y$ has the required properties.

  Formally, we can compute:
  \begin{align*}
    F(s) &= \int_0^\infty a_n e^{-2\pi n y} y^s dy/y\\
    &= \sum_{n \geq 1} a_n \int_{0}^\infty e^{-2\pi n y}y^s dy/y\\
    &= \sum_{n \geq 1} a_n \int_0^\infty e^{-y}\left(\frac{y}{2\pi n}\right)^s dy/y\\
    &= \sum_{n \geq 1} a_n n^{-s} \Gamma(s) (2\pi)^{-s}\\
    &= (2\pi)^{-s}\Gamma(s) L(f,s)\\
    &= \Lambda(f,s)
  \end{align*}
  The absolute convergence of $L(f,s)$ in the region $\Re(s) > k/2 + 1$ implies that this computation is valid in the same region.

  To get the functional equation, we compute:
  \begin{align*}
    \Lambda(f,s) &= \int_0^1 f(\im y) y^s dy/y + \int_1^\infty f(\im y)y^s dy/y\\
    &= \int_0^1 f(\im/y) (\im y)^{-k} y^s dy/y + \int_1^\infty f(\im y)y^s dy/y\\
    &= \int_1^\infty f(\im y) i^k y^{k-s} dy/y + \int_1^\infty f(\im y) y^s dy/y
  \end{align*}
  and hence $\Lambda(f,s) = \im ^k \Lambda(f, k-s)$.
\end{proof}
\begin{theorem}
  Let $f \in S_k(SL_2(\Z))$ be a normalised eigenform. Then $L(f,s)$ has the Euler product \[L(f,s) = \prod_p (1-a_p(f)p^{-s} + p^{k-1-2s})^{-1}\]
\end{theorem}
\begin{proof}
  We know $a_{nm}(f) +a_n(f)a_m(f)$ when $n,m$ coprime. Hence $\sum_{n\geq 1} a_n(f) n^{-s} = \prod_p \sum_{k \geq 0} a_{p^k}(f)p^{-ks}$.

  We need to show that $\sum_{k \geq 1} a_{p^k}(f) p^{-ks} = (1-a_p(f)+p^{k-1-2s})^{-1}$. We saw last time that this follows from the relation for $T_p T_{p^k}$.
\end{proof}
Now, given $f \in S_k(SL_2(\Z))$ a normalised eigenform, we factor, for each prime $p$:
\[(1-a_pX + p^{k-1}X^2) = (1-\alpha_p X)(1-\beta_p X)\]
\begin{definition}
  For each $m \geq 1$, we define the associated symmetric power $L$-function
  \[L(Sym^m, f,s) =  \prod_p \prod_{i=0}^m (1-\alpha_p^i \beta_p^{m-i} p^{-s})^{-1}\]
\end{definition}
\begin{lemma}
  $L(Sym^m,f,s)$ converges in some right half-plane.
\end{lemma}
\begin{proof}
  We saw in the previous lecture that $|a_p(f)| = O(p^{k/2})$.

  This implies that $|\alpha_p|, |\beta_p| = O(p^{k/2})$, and hence $|\alpha_p^i \beta_p^{m-i}| = O(p^{mk/2})$. It follows that $\prod_p (1-\alpha_p^i\beta_p^{m-i}p^{-s})^{-1}$ is absolutely convergent in some right half-plane.

  We thus deduce that $L(Sym^m, f,s)$ has the same property.
\end{proof}

These $L$-functions were first considered in the 1960s by Langlands and Serre. The idea was to associate to each prime $p$ the conjugacy class of the matrix $t_p = \begin{pmatrix} \alpha_p & 0 \\ 0 & \beta_p \end{pmatrix}$.

Then associate to any algebraic representation $R: GL_2(\C) \to GL_N(\C)$ the $L$-function $L(R,f,s) = \prod_p \det(1-R(t_p)p^{-s})^{-1}$. The irreducible representatives of $GL_2$ are the symmetric powers $Sym^m :GL_2(\C) \to GL_{m+1}(\C)$ of the identity representations (up to a twist).
\begin{conjecture}
  For all $m \geq 1$, $L(Sym^m, f,s)$ has an analytic continuation and satisfies a functional equation $\Lambda(Sym^m, f,s) = \Lambda(Sym^m, f, m(k-1)+1-s)$, where $\Lambda$ is an explicit completed $L$-function.
\end{conjecture}
\begin{proposition}[Langlands]
  If, for all $m \geq 1, L(Sym^m, f,s)$ has an analytic continuation to $\C$, then the Ramanujan-Peterson conjecture holds for $f$.
\end{proposition}
The idea behind this proposition made another appearance in the proof of the Weil conjectures by Deligne.
\begin{conjecture}[Sato-Tate]
  Suppose the Ramanujan-Peterson conjecture holds, so $|a_p(f)| \leq 2p^{(k-1)/2}$, and so $a_p/(2p^{(k-1)/2}) \in [-1,1]$. Then these numbers are equidistributed throughout $[-1,1]$ as $p \to \infty$ with respect to the Sato-Tate measure $\frac{2}{\pi}\sqrt{1-t^2}dt$.

  More precisely, for all continuous functions $g:[-1,1]\to \R$,
  \[\lim_{X\to \infty}\frac{1}{\pi(X)}\sum_{p < X} g(a_p/(2p^{(k-1)/2})) \to \frac{2}{\pi}\int_{-1}^1 g(t)\sqrt{1-t^2}dt\]
  where $\pi(x)$ is the prime counting function.

  This has the consequence that the Ramanujan-Peterson conjecture is sharp.
\end{conjecture}
\begin{proposition}[Serre]
  Suppose for all $m \geq 1$, $L(Sym^m,f,s)$ has an analytic continuation to $\C$ which is non-vanishing on the line $\Re(s) = 1+m\frac{k-1}{2}$. Then the Sato-Tate conjecture holds for $f$.
\end{proposition}
Recall the formula for an odd prime $p$: $r_{24}(p) = \frac{16}{691}(1+p^{11})+\frac{33152}{691}\tau(p)$.

The Sato-Tate conjecture implies that the normalised error terms
\[(r_{24}(p) - \frac{16}{691}(1+p^{11})\times \frac{691}{33152 \times 2 \times p^{11/2}} \in [-1,1]\]
are equidistributed.

The Sato-Tate conjecture was proved in 2010 by Barnet-Lamb, Geraghty, Harris, and Taylor. The complete analytic continuation of $L(Sym^m, f,s)$ was established in 2019 by Newton and Thorne.

The next step is to study modular forms $M_k(\Gamma), S_k(\Gamma)$ where $\Gamma$ is any congruence subgroup of $SL_2(\Z)$.


\section{Modular Forms on Congruence Subgroups of \(SL_2(\Z)\)}
\begin{definition}
  For all $N \in \N$, we define $\Gamma(N) = \ker(SL_2(\Z) \to SL_2(\Z/N\Z))$.

  A \emph{congruence subgroup} $\Gamma \leq SL_2(\Z)$ is any subgroup containing $\Gamma(N)$ for some $N \in \N$.
\end{definition}
Important examples:
\begin{itemize}
  \item $\Gamma_0(N) = \{\begin{pmatrix} a&b\\c&d\end{pmatrix} \in SL_2(\Z): c \equiv 0 \mod N\}$
  \item $\Gamma_1(N) = \{\begin{pmatrix} a&b\\c&d\end{pmatrix} \in SL_2(\Z): c \equiv 0, a \equiv 1 \mod N\}$
\end{itemize}
The homomorphism $SL_2(\Z) \to SL_2(\Z/N\Z)$ is surjective. This implies that $\Gamma_0(N)/\Gamma_1(N) \cong (\Z/N\Z)^\times$, given by $\begin{pmatrix}a&b\\c&d\end{pmatrix}\mapsto d \mod N$.

We've also seen $\Gamma = \angle{S, \Gamma(2)}$.
\begin{definition}
  A \emph{weakly modular function of weight k and level $\Gamma$} where $\Gamma$ is a congruence subgroup is a meromorphic function on $\H$ such that, for all $\gamma \in \Gamma$, $f|_k[\gamma] = f$.
\end{definition}
Recall $SL_2(\Z) \cap \H$ had the fundamental domain $\mathscr{F}$.
\begin{definition}
  A cusp of a congruence subgroup $\Gamma$ is a $\Gamma$-orbit on the set $\P^1(\Q) = \Q \cup \{\infty\} \subseteq \hat{\C}$.
\end{definition}
Note $GL_2(\Q)^+$ acts on $\P^1(\Q)$ by M\"obius transformations.
\begin{lemma}
  $SL_2(\Z)$ acts transitively on $\P^1(\Q)$. Equivalently, $SL_2(\Z)$ has a unique cusp.
\end{lemma}
\begin{proof}
  It's enough to show that, if $\frac{a}{c} \in \Q$ with $a,b \in \Z, (a,b)=1$, then there is $\gamma \in SL_2(\Z)$ with $\gamma \cdot 0 = \frac{a}{c}$. If $\gamma = \begin{pmatrix}A&B\\C& D \end{pmatrix}$, then $\gamma \cdot 0 = B/D$.

  Since $(a,b) = 1$, we can find $c,d \in \Z$ such that $ad-bc = 1$. So we can take $\gamma = \begin{pmatrix}-b & a\\-d&c\end{pmatrix}$.
\end{proof}
\begin{corollary}
  If $\Gamma \leq SL_2(\Z)$ is a congruence subgroup, then $\Gamma$ has only finitely many cusps.
\end{corollary}
\begin{proof}
  Let $\Gamma_\infty = \Stab_{\Gamma(1)}(\infty) = \{\pm\begin{pmatrix}1 & b\\ 0 & 1\end{pmatrix} : b \in \Z\}$. There's a bijection $\Gamma(1)/\Gamma_\infty \to \P^1(\Q)$, given by $\gamma \Gamma_\infty \mapsto \gamma\cdot\infty$.

  The set of cusps for $\Gamma$ can be identified with the double quotient $\Gamma \diagdown \Gamma(1) / \Gamma_\infty$.
\end{proof}
For example, we compute the cusps of $\Gamma = \angle{S, \Gamma(2)}$. We want to compute $\Gamma \diagdown \Gamma(1)/\Gamma_\infty = \angle{S}\diagdown SL_2(\Z/2\Z)/\Gamma_\infty$. Now $SL_2(\Z/2\Z)/\Gamma_\infty = \F_2^2 \setminus\{0\}$.

So $\Gamma\diagdown \Gamma(1)/\Gamma_\infty = \{\{\begin{pmatrix}1\\0\end{pmatrix}, \begin{pmatrix}0\\1\end{pmatrix}\}, \{\begin{pmatrix}1\\1\end{pmatrix}\}\}$. Representatives are given by 1 and $\begin{pmatrix}-1 & -1 \\ 1 & 0 \end{pmatrix}$.

$\Gamma$ has two cusps, corresponding to $\Gamma \cdot \infty$ and $\Gamma \cdot -1$.

We'll see later that if $\Gamma$ is a congruence subgroup, then $\Gamma \diagdown \H \sqcup \Gamma \diagdown \P^1(\Q)$ can be given the structure of a compact Riemann surface.

\begin{definition}
  If $\Gamma$ is a congruence subgroup, the width of the csup $\infty$ is:
  \[\min\{h \in \N:\begin{pmatrix}1&h\\0&1\end{pmatrix} \in \Gamma\} = [\Gamma_\infty:\Gamma_\infty \cap \{\pm 1\}\Gamma]\]

\end{definition}
Let $h$ be the width of the cusp $\infty$, define $q_h = e^{2\pi\im\tau/h}$.

If $f$ is a weakly modular function of weight $k$ and level $\Gamma$, then $f(\tau+h) = f(\tau)$ for all $\tau \in \H$, so we can define a meromorphic function $\tilde{f}:\{q_h \in \C: 0 <|q_h| < 1\}$ by the formula $\tilde{f}(e^{2\pi\im\tau/h}) = f(\tau)$.

\begin{definition}
  We say $f$ is meromorphic at $\infty$ if $\tilde{f}$ is meromorphic at $0$, and holomorphic (resp. vanishes) at infinity if $\tilde{f}$ is holmorphic (resp. vanishes) at $q_h = 0$.

  If $f$ is meromorphic at $\infty$, then $\tilde{f}$ admits a $q_h$-expansion $\tilde{f}(q_h) = \sum_{n \in \Z} a_n q_h^n$, and hence $f(\tau) = \sum_{n \in \Z} a_n q_h^n$.
\end{definition}
\begin{definition}
  Let $f$ be a weakly modular function of weight $k$ and level $\Gamma$. We say $f$ is meromorphic at the cusp $\Gamma \cdot z$, $z \in \P^1(\Q)$, if choosing $\alpha  \in SL_2(\Z)$ such that $\alpha \cdot \infty = z$, $f|_k[\alpha]$ is meromorphic at $\alpha$, when viewed as a weakly modular function of level $\alpha^{-1}\Gamma\alpha$.

  Similarly, we define what it means for $f$ to be holomorphic or vanish at the cusp $\Gamma\cdot z$. We define the width of the cusp $\Gamma \cdot z$ to be the width of the cup $\infty$ for the group $\alpha^{-1}\Gamma \alpha$.
\end{definition}
\begin{lemma}\hspace*{0cm}
  \begin{enumerate}
    \item The width of a cusp is well defined.
    \item The meromorphy/holomorphy/vanishing of a weakly modular function at a cusp is well-defined.
  \end{enumerate}
\end{lemma}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item We need to first show that if $\alpha\infty = \beta\infty = z$, then the widths given by these choices are equal.

    We must have $\beta = \alpha S$ for some $S \in \Gamma_\infty$

    Then $[\Gamma_\infty:\{\pm 1\}\beta^{-1}\Gamma\beta \cap \Gamma_\infty] = [\Gamma_\infty : \{\pm 1\}S^{-1}\alpha^{-1}\Gamma \alpha S \cap \Gamma_\infty] = [\Gamma_\infty : \{\pm 1\}\alpha^{-1}\Gamma \alpha \cap \Gamma_\infty]$.

    Next we show that, if $\gamma \in \Gamma$ and $\alpha \in SL_2(\Z)$, then $[\Gamma_\infty : \{\pm 1\}\alpha^{-1}\gamma^{-1}\Gamma \gamma \alpha\cap \Gamma_\infty] = [\Gamma_\infty:\{\pm 1\}\alpha^{-1}\Gamma \alpha \cap \Gamma_\infty]$, but this is true since $\gamma^{-1}\Gamma \gamma = \Gamma$.

    \item Suppose $\alpha, \beta \in SL_2(\Z)$ satisfy $\alpha \infty = z = \beta \infty$. Then $\beta = \alpha \delta$ for some $\delta \in \Gamma_\infty$, say $\delta = \pm \begin{pmatrix} 1 & a \\ 0 & 1\end{pmatrix}$. Then $f|_k[\beta](\tau) = f|_k[\alpha\delta](\tau) = f|_k[\alpha](\tau+a)(\pm 1)^{k}$.

    If $f|_k[\alpha](\tau) = \sum_{n \in \Z}a_n q_h^n$, then $f|_k[\beta](\tau) = \sum_{n \in \Z}a_n e^{2\pi\im\tau/h}e^{2\pi\im a/h}(-1)^k$.

    This shows that the meromorphy at $\infty$ of $f|_k[\alpha]$ is independent of choice of $\alpha$.

    Now suppose $\gamma \in \Gamma$ and $\gamma z = z'$. If $\alpha \infty = z$, then $\gamma \alpha \infty = z'$, and hence $f|_k[\gamma\alpha] = f|_k[\alpha]$, and again meromorphy at $\infty$ is independent of the choice of $z$.
  \end{enumerate}
\end{proof}
\textbf{Remark.} The $q$-expansion of a weakly modular function $f$ is not well defined independently of choices. By ``the'' $q$-expansion of a weakly modular function which is meromorphic at $\infty$, we mean the $q$-expansion at $\infty$.
\begin{definition}
  A \emph{modular function of weight k and level $\Gamma$}, for $\Gamma$ a congruence subgroup and $k \in \Z$, is a weakly modular function that is meromorphic at every cusp of $\Gamma$.

  $f$ is a \emph{modular form} if $f$ is holomorphic in $\H$ and holomorphic at every cup of $\Gamma$, and a cuspidal modular form if $f$ is a modular form vanishing at every cusp.

  We write $M_k(\Gamma)$ (resp. $S_k(\Gamma)$) for the vector spaces of modular (resp. cuspidal modular) forms.
\end{definition}
\textbf{Remark.} An equivalent definition is that $f$ is a modular form if $f$ is holomorphic in $\H$ and for all $\alpha \in \Gamma(1)$, $f|_k[\alpha]$ is holomorphic at $\infty$.

\begin{lemma}\hspace*{0cm}
  \begin{enumerate}
    \item If $f \in M_k(\Gamma)$ and $g \in M_\ell(\Gamma)$, then $fg \in M_{k+\ell}(\Gamma)$.
    \item If $\Gamma' \leq \Gamma$ is another congruence subgroup, then $M_k(\Gamma) \leq M_k(\Gamma')$.
    \item If $\Gamma, \Gamma'$ are congruence subgroups and $\alpha \in GL_2(\Q)^+$, and $f \in M_k(\Gamma)$ and if $\Gamma' \leq \alpha^{-1}\Gamma\alpha$, then $f|_k[\alpha] \in M_k(\Gamma')$.
  \end{enumerate}
  Moreover, these hold if $M_k$ is replaced by $S_k$ everywhere.
\end{lemma}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item Clear - same as in the case $\Gamma=\Gamma(1)$.
    \item Is a special case of 3.
    \item $f|_k[\alpha]$ is holomorphic in $\H$ and is invariant under the weight $k$ action of $\alpha^{-1}\Gamma\alpha$. We need to check that $f|_k[\alpha]$ is holomorphic at the cusps of $\Gamma'$. Equivalently, we need to check that, for all $\beta in \Gamma(1)$, $f|_k[\alpha\beta]$ is holomorphic at $\infty$.

    We can write $\alpha\beta\infty = \gamma \infty$ for some $\gamma \in \Gamma(1)$, and then $\alpha\beta = \gamma\delta$ for some $\delta \in \Stab_{GL_2(\Q)^+}(\infty)$, say $\delta=\begin{pmatrix}a & b \\0 &d\end{pmatrix}$ with $a,b,d \in \Q$, and $ad>0$.

    Then $f|_k[\alpha\beta](\tau)=f|_k[\gamma\delta](\tau) = f|_k[\gamma](\frac{a\tau+b}{d})(ad)^{k-1}d^{-k}$. Since $f|_k[\gamma]$ is holomorphic at $\infty$, we know $\lim_{\Im \tau \to \infty}f|_k[\gamma](\tau)$ exists. It follows that $\lim_{\Im \tau \to \infty}f|_{k}[\gamma](\frac{a\tau+b}{d})$ also exists, and so $f|_k[\alpha\beta]$ is holomorphic at $\infty$.
  \end{enumerate}
\end{proof}
\textbf{Examples.} Recall $\Gamma_0(N) = \{\begin{pmatrix}a&b\\c&d\end{pmatrix}\in SL_2(\Z): c\equiv 0 \mod N\}$.

If $f \in M_k(\Gamma_0(M))$ and $L\in \N$, then $f(L\tau) \in M_k(\Gamma_0(ML))$.

Why? $L\tau = \begin{pmatrix}L&0\\0&1 \end{pmatrix}\tau$. By the lemma, we need to check that $\Gamma_0(ML) \leq \begin{pmatrix}L&0\\0&1 \end{pmatrix}^{-1}\Gamma_0(M)\begin{pmatrix}L&0\\0&1 \end{pmatrix}$.

So if $k \in 2\N, k\geq4, p$ prime, then $G_k(\tau), G_k(p\tau) \in M_k(\Gamma_0(p))$.

\textbf{Example.} If $\tau \in \H$, we define
\[\theta(\tau) = \sum_{n \in \Z}e^{\pi\im n^2\tau}\]
This defines absolutely and uniformly in compact subsets of $\H$, so defines a holomorphic function. We have $\theta(\tau+2) = \theta(\tau)$.
\begin{proposition}[Poisson Summation Formula]
  Let $f:\R \to \C$ be a continuous function such that $\sum_{n \in \Z}|f(n+x)|$ converges uniformly in $\R$ and $\sum_{n \in \Z}|\hat{f}(n)|$ converges, where
  \[\hat{f}(n) = \int_{-\infty}^\infty f(t)e^{-2\pi\im n t}dt\]
  Then we have:
  \[\sum_{n \in \Z}f(n) = \sum_{n \in \Z}\hat{f}(n)\]
\end{proposition}
\begin{proof}
  Let $\phi(x) = \sum_{n \in \Z}f(n+x)$. Then $\phi$ is continuous. Its Fourier expansion $\phi(x) = \sum_{n \in \Z}\hat{\phi}(n)e^{2\pi\im n x}$, where $\hat{\phi}(n) = \int_0^1 \phi(t) e^{2p\im n t}dt = \sum_{n \in \Z}\int_0^1 f(n+t)e^{-2\pi\im n t}dt = \int_{-\infty}^\infty f(t)e^{-2\pi\im n t}dt= \hat{f}(n)$.

  If $\psi : \R \to \C$ is continuous and periodic, so $\psi(x) = \psi(x+1)$, and its series of Fourier coefficients is absolutely convergent, then the Fourier series converges uniformly.

  We then evaluate at $x= 0$: $\phi(0)= \sum_{n \in \Z}f(n) = \sum_{n \in \Z}\hat{f}(n)$.
\end{proof}
We can use this to prove more properties of the $\theta$ function. We then apply this to $f_y(x) = e^{-\pi x^2 y}$, as then $\theta(\im y) = \sum_{n \in \Z} f_y(n)$.

We compute:
\begin{align*}
  \hat{f_y}(s) &=\int_{-\infty}^{\infty} e^{-\pi x^2 y}e^{-2\pi\im xs}dx \\
  &= \int_{-\infty}^{\infty} e^{-\pi (x\sqrt{y}+\im s/sqrt{y})^2}e^{-\pi s^2/y}dx\\
  &= \int_{-\infty}^{\infty} e^{-\pi (x+\im s/\sqrt{y})^2} e^{-\pi s^2/y}dx/\sqrt{y}\\
  &= \frac{e^{-\pi s^2/y}}{\sqrt{y}}\int_{-\infty}^{\infty} e^{-\pi x^2}dx\\
  &= e^{-\pi s^2/y}/\sqrt{y}
\end{align*}
So $\theta(\im y) = \sum_{n \in \Z} e^{-\pi n^2/y}\sqrt{y}^{-1} = \theta(1/y)\sqrt{y}^{-1}$. So $\theta(\tau) = \theta(-1/\tau)\sqrt{\tau/\im}^{-1}$, where $\sqrt{\cdot}$ is the branch of the square root defined on $\Re(z) > 0$, which takes positive real values on $\R_{>0}$.

It then follows that $\theta^8(\tau+ 2) =\theta^8(\tau)$, and $\theta^8(-1/\tau)\tau^{-4} = \theta^8(\tau)$, or equivalently that $\theta^8|_{4}\left[\begin{pmatrix}1&2\\0&1\end{pmatrix}\right] = \theta^8$, and $\theta^8|_{4}\left[\begin{pmatrix}0&-1\\1&0\end{pmatrix}\right] = \theta^8$.
\begin{proposition}
  $\theta^8 \in M_4(\Gamma)$, where $\Gamma \leq \Gamma(1)$ is the subgroup of matrices $\gamma$ such that $\gamma \equiv 1 \mod 2$ or $\gamma \equiv S \mod 2$.
\end{proposition}
\begin{proof}
  We know $\theta^8$ is holomorphic in $\H$. We know from ex. sheet 1 that $\Gamma$ is generated by $\pm \begin{pmatrix}1&2\\0&1 \end{pmatrix}$ and $\begin{pmatrix}0&-1\\1&0\end{pmatrix}$.

  This shows that $\theta^8$ is invariant under the weight $4$ action of $\Gamma$. It remains to check that $\theta^8$ is holomorphic at the cusps $\Gamma \cdot \infty$ and $\Gamma \cdot 1$.

  Since $\theta^8 = \left(1 + \sum_{n\geq 1}q_2^{n^2}\right)^8$, we see that $\theta^8$ is holomorphic at $\infty$.

  To show holomorphy at $\Gamma \cdot 1$, we need to show $\theta^8|_{4}\left[\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right]$ is holomorphic at $\infty$. We'll show that $\theta^8|_{4}\left[\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right]$ vanishes at $\infty$.

  We start by looking at $\theta(\tau+1) = \sum_{n \in \Z}(-1)^n q_2^{n^2}$. We thus have $\theta(\tau) + \theta(\tau+1) = 2\theta(4\tau)$.

  So $\theta(-1/\tau) + \theta((\tau-1)/\tau) = 2\theta(-4/\tau)$, and hence:
  \[\theta(\frac{\tau-1}{\tau})\sqrt{\tau/\im}^{-1} = \theta(-4/\tau)\sqrt{\tau/4\im}^{-1} - \theta(-1/\tau)\sqrt{\tau/\im}^{-1} = \theta(\tau/4) - \theta(\tau)\]
  It then follows that $\theta^8|_{4}\left[\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right] = (\theta(\tau/4)-\theta(\tau))^8$. Hence $\theta^8$ is holomorphic at vanishes at the cusp $\Gamma \cdot 1$.
\end{proof}
One application of $\theta$ functions is the expression:
\[\theta^k(\tau)  = \left(\sum_{n \in \Z}q_2^{n^2}\right)^k = \sum_{n \in \Z_{\geq 0}}r_k(n)q_2^n\]
where $r_k(n)$ is the number of ways of writing $n$ as a sum of $k$ squares.

For $k=8$, we know already that $\theta^8 \in M_4(\Gamma)$. What other elements are there? We know $M_4(\Gamma(1)) \leq M_4(\Gamma)$, so $E_4 \in M_4(\Gamma)$. We also have $\begin{pmatrix}1&1\\0&2\end{pmatrix} \Gamma \begin{pmatrix}1&1\\0&2\end{pmatrix}^{-1} \leq \Gamma(1)$ via a direct computation.

This shows that $E_4|_4\left[\begin{pmatrix}1&1\\0&2\end{pmatrix}\right] = \frac12 E_4(\frac{\tau+1}{2}) \in M_4(\Gamma)$.

We will prove later on that $\dim_\C M_4(\Gamma) = 2$, so $E_4(\tau), E_4(\frac{\tau+1}{2})$ span $M_4(\Gamma)$.

So $\theta^8(\tau) = \lambda E_4(\tau) + \mu E_4(\frac{\tau+1}{2})$ for $\lambda, \mu \in \C$. We can either compute $\lambda, \mu$ via $q$ expansions, or using vanishing at cusps.

We know $\theta^8(\infty) = 1$ and $\theta^8|_4\left[\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right](\infty) = 0$.

We also have $E_4(\infty) = 1$ and $E_4|_4\left[\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right](\infty) = E_4(\infty) = 1$, whilst $E_4(\frac{\tau+1}{2}) = 1+\sum_{n \geq 1}\sigma_3(n)(-1)^n q_2^n$, so $E_4(\frac{\tau+1}{2})|_{\tau=\infty} = 1$. We just need to compute $2E_4|_4\left[\begin{pmatrix}1&1\\0&-2\end{pmatrix}\begin{pmatrix}1&-1\\1&0\end{pmatrix}\right](\infty) = 2\cdot2^3 E_4(2\tau) = 16E_4(2\tau)$, so at infinity this is $16$.

So $\mu = -\lambda/16$, $\lambda+\mu = 1$, and hence $\lambda = 16/15, \mu = -1/15$. We conclude that $\theta^8 = \frac{16}{15}E_4(\tau) - \frac{1}{15}E_4(\frac{\tau+1}{2})$, and so $r_8(n) = \frac{16}{15}\cdot 240 \cdot \sigma_3(n/2) - \frac{1}{15}(-1)^n 240 \sigma_3(n) = 2^8 \sigma_3(n/2) - (-1)^n 2^4 \sigma_3(n)$. So if $p$ is an odd prime, then e.g. $r_8(p) = 16\sigma_3(p)$.

\begin{lemma}
  If $\Gamma \leq \Gamma(1)$ is a congruence subgroup, then $(GL_2(\Q)^+, \Gamma)$ is a Hecke pair.
\end{lemma}
\begin{proof}
  We need to show that, for all $g \in GL_2(\Q)^+$, $\Gamma \diagdown \Gamma g\Gamma$ is finite. Equivalently, $g^{-1}\Gamma g \cap \Gamma \diagdown \Gamma$ is finite.

  Choose $N \in \N$ such that $\Gamma(N) \leq \Gamma$ and $Ng, Ng^{-1} \in M_2(\Z)$.

  We have $g \Gamma(N^3) g^{-1} \subseteq 1 + gN^3 M_2(\Z)g^{-1} \subseteq 1 + (Ng)N M_2(\Z) (Ng^{-1}) \subseteq 1 + NM_2(\Z)$. Hence $g\Gamma(N^3)g^{-1} \leq \Gamma(N)$, so $\Gamma(N^3) \leq g^{-1}\Gamma g \cap \Gamma$.
\end{proof}
\begin{definition}
  Let $k \in \Z$, and let $\mathcal{M}_k = \bigcup_{\Gamma\leq \Gamma(1)}M_k(\Gamma)$, and similarly $\mathcal{S}_k$.
\end{definition}
\begin{proposition}
  $GL_2(\Q)^+$ acts on $\mathcal{M}_k$ and $\mathcal{S}_k$ by the weight $k$ action.
\end{proposition}
\begin{proof}
  We need to show that, if $f \in M_k(\Gamma)$ and $g \in GL_2(\Q)^+$, then there exists $\Gamma' \leq \Gamma(1)$ such that $f|_k[g] \in M_k(\Gamma')$. $f|_k[g]$ is invariant under the weight $k$ action of $g^{-1}\Gamma g$.

  We can always find a congruence subgroup $\Gamma' \leq g^{-1}\Gamma g$, and we've already proven in this case that $f|_{k}[g] \in M_k(\Gamma')$.
\end{proof}
\begin{corollary}
  $\mathcal{H}(GL_2(\Q)^+, \Gamma)$ acts on $M_k(\Gamma)$ and $S_k(\Gamma)$.
\end{corollary}
We've seen that $\mathcal{H}(GL_2(\Q)^+, \Gamma(1))$ is commutative, and $S_k(\Gamma(1))$ decomposes with multiplicity one under the action of this Hecke algebra. However, in general, $\mathcal{H}(GL_2(\Q)^+, \Gamma)$ is not commutative.

Recall $\Gamma_0(N) = \left\{\begin{pmatrix}a&b\\c&d\end{pmatrix}\in \Gamma(1): c \equiv 0 \mod N\right\}$ and $\Gamma_1(N) = \left\{\begin{pmatrix}a&b\\c&d\end{pmatrix}\in \Gamma(1): a \equiv d \equiv 1 \mod N, c \equiv 0 \mod N\right\}$.

For any $N \in \N$, $SL_2(\Z) \to SL_2(\Z/N\Z)$ is surjective, and in particular, $\Gamma_1(N) \triangleleft \Gamma_0(N)$, with $\Gamma_0(N)/\Gamma_1(N) \cong (\Z/N\Z)^\times$, mapping to $d \mod N$.

If $d \in \N$ and $(d, N) = 1$,t hen we write $\angle{d}$ for the endomorphism of $M_k(\Gamma_1(N))$ induced by $\left[\left\{\begin{pmatrix}A&B\\C&D\end{pmatrix} \in \Gamma_0(N) : D \equiv d \mod N\right\}\right] \in \mathcal{H}(GL_2(\Q)^+, \Gamma_1(N))$.

If $p$ is prime, then we write $T_p$ for the endomorphism of $M_k(\Gamma)$ induced by $[\Gamma_1(N) \begin{pmatrix}1&0\\0&p \end{pmatrix}\Gamma_1(N)] \in \mathcal{H}(GL_2(\Q)^+, \Gamma_1(N))$. If $N = 1$, then this is the same as $T_p$.

In general, if $p \nmid N$, then $T_p$ behaves in a similar way to the $N=1$ case, but if $p |N$, then $T_p$ is of a different nature.

Let's first discuss the operators $\angle{d}$. We can think about the action of these operators in another way: since $\Gamma_1(N) \triangleleft \Gamma_0(N)$, then $\Gamma_0(N)/\Gamma_1(N)$ acts on $\mathcal{M}_k^{\Gamma_1(N)} = M_k(\Gamma(N))$ via the weight $k$ action.
\begin{lemma}
  If $f \in M_k(\Gamma_1(N))$ and $\begin{pmatrix}A&B\\C&D \end{pmatrix} \in \Gamma_0(N)$, and $D \equiv d \mod N$, then $f|_k[D] = \angle{d}(f)$.
\end{lemma}
\begin{proof}
  To compute the RHS, we decompose $\{\begin{pmatrix}X&Y\\Z&W\end{pmatrix}\in \Gamma_0(N) : w \equiv d \mod N\}$ as a disjoint union $\bigsqcup_i \Gamma_1(N) x_i$.

  Then $\angle{d}(f) = \sum_i f|_k [x_i]$. In fact this double coset is $\Gamma_1(N) \begin{pmatrix}A&B\\C&D \end{pmatrix}$, so $\angle{d}(f) = f|_k[D] = LHS$.
\end{proof}
\begin{lemma}
  If $A$ is a finite abelian group acting by linear maps on a $\C$-vector space $V$, then $V = \bigoplus_{\chi \in \Hom(A, \C^\times)}V_\chi$, where $V_\chi = \{v \in V: \forall a \in A, a\cdot v = \chi(a)v\}$.
\end{lemma}
\begin{corollary}
  \[M_k(\Gamma_1(N)) = \bigoplus_\chi M_k(\Gamma_1(N), \chi)\]
  and similarly for $S_k(\Gamma_1(N))$, where the sums run over the set of homomorphisms $\chi:(\Z/N\Z)^\times \to \C^\times$, and $M_k(\Gamma_1(N), \chi) = \{f \in M_k(\Gamma_1(N)) : \forall d \in \Z, (d,N) = 1 \implies \angle{d}f = \chi(d)f\}$.
\end{corollary}
\begin{proposition}\hspace*{0cm}
  \begin{enumerate}
    \item If $p |N$ then $\Gamma_1(N)\begin{pmatrix}1&0\\0&p\end{pmatrix}\Gamma_1(N) = \bigsqcup_{j=0}^{p-1}\Gamma_1(N) \begin{pmatrix}1&j\\0&p \end{pmatrix}$.

    \item IF $p \nmid N$, then $\Gamma_1(N)\begin{pmatrix}1&0\\0&p\end{pmatrix}\Gamma_1(N) = \bigsqcup_{j=0}^{p-1}\Gamma_1(N) \begin{pmatrix}1&j\\0&p \end{pmatrix} \sqcup \Gamma_1(N) \begin{pmatrix}p^a&r\\pN & p^j\end{pmatrix}$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  For any $g \in GL_2(\Q)^+$, there is a bijection $g^{-1}\Gamma_1(N)g \cap \Gamma_1(N)\diagdown \Gamma_1(N) \to \Gamma_1(N)\diagdown \Gamma_1(N)g\Gamma_1(N)$, given by $\gamma \mapsto \Gamma_1(N) g\gamma$. I got fed up with latexing matrices here  -  the proof is a big computation (lecture 17, 41:40).
\end{proof}
So, if $f \in M_k(\Gamma_1(N))$, then if $p |N$ we have:
\[T_p f = \sum_{j=0}^{p-1}f|_k\left[\begin{pmatrix}1&0\\0&p \end{pmatrix}\gamma_j\right]\]
where $\gamma_0, \ldots, \gamma_{p-1}$ in $\Gamma_1(N)$ project to representatives for the quotient
\[\{SL_2(\Z/N\Z): c = 0, b= 0 \}\diagdown \{SL_2(\Z/N\Z) : c = 0\}\]
We can take $\gamma_j = \begin{pmatrix}1&j\\0&1\end{pmatrix}$.

If $p \nmid N$, then we have
\[T_p f = \sum_{j=0}^{p}f|_k\left[\begin{pmatrix}1&0\\0&p \end{pmatrix}\gamma_j\right]\]
where $\gamma_0, \ldots, \gamma_p \in \Gamma_1(N)$ project to representatives for the quotient
\[\{SL_2(\Z/p\Z) : b = 0\} \diagdown SL_2(\Z/p\Z)\]
We can take $\gamma_j = \begin{pmatrix}1&j\\0&1\end{pmatrix}$ for $0\leq j\leq p-1$, and $\gamma_p = \begin{pmatrix}p^a & r\\ N & s\end{pmatrix}$ where $a \in \N$ such that $p^a \equiv 1 \mod N$, and $p^a s - Nr = 1$.

By definition, $\angle{d}(f) = f|_k[S]$ for any $S =\begin{pmatrix}A&B\\C&D\end{pmatrix} \in \Gamma_0(N)$ such that $D \equiv d \mod N$.

\begin{lemma}
  $\angle{d}$ and $T_p$ commute.
\end{lemma}
\begin{corollary}
  The operators $T_p$ preserve the subspaces $M_k(\Gamma_1(N), \chi)$ and $S_k(\Gamma_1(N), \chi)$ for characters $\chi : (\Z/N\Z)^\times \to \C^\times$.
\end{corollary}
\begin{proof}[Proof of lemma]
  We just treat the case $p \nmid N$. Choose $\delta \in \Gamma_0(N)$ with entries $A,B,C,D$, congruent to the identity matrix mod $p^2$. Then:
  \[\angle{d}(T_p(f)) = \sum_{j=0}^p f|_k[\begin{pmatrix}1&0\\0&p \end{pmatrix}\gamma_j \delta]\]
  \[T_p(\angle{d}(f)) = \sum_{j=0}^p f|_k[\delta\begin{pmatrix}1&0\\0&p \end{pmatrix}\gamma_j ]\]
  We can rewrite $\angle{d}(T_p(f)) = \sum_{j=0}^p f|_k [\delta \begin{pmatrix}1&0\\0&p\end{pmatrix}\begin{pmatrix}1&0\\0&p\end{pmatrix}^{-1}\delta^{-1}\begin{pmatrix}1&0\\0&p\end{pmatrix}\gamma_j \delta]$.

  This will equal $T_p(\angle{d}(f))$ if the matrices $\epsilon_j = \begin{pmatrix}1&0\\0&p\end{pmatrix}^{-1}\delta^{-1}\begin{pmatrix}1&0\\0&p\end{pmatrix}\gamma_j \delta$ lie in $\Gamma_1(N)$ and project to representatives for the quotient
  \[\{SL_2(\Z)/p\Z : b = 0\} \diagdown SL_2(\Z/p\Z)\]
  Now $\begin{pmatrix}1&0\\0&p\end{pmatrix}^{-1}\delta^{-1}\begin{pmatrix}1&0\\0&p\end{pmatrix} = \begin{pmatrix}D & -pB\\ -C/p & A \end{pmatrix} \in \Gamma_0(N)$ and congruent to $I$ mod $p$. We see that $\epsilon_j \in \Gamma_1(N)$ and congruent to $\gamma_j \mod p$.
\end{proof}
\begin{proposition}
  Let $f \in M_k(\Gamma_1(N))$ and write $f(\tau)  =\sum_{n\geq 0}a_n(f)q^n$. Then:
  \[T_p(f) = \sum_{n\geq 0}[a_{np}(f) + p^{k-1}\delta_{p\nmid N}a_{n/p}(\angle{p}f)]q^n\]
  where $\delta_{p\nmid N}$ is 1 if $p\nmid N$ and 0 otherwise, and $a_{n/p} = 0$ if $p \nmid n$.
\end{proposition}
\begin{proof}
  \begin{align*}
    T_p(f) &= \sum_{j =0}^{p-1}f|_k[\begin{pmatrix}1&j\\0&p\end{pmatrix}] + \delta_{p\nmid N}f|_k[\begin{pmatrix}p^a&r\\pN&ps\end{pmatrix}] \\
    &= p^{k-1}p^{-k} \sum_{j=0}^{p-1} f(\frac{\tau+j}{p}) + \delta_{p\nmid N}f|_k[\begin{pmatrix}p^a&r\\N&ps\end{pmatrix}\begin{pmatrix}p&0\\0&\end{pmatrix}]\\
    &= \frac{1}{p}\sum_{n\geq 0}\sum_{j=0}^{p-1}a_n(f)e^{2\pi\im n\tau/p}e^{2\pi\im n j/p}+\delta_{p\nmid N}(\angle{p}(f))|_k [\begin{pmatrix}p&0\\0&1\end{pmatrix}]\\
    &= \sum_{n\geq 0}a_{np}(f)q^{n} + \delta_{p\nmid N}\sum_{n\geq 0}a_n(\angle{p}(f))q^{np}
  \end{align*}
\end{proof}
\begin{corollary}
  If $p, q$ are primes, then $T_p, T_q$ commute.
\end{corollary}
\begin{proof}
  WLOG $p \neq q$.
  \begin{align*}
    a_n(T_p(T_q(f))) &= a_{np}(T_q(f))+p^{k-1}\delta_{p\nmid a_{n/p}}(\angle{p}T_q(f)) \\
    &= a_{npq}(f) + \delta_{q \nmid N}a_{np/q}(\angle{q}(f))q^{k-1} + p^{k-1}\delta_{p\nmid N}(a_{nq/p}(\angle{p}(f)) + a{n/pq}(\angle{q}\angle{p}f)\delta_{q\nmid N}q^{k-1})\\
    &= a_{npq}(f) + q^{k-1}\delta_{q\nmid N}a_{np/q}(\angle{q}(f)) + p^{k-1}\delta_{p\nmid N}a_{nq/p}(\angle{p}(f)) + p^{k-1}q^{k-1}\delta_{p\nmid N}\delta_{q\nmid N}a_{n/pq}(\angle{pq}(f))
  \end{align*}
  which is symmetric in $p,q$.
\end{proof}
\begin{proposition}
  Define an inner product $\angle{\cdot,\cdot}$ on $S_k(\Gamma_1(N))$ by
  \[\angle{f,g} = [\Gamma(1):\Gamma_1(N)]^{-1}\int_{\Gamma_1(N)\diagdown \H}f(\tau)\overline{g(\tau)}y^{k}dxdy/y^2\]
  If $d \in (\Z/N\Z)^\times$, its adjoint is $\angle{d}^\ast = \angle{d^{-1}}$. If $p \nmid N$, the adjoint of $T_p$ is $T_p^\ast = \angle{p^{-1}}T_p$.
\end{proposition}
\begin{corollary}
  The operators $\angle{d}$ and $T_p$ for $p \nmid N$ are simultaneously diagonalisable on $S_k(\Gamma_1(N))$.
\end{corollary}
\textbf{Remark.} If $p |N$, then $T_p$ is not diagonalisable on $S_k(\Gamma_1(N))$ in general. The simultaneous eigenspaces of $\angle{d}, T_p$ for $p \nmid N$ not 1-dimensional - both of these defects are explained by the presence of ``oldforms''. Suppose $N >1$ and $f \in S_k(\Gamma(1))$ is a normalised eigenform. Then $f(\tau), f(N\tau) = g(\tau) \in S_k(\Gamma_1(N))$ are linearly independent. If $p \nmid N$ is a prime, then $f, g$ are eigenvectors of $T_p$ with the same eigenvalue, $a_p(f)$.

$T_p f$ is the same considered either in $S_k(\Gamma(1))$ or in $S_k(\Gamma_1(N))$, so $T_p f = a_p(f)f$. We have $g(\tau)  \sum_{n\geq 1}a_n(f)q^{Nn} = \sum_{n\geq 1}a_{n/N}(f)q^n$, so $a_n(T_p g) = a_{np}(g) + p^{k-1}a_{n/p}(g) = a_{np/N}(f) + p^{k-1}a_{n/pN}(f) = a_{n/N}(T_p f) = a_p(f)a_{n/N}(f) = a_p(f)a_n(g)$.

\begin{definition}
  Let $N \in \N$. The old subspace $S^{old}_k(\Gamma_1(N)) \leq S_k(\Gamma_1(N))$ is the span of all modular forms of type $f(M\tau)$ where $M | N, M> 1$, and $f \in S_k(\Gamma_1(N/M))$.

  The new subspace $S^{new}_k(\Gamma_1(N))$ is the orthogonal complement with respect to the inner product of the old subspace.
\end{definition}
\begin{theorem}
  All of the operators $\angle{d}, T_p$ preserve the direct sum decomposition $S_k(\Gamma_1(N)) = S_k^{old}(\Gamma_1(N)) \oplus S_k^{new}(\Gamma_1(N))$.

  The simultaneous eigenspaces of the operators $\angle{d}, T_p (p \nmid N)$ on $S_k^{new}(\Gamma_1(N))$ are 1-dimensional.

  $S_k^{new}(\Gamma_1(N))$ has a unique basis of normalised eigenforms, i.e. forms $f \in S_k^{new}(\Gamma_1(N))$ which are eigenvectors for all operators $\angle{d}, T_p$ which satisfy $a_1(f) = 1$.
\end{theorem}
\begin{definition}
  A \emph{newform} of weight $k$ and level $\Gamma_1(N)$ is a normalised eigenform in $S_k^{new}(\Gamma_1(N))$.
\end{definition}
\textbf{Example.} $S_2(\Gamma(1)) = 0$. If $p$ is a prime, then $S_2(\Gamma_1(p)) = S_2^{new}(\Gamma_1(p))$. The first prime $p$ for which this space is nonzero is $p=11$, in which case it has dimension 1.

Recall $\eta(\tau) = q_{24}\prod_{n \geq 1}(1-q^n)$. Then $\eta(\tau)^2 \eta(11\tau)^2$ is the unique newform in $S_2(\Gamma_1(11))$.

\begin{theorem}
  Let $f \in S_k(\Gamma_1(N))$ be a newform, say $f(\tau) = \sum_{n\geq 1}a_n q^n$, and define $L(f,s) = \sum_{n\geq 1}a_n n^{-s}$. Then:
  \begin{enumerate}
    \item $L(f,s)$ is absolutely convergent in $\Re(s) > k/2+1$.
    \item There is a character $\chi: (\Z/N\Z)^\times \to \C^\times$ such that $f \in S_k(\Gamma_1(N), \chi)$.
    \item There's an Euler product $L(f,s) = \prod_p (1-a_p p^{-s}+\chi(p)p^{k-1-2s})^{-1}$ - here we make the convention that $\chi(p) = 0$ if $p |N$.
    \item $L(f,s)$ has an analytic continuation to $\C$ and if we define
    \[\Lambda(f,s) = N^{s/2}(2\pi)^{-s}\Gamma(s)L(f,s)\]
    then there's a sign $\epsilon_f \in \{\pm 1\}$ such that $\Lambda(f,s) = \epsilon_f \Lambda(f, k-s)$.
  \end{enumerate}
\end{theorem}
The Shimura-Taniyama-Weil conjecture (now the Modularity Theorem) asserts that there is a bijection between elliptic curves $E/\Q$ up to isogeny and newforms $f \in S_2(\Gamma_1(N), \one)$ such that, for all $n \in \N$, $a_n(f) \in \Z$, given by $E \mapsto f$ if, for all but finitely many primes $p$, $a_p(f) = p+1-|\tilde{E}(\F_p)|$.

\section{Modular Curves and Riemann Surfaces}
The goal of this section is to endow $\Gamma \diagdown \H$ and $\Gamma \diagdown \H \sqcup \Gamma \diagdown \P^1(\Q)$ with the structure of Riemann surfaces. These quotients are called modular curves.
\begin{definition}
  A \emph{Riemann surface} is a compact Haudorff topological space $X$ together with an atlas $\mathscr{A} = \{(U_i, V_i, \phi_i:U_i \to V_i): i \in I\}$ where
  \begin{enumerate}
    \item $U_i \subset X$ is open and $V_i \subset \C$ is open.
    \item For all $i,j \in I$, the map $\phi_i(U_i \cap U_j) \to \phi_j(U_i \cap U_j)$ is holomorphic.
    \item $U_{i \in I}U_i = X$.
  \end{enumerate}
\end{definition}
If $X, Y$ are Riemann surfaces, then a morphism $f: X \to Y$ is a continuous map such that, for all charts $\phi_i : U_i \to V_i$ of $X$ and $\psi_j : U_j' \to V_j$ of $Y$, the induced map $V_i \cap f^{-1}(U_j') \to V_j'$ is holomorphic.

\textbf{Examples.} $X = \C, \mathscr{A} = \{(\C, \C, \id:\C \to \C)\}$. If $Y$ is another Riemann surface, then a morphism $f:Y \to \C$ is a continuous function such that, for every chart $\phi_i : U_i \to V_i$ of $Y$, the map $f \circ \phi_i^{-1}:V_i \to \C$ is holomorphic.

$X = \hat{C} = \C \cup \{\infty\}$. We have charts $(\C, \C, \id:\C\to\C)$, and $(\C^\times \cup \{\infty\}, \C, z\mapsto 1/z)$ Then $\phi_2 \circ \phi_1^{-1}:\C^\times \to \C^\times$ is $z \mapsto 1/z$.

The first goal: we can make $Y(\Gamma) = \Gamma \diagdown \H$ for $\Gamma \leq \Gamma(1)$ a congruence subgroup into a connected Hausdorff topological space. We give $\H$ its usual topology and $Y(\Gamma)$ the quotient topology. So, if $\pi: \H \to Y(\Gamma)$ is the quotient map then a subset $U \subset Y(\Gamma)$ is open if and only if $\pi^{-1}(U)$ is open.

\begin{lemma}
  Suppose $A, B \subset \H$ are compact subsets. Then $\{\gamma \in \Gamma(1): \gamma A \cap B \neq \emptyset\}$ is finite.
\end{lemma}
\begin{proof}
  $\Omega_X = \{\tau \in \H: |\Re \tau| \leq X, \Im \tau \geq 1/X\}$. We showed that there is $C_X >0$ such that, for all $\tau \in \Omega_X$ and $t \in \R$, $|\tau+t| \geq C_X\sup(1, |t|)$.

  If $c,d \in \Z$, then $|c\tau +d| \geq C_X \sup(|c|, |d|)$.

  So, if $\tau \in \Omega_X$, then $\Im(\gamma \tau) \leq \frac{\Im(\tau)}{C_X^2 \sup(|c|,|d|)^2}$, and hence $\sup(|c|,|d|)^2 \leq \frac{\Im(\tau)}{C_X^2 \Im(\gamma \tau)}$.

  Now suppose that $A, B \subseteq \Omega_X$. If $\tau \in A, \gamma \tau \in B$, then $\sup(|c|, |d|)$ is bounded above by a constant only depending on $A$ and $B$.

  If $\gamma \in \Gamma(1)$ and $\gamma A \cap B \neq \emptyset$, then there are only finitely many possibilities for $(c,d)$. Now observe that $\gamma, \delta$ have the same bottom row, then $\delta = \epsilon \gamma$ for some $\epsilon \in \Gamma_\infty = \{SL_2(\Z): a=d=1, c=0\} = \Stab_{SL_2(\Z)}(\infty)$.

  Since $A,B$ are compact, there can only be finitely many $\epsilon$ such that $\epsilon \gamma A \cap B \neq \emptyset$.
\end{proof}
\begin{proposition}
  $Y(\Gamma)$ is Hausdorff.
\end{proposition}
\begin{proof}
  Let $x, y \in \H$ be such that $x, y$ are not $\Gamma$-conjugate. It will be enough to find open sets $W_x \ni x$ and $W_y \ni y$ of $\H$ such that, if $\gamma \in \Gamma(1)$ then $\gamma W_x \cap W_y = \emptyset$.

  We begin by choosing open subsets $U_x \ni x$ and $U_y \ni y$, and compact subsets $K_x \supseteq U_x$ and $K_y \supseteq U_y$ of $\H$.

  The previous lemma tells us that the set $N = \{\gamma \in \Gamma: K_x \cap yK_y \neq \emptyset\}$ is finite. For all $\gamma \in N$, we can choose open sets $A_\gamma \ni x, B_\gamma \ni \gamma y$ such that $A_\gamma \cap B_\gamma = \emptyset$, as $\H$ is Hausdorff.

  We now take $W_x = U_x \cap \bigcap_{\gamma \in N} A_\gamma$, an open set containing $x$, and $W_y = U_y \cap \bigcap_{y \in N}\gamma^{-1}B_\gamma$, an open set containing $y$.

  Then for all $\gamma \in \Gamma, W_x \cap \gamma W_y = \emptyset$. Indeed, $W_x \subset U_x \subset K_x$ and $W_y \subset U_y \subset K_y$, so if $W_x \cap \gamma W_y \neq \emptyset$, then $\gamma \in N$. But if $\gamma \in N$, then $W_x \subset A_\gamma$ and $\gamma W_y \subset B_\gamma$, and $A_\gamma \cap B_\gamma = \emptyset$, so $W_x \cap \gamma W_y = \emptyset$.
\end{proof}
The next goal is to define the topology of $X(\Gamma) = \Gamma \diagdown \H \sqcup \Gamma \diagdown \P^1(\Q)$.
\begin{definition}
  We set $\H^\ast = \H \sqcup \P^1(\Q)$. We let $GL_2(\Q)^+$ act on $\H^\ast$ by the usual action on $\H$ and $\P^1(\Q)$.

  We define a topology on $\H^\ast$ by declaring $\H$ to be an open subspace with its usual topology, and by giving $z = \alpha\infty$ the basis of open nbhds $\alpha V_R \cup \{z\} = \alpha(V_R \cup \{\infty\})$, where $V_R = \{\tau \in \H: \Im(\tau) > R\}$. Note that $\alpha(V_r \cup \{\infty\})$ only depends on $z$ and $R$, and not on the choice of $\alpha$.

  We give $X(\Gamma)$ the quotient topology
\end{definition}
If $\gamma \in \Gamma(1)$, then $\gamma:\H^\ast  \to \H^\ast$ is a homeomorphism. We define $X(\Gamma) = \Gamma \diagdown \H^\ast$, endowed with the quotient topology. We write $\pi : \H^\ast \to X(\Gamma)$ for the quotient map.

Why is the topology defined this way? If $R>2$, then for all $\gamma \in \Gamma(1)$, $\gamma V_r \cap V_r \neq \emptyset \implies \gamma \in \Gamma_\infty = \Stab_{\Gamma(1)}(\infty)$. Indeed, if $\tau \in \gamma V_r \cap V_r$, say $\tau = \gamma \tau'$ for some $\tau' \in V_R$, then there is $\delta, \epsilon \in \Gamma_\infty$ such that $\delta \tau, \epsilon \tau'$ lie in $\mathscr{F}$.

We can further require $\delta \tau, \epsilon \tau$ have real part in $[-\frac12, \frac12)$. It follows that $\delta \tau = \epsilon \tau'$, since they are $\Gamma(1)$-conjugate. We thus have $\tau = \delta^{-1}\epsilon \gamma \tau$, so $\delta^{-1}\epsilon \gamma = \pm 1$, so $\gamma \in \Gamma_\infty$.

We have a commutative diagram:
\begin{center}
  \begin{tikzcd}
    \H^\ast \arrow{r} & X(\Gamma) \\
    V(R) \arrow{u} \arrow{r} & V_R/\Gamma \cap \Gamma_\infty \arrow{u}
  \end{tikzcd}
\end{center}
The map $V_R/\Gamma \cap \Gamma_\infty \to X(\Gamma)$ is injective, continuous, and open, so a homeomorphism onto its image.

We have a continuous bijection $V_R/\Gamma \cap \Gamma_\infty \to D_R = \{q_h \in \C: |q_h| < e^{-2\pi R/h}\}$ given by the formula $\infty \mapsto 0, \Gamma\cap \Gamma_\infty \cdot \tau \mapsto e^{2\pi \im \tau/h}$. This map is open by the open mapping theorem from complex analysis. Hence $\pi(V_R)$ is an open neighbourhood of $\pi(\infty)$ in $X(\Gamma)$, which is homeomorphic to the disc $D_R \subseteq \C$. Similarly, if $\alpha \in \Gamma(1)$ and $\Gamma \cdot \alpha\infty$ is a cusp of $\Gamma$ of width $h$, then $\pi(\alpha V_R)$ for any $R > 0$ is an open neighbourhood of $\pi(\alpha \infty)$ which is homeomorphic to the disc $D_R$ by the map which sends $\alpha \infty \mapsto 0$, and $\Gamma \cdot \tau$ for $\tau \in \alpha V_R \mapsto e^{2\pi\im \alpha^{-1}\tau/h}$.

\begin{theorem}
  $X(\Gamma)$ is connected, Hausdorff, and compact.
\end{theorem}
\begin{proof}
  $\H^\ast$ is connected - if $\H^\ast = U\sqcup V$ for $U, V$ open, then $\H = (U \cap \H) \cup (V \cap \H)$, so without loss of generality $\H \subseteq U$, and $V \subset \P^1(\Q)$. If $z \in \P^1(\Q)$, then $\alpha V_R \subset U$ for some $R$, but $\alpha V_R \cap \H = \alpha V_R \cap U \neq \emptyset$, so $V = \emptyset$, and so $\H^\ast$ is connected.

  For $X(\Gamma)$ is Hausdorff, it's enough to take the pairs $\Gamma \cdot \tau, \Gamma \cdot \alpha\infty$, and $\Gamma \alpha \infty, \Gamma \beta \infty$, and construct disjoint open neighbourhoods in each case.

  In the first case, we can find an open set $U_\tau \subset \H$ and a compact set $K_\tau \subset \H$ such that $\tau \in U_\tau \subset K_\tau$. We saw last time that we can find a constant $C_\tau >0$ such that $\Im(\gamma \tau) \leq C_\tau$ for all $\gamma \in \Gamma(1)$ and $z \in K_\tau$.

  If $R > C_\tau$, then $\gamma K_\tau \cap V_R = \emptyset$ for all $\gamma \in \Gamma(1)$, and hence $\gamma U_\tau \cap \alpha V_R =\emptyset$ for all $\gamma \in \Gamma$.

  This means that $\pi(U_\tau)$ and $\pi(\alpha V_R)$ are disjoint.

  If $\Gamma \alpha \infty, \Gamma \beta \infty$ are distinct cusps, then $\alpha V_R, \beta V_R$ are distinct when $R > 2$. If $\gamma \in \Gamma$ and $\gamma\alpha V_R \cap \beta V_R \neq \emptyset$, then there is $\delta \in \Gamma_\infty$ such that $\gamma \alpha= \beta \delta$, and so we have $\gamma \alpha \infty = \beta \infty \contr$.

  Hence $\pi(\alpha V_R), \pi(\beta V_R)$ are disjoint.

  For compactness, we first show that $\mathscr{F}^\ast = \mathscr{F}\cup \{\infty\}$ is compact. It's enough to show that, for all $R > 0$, $\mathscr{F}^\ast - V_R$ is compact. But $\mathscr{F}^\ast -V_R = \{\tau \in \H : |\tau| \geq 1, \Re \tau\in [-\frac12, \frac12], \Im \tau \leq R\}$. This is closed and bounded in $\H$ so is compact.

  If $\gamma_1, \ldots, \gamma_n$ is a transversal for $\Gamma \diagdown \Gamma(1)$, then $\pi(\bigcup_{i=1}^n \gamma_i \mathscr{F}^\ast) = X(\Gamma)$. So $X(\Gamma)$ is a continuous image of a compact set, so compact.
\end{proof}

We now show how to give $X(\Gamma)$ the structure of a Riemann surface, by giving explicit charts.

We let $I$ be a set of representatives for the $\Gamma$-orbits in $\H^\ast$. For each $x \in I$, we construct a chart $\phi_x : U_x \to V_x$ where $U_x \subset X(\Gamma)$ is an open neighbourhood of $\pi(x)$, and $V_x \subset \C$ is an open subset.

If $x \in \P^1(\Q)$, say $x = \alpha\infty$ for some $\alpha \in \Gamma(1)$, then we define $U_x = \pi(\alpha V_z)$, $V_x = \{q_h \in \C: |q_h|< e^{-2\pi R/h}\}$, and $\phi_x(\pi(\alpha\infty)) = 0, \phi_x(\pi(\alpha \tau)) = e^{2\pi\im \tau/\H}$ if $\tau \in V_z$. We've already seen that $\phi_x$ is a homeomorphism.

If $x \in \H$, we first show that we can find an open set $W_x \subset \H$ with the following properties:
\begin{enumerate}
  \item $x \in W_x$ and $W_x$ is stable under $\Stab_\Gamma(x)$.
  \item If $y \in W_x$ and $y \neq x$, then $\Stab_\Gamma(y) = \Gamma \cap \{\pm 1\}$.
\end{enumerate}
To do this, choose $M_x \subset \H$ open and $K_x \subset \H$ compact, such that $x \in M_x \subset K_x$, and let $N = \{\gamma \in \Gamma: \gamma k_x \cap k_y \neq \emptyset\}$. Then $N$ is finite, and contains $\Stab_\Gamma(x)$. If $\gamma \in N - \Stab_\Gamma(x)$, then $\gamma x \neq x$, so we can find $A_\gamma, B_\gamma \subset \H$ open such that $x \in A_\gamma, \gamma x \in B_\gamma$, and $A_\gamma \cap B_\gamma = \emptyset.$

We define $W_x = M_x \cap \bigcap_{\gamma \in N - \Stab_\Gamma(x)} (A_\gamma \cap \gamma^{-1}B_\gamma)$. This is an open subset of $\H$ containing $x$. If $\gamma \in \Gamma$ and $W_x \cap \gamma W_x \neq \emptyset$, then $\gamma \in N$. If $\gamma \notin \Stab_{\Gamma}(x)$, then $W_x \cap \gamma W_x \subset A_\gamma \cap B_\gamma = \emptyset$.

Consider the M\"obius transformation $\psi_x(z) = \frac{z-x}{z-\bar{x}}$. Then $\psi_x(x) = 0, \psi_x(\infty)=\infty, \psi_x \Stab_\Gamma(x) \psi_x^{-1}$ stabilises both $0$ and $\infty$.

Any M\"obius transformation which stabilises $0$ and $\infty$ and which is of finite order must be given by $z \mapsto \zeta z$ for some root of unity $\zeta$. We can assume, after shrinking $W_x$, that $\psi_x(w_x)$ is an open disc $D_\epsilon$ for some $0 < \epsilon <1$. Then $W_X$ is stable under $\Stab_\Gamma(x)$.

If $y \in W_x$ and $y \neq x$ and $\delta \in \Gamma$ and $\delta y = y$. Then $\delta W_x \cap W_x \neq \emptyset$, so $\delta \in \Stab_\Gamma(x)$, so $\psi_X \delta \psi_x^{-1}$ stabilises $\psi_x(y) \neq 0$, and so $\psi_x \delta \psi_x^{-1}$ is trivial, giving $\delta \in \Gamma \cap \{\pm 1\}$.

We conclude that $\pi(W_x)$ is an open subset of $X(\Gamma)$ which contains $\pi(x)$ and which is homeomorphic to $W_x/\Stab_\Gamma(x) \cong D_\epsilon/ \psi_x \Stab_\Gamma(x) \psi_x^{-1}$.

The group $\psi_x \Stab_\Gamma(x) \psi_x^{-1} / \Gamma \cap \{\pm 1\}$ is cyclic of some order $n_x$, generated by $z \mapsto e^{2\pi\im/n_x}\cdot z$. It follows that $D_\epsilon/ \psi_x \Stab_\Gamma(x)\psi_x^{-1}$ is homeomorphic to $D_{\epsilon^{n_x}}$, via the map $z \mapsto z^{n_x}$.

We can now write down our chart around the point $\pi(x)$: we take $U_x = \pi(W_x), V_x =D_{\epsilon^{n_x}}, \phi_x:U_x \to V_x$ defined by $\phi_x(\pi(z)) = \psi_x(z)^{n_x}$ when $z \in W_x$.
\begin{proposition}
  $f \mapsto \pi \circ f|_{\H}$ defines a bijection between the meromorphic functions on $X(\Gamma)$ (i.e. morphisms $X(\Gamma) \to \hat{\C}$) and modular functions of weight 0 and level $\Gamma$.
\end{proposition}
\begin{proof}
  The map $\pi|_{\H}: \H \to Y(\Gamma)$ is a morphism of Riemann surfaces, so if $f: X(\Gamma) \to \hat{\C}$, then $F = f \circ \pi|_{\H}$ is a morphism, so is weakly modular of weight 0 and level $\Gamma$. We must check $F$ is meromorphic at infinity.

  Let $\alpha \infty \in \P^1(\Q)$. Since $f$ is meromorphic, there exists a meromorphic function $g_\alpha: D \to \hat{\C}$, where $D$ is an open disc centered at 0, such that, for all $\tau \in V_2, f(\pi(\alpha\tau)) = F(\alpha \tau) = F|_0[\alpha](\tau) = g(q_h)$. So $\tilde{F|_0[\alpha]}$ extends to a meromorphic function in $D$, and so $F$ is meromorphic at the cusp $\Gamma \cdot \alpha \infty$.

  Now let's suppose that $F$ is a modular function of weight 0 and level $\Gamma$. Then $F: \H \to \hat{\C}$ factors through $f: Y(\Gamma)\to \hat{\C}$. We need to show that $f$ extends to a continuous map $f: X(\Gamma)\to \hat{\C}$ and that this $f$ is a morphism of Riemann surfaces.

  The computation to show that $f$ extends to $X(\Gamma)$ and is meromorphic in the charts around the cusps is the previous computation just done in reverse.

  We check $f$ is meromorphic in a chart $\phi_x(\pi(z)) = \psi_\tau(x)^{n_x}$ in a neighbourhood $U_x$ of a point $\pi(\tau)$. Explicitly, we need to show that the function $w = \psi_\tau(z)^{n_x} \mapsto F(z)$ is meromorphic in $D$.

  Equivalently, $w\mapsto (F \circ \psi_\tau^{-1})(\psi_\tau(z))$ is meromorphic in $D$. $F \circ \psi_\tau^{-1}$ is meromorphic in an open disc $D'$ centered at 0, and it satisfies $F \circ \psi_\tau^{-1}(\zeta{n_x} z) = F \circ \psi_\tau^{-1}(z)$ for every $\zeta_{n_x}$ an $n_x\th$ root of unity.  The result then follows from the following lemma.
\end{proof}
\begin{lemma}
  If $g$ is a meromorphic function in $D'$ and for all $z \in D', g(z) = g(e^{2\pi\im/n_x}z)$, then there exists a meromorphic function $h$ in $D$ such that $h(z^n) = g(z)$.
\end{lemma}
\textbf{Example.} $j(\tau)$ is a modular function of weight 0 and level $\Gamma(1)$, so it defines a morphism $X(\Gamma(1)) \eqqcolon X(1) \to \hat{\C}$. This morphism is bijective, so is an isomorphism of Riemann surfaces.
\begin{definition}
  If $U \subseteq \C$ is an open subset, then a holomorphic differential is a symbol of the form $f(z)dz$, where $f:U \to \C$ is a holomorphic function. We write $\Omega^1(U)$ for the set of holomorphic differentials in $U$, which is a $\C$-vector space.

  If $g: U \to V$ is a holomorphic map between two open subsets of $\C$, then we write $g^\ast$ for the induced pullback map $g^\ast:\Omega^1(V) \to \Omega^1(U)$ given by $g^\ast(f(w)dw) = f(g(z))g'(z)dz$.

  If $X$ is a Reimann surface, then a holomorphic differential on $X$ is the data for every chart $\phi_i : U_i \to V_i$ of a holomorphic differential $\omega_i \in \Omega^1(V_i)$. These are required to satisfy some compatibility relation: for every $i,j$, the pullback of $\omega_j|_{\phi_j(U_i \cap U_j)} \in \Omega^1(\phi_j(U_i \cap U_j))$ under the map $\phi_j \circ \phi_i^{-1}$ is equal to $\omega_i|_{\phi_i(U_i \cap U_j)}$. We write $\Omega^1(X)$ for the $\C$-vector space of holomorphic differentials.
\end{definition}
\begin{theorem}
  If $X$ is compact, then $\Omega^1(X)$ is finite dimensional, and its dimension $g_X$ is called the genus of $X$.
\end{theorem}
\textbf{Example.} $g_{\hat{C}} = 0 \implies g_{X(1)} = 0$. We're going to prove:
\begin{theorem}
  If $\Gamma \leq \Gamma(1)$ is a congruence subgroup, then $g_{X(\Gamma)} = 1+ \frac{[\Gamma(1):\Gamma \cdot \{\pm 1\}]}{12} - \frac{\epsilon_2}{4} - \frac{\epsilon_3}{3} - \frac{\epsilon_\infty}{2}$, where:
  \begin{itemize}
    \item $\epsilon_\infty$ is the number of cusps of $\Gamma$.
    \item $\epsilon_3$ is the number of elliptic points of $\Gamma$ of period 3, i.e., the number of $x \in Y(\Gamma)$ such that $n_x = 3$.
    \item $\epsilon_2$ is the number of elliptic points of $\Gamma$ of period 2.
  \end{itemize}
\end{theorem}
\textbf{Remark.} An elliptic point of $\Gamma$ is a point $x = \pi(\tau), \tau \in \H$, such that $\Stab_\Gamma(\tau)/\Gamma \cap \{\pm 1\}$ is non-trivial. If $x$ is an elliptic point, then $\Stab_\Gamma(\tau)/\Gamma \cap \{\pm 1\} \injection \Stab_{\Gamma(1)}(\tau)/\{\pm 1\}$. This means $\tau$ is $\Gamma(1)$-conjugate to $\rho = e^{2\pi\im/3}$ or $\im$, and the stabilizer of $\tau$ is cyclic of order 3 or 2.

We will use the following theorem to prove \textbf{4.10}:
\begin{theorem}[Riemann-Hurwitz]
  Let $f: X \to Y$ be a non-constant morphism of compact Riemann surfaces. Then
  \[2-2g_X = d(2-2g_Y) - \sum_{x \in X}(e_x-1)\]
  where $d = \deg f$, and $e_x$ is the ramification index at a point $x \in X$.
\end{theorem}
Here, the ramification index at $x$ is defined as follows: choose charts $\phi_x: U_x \to V_x$ around $x$ and $\phi_y : U_y \to V_y$ around $y =f(x)$ such that $\phi_x(x) = 0, \phi_y(y) = 0$. Then $\phi_y \circ f \circ \phi_x^{-1}$ is a holomorphic function at $z=  0$, and so takes the form $z^n g(z)$ for some $n \geq 1$, and $g(z)$ holomorphic non-vanishing at $z= 0$. Then we define $e_x = n$.

The degree $\deg f$ is defined to be $\sum_{x \in f^{-1}(y)}e_x$ for any $y \in Y$. This is independent of choice of $y$.

To prove \textbf{4.10}, we'll apply R-H to the morphism $f: X(\Gamma) \to X(1)$ of Riemann surfaces.

The key input is the computation of ramification indices. If $x = \pi(\tau)$ for $\tau \in \H$, then a chart around $x$ ahs the form $\pi(z) \mapsto \psi_\tau(z)^{n_x}$. A chart around $f(x)$ has the form $\psi_\tau(z)^{n_{f(x)}}$. In these charts, $f$ has the form $w \mapsto w^{n_{f(z)}/n_x}$, so $e_x = n_{f(x)}/n_x$. If $x = \pi(\alpha \infty)$, then a chart around $x$ is $\pi(\alpha \tau) \mapsto e^{2\pi \im \tau/h}$, and a chart around $f(x)$ is $\pi(\alpha \tau) \mapsto e^{2\pi\im \tau} = (e^{2\pi\im\tau/h})^h$. In these charts, $f$ is given by $w \mapsto w^h$, where $h$ is the width of the cusp.

\begin{proof}[Proof of \textbf{4.10}]
  We apply R-H to $f:X(\Gamma)\to X(1)$ of compact Riemann surfaces.
  \[2-2 g_{X(\Gamma)} = 2\deg f - \sum_{x \in X(\Gamma)}(e_x-1)\]
  We compute $e_x$ above: $e_x = n_{f(x)}/n_x$ if $x \in Y(\Gamma)$, and the width of the cusp $\Gamma \cdot \alpha \infty$ if $x = \pi(\alpha \infty)$.

  If $\tau = 2$ then for all $\gamma \in \Gamma(1), e_{\pi(\gamma \tau)} = 1$, as $n_{f(\pi(\gamma\tau))} = 1$. So $\deg f = |f^{-1}f(\pi(2))| = |\Gamma \diagdown \Gamma(1)\cdot 2| = |\Gamma \diagdown \Gamma(1) / \{\pm 1\}| = [\Gamma(1):\Gamma\cdot \{\pm 1\}] = d$.

  We now want to compute $\sum_{x \in X(\Gamma)}(e_X - 1)$ in terms of $d, \epsilon_2, \epsilon_3, \epsilon_\infty$. If $e_x > 1$, then either $x$ is a cusp or $x \in Y(\Gamma)$ and $n_{f(x)} > 1$, which case $f(x) = \Gamma(1)\cdot \im$ or $\Gamma(1) \cdot \rho$.
  \[\sum_{x \in f^{-1}(\Gamma(1)\cdot \im)}(e_x - 1)=d-|f^{-1}(\Gamma(1)\cdot \im)|\]
  Let $a_i = |\{x \in f^{-1}(\Gamma(1)\cdot \im) : e_x = 1\}|, b_i = |\{x \in f^{-1}(\Gamma(1)\cdot \im): e_x = 2\}|$. Then $a_i + 2b_i = d, a_i + b_i = |f^{-1}(\Gamma(1)\cdot \im)|$, and $a_i = \epsilon_2$.

  So $b_i = \frac{d-\epsilon_2}{2}, d - (a_i+b_i) = \frac{d-\epsilon_2}{2}$.

  A similar computation for $\rho$ gives $a_\rho = \epsilon_3, b_\rho = \frac{d-\epsilon_\rho}{3}$.

  So $\sum_{x \in f^{-1}(\Gamma(1)\cdot \rho)} = \frac{2}{3}(d-\epsilon_3)$.

  Also $\sum_{x \in f^{-1}(\Gamma(1)\cdot \infty)} = d- \epsilon_\infty$.

  So $2-2g_{X(\Gamma)} = 2d - \frac{d}{2} + \frac{\epsilon_2}{2} - \frac{2d}{3} + \frac{2}{3}\epsilon_3 - d + \epsilon_\infty$, which rearranges to the required form.
\end{proof}
\textbf{Example.} Let $\Gamma = \angle{\Gamma(2), S}$. We know $\epsilon_\infty = 2$, and $[\Gamma(1):\Gamma] = 3$. Also $S \in \Gamma, S\im = \im$, so $\epsilon_2 \geq 1$.

So $g_{X(\Gamma)} = \frac{1}{4} - \frac{\epsilon_2}{4} - \frac{\epsilon-3}{3}$. Hence $g_{X(\Gamma)} = 0, \epsilon_2 = 1, \epsilon_3 = 0$, and so $X(\Gamma) \cong \hat{\C}$.

\begin{definition}
  Let $n \in \Z$, and $U \subset \C$. We define a holomorphic $n$-differential to be a symbol $f(z)(dz)^n$, where $f:U \to \C$ is a holomorphic function. If $f$ is meromorphic, we can similarly have a meromorphic $n$-differential, and write it $f(z)(dz)^{\otimes n}$.

  We write $\Omega^{\otimes nn}(U)$ for the $\C$-vector space of holomorphic $n$-differentials in $U$, and $\Omega^{\otimes n}_!(U)$ for the meromorphic $n$-differentials.

  If $g:U \to V$ is a holomorphic map between open subsets of $\C$, we can define a pullback map $g^\ast : \Omega^{\otimes n}(V)\to \Omega^{\otimes n}(U)$ by the formula
  \[g^\ast(f(w)(dw)^n) = f(g(z))g'(z)^n (dz)^n\]
\end{definition}
If $X$ is a Riemann surface, we define a holomorphic $n$-differential on $X$ as the data of $\omega_i \in \Omega^{\otimes n}(V_i)$ for every chart $\phi_i:U_i \to V_i$, satisfying the relation that, for all $i,j$, $(\phi_j \circ \phi_i^{-1})^\ast(\omega_i|_{\phi_i(U_i \cap U_j)}) = \omega_j|_{\phi_j(U_i \cap U_j)}$, and similarly we define meromorphic $n$-differentials on $X$, denoted $\Omega^{\otimes n}(X), \Omega^{\otimes n}_!(X)$.

\begin{proposition}
  Let $n \in \Z$. Then the map $\Omega_!^{\otimes n}(X(\Gamma)) \to \Omega^{\otimes n}_!(\H)$ given by
  \[\omega \mapsto (\pi|_\H)^\ast(\omega) = f(\tau)(d\tau)^{\otimes n}\]
  defines a bijection between $\omega \in \Omega^{\otimes n}_!(X(\Gamma))$ and the set of modular functions $f(\tau)$ of weight $k=2n$ and level $\Gamma$.
\end{proposition}
\begin{proof}
  Let $\omega \in \Omega_!^{\otimes n}(X(\Gamma))$ and write $(\pi|_\H)^\ast(\omega) = f(\tau)(d\tau)^{\otimes n}$.

  We first explain why $f$ is invariant under the weight $k$ action of $\Gamma$. For all $\gamma \in\Gamma, (\pi|_\H \circ \gamma) = \pi|_\H$, so $(\pi|_\H)^\ast = \gamma^\ast \circ (\pi|_\H)^\ast$.

  Hence $\gamma^\ast(f(\tau)(d\tau)^n) = f(\gamma \tau)\gamma'(\tau)^n(d\tau)^n = f(\gamma\tau)j(\gamma,\tau)^{-2n}(d\tau)^n=f(\tau)(d\tau)^n$.

  So $f|_k[\gamma] = f$.

  We next check that $f$ is meromorphic at each cusp $\Gamma \cdot \alpha \infty$. Since $\omega$ is a meromorphic differential, there is a meromorphic function $g$ in a disc around $q_h = 0$ such that, in the chart $\pi(\alpha V_2) \to D, \pi(\alpha \tau)\mapsto e^{2\pi\im\tau/h}$, $w$ is $g(q_h)dq_h$.

  In $\alpha V_2, \pi^\ast(\omega) = f(\tau)d\tau$ is given by the pullback of $g(q_h)dq_h$ under the map $\tau \mapsto e{^2\pi\im\alpha^{-1}\tau/h}$. Hence $f(\tau)(d\tau)^n = g(e^{2\pi\im\alpha^{-1}\tau/h})\frac{2\pi\im}{h}j(\alpha^{-1}\tau)^{-2n}(e^{2\pi\im\alpha^{-1}\tau/h})^n(d\tau)^{\otimes n}$.

  So $f(\tau) = g(e^{2\pi\im\alpha^{-1}\tau/h})\frac{2\pi\im}{h}j(\alpha^{-1},\tau)^{-2n}(e^{2\pi\im\alpha^{-1}\tau/h})^n$, if $\tau \in \alpha V_2$.

  So $f|_k[\alpha](\tau) = g(q_h)\frac{2\pi\im}{h}q_h^n$, where $q_h = e^{2\pi\im\tau/h}$. This is meromorphic as a function of $q_h$, so we see that $f$ is meromorphic at the cusp $\Gamma\cdot\alpha\infty$.

  The remainder of the proof is an exercise.
\end{proof}
\begin{definition}
  Let $X$ be a Riemann surface, $\omega \in \Omega^{\otimes n}_!(X)$. If $x \in X$ then the order $v_x(w)$ at $x$ is defined as follows: choose a chart $\phi_x: U_x \to V_x$ around $x$, and write $\omega_x = f(z)(dz)^{\otimes n}$, where $f:V_x \to \hat{\C}$ is a meromorphic function. Then $v_x(\omega)$ is the order of $f$ at the point $\phi_x(x)\in V_x$, and is independent of the choice of chart (check!).
\end{definition}
\begin{proposition}
  Let $\omega \in \Omega_!^{\otimes n}(X(\Gamma))$ corresponding to a modular function $f$ of weight $k=2n$ and level $\Gamma$.  Then:
  \begin{enumerate}
    \item If $x = \pi(\alpha \infty)$, then $v_x(\omega) = v_\infty(f|_k[\alpha]) - n$.
    \item If $x \in Y(\Gamma)$, then $n_x v_x(\omega) = v_\tau(f)-n(n_x-1)$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  The formula above gives $v_x(\omega) = v_x(g) = v_\infty(f|_k[\alpha]) - n$ in the first case.

  In the second case, we take a chart $\phi_x:U_x \to V_x$ around $x$, given by $\phi_x(\pi(z)) = \psi_\tau(z)^{n_x}$, where $\pi(\tau) = x$.

  We can then write $\omega_x = g(\omega)(d\omega)^{\otimes n}$ for some $g:V_x \to \hat{\C}$ meromorphic; then $(\pi|_{\H})^\ast(\omega_x)$ is given in a neighbourhood of $\tau$ by $g(\psi_\tau(z)^{n_x})n_x \psi_\tau(z)^{n_x-1}\psi_\tau'(z)(dz)^{\otimes n}$.

  Hence $f(z) = g(\psi_\tau(z)^{n_x})n_x\psi_\tau(z)^{n_x-1}\psi_\tau'(z)^n$ in a neighbourhood of $\tau$, and so $v_\tau(f) = n_x v_x(\omega) + n(n_x-1)$.
\end{proof}
\begin{corollary}
  The map $\omega \mapsto (\pi|_{\H})^d \omega = f(\tau)d\tau$ restricts to an isomorphism $\Omega^1(X(\Gamma)) \to S_2(\Gamma)$.

  In particular, $\dim_\C S_2(\Gamma) = g_{X(\Gamma)}$.
\end{corollary}
\begin{proof}
  If $\omega \in \Omega^1_!(X(\Gamma))$ then $\omega$ is holomorphic if and only if $v_x(\omega) \geq 1$ for all $x \in X(\Gamma)$.

  If $f$ is a modular function, then $f$ is a cuspidal modular form if and only if, for all $\alpha \in \Gamma(1), v_\infty(f|_k[\alpha]) \geq 1$, and for all $\tau \in \H, v_\tau(f) \geq 0$. We've just shown that $v_x(\omega) = v_\infty(f|_k[\alpha]) - 1$ if $x = \pi(\alpha\infty)$, and $v_\tau(f) = n_xv_x(\omega) + (n_x-1)$ if $x = \pi(\tau)$.

  Note that $v_\tau(f)$ and $v_x(\omega)$ are integers, so these conditions match up.
\end{proof}
\begin{definition}
  Let $X$ be a Riemann surface. A divisor on $X$ is a formal sum of points $D=\sum_{x \in X} n_x \cdot x$ where for all $x \in X$, $n_x \in \Z$, and only finitely many $n_x$ are nonzero.

  We define the degree of the divisor $\deg D = \sum_{x\in X} n_x$.

  Divisors form an abelian group, and $\deg(D+E) = \deg D + \deg E$.

  If $D$ is a divisor on $X$, we define $\Omega^{\otimes n}(D)(X) = \{\omega in \Omega^{\otimes n}_! (X) : \forall x \in X, v_x(\omega) + n_x \geq 0\}$.
\end{definition}
For example, if $n = 0$, then $\Omega^{\otimes 0}_! (x)$ is the space of meromorphic functions on $X$. If $f$ is a meromorphic function, $x \in X$ and $n_x =0$, then $v_x(f) + n_x \geq 0$ is the same as saying $f$ is holomorphic at $x$. If $n_x > 0$, then $v_x(f) + n_x \geq 0$ if and only if $f$ has a pole of order at most $n_x$ at $x$, and if $n_x < 0$, then $f$ has a zero of order at least $-n_x$ at $x$.

\begin{corollary}
  There are isomorphisms of vector spaces, for $n \in \Z, k=2n$:
  \[M_k(\Gamma) \to \Omega^{\otimes n}\left(\sum_{\Gamma \cdot z \in \Gamma \diagdown \P^1(\Q)} n\cdot (\Gamma \cdot z) + \sum_{x \in X} \floor{n(1-\frac{1}{n_x})}\right)\]
  and
  \[S_k(\Gamma) \to \Omega^{\otimes n}\left(\sum_{\Gamma \cdot z \in \Gamma \diagdown \P^1(\Q)} (n-1)\cdot (\Gamma \cdot z) + \sum_{x \in X} \floor{n(1-\frac{1}{n_x})}\right)\]
\end{corollary}
\begin{proof}
  We recall if $\omega \leftrightarrow f$, then $v_\infty(f|_h[\alpha]) = v_{\pi(\alpha\infty)}(\omega)+n$, and $v_\tau(f) = n_x v_x(\omega) + n(n_x-1)$.

  So $f \in M_k(\Gamma)$ if and only if, for all $\tau \in \H, v_\tau(f) \geq 0$ and for all $\alpha \in \Gamma(1), v_\infty(f|_h[\alpha]) \geq 0$, i.e. for all $x \in Y(\Gamma), v_x(\omega) \geq -n(1-\frac{1}{n_x})$ and for all cusps $z \in \P^1(\Q), v_{\Gamma\cdot z}()\omega) \geq -n$. Since $n_x \in \Z$, we may introduce the floors required, and after rearranging we are done.
\end{proof}
\begin{theorem}[Riemann-Roch]
  Let $X$ be a compact Riemann surface, $n \in \Z$, and let $D$ be a divisor on $X$ such that $\deg D + (2g-2)(n-1) > 0$. Then $\dim_\C \Omega^{\otimes n}(D)(X) = \deg D + (2g-2)n + (1-g) = \deg D + (2n-1)(g-1)$.
\end{theorem}
We can use this compute $\dim_\C M_k(\Gamma)$ and $\dim_\C S_k(\Gamma)$, when $k=2n, n \in \N$.

By the previous corollary, we want to compute the degree of $D = n\sum(\Gamma \cdot z) + \sum \floor{n(1-\frac{1}{n_x})}$, which is $n\epsilon_\infty + \epsilon_2 \floor{n/2} + \epsilon_3 \floor{n/3}$. Then we check that $\deg D + (2g-2)(n-1) > 0$ (recalling that $2g-2 = (d/12 - \epsilon_2/2 - 2\epsilon_3/3 - \epsilon \infty)$, and this inequality holds.

Hence we can apply Reimann-Roch to find:
\[\dim_\C M_k(\Gamma) = \dim_\C \Omega^{\otimes n}(D) = \deg D + (2n-1)(g-1)\]
giving us:
\begin{theorem}
  If $n \in \N, k= 2n$, then $\dim_\C M_k(\Gamma) = n\epsilon_\infty + \epsilon_2\floor{n/2} + \epsilon_e \floor{2n/3} + (k-1)(g-1)$.

  If $n \geq 2$, then $\dim_\C S_k(\Gamma) = (n-1)\epsilon_\infty + \epsilon_2\floor{n/2} + \epsilon_3 \floor{2n/3} + (k-1)(g-1)$.
\end{theorem}
\begin{proof}
  The condition we need to check is $\deg D' + (2g-2)(n-1) > 0$, where
  \[D' = \sum_{\Gamma \cdot z}(n-1)(\Gamma\cdot z)  + \sum_{x} \floor{n(1-1/n_x)}x\]
  The same computation gives $\deg D' + (2g-2)(n-1) = \epsilon_2(\floor{n/2} - \frac{n-1}{2}) + \epsilon_3(\floor{2n/3} - \frac{2(n-1)}{3}) + (n-1)d/6 > 0$.
\end{proof}
For example, if $\Gamma = \Gamma_1$, then $g=0, \epsilon_2=  \epsilon_3 = \epsilon_\infty = 1$, and so $\dim_\C S_k(\Gamma(1)) = \frac{k}{2}-1 + \floor{\frac{k}{4}} + \floor{\frac{k}{3}} - (k-1) = \floor{k}{4} + \floor{k}{3} - \frac{k}{2}$, which equals the formula we already know.

If $\Gamma = \angle{\Gamma(2), S}$, then $g = 1 + \frac{1}{4} - \frac{\epsilon_2}{4} - \frac{\epsilon_3}{3} - \frac{\epsilon_\infty}{2}$. We know $\epsilon_\infty = 2, \epsilon_2 \geq 1$, so $g = 0, \epsilon2 = 1, \epsilon_3 = 0$.

If $k \in 2\N, k \geq 4$, then $\dim_\C M_k(\Gamma) = k+\floor{\frac{k}{4}} - (k-1) = \floor{\frac{k}{4}}+1$, and $\dim_\C S_k(\Gamma) = \floor{\frac{k}{4}} - 1$.

When $k=4$, we get $\dim_\C M_4(\Gamma) = 2, \dim_\C S_4(\Gamma) = 0$. This implies that $M_4(\Gamma)$ is spanned by $E_4(\tau), E_4(\frac{\tau+1}{2})$.

We now apply this to the study of $v_\ell(n)$, where $\ell \in 8 \N$. Let $k = \ell/2$, then we know that if $\theta(\tau) = \sum_{n \in \Z}e^{\pi\im n^2 \tau}$, then $\theta^\ell \in M_k(\Gamma)$ and $\theta^\ell = \sum_{n \geq 0}r_\ell(n) q_2^n = 1 + 2\ell q_2 + \ldots$.

We also know that $\theta^\ell$ vanishes at the cusp $\Gamma \cdot 1$.

We can use this to get an approximate formula for $r_\ell(n)$. We know that $E_k(\tau) = 1 - \frac{2k}{B_k}\sum_{n \geq 1}\sigma_{k-1}(n)q^n \in M_k(\Gamma)$, and $E_k|_k[\begin{pmatrix}1&1\\0&2\end{pmatrix}](\tau) = \frac{1}{2}E_k(\frac{\tau+1}{2}) = \frac{1}{2}[1-\frac{2k}{B_k}\sum_{n\geq 1}(-1)^n \sigma_{k-1}(n)q_2^n] \in M_k(\Gamma)$, since $E_k|_k[\begin{pmatrix}1&1\\0&2\end{pmatrix}]$ is invariant under $\begin{pmatrix}1&1\\0&2\end{pmatrix}^{-1}\Gamma(1)\begin{pmatrix}1&1\\0&2 \end{pmatrix}$, which contains $\Gamma$.

It then follows that $E_k, E_k|_k[\begin{pmatrix}1&1\\0&2\end{pmatrix}]$ give a complement in $M_k(\Gamma)$ to the subspace $S_k(\Gamma)$.

We now find $a, b \in \Q$ such that $\theta^\ell - aE_k -bE_k|_k[\begin{pmatrix}1&1\\0&2\end{pmatrix}] \in S_k(\Gamma)$.

The constant term


\end{document}
