\documentclass[10pt,a4paper]{article}
\input{./preamble.tex}

\title{Elliptic Curves}
\begin{document}
\maketitle
\tableofcontents
\newpage
\section{Fermat's Method of Infinite Descent}
Suppose we have a right-angled triangle $\Delta$ with side lengths $a, b, c$, so that by Pythagoras we have $a^2 + b^2 = c^2$, and $\text{area}(\Delta) = \frac12 ab$.
\begin{definition}
  $\Delta$ is \emph{rational} if $a, b, c \in \Q$, and \emph{primitive} if $a, b, c \in \Z$ coprime.
\end{definition}
\begin{lemma}
  Every primitive triangle is of the form $a = u^2-v^2, b = 2uv, c = u^2+v^2$ for coprime integers $u > v > 0$.
\end{lemma}
\begin{proof}
  If $a, b$ were both odd, then $a^2 + b^2 \equiv 2 \mod 4$, and we have no solutions for $c$. If $a,b$ both even, then they are not coprime. So we may assume $a$ is odd, $b$ is even, $c$ is odd.

  Then $(\frac{b}{2})^2 = \frac{c+a}{2}\frac{c-a}{2}$, and the right hand side is a product of coprime positive integers. So by unique prime factorisation in the integers, $\frac{c+a}{2} = u^2, \frac{c-a}{2} = v^2$ for some coprime integers $u, v$. Rearranging, we have the lemma.
\end{proof}

\begin{definition}
  $D \in \Q_{>0}$ is a \emph{congruent number} if it is the area of a rational triangle.
\end{definition}
Note that, by scaling the triangle, it suffices to consider $D \in \Z_{>0}$ squarefree.

For example, $D = 5,6$ are congruent numbers. $6 = \frac12\cdot 3\cdot 4$, and $3^2+4^2 = 5^2$, and 5 is left as an exercise.

\begin{lemma}
  $D \in \Q_{>0}$ is congruent if and only if $Dy^2 = x^3-x$ for some $x, y \in \Q, y \neq 0$.
\end{lemma}
\begin{proof}
  Lemma \textbf{1.2} shows that $D$ is congruent if and only if $Dw^2 = uv(u^2-v^2)$ for some $u,v,w\in \Q, w\neq 0$.

  Setting $x = \frac{u}{v}, y = \frac{w}{v^2}$ finishes the proof.
\end{proof}

Fermat showed that 1 is not a congruent number.
\begin{theorem}
  There is no solution to
  \begin{align*}
    w^2 = uv(u+v)(u-v)\tag{$\ast$}
  \end{align*} in integers $u,v,w$ with $w \neq 0$.
\end{theorem}
\begin{proof}
  Without loss of generality, $u,v$ are coprime with $u > 0, w> 0$. If $v < 0$ then replace $(u,v,w)$ by $(-v, u, w)$. If $u, v$ are both odd, then replace $(u,v,w)$ by $(\frac{u+v}{2}, \frac{u-v}{2}, \frac{w}{2})$. So we may assume that all of $u, v, u+v, u-v$ are coprime positive integers whose product is a square, and hence are all squares, say $a^2, b^2, c^2, d^2$ respectively, where $a,b,c,d \in \Z_{>0}$.

  Since $u \nequiv v \mod 2$, both $c, d$ are odd. Consider the right angled triangle with side lengths, $\frac{c+d}{2}, \frac{c-d}{2}, a$. This is a primitive triangle, and it has area $\frac{c^2-d^2}{8} = \frac{v}{4} = (\frac{b}{2})^2$.

  Let $w_1 = \frac{b}{2}$. Then lemma \textbf{1.2} gives $w_1^2 = u_1v_1(u_1^2-v_1^2)$ for some $u_1, v_1 \in \Z$, giving a new solution to $(\ast)$. But $4w_1^2 = b^2 = v | w^2$, and so $w_1 \leq \frac12 w$.

  So by Fermat's method of infinite descent, if there were a solution we would have a strictly decreasing infinite sequence of positive integers $\contr$. Hence there is no solution to $(\ast)$.
\end{proof}

\subsection{A Variant for Polynomials}
Here, $K$ is a field with $\charr K \neq 2$. The algebraic closure of $K$ will be $\overline{K}$.
\begin{lemma}
  Let $u, v \in K[t]$ be coprime. If $\alpha u + \beta v$ is a square for four distinct $(\alpha :\beta) \in \P^1$, then $u, v \in K$.
\end{lemma}
\begin{proof}
  Without loss of generality we may assume $K = \overline{K}$, as that doesn't change the degree of polynomials, and every square is still a square.

  Changing coordinates on $\P^1$, we may assume the ratios $\alpha:\beta$ are $(1:0), (0:1), (1:-1), (1:-\lambda)$ for some $\lambda \in K\setminus\{0, 1\}$, with $\mu = \sqrt{\lambda}$.

  Then $u = a^2, v = b^2, u-v = (a+b)(a-b), u-\lambda v = (a+\mu b)(a-\mu b)$ are all squares. They are also coprime, and so by unique factorisation in $K[t]$, $(a+b), (a-b), (a+\mu b), (a-\mu b)$ are all squares.

  But $\max \{\deg a, \deg b\} \leq \frac12 \max \{\deg u, \deg v\}$. So by Fermat's method of infinite descent, we get that the original $u,v \in K$.
\end{proof}

Now we have some important definitions:
\begin{definition}\hspace*{0cm}
  \begin{enumerate}
    \item An \emph{elliptic curve} $E$ over a field $K$ is the projective closure of the affine curve $y^2 = f(x)$ where $f \in K[x]$ is a monic cubic polynomial with distinct roots.
    \item For $L/K$ any field extension, $E(L) = \{ (x,y) \in L^2 : y^2 = f(x)\} \cup \{0\}$. $0$ is called the \emph{point at infinity}.
  \end{enumerate}
\end{definition}
We call the point at infinity $0$ because we will see that $E(L)$ is naturally an abelian group under an operation we will denote by $+$, and $0$ will be the identity for that group. In this course we will study $E(L)$ for $L$ a finite field, a local field, and a number field.

Lemma \textbf{1.4} and theorem \textbf{1.5} together imply that, if $E$ is given by $y^2 = x^3-x$, then $E(\Q) = \{0, (0,0), (\pm 1, 0)\}$, which we will see is the group $C_2\times C_2$.

\begin{corollary}
  Let $E/K$ be an elliptic curve. Then $E(K(t)) = E(K)$.
\end{corollary}
\begin{proof}
  Without loss of generality, $K = \overline{K}$. By a change of coordinates we may assume $E: y^2 = x(x-1)(x-\lambda)$ for some $\lambda \in K\setminus\{0, 1\}$. Suppose $(x, y) \in E(K(t))$. Write $x = \frac{u}{v}$ with $u, v \in K[t]$ coprime. Then $w^2 = uv(u-v)(u-\lambda v)$ for some $w \in K[t]$.

  Unique factorisation in $K[t]$ gives $u, v, u-v, u-\lambda v$ are all squares, and so by lemma \textbf{1.6}, $u, v \in K$, and so $x, y \in K$.
\end{proof}

\section{Some Remarks on Algebraic Curves}
We will be working over an algebraically closed field $K$.
\begin{definition}
  An (irreducible) plane algebraic curve $C = \{f(x, y) = 0\}\subset \A^2$ is \emph{rational} if it has a rational parametrization, i.e. there are $\phi, \psi \in K(t)$ such that:
  \begin{enumerate}
    \item $\A^1 \to \A^2; t \mapsto (\phi(t), \psi(t))$ is injective on $\A^1 \setminus\{\text{finite set}\}$.
    \item $f(\phi(t), \psi(t)) = 0$.
  \end{enumerate}
\end{definition}

\stepcounter{theorem}
\textbf{Examples \thetheorem.}
\begin{enumerate}
  \item Any nonsingular plane conic is rational. For example, take a circle $x^2+y^2 = 1$. Pick a point on it, $(-1, 0)$. Now draw a line through it with slope $t$, and solve for the points of intersection between the curve and the line.
  \begin{figure}[H]
    \centering
    \begin{tikzpicture}
      \begin{axis}[xmin = -2, xmax=2, ymin=-2, ymax=2, ticks=none, axis lines=middle, axis equal, trig format plots = rad, xscale=1.2, yscale=1.2]
        \addplot[domain=0:2*pi, samples=50, blue] ({sin(x)}, {cos(x)});
        \addplot[domain=-3:3, green!60!black] {0.4*(x+1)} node[above left, pos=0.9] {$y=t(x+1)$};
        \node[circle, draw, fill, inner sep=0pt, minimum size=2pt, label={below right:$(-1,0)$}] at (axis cs:-1, 0) {};
        \node[circle, draw, fill, inner sep=0pt, minimum size=2pt, label={below:$p$}] at (axis cs:0.7241,0.6897) {};
      \end{axis}
    \end{tikzpicture}
  \end{figure}
  Solving for the coordinates of $p$, we get the quadratic $x^2 + t^2(x+1)^2 = 1$, i.e. $x = -1$ or $\frac{1-t^2}{1+t^2}$. So we have the rational parametrization $(x,y) = \left(\frac{1-t^2}{1+t^2}, \frac{2t}{1+t^2}\right)$

  \item Any singular plane cubic is rational.
  \begin{figure}[H]
    \begin{subfigure}{0.5\textwidth}
      \begin{tikzpicture}
        \begin{axis}[xmin = -2, xmax=2, ymin=-2, ymax=2, ticks=none, axis lines=middle, axis equal]
          \addplot[domain=0:2, samples=50, blue] {sqrt(x^3)} node[left, pos=0.6] {$y^2=x^3$};
          \addplot[domain=0:2, samples=50, blue] {-sqrt(x^3)};
          \addplot[domain=-3:3, green!60!black] {0.8*x} node[above left, pos=0.4] {$y=tx$};
        \end{axis}
      \end{tikzpicture}
      \caption{Rational Parametrization $(x,y) = (t^2, t^3)$}
    \end{subfigure}
    \begin{subfigure}{0.5\textwidth}
      \begin{tikzpicture}
        \begin{axis}[xmin = -2, xmax=2, ymin=-2, ymax=2, ticks=none, axis lines=middle, axis equal]
          \addplot[domain=-1:2, samples=100, blue] {sqrt(x^3+x^2)} node[left, pos=0.62] {$y^2 = x^2(x+1)$};
          \addplot[domain=-1:2, samples=100, blue] {-sqrt(x^3+x^2)};
          \addplot[domain=-3:3, green!60!black] {0.4*x} node[above left, pos=0.9] {$y=tx$};
        \end{axis}
      \end{tikzpicture}
      \caption{Left as an example on the first sheet}
    \end{subfigure}
  \end{figure}

  \item Corollary \textbf{1.8} shows that elliptic curves are \textit{not} rational.
\end{enumerate}

\begin{definition}
  The \emph{genus} $g(C) \in \Z_{\geq 0}$ is an invariant of a smooth projective curve.
  \begin{itemize}
    \item If $K = \C$, then $g(C) = $ genus of the Riemann surface $C$.
    \item A smooth plane curve $C \subset \P^2$ of degree $d$ has genus $g(C) = \frac{(d-1)(d-2)}{2}$.
  \end{itemize}
\end{definition}
\begin{proposition}
  Let $C$ be a smooth projective curve over $K$, an algebraically closed field. Then:
  \begin{enumerate}
    \item $C$ is rational $\iff g(C) = 0$.
    \item $C$ is an elliptic curve $\iff g(C) = 1$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  A proof of \textit{1} is omitted from this course. For \textit{2}, we check (on the first example sheet) that elliptic curves are smooth plane curves. Then they have degree 3, so genus $\frac{2\cdot 1}{2} = 1$. For the other direction, see later on in the course.
\end{proof}

\subsection{Order of Vanishing}
$C$ will be an algebraic curve, and $K(C)$ its function field, with $P \in C$ a smooth point. Write $\ord_P(f)$ to mean the order of vanishing of $f \in K(C)$ at $P$ (negative if $f$ has a pole).

Fact: $\ord_P : K(C)^\times \to \Z$ is a discrete valuation, i.e. $\ord_P(f_1f_2) = \ord_P(f_1) + \ord_P(f_2)$ and $\ord_P(f_1+f_2) \geq \min \{\ord_P(f_1), \ord_P(f_2)\}$.

We say $t \in K(C)^\times$ is a \emph{uniformizer} at the point $P$ if $\ord_P(t) = 1$.

\stepcounter{theorem}
\textbf{Example \thetheorem.} Let $C = \{g(x,y) = 0\}\subseteq \A^2$, where $g \in K[x,y]$ is irreducible. Then $K(C) = \Frac \frac{K[x,y]}{(g)}$, with $g = g_0 + g_1(x,y) + g_2(x,y) + \ldots$, $g_i$ homogeneous of degree $i$.

Suppose $P = (0, 0) \in C$ is a smooth point, i.e. $g_0 = 0, g_1(x, y) = \alpha x + \beta y$ with $\alpha, \beta$ not both zero.

Let $\gamma, \delta \in K$. It is a fact that $\gamma x + \delta y \in K(C)$ is a uniformizer at $P$ if and only if $\frac{\gamma}{\delta} \neq \frac{\alpha}{\beta}$, i.e. $\alpha\delta-\beta\gamma \neq 0.$

\stepcounter{theorem}
\textbf{Example \thetheorem.} $\{y^2 = x(x-1)(x-\lambda)\}\subset\A^2$, $\lambda \neq 0, 1$. We take the projective closure, i.e. homogenize the equation as $\{Y^2Z = X(X-Z)(X-\lambda Z)\}\subset \P^2$ by setting $x = X/Z, y = Y/Z$.

Have we got new points by taking projective closure? We only get these when $Z = 0$, i.e. $0 = X^3 \implies X = 0$, $Y\neq 0$. Since we're in projective space, this is just one point: $P = (0:1:0)$. We compute $\ord_P(x)$ and $\ord_P(y)$. Put $t = X/Y, w = Z/Y$ (since we can't return to the original affine piece, as it doesn't contain $Z=0$). Then we get $w = t(t-w)(t-\lambda w)$. Now $P$ is the point $(t,w) = (0,0)$. This is a smooth point, as there are linear terms at that point (namely $w$). So $\ord_P(t) = \ord_P(t-2) = \ord_P(t-\lambda w) = 1$, and $\ord_P(w) = 1+1+1 = 3$.

Then:
\begin{align*}
  \ord_P(x) &= \ord_P(X/Z) = \ord_P(t/w) = 1-3 = -2\\
  \ord_P(y) &= \ord_P(Y/Z) = \ord_P(1/w) = -3
\end{align*}

\subsection{Riemann Roch Spaces}
Let $C$ be a smooth projective curve. Then a \emph{divisor} is a formal sum of points on $C$, say $D = \sum_{P \in C} n_P P$ where $n_P \in \Z$, and only finitely many $n_P$ are nonzero, and let $\deg D = \sum_{P \in C} n_P$. These divisors form a group under addition, denoted $\Div(C)$.

$D$ is said to be \emph{effective}, written $D \geq 0$ if $n_p \geq 0$ for all $P \in C$.

If $f \in K(C)^\times$, we write $\div(f) = \sum_{P \in C} \ord_P(f) P$.

The Riemann Roch space of $D \in \Div(C)$ is:
\begin{align*}
  \mathscr{L}(D) = \{f \in K(C) : \div(f) + D \geq 0\}\cup\{0\}
\end{align*}
i.e. the $K$-vector space of rational functions on $C$ with ``poles no worse than specified by $D$."

\begin{theorem}[Riemann Roch for genus 1]
  \begin{align*}
    \dim \mathscr{L}(D) = \begin{cases} 0 & \deg D < 0 \\ 0\text{ or } 1 & \deg D = 0 \\ \deg D & \deg D > 0 \end{cases}
  \end{align*}
\end{theorem}

\textbf{Example 2.6 (revisited).} Our curve is $\{y^2 = x(x-1)(x-\lambda) \} \subset \A^2$, together with $P = (0:1:0)$, the point at infinity. Recall $\ord_P(x) = -2, \ord_P(x) = -3$.

We thus deduce that $\mathscr{L}(2P) = \angle{1, x}, \mathscr{L}(3P) = \angle{1, x, y}$.

\begin{proposition}
  Let $K$ be an algebraically closed field not of characteristic 2. Let $C \subset \P^2$ be a smooth plane cubic, and that $P \in C$ is a point of inflection. Then we may change coordinates such that:
  \begin{align*}
    C: Y^2Z &= X(X-Z)(X-\lambda Z),\;\;\lambda \neq 0, 1\\
    P &= (0:1:0)
  \end{align*}
\end{proposition}
\begin{proof}
  We make a change of coordinates such that $P = (0:1:0)$ and the tangent line to $C$ at $P$, $T_P(C) = \{Z=0\}$. Now let $C = \{F(X,Y,Z) = 0\}$.

  Since $P \in C$ is a point of inflection, $F(t, 1, 0)$ has a triple root at $t = 0$. But $F$ is degree 3, so we have $F(t,1,0) = kt^3$ for $k$ some constant. I.e., there are no terms in $F$ of the form $X^2Y, XY^2, Y^3$.

  So $F \in \angle{Y^2Z, XYZ, YZ^2, X^3, X^2Z, XZ^2, Z^3}$. The coefficient of $Y^2Z$ is nonzero, as otherwise $P$ would be singular. The coefficient of $X^3$ is also nonzero, as $C$ is irreducible and otherwise $\{Z=0\}\subset C$.

  We are free to rescale $X,Y,Z,F$, and so \textsc{wlog} $C$ is defined by \[Y^2Z + a_1XYZ + a_3YZ^2 = X^3+a_2X^2Z+a_4XZ^2+a_6Z^3\]
  We call this Weierstrass form.

  Since our field doesn't have characteristic 2, we may complete the square by substituting $Y = Y - \frac12 a_1X - \frac12 a_3Z$, we may assume $a_1 = a_3 = 0$.

  Now $C: Y^2Z = Z^3f(X/Z)$, where $f$ is a monic cubic polynomial. Since $C$ is smooth, $f$ has distinct roots, which are \textsc{wlog} $0, 1, \lambda$. So \[C : Y^2Z = X(X-Z)(X-\lambda Z)\]which we call the Legendre form.
\end{proof}

It may be shown that the points of inflection on $C = \{F=0\}\subset \P^2$ are given by $F = \det\left(\frac{\partial^2 f}{\partial X_i \partial X_j}\right) = 0$

\subsection{The Degree of a Morphism}
Let $\phi : C_1 \to C_2$ be a nonconstant morphism of smooth projective curves. Let $\phi^\ast : K(C_2) \to K(C_1), f \mapsto f \circ \phi$.

\textbf{Definition.}
\textit{
  \begin{enumerate}
    \item $\deg \phi = [K(C_1) : \phi^\ast K(C_2)]$
    \item $\phi$ is separable if $K(C_1)/\phi^\ast K(C_2)$ is a separable field extension (which by Galois theory is automatic if $\charr K = 0$)
  \end{enumerate}
}

Suppose $P \in C_1, Q \in C_2, \phi:P \to Q$. Let $t \in K(C_2)$ be a uniformizer at $Q$. We then define $e_\phi(p) = \ord_P(\phi^\ast t)$, which is always $\geq 1$, and independent of $t$. $e_\phi(P)$ is called the \emph{ramification index} of $\phi$ at $p$.

\begin{theorem}
  Let $\phi : C_1 \to C_2$ be a nonconstant morphism of smooth projective curves. Then
  \begin{align*}
      \sum_{p \in \phi^{-1}(Q)} e_\phi(P) = \deg \phi
  \end{align*}
  for any point $Q \in C_2$. Moreover, if $\phi$ is separable then $e_\phi(P) = 1$ with at most finitely many exceptions.

  In particular:
  \begin{enumerate}
    \item $\phi$ is surjective
    \item If $\phi$ is separable, $\#\phi^{-1}(Q) \leq \deg \phi$, with equality for all but finitely many choices of $Q$.
  \end{enumerate}
\end{theorem}

\stepcounter{theorem}
\textbf{Remark \thetheorem.} Let $C$ be an algebraic curve. A rational map is given by $\phi: C \dashrightarrow \P^n, P \mapsto (f_0(P):\ldots:f_n(P))$, where $f_0, \ldots, f_n \in K(C)$ are not all zero. If $C$ is smooth then $\phi$ is a morphism.

\section{Weierstrass Equations}
In this section, $K$ is a perfect field (so that all finite extensions of $K$ are separable), with algebraic closure $\bar{K}$.

\textbf{Definition.} An elliptic curve $E$ over $K$ is a smooth projective curve of genus 1 defined over $K$ with a specified $K$-rational point $O_E$.

\underline{Example:} Take $\{X^3+pY^3+p^2Z^3 = 0\} \subset \P^2$ for $p$ prime. This is not an elliptic curve over $\Q$ since there is no $\Q$-points.

\begin{theorem}
  Every elliptic curve $E$ is isomorphic over $K$ to a curve in Weierstrass form via an isomorphism taking $O_E$ to $(0:1:0)$.
\end{theorem}
Proposition \textbf{2.8} treated the special case where $E$ is a smooth plane cubic and $O_E$ is a point of inflection.

If $D \in \Div(E)$ is defined over $K$ (i.e. fixed by the natural action of $\Gal(\bar{K}/K)$, then $\mathscr{L}(D)$ has a basis in $K(E)$, not just in $\bar{K}(E)$).

\begin{proof}
  Note that
  \[\mathscr{L}(2O_E) \subset \mathscr{L}(3O_E)\]
  Pick bases of these spaces, say $\{1, x\}$ and $\{1, x, y\}$.

  Note that $\ord_{O_E}(x) = -2, \ord_{O_E}(y) = -3$. The 7 elements $\{1, x, y, x^2, xy, x^3, y^2\}$ are rational functions with no pole except at $O_E$, where they have poles of degree at most 6, so they all lie in $\mathscr{L}(6O_E)$. Riemann-Roch tells us this space has dimension 6, so there is a dependence relation between these elements.

  Leaving out $x^3$ or $y^2$ gives a basis for $\mathscr{L}(6O_E)$ since each term has a different order pole at $O_E$, so they are independent.

  Therefore this dependence relation \textit{must} involve both $x^3$ and $y^2$. Rescaling $x, y$ we get
  \[ y^2 + a_1 xy + a_3 y = x^3 + a_2 x^2 + a_4 x + a_6 \]
  Let $E'$ be the curve defined by this equation (or rather its projective closure).

  There is a morphism
  \begin{align*}
    \phi: E &\to E'\\
    P &\mapsto (x(P): y(P): 1) = \left(\frac{x}{y}(P) : 1 : \frac{1}{y}(P)\right)\\
    O_E &\mapsto (0:1:0)
  \end{align*}
  $[K(E):K(x)] = \deg(E\xrightarrow{x}\P^1) = \ord_{O_E}\left(\frac{1}{x}\right) = 2$\\
  $[K(E):K(y)] = \deg(E\xrightarrow{y}\P^1) = \ord_{O_E}\left(\frac{1}{y}\right) = 3$\\

  This gives us a diagram of field extensions
  \begin{tikzcd}
    & K(E) \arrow[dash]{d}{} \arrow[dash, swap]{ddl}{2} \arrow[dash]{ddr}{3}\\
    & K(x,y) \arrow[dash]{dl}{} \arrow[dash]{dr}{}\\
    K(x) & & K(y)
  \end{tikzcd}

  So $[K(E):K(x,y)]$ divides both 2 and 3 by the tower law, and hence $K(E) = K(x,y)$, and hence $\deg(E\xrightarrow{\phi}E') = 1$, and $\phi$ is birational. If $E'$ is singular, then it is rational, and so $E$ is also rational $\contr$. So $E'$ is not singular and hence smooth, and we may use remark \textbf{2.10} to $\phi^{-1}$ to see that $\phi^{-1}$ is a morphism, and hence $\phi$ is an isomorphism.
\end{proof}

\begin{proposition}
  Let $E, E'$ be elliptic curves over $K$ in Weierstrass form. Then $E \cong E'$ over $K$ if and only if the Weierstrass equations are related by a change of variables of the form
  \begin{align*}
    x &= u^2x' + r\\
    y &= u^3y' + u^2sx' + t
  \end{align*}
  for $u, r, s, t \in K, u \neq 0$.
\end{proposition}
\begin{proof}
  Using the notation of the previous proof,
  \begin{align*}
    \angle{1, x} = &\mathscr{L}(2O_E) = \angle{1, x'}\\
    \angle{1, x, y} = & \mathscr{L}(3O_E) = \angle{1, x', y'}\\
    \implies &\begin{cases} x = \lambda x'+ r & \lambda_1 r \in K, \lambda \neq 0 \\ y = \mu y' + \sigma x' + t & \mu, \sigma, t \in K, \mu \neq 0\end{cases}
  \end{align*}
  Looking at the coefficients of $x^3$ and $y^2$, $\lambda^3 = \mu^2 \implies (\lambda, \mu) = (u^2, u^3)$ for $u \in K^\times$.

  Put $s = \sigma/u^2$
\end{proof}
The effect of this transformation on the coefficients $a_i$ is on the formula sheet for this course. A Weierstrass equation defines an elliptic curve if and only if defines a smooth curve, if and only if $\Delta(a_1, \ldots, a_6) \neq 0$ where $\Delta$ is as follows:
\begin{align*}
  b_2 &\coloneqq a_1^2+4a_2\\
  b_4 &\coloneqq 2a_4+a_1a_3\\
  b_6 &\coloneqq a_3^2+4a_6\\
  b_8 &\coloneqq a_1^2a_6 + 4a_2a_6 - a_1a_3a_4 + a_2a_3^2 - a_4^2\\
  \Delta &\coloneqq -b_2^2b_8 - 8b_4^3 - 27b_6^2 + 9b_2b_4b_6
\end{align*}

If $\charr K \neq 2,3$, then we can reduce to the case
\begin{align*}
  E: y^2 &= x^3+ax+b \\ \Delta &= -16(4a^3+26b^2)
\end{align*}
\begin{corollary}
  Assume $\charr K \neq 2, 3$. If we have two elliptic curves
  \begin{align*}
    E &: y^2 = x^3 + ax+b\\
    E' &: y^2 = x^3+a'x + b'
  \end{align*}
  then they are isomorphic over $K$ if and only if
  \begin{align*}
    a' &= u^4 a\\
    b' &= u^6 b
  \end{align*}
  for some $u \in K^\times$.
\end{corollary}
\begin{proof}
  $E$ and $E'$ are related as in \textbf{3.2} with $r = s = t = 0$.
\end{proof}

\textbf{Definition.} The \emph{j-invariant} is $j(E) = \frac{1728(4a^3)}{4a^3+27b^2}$. Note that the denominator is nonzero since the discriminant is nonzero.

\begin{corollary}
  $E \cong E' \implies j(E) = j(E')$, and the converse holds if $K = \bar{K}$.
\end{corollary}
\begin{proof}
  \begin{align*}
    E \cong E' &\iff a' = u^4a; b' = u^6 b\text{ for some } u \in K^\times \\
    &\implies (a^3:b^2) = ((a')^3:(b')^2)\\
    &\iff j(E) = j(E')
  \end{align*}
  and the reverse implication holds in the second line if $K = \bar{K}$.
\end{proof}

\section{Group Law}
Let $E \subset \P^2$ be a smooth plane cubic, and $O_E \in E(K)$. Since $E$ is of degree 3, it meets each line in 3 points counted with multiplicity. Hence, given two points $P, Q$ on $E$, the line $\overline{PQ}$ meets $E$ at a third point $S$. Then the line $\overline{O_E S}$ meets $E$ at a third point $R$. We then define $P \oplus Q = R$.

If $P=Q$, then we take the tangent line at $P$, likewise if $S = O_E$. We can view this diagrammatically as follows:
\begin{figure}[H]
  \centering
  \begin{tikzpicture}[scale=2]
      \draw plot [smooth, tension=1.1] coordinates {(0,2) (1,1) (0,0) (2,-1)};
      \node[circle, draw, fill, minimum size=1pt, inner sep=0pt, label={above:$O_E$}] (O) at (0.6, 1.655) {};
      \node[blue, circle, draw, fill, minimum size=1pt, inner sep=0pt, label={below:\color{blue}$P$}] (P) at (0.105, -0.15) {};
      \node[blue, circle, draw, fill, minimum size=1pt, inner sep=0pt, label={right:\color{blue}$Q$}] (Q) at (0.887, 1.35) {};
      \draw[blue] (P) -- (Q);
      \node[burgundy, circle, draw, fill, minimum size=1pt, inner sep=0pt, label={[shift={(-0.2, -0.1)}]:\color{burgundy}$S$}] (S) at (0.457, 0.525) {};
      \node[green!60!black, circle, draw, fill, minimum size=1pt, inner sep=0pt, label={right:\color{green!60!black}$R$}] (R) at (0.346, -0.355) {};
      \draw[burgundy] (O) -- (R);
  \end{tikzpicture}
  \caption{Illustration of the group operation on an elliptic curve}
\end{figure}

We call this the ``chord and tangent process".

\begin{theorem}
  $(E, \oplus)$ is an abelian group.
\end{theorem}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}[label=(\roman*)]
    \item $P\oplus Q = Q\oplus P$ by construction.
    \item $O_E$ is the identity.
    \item For inverses, let $S$ be the third point of intersection of $T_{O_E}$ and $E$, and $Q$ be the third point of intersection of $\overline{PS}$ and $E$. Then $P\oplus Q = O_E$.
    \item Associativity is much harder.
  \end{enumerate}
\end{proof}
\textbf{Definition.} $D_1, D_2 \in Div(E)$ are \emph{linearly equivalent} (written $D_1 \sim D_2$) if there is $f \in \bar{K}(E)^\times$ such that $\div(f)=D_1 - D_2$. Then we will let $[D] = \{D' : D'\sim D\}$.

\textbf{Definition.} The \emph{Picard group of E}, $\Pic(E) = \Div(E)/\sim$. We write $\Div^0(E) \coloneqq \ker\left(\Div(E) \xrightarrow{\deg} \Z\right)$ for the group of degree 0 divisors on $E$, and then $\Pic^0(E) = \Div^0(E)/\sim$. Sometimes $\Pic^0$ is called the Jacobian.

\begin{proposition}
  Let $\psi : E \to \Pic^0(E); P \mapsto [(P) - (O_E)]$. Then:
  \begin{enumerate}
    \item $\psi(P \oplus Q) = \psi(P) + \psi(Q)$
    \item $\psi$ is a bijection
  \end{enumerate}
\end{proposition}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}[label=\textit{\arabic*.}]
    \item Referring back to Fig. 2, let $\{\ell=0\}$ be the line {\color{blue}$\overline{PQ}$}, and $\{m=0\}$ be the line {\color{burgundy}$\overline{O_E R}$}. Then:
    \begin{align*}
      \div(\ell/m) &= (P)+(S)+(Q)-(R)-(S)-(O_E)\\
      &= (P)+(Q)-(O_E)-(P\oplus Q)\\
      \implies (P\oplus Q)+(O_E) &\sim (P)+(Q)\\
      \implies (P\oplus Q)-(O_E) &\sim (P)-(O_E)+(Q)-(O_E)\\
      \implies \psi(P\oplus Q) &= \psi(P) + \psi(Q)
    \end{align*}
    \item For injectivity, suppose $\psi(P) = \psi(Q)$. Then there is $f \in \bar{K}(E)^\times$ such that $\div(f) = P-Q$. Then $\deg\left(E\xrightarrow{f}\P^1\right) = \ord_P(f) = 1$. But then $f$ is a birational morphism, so an isomorphism, and $E \cong \P^1 \contr$.

    For surjectivity, let $[D] \in \Pic^0(E)$. Then $D+(O_E)$ has degree 1 (as $D$ had degree $0$). Then Riemann-Roch tells us $\dim \mathscr{L}(D+(O_E)) = 1$, and so there exists some $f \in \bar{K}(E)^\times$ such that $\div(f)+D+(O_E) \geq 0$. Since $f$ is rational, $\deg \div(f) = 0$, and $\deg D = 0$. So the coefficients of $\div(f) + D + (O_E)$ are non-negative and sum to 1, hence one of them is 1 and the rest are 0. So $\div(f) + D + (O_E) = (P)$ for some $P \in E$. But then $(P) - (O_E) \sim D$, i.e. $\psi(P) = [D]$.
  \end{enumerate}
\end{proof}
So $\psi$ is a bijection respecting the group law, and so we deduce that $\oplus$ is associative, and then $(E, \oplus) \overset{\psi}{\cong} (\Pic^0E, +)$.

\subsection{Explicit Formulae for the Group Law}
We consider $E$ in Weierstrass form, with $O_E$ the point at infinity:
\[y^2 + a_1 xy + a_3 y = x^3 + a_2 x^2 + a_4 x + a_6\tag{$\ast$}\]
Note that $O_E$ is a point of inflection. Now $P_1 \oplus P_2 \oplus P_3 = O_E \iff P_1, P_2, P_3$ are collinear.

We will use the following notation:
\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    \begin{axis}[
      xmin = -2, xmax = 3, ymin = -4, ymax = 4,
      axis equal,
      ticks = none,
      axis lines = middle,
      ]
      \addplot[domain=-1.32471796:3, blue, samples=100] {sqrt(x^3-x+1)};
      \addplot[domain=-1.32471796:3, blue, samples=100] {-sqrt(x^3-x+1)};
      \node[circle, burgundy, draw, fill, inner sep=0pt, minimum size=2pt, label={left:\textcolor{burgundy}{$P_1$}}] (P1) at (axis cs:-1.25,-0.54486) {};
      \node[circle, burgundy, draw, fill, inner sep=0pt, minimum size=2pt, label={above:\textcolor{burgundy}{$P_2$}}] (P2) at (axis cs:0.3,0.85264) {};
      \node[circle, burgundy, draw, fill, inner sep=0pt, minimum size=2pt, label={left:\textcolor{burgundy}{$P'$}}] (P3) at (axis cs:1.763, 2.17180) {};
      \addplot[domain=-2.5:3, burgundy] {0.90161*x+0.58216};
      \addplot[burgundy, mark=none] coordinates {(1.763, -3.5) (1.763, 3.5)};
      \node[circle, burgundy, draw, fill, inner sep=0pt, minimum size=2pt, label={right:\textcolor{burgundy}{$P_3 = P_1 \oplus P_2$}}] (P4) at (axis cs:1.763, -2.17180) {};
    \end{axis}
  \end{tikzpicture}
\end{figure}
and put $P_i = (x_i, y_i)$, $P'=(x',y')$.

Now $\ominus P_1 = (x_1, -(a_1x_1+a_3)-y_1)$, just by setting $y = -y_1$ in $(\ast)$.

The line through $P_1, P_2$ has equation say $y = \lambda x + \nu$. Substituting into $(\ast)$ and looking at the coefficient of $x^2$, we get:
\[\lambda^2 + a_1 \lambda - a_2 = x_1 + x_2 + x'\]
Since $x_3 = x'$, we have:
\begin{align*}
   x_3 &= \lambda^2+a_1\lambda-a_2-x_1-x_2\\
   y_3 &= -(a_1 x' + a_3) - y'\\
   &= -(\lambda+a_1)x_3 - \nu - a_3
\end{align*}
It remains to find $\lambda$ and $\nu$. There are 3 cases:
\begin{enumerate}
  \item $x_1=x_2, P_1 \neq P_2$.

  Then $P_1 \oplus P_2 = O_E$.

  \item $x_1 \neq x_2$.

  \[\lambda = \frac{y_2-y_1}{x_2-x_1},\;\; \nu = y_1-\lambda x_1 = \frac{y_1x_2-y_2x_1}{x_2-x_1}\]

  \item $P_1 = P_2$.

  Here we have to compute the equation of the tangent line etc. The solutions are:
  \[ \lambda=\frac{3x_1^2+2a_2x_1+a_4-a_1y_1}{2y_1+a_1x_1+a_3},\;\;\nu = \frac{-x_1^3+a_4x_1+2a_6-a_3y_1}{2y_1+a_1x_1+a_3}\]
\end{enumerate}

\begin{corollary}
  $E(K)$ is an abelian group.
\end{corollary}
\begin{proof}
  It is a subgroup of $E$ ($=E(\bar{K})$).

  \begin{itemize}[leftmargin=2cm]
    \item[Identity:] $O_E \in E(K)$ by definition.
    \item[Closure:] See formulae above.
    \item[Inverses:] See formulae above.
    \item[Associativity:] Inherited from $E(\bar{K})$.
    \item[Commutativity:] Inherited from $E(\bar{K})$.
  \end{itemize}
\end{proof}

If there is no ambiguity (i.e. we are not also adding numbers at the same time), the circles will be dropped from the group operation.
\begin{theorem}
  Elliptic curves are group varieties.

  i.e., $[-1]:E \to E; P\mapsto -P$ and $+:E\times E \to E; (P,Q)\mapsto P+Q$ are morphisms of algebraic varieties.
\end{theorem}
\begin{proof}
  The above formulae show that $[-1]$ and $+$ are rational maps. We know immediately that $[-1]$ is a morphism, as it is a rational map from a smooth curve to a projective variety.

  The formulae also show that $+$ is regular on the set
  \[ U = \{(P,Q) \in E \times E \mid P, Q, P+Q, P-Q \neq O_E\}\]
  For $P \in E$, let $\tau_P:E \to E; X \mapsto P+X$ be the ``translation by $P$" map.

  Then $\tau_P$ is a rational map from a smooth curve to a projective variety, so is a morphism.

  We factor $+$ as:
  \[ E\times E\xrightarrow[\tau_{-A}\times \tau_{-B}]{}E\times E \xrightarrow[\tau_{A+B}]{} E \xrightarrow[\tau_{A+B}]{} E\]

  Now $+$ is regular on $(\tau_A \times \tau_B)(U)$ for all $A, B \in E$, and so $+$ is regular on $E \times E$.
\end{proof}

\underline{\textbf{Definition.}} For any $n \in \Z_{>0}$, let $[n]: E \to E; P \mapsto P+\ldots+P$, $n$ times, and $[-n] = [-1]\circ [n]$, $[0]:P \mapsto O_E$ (i.e., the standard way of turning an abelian group into $\Z$ module).

\underline{\textbf{Definition.}} The \emph{n-torsion} subgroup of $E$ is $E[n] = \ker([n]:E\to E)$.

\begin{lemma}
  If $\charr(K) \neq 2$, and $E : y^2 = (x-e_1)(x-e_2)(x-e_3)$.

  Then $E[2] = (0, (e_1, 0), (e_2, 0), (e_3 0)) \cong (\Z/2\Z)^2$.
\end{lemma}
\begin{proof}
  Let $P = (x, y) \in E$. Then $[2]P = 0 \iff P = -P \iff (x, y) = (x, -y) \iff y = 0$.
\end{proof}

\subsection{Elliptic Curves over $\C$}
Let $\Lambda = \{a\omega_1 + b\omega_2 : a, b \in \Z\}$, where $\omega_1, \omega_2$ form a basis for $\C$ over $\R$.

Then the meromorphic functions on the Riemann surface (or lattice) $\C/\Lambda$ are the same as the $\Lambda$-invariant meromorphic functions on $\C$ (i.e. $f(z) = f(z+\lambda)$ for $\lambda \in \Lambda$).

This set of functions is a field, and is generated by $\wp(z)$ and $\wp'(z)$, where:
\begin{align*}
  \wp(z) = \frac{1}{z^2} + \sum_{0 \neq \lambda\in\Lambda} \left(\frac{1}{(z-\lambda)^2} - \frac{1}{\lambda^2}\right)
\end{align*}
They satisfy $\wp'(z)^2 = 4\wp(z)^3-g_2\wp(z)-g_3$, for some $g_1, g_3 \in \C$ depending on $\lambda$. We call $\wp$ the \emph{Weierstrass p-function}.

One can show that $\C/\Lambda \cong E(\C)$, where $E$ is the elliptic curve $y^2=4x^3-g_2x-g_3$. This is an isomorphism, not only of Riemann surfaces, but moreover of groups

\begin{theorem}[Uniformisation Theorem]
  Every elliptic curve over $\C$ arises in this way.
\end{theorem}

Thus, for elliptic curves $E/\C$, we have:
\begin{enumerate}[label=\protect\circled{\arabic*}]
  \item $E[n] \cong (\Z/n\Z)^2$
  \item $\deg[n] = n^2$
\end{enumerate}
We will show that \circled{2} holds over any field $K$, and \circled{1} holds if $\charr K \nmid n$.

\underline{Summary of Results} (N.B. the isomorphisms in 1, 2, 4 respect the relevant topologies)
\begin{enumerate}
  \item $K = \C$\hspace{2cm}$E(\C) \cong \C/\Lambda \cong \R/\Z\times \R/\Z$
  \item $K = \R$\hspace{2cm}$E(\R) \cong \begin{cases} \Z/2\Z \times \R/\Z & \Delta > 0 \\ \R/\Z & \Delta < 0\end{cases}$
  \item $K = \F_q$\hspace{1.9cm}$|\#E(\F_q) - (q+1)|\leq 2\sqrt{q}$
  \item $[K:\Q_p]<\infty$\hspace{1cm}$E(K)$ has a subgroup of finite index isomorphic to $(\O_K, +)$
  \item $[K:\Q]<\infty$\hspace{1.15cm}$E(K)$ is a finitely generated abelian group.
\end{enumerate}

\section{Isogenies}
Let $E_1, E_2$ be elliptic curves.

\textbf{Definition.} An \emph{isogeny} $\phi:E_1 \to E_2$ is a non-constant morphism taking $O_{E_1}$ to $O_{E_2}$, and we say $E_1$ and $E_2$ are \emph{isogenous} if there is an isogeny $E_1 \to E_2$.

\textbf{Definition.} $\Hom(E_1, E_2) = \{\text{isogenies } E_1 \to E_2\}\cup\{0\}$. This is a group under $(\phi+\psi)(P) = \phi(P)+\psi(P)$.

If $E_1 \xrightarrow{\phi} E_2 \xrightarrow{\psi} E_3$ are isogenies, then $\psi\phi$ is an isogeny. The tower law tells us that $\deg(\psi\phi) = \deg(\phi)\deg(\psi)$.

\begin{lemma}
  If $0 \neq n \in \Z$, then $[n] : E \to E$ is an isogeny.
\end{lemma}
\begin{proof}
  Theorem \textbf{4.4} tells us that $[n]$ is a morphism. We must show that $[n]\neq 0$.

  Assume $\charr K \neq 2$, then we can use Lemma \textbf{4.5}. If $n=2$, then $\#E[2] = 4$, and so $[2] \neq 0$.

  If $n$ is odd, then there is $0\neq T \in E[2]$. Then $nT = T \neq 0$, so $[n]$ is not the zero map.

  Now $[m][n] = [m]\circ[n]$, and any $n = 2^k m$ for $m$ odd, so $[n]$ is not the zero map for any $n \neq 0$.

  If $\charr K =2$, then replace \textbf{4.5} with a lemma computing $E[3]$.
\end{proof}
\textbf{Corollary.} \textit{$\Hom(E_1, E_2)$ is torsion-free as a $\Z$-module.}
\begin{lemma}
  Let $\phi:E_1 \to E_2$ be an isogeny. Then $\phi(P+Q) = \phi(P) + \phi(Q)$ for all $P, Q \in E_1$.
\end{lemma}
\begin{proof}[Sketch proof.]
  $\phi$ induces a map $\phi_\ast : \Div^0(E_1) \to \Div^0(E_2)$ given by $\sum\limits_{P\in E_1}n_p P \mapsto \sum\limits_{P \in E_1}n_p \phi(P)$.

  Recall that, via a pullback, $\phi^\ast : K(E_2) \injection K(E_1)$.

  If $f \in K(E_1)^\ast$, then $\phi_\ast(\div f)=\div(N_{K(E_1)/K(E_2)}f)$ - this is a fact that we'll take for granted.

  So $\phi_\ast$ takes principal divisors to principal divisors. Since $\phi(O_{E_1}) = O_{E_2}$, the following diagram commutes:
  \begin{tikzcd}
    E_1 \arrow{r}{\phi} \arrow{d}{\psi_1} & E_2 \arrow{d}{\psi_2}\\
    \Pic^0(E_1) \arrow{r}{\phi_\ast} & \Pic^0(E_2)
  \end{tikzcd}
  ,where $\psi_1:P \mapsto [(P) -(O_{E_1})], \psi_2:Q \mapsto [(Q)-(O_{E_2})]$.

  Since $\phi_\ast$ is a group homomorphism, $\phi$ is also a group homomorphism.
\end{proof}

\begin{lemma}
  Let $\phi:E_1\to E_2$ be an isogeny. Then there is a morphism $\xi$ making the following diagram commute:

  \begin{center}
    \begin{tikzcd}
      E_1 \arrow{r}{\phi} \arrow{d}{x_1} & E_2 \arrow{d}{x_2} \\
      \P^1 \arrow{r}{\xi} & \P^1
    \end{tikzcd}
  \end{center}

  where $x_i$ is the $x$-coordinate in a Weierstrass equation for $E_i$.

  Moreover, if $\xi(t) = \frac{r(t)}{s(t)}$ for $r, s \in K[t]$ coprime, then $\deg \phi = \deg \xi = \max(\deg r, \deg s)$.
\end{lemma}
\begin{proof}
  For $i = 1,2$, $K(E_i)/K(x_i)$ is a degree 2 extension, since the extension is given by adjoining $y_i$, which satisfies a quadratic (see the Weierstrass equation). Moreover, it is Galois, as $[-1]^\ast$ is a non-trivial automorphism of $K(E_i)$ fixing $K(x_i)$.

  Since $\phi$ is a group homomorphism, we have that $\phi(-P) = -\phi(P)$, i.e. $\phi \circ [-1] = [-1]\circ \phi$.

  If $f \in K(x_2)$, then $[-1]^\ast f = f$, and $[-1]^\ast (\phi^\ast f) = \phi^\ast ([-1]^\ast f) = \phi^\ast f$. Hence $\phi^\ast f$ is fixed by $[-1]$, so is in $K(x_1)$, and $K(x_2) \leq K(x_1)$.

  Taking $f = x_2$, then $\phi^\ast x_2 \in K(x_1)$, say $\xi(x_1)$ for some rational function $\xi$. Then $\xi$ is as required.

  Since $[K(E_1):K(x_1)] = [K(E_2):K(x_2)] = 2$, we have the following diagram of field extensions:
  \begin{center}
    \begin{tikzcd}
      & K(E_1) \arrow[dash, swap]{dl}{2} \arrow[dash]{dr}{\deg\phi} & \\
      K(x_1) \arrow[dash, swap]{dr}{\deg\xi} & & K(x_2) \arrow[dash]{dl}{2}\\
      & K(x_2) &
    \end{tikzcd}
  \end{center}
  Using the tower law, $\deg \phi = \deg \xi$. Now, $K(x_2) \injection K(x_1)$ via $x_2 \mapsto \xi(x_1) = \frac{r(x_1)}{s(x_2)}$ for $r, s \in K[t]$ coprime.

  The minimal polynomial of $x_1$ over $K(x_2)$ is $f(t) = r(t)-s(t)x_2 \in K(x_2)[t]$ - this is clearly a polynomial for $x_1$, but we need to check it's irreducible.

  $f$ is irreducible in $K[t][x_2] = K[x_2][t]$ as it is of degree 1 in $x_2$, so one of the factors must be constant in $x_2$, so divide both $r$ and $s$ which are coprime. Then we can use Gauss's lemma, and it is irreducible in $K(x_2)[t]$.

  Hence $\deg \phi = \deg \xi = [K(x_1):K(x_2)] = \deg (r(t)-s(t)x_2) = \max(\deg r, \deg s)$.
\end{proof}

\begin{lemma}
  $\deg[2] = 4$
\end{lemma}
\begin{proof}
  Assume $\charr K \neq 2, 3$. Then $E: y^2=x^3+ax+b=f(x)$.

  If $P = (x,y)$, then $x(2P) = \left(\frac{3x^2+a}{2y}\right)^2-2x = \frac{(3x^2+a)^2-8xf(x)}{4f(x)} = \frac{x^4+\ldots}{4f(x)}$.

  The numerator and denominator are coprime - suppose there was a common factor. Then $\exists \theta \in \bar{K}$ with $f(\theta) = (3\theta^2+a)^2 = f'(\theta) = 0$, and so $f$ has a multiple root. But $E$ is an elliptic curve so $f$ doesn't have multiple roots.

  Hence $\deg [2] = \max(\deg x^4+\ldots, \deg 4f(x)) = \max(4, 3) = 4$.
\end{proof}

\textbf{Definition.} Let $A$ be an abelian group. We say that $q:A \to \Z$ is a \emph{quadratic form} if it satisfies
\begin{enumerate}
  \item $q(nx) = n^2q(x) \forall n \in \Z, x \in A$.
  \item $(x,y) \to q(x+y)-q(x)-q(y)$ is $\Z$-bilinear.
\end{enumerate}
\begin{lemma}
  $q:A \to \Z$ is a quadratic form if and only if it satisfies the parallelogram law:
  \[q(x+y)+q(x-y) = 2q(x)+2q(y) \forall x,y \in A\]
\end{lemma}
\begin{proof}
  For the forwards direction, let $\angle{x,y} = q(x+y)-q(x)-q(y)$.

  Then $\angle{x,x} = q(2x)-2q(x) = 2q(x)$.

  Then $\frac{1}{2}\angle{x+y,x+y} + \frac{1}{2}\angle{x-y,x-y} = \angle{x,x}+\angle{y,y}$ by bilinearity, and hence $q(x+y)+q(x-y) = 2q(x)+2q(y)$.

  The reverse direction is left as an exercise on example sheet 2.
\end{proof}
\begin{theorem}
  \[\deg : \Hom(E_1, E_2) \to \Z\]
  is a quadratic form.
\end{theorem}
\begin{proof}
For the proof, we will assume $\charr K \neq 2, 3$ for simplicity - the result still holds in those characteristics.

We write $E_2: y^2=x^3+ax+b$.

Let $P, Q \in E_2$ with $P, Q, P+Q, P-Q \neq 0$, and let $x_1, \ldots, x_4$ be the $x$-coordinates of these 4 points. Then we have:
\begin{lemma}
  There exists $w_0, w_1, w_2 \in \Z[a,b][x_1,x_2]$ of degree $\leq 2$ in $x_1$ and in $x_2$ such that $(1:x_3+x_4:x_3x_4) = (w_0:w_1:w_2)$.
\end{lemma}
\begin{proof}
  We could prove this by direct calculation, leading to the formulae:
  \begin{align*}
    w_0 &= (x_1-x_2)^2\\
    w_1 &= 2(x_1x_2+a)(x_1+x_2)+4b\\
    w_2 &= x_1^2x_2^2-2ax_1x_2-4b(x_1+x_2)+a^2
  \end{align*}

  As an alternative proof, let $y=\lambda x +\nu$ be the line through $P$ and $Q$. Then
  \[x^3+ax+b-(\lambda x+\nu)^2 = (x-x_1)(x-x_2)(x-x_3) = x^3-s_1x^2+s_2x-s_3\]
  where $s_i$ is the $i\th$ symmetric polynomial in $(x_1, x_2, x_3)$.

  Comparing coefficients:
  \begin{align*}
    \lambda^2 &= s_1\\
    -2\lambda\nu+a &= s_2\\
    \nu^2-b &=  s_3
  \end{align*}
  Eliminating $\lambda, \nu$, we have $F(x_1, x_2, x_3) \coloneqq (s_2-a)^2-4s_1(s_3+b)=0$. Then $F$ has degree at most 2 in each $x_i$.

  $x_3$ is a root of the quadratic polynomial $W(t) = F(x_1, x_2, t)$, and repeating this for the line through $P$ and $-Q$ shows that $x_4$ is the other root. Hence
  \[w_0(t-x_3)(t-x_4) = W(t) = w_0t^2-w_1t+w_2\]
  And so $(1:x_3+x_4:x_3x_4) = (w_0:w_1:w_2)$.
\end{proof}

We then show that, if $\phi, \psi \in \Hom(E_1, E_2)$, then
\[ \deg(\phi+\psi) +\deg(\phi-\psi) \leq 2\deg(\phi)+2\deg(\psi)\]
We may assume $\phi, \psi, \phi+\psi, \phi-\psi != 0$, as otherwise the result is trivial.

\begin{align*}
  \phi&: (x, y) \mapsto (\xi_1(x), \ldots)\\
  \psi&: (x, y) \mapsto (\xi_2(x), \ldots)\\
  \phi+\psi&: (x, y) \mapsto (\xi_3(x), \ldots)\\
  \phi-\psi&: (x, y) \mapsto (\xi_4(x), \ldots)
\end{align*}
Then \textbf{5.7} gives $(1:\xi_3+\xi_4:\xi_3\xi_4) = ((\xi_1-\xi_2)^2:\ldots:\ldots)$.

Put $\xi_i = \frac{r_i}{s_i}$ where $r_i, s_i \in K[x]$ are coprime:
\[(s_3 s_4:r_3 s_4+r_4 s_3:r_3 r_4) = ((r_1 s_2-r_2 s_2)^2:\ldots:\ldots)\tag{$\ast$}\]

So we have:
\begin{align*}
  \deg(\phi+\psi)+\deg(\phi-\psi) &= \max(\deg r_3, \deg s_3)+\max(\deg r_4, \deg s_4) \\
  &= \max(\deg(s_3s_4), \deg(r_3s_4+r_4s_3), \deg(r_3r_4))
\end{align*}
Suppose $(s_3s_4, r_3s_4+r_4s_3, r_3r_4)$ are not coprime, so that $p$ irreducible divides all $3$. Then $p$ divides one of $r_3, r_4$, and one of $s_3, s_4$. $p$ can't divide both $s_i$ and $r_i$ as they are coprime, so \textsc{wlog} $p$ divides $r_3$ and $s_4$ and not $r_4$ nor $s_3$. Then $p$ doesn't divide $r_3s_4+r_4s_3 \contr$. Hence these polynomials are coprime.

Hence the polynomials on \textsc{rhs} of $(\ast)$ must be multiples of polynomials on the \textsc{lhs} by some irreducible polynomial, and hence each have degree $\geq$ their corresponding polynomial on \textsc{lhs}, and thus, as $w_i$ are of degree $\leq 2$ in $r_1, s_1, r_2, s_2$,
\begin{align*}
  \deg(\phi+\psi)+\deg(\phi-\psi) &\leq \max(\deg(w_0), \deg(w_1), \deg(w_2))\\
  &\leq 2\max(\deg r_1, \deg s_1) + 2\max(\deg r_2, \deg s_2)\\
  &= 2 \deg \phi + 2 \deg \psi\tag{1}
\end{align*}
Now replace $\phi$ and $\psi$ by $\phi+\psi$ and $\phi-\psi$ to get
\[\deg(2\phi)+\deg(2\psi) \leq 2\deg(\phi+\psi)+2\deg(\phi-\psi)\]
Since $\deg[2] = 4$,
\[2\deg(\phi)+2\deg(\psi) \leq \deg(\phi+\psi)+\deg(\phi-\psi)\tag{2}\]
(1) and (2) together give
\[ 2\deg(\phi)+2\deg(\psi) = \deg(\phi+\psi)+\deg(\phi-\psi)\]
so $\deg$ satisfies the parallelogram law, and hence is a quadratic form.
\end{proof}
\begin{corollary}
  \[deg(n\phi) = n^2\deg(\phi) \forall n\in \Z, \phi \in \Hom(E_1, E_2)\]
  In particular, $\deg[n] = n^2$.
\end{corollary}
\stepcounter{theorem}
\textbf{Example \thetheorem.} Let $E/K$ be an elliptic curve, suppose $\charr K \neq 2$, and let $O_E \neq T \in E(K)[2]$.

Then we may take $E: y^2 = x(x^2+ax+b), a, b \in K, b(a^2-4b) \neq 0$, $T=(0, 0)$

Then if $P=(x,y)$ and $P'=P+T = (x', y')$, then:
\begin{align*}
  x' &= (y/x)^2 - a - x = \frac{x^2+ax+b}{x}-x-a- = \frac{b}{x}\\
  y' &= -(y/x)x' = \frac{-by}{x^2}
\end{align*}
Then let $\xi = x+x'+a = \frac{x^2+ax+b}{x} = \left(\frac{y}{x}\right)^2$, and $\eta = y+y' = \frac{y}{x}(x-\frac{b}{x})$

Then $\eta^2=\left(\frac{y}{x}\right)^2\left[\left(x+\frac{b}{x}\right)^2-4b\right] = \xi\left((\xi-a)^2-4b\right) = \xi(\xi^2-2a\xi+a^2-4b)$

Let $E': y^2=x(x^2+a'x+b')$ where $a' = -2a, b'=a^2-4b$. Then there is an isogeny $\phi:E \to E'$ given by $(x, y) \mapsto \left(\left(\frac{y}{x}\right)^2:\frac{y(x^2-b)}{x^2}:1\right); O_E \mapsto (0:1:0)$

\textbf{5.3} tells us, as $x' = \left(\frac{y}{x}\right)^2 = \frac{x^2+ax+b}{x}$, that $\deg(\phi) = \max(2,1) = 2$, and we say $\phi$ is a 2-isogeny.

\section{The Invariant Differential}
Let $C$ be an algebraic curve over an algebraically closed field. Then the \emph{space of differentials} $\Omega_C$ is a vector space over the function field of the curve $K(C)$, generated by $df$ for $f \in K(C)$ subject to the relations
\begin{enumerate}
  \item $d(f+g) = df+dg$
  \item $d(fg) = fdg+gdf$
  \item $da = 0$ for $a \in K$
\end{enumerate}
It turns out that $\dim \Omega_C = \dim C$, and since $C$ is a curve, $\Omega_C$ is a 1-dimensional $K(C)$-vector space.

Let $0\neq \omega \in \Omega_C$, and let $P \in C$ be a smooth point, with $t \in K(C)$ a uniformizer at $P$ (has order of vanishing 1 at $P$). Then $\omega = fdt$ for some $f \in K(C)$.

We define $\ord_P(\omega) = \ord_P(f)$. This does not depend on the choice of uniformizer.

Suppose we have $f \in K(C)^\ast$, and $\ord_P(f) = n \neq 0$. Then, if $\charr K \nmid n$, $\ord_P(df) = n-1$.

If $C$ is now a smooth projective curve, we define the divisor of $\omega \in \Omega_C$ to be
\[\div(\omega) = \sum_{P \in C} \ord_P(\omega) P \in \Div(C)\]
using the fact that $\ord_P(\omega)$ is zero at all but finitely many points $P \in C$.

The \emph{space of regular differentials} is the finite dimensional vector space over $K$ of all $\omega \in \Omega_C$ for which $\div(\omega)$ is effective, i.e. there are no poles. The dimension of this space is called the \emph{genus} of $C$, $g(C)$.

As a consequence of Riemann-Roch, we have, for $0 \neq \omega \in \Omega_C$, $\deg(\div(\omega)) = 2g(C)-2$.

\begin{lemma}
  Assume $\charr K \neq 2$. Take an elliptic curve $E:y^2=(x-e_1)(x-e_2)(x-e_3)$, where $e_1, e_2, e_3$ distinct.

  Then $\omega = \frac{dx}{y}$ is a differential on $E$, and has no zeros and no poles, and so $g(E)=1$.

  Moreover, the space of regular differentials is just $\angle{\omega}$.
\end{lemma}
\begin{proof}
  Let $T_i = (e_i, 0)$, so that $E[2] = \{O, T_1, T_2, T_3\}$.

  Then $\div(y) = (T_1)+(T_2)+(T_2)-3(O)$ - we know the zeros at $T_i$ are simple as $y$ is rational, so $\deg \div(y) = 0$.

  Then for $P \in E, \div(x-x_P) = (P) + (-P) - 2(O)$, in the same way as above.

  If $P \in E\setminus E[2]$, then $\ord_P(x-x_P) = 1$, so $\ord_P(d(x-x_P)) = \ord_P(dx) = 1-1= 0$.

  If $P = T_i$, then $P = -P$, and $\ord_P(x-x_p) = 2$, so $\ord_P(dx) = 2-1 = 1$

  If $P = O$, then $\ord_P(x) = -2$, so $\ord_P(dx) = -3$.

  Hence $\div(dx) = (T_1)+(T_2)+(T_3)-3(O) = \div(y)$.

  So $\div(dx/y) = \div(dx)-\div(y) = 0$. Then Riemann-Roch gives $g(E) = 1$, and so the space of regular differentials is 1-dimensional, so generated by $\omega$.
\end{proof}
\textbf{Definition.} If $\phi:C_1 \to C_2$ is a non-constant morphism, then we can pull back to \[\phi^\ast:\Omega_{C_1}\to \Omega_{C_2}; fdg \mapsto \phi^\ast f d(\phi^\ast g)\]

\begin{lemma}
  Let $P \in E$, $\tau_P:E \to E; X \mapsto P+X$, and $\omega = dx/y$ be as above.

  Then $\tau_P^\ast \omega = \omega$, and so $\omega$ is called the \emph{invariant differential}.
\end{lemma}
\begin{proof}
  Since $\omega$ had no poles, $\tau_P^\ast \omega$ is again a regular differential, and hence equal to $\lambda_P \omega$ for some $\lambda_P \in K$, as the regular differentials are a 1-dimensional vector space over $K$.

  The map $E \to \P^1; P \mapsto \lambda_P$ is a morphism of smooth projective curves, but is not surjective as it misses $0$ and $\infty$, and so this morphism is constant, by \textbf{2.8}.

  So $\lambda$ is independent of $P$. Take $P = O_E$, then $\tau_P$ is the identity map, and so $\lambda$ is 1.
\end{proof}
If $K = \C$, then $\C/\Lambda \cong E(\C)$, via $z \mapsto (\wp(z), \wp'(z))$. Then $\frac{dx}{y}=\frac{\wp'(z)dz}{\wp'(z)} = dz$, which is invariant under $z \mapsto z+\text{const.}$.

\begin{lemma}
  Let $\phi, \psi \in \Hom(E_1, E_2)$, $\omega$ the invariant differential on $E_2$. Then \[(\phi+\psi)^{\ast}(\omega) = \phi^{\ast}\omega + \psi^{\ast}\omega\]
\end{lemma}
\begin{proof}
  Write $E=E_2$, and consider the maps:
  \begin{align*}
    E\times E &\to E\\
    \upmu:(P, Q) &\mapsto P+Q\\
    \text{pr}_1:(P,Q) &\mapsto P\\
    \text{pr}_2:(P,Q) &\mapsto Q
  \end{align*}
  $\Omega_{E\times E}$ is a 2-dimensional $K(E\times E)$ vector space with basis $\text{pr}_1^\ast \omega$ and $\text{pr}_2^\ast \omega$.

  Then $\upmu^\ast \omega = f \text{pr}_1^\ast \omega + g\text{pr}_2^\ast \omega$ for some $f, g \in K(E\times E)$.

  For $Q \in E$, let $\iota_Q : E \to E\times E; P \mapsto (P, Q)$. Then

  \begin{align*}
    \iota_Q^\ast(\upmu^\ast \omega) = (\upmu\circ\iota_Q)^\ast \omega &= \iota_Q^\ast f(\text{pr}_1\circ \iota_Q)^\ast\omega + \iota_Q^\ast g (\text{pr}_2\circ \iota_Q)^\ast \omega\\
    \tau_Q^\ast \omega &= \iota_Q^\ast f \omega + 0\\
    \omega &= \iota_Q^\ast f \omega
  \end{align*}
  So $\iota_Q^\ast f = 1$ for all $Q \in E$, so $f(P,Q) = 1$ for all $P, Q \in E$.

  Similarly, $g(P,Q) = 1$.

  So $\mu^{\ast} \omega= \text{pr}_1^\ast \omega + \text{pr}_2^\ast \omega$. Now pull back by $E\to E\times E; P \mapsto (\phi(P), \psi(P))$ to get $(\phi+\psi)^\ast \omega=  \phi^\ast \omega + \psi^\ast \omega$.
\end{proof}
\begin{lemma}
  If $\phi:C_1 \to C_2$ is a non-constant morphism, then $\phi$ is separable if and only if $\phi^\ast:\Omega_{C_2}\to \Omega_{C_1}$ is nonzero
\end{lemma}
\begin{proof}
  Omitted.
\end{proof}
\underline{Example:} Let $\mathbb{G}_m = \A^1\setminus\{0\} = \P^1\setminus\{0, \infty\}$, with group law $\mathbb{G}_m \times \mathbb{G}_m \to \mathbb{G}_m; (x,y)\mapsto xy$.

Let $n \geq 2$ be an integer, $\alpha:\G_m \to \G_m; x\mapsto x^n$.

Then $\alpha^{\ast}(dx) = d(\alpha x) =d(x^n) = nx^{n-1}dx$. So if $\charr K \nmid n$, then $\alpha$ is separable. So $\# \alpha^{-1}(Q) = \deg \alpha$ for all but finitely many $Q \in \mathbb{G}_m$.

But $\alpha$ is group homomorphism, so all fibres have the same size, and $\#\alpha^{-1}(Q) = \#\ker \alpha$, hence $\# \ker \alpha = \deg \alpha=n$. So $K (=\bar{K})$ contains exactly $n$ $n\th$ roots of unity.

\begin{theorem}
  If $\charr K \nmid n$, then $E[n] \cong (\Z/n\Z)^2$.
\end{theorem}
\begin{proof}
  By \textbf{6.3} and induction, $[n]^\ast \omega = n\omega$. So if $\charr K \nmid n$, $[n]$ is separable. So all but finitely many fibres of $[n]$ have size $\deg [n]$, and since $[n]$ is a group homomorphism, all fibres have the same size, and hence $\#[n]^{-1}(O_E) = \#E[n] = \deg [n] = n^2$.

  By the structure theorem for finite abelian groups, $E[n] \cong \Z/d_1\Z \times \ldots \Z/d_t\Z$ with $d_i | d_{i+1}$. Since this group is killed by multiplication by $n$, all $d_i| n$ as well, and $\prod_{i=1}^t d_i = n^2$ by the previous paragraph.

  If $p$ is a prime with $p | d_1$, then $E[p] \cong (\Z/p\Z)^t$, and by the first paragraph, $t=2$. Then $d_1|d_2|n$, and $d_1d_2 = n^2$, hence $d_1=d_2 = n$.
\end{proof}
Remark (not to be used on example sheet 2). If $\charr K = p$, then $[p]$ is not separable. It can be shown that $E[p^r] \cong \Z/p^r\Z$ for all $r \geq 1$ or $E[p] = 0$. The first case is described as ``ordinary", and the second case is ``supersingular".

\section{Elliptic Curves over Finite Fields}
\begin{lemma}
  Let $A$ be an abelian group and $q:A \to \Z$ a positive definite quadratic form. If $x, y \in A$ then $\angle{x, y}\coloneqq |q(x + y)-q(x)-q(y)|\leq 2 \sqrt{q(x)q(y)}$.
\end{lemma}
\begin{proof}
  We may assume $x \neq 0$ otherwise the result is clear. Let $m,n \in \Z$.
  \begin{align*}
      0 & \leq q(mx+ny)\\
      &=\frac{1}{2}\angle{mx+ny,mx+ny} \\
      &= m^2q(x) + mn\angle{x,y} + n^2q(y)\\
      &= q(x)\left(m+\frac{\angle{x,y}}{2q(x)}n\right)^2 + n^2\left(q(y)-\frac{\angle{x,y}^2}{4q(x)}\right)
  \end{align*}
  Take $m = \angle{x,y}, n = -2q(x)$, we deduce $\angle{x,y}^2 \leq 4q(x)q(y)$, so $|angle{x,y}| \leq 2\sqrt{q(x)q(y)}$.
\end{proof}
Recall that $\Gal(\F_{q^r}/\F_q)$ is cyclic of order $r$ generated by the Frobenius map $x \mapsto x^q$.
\begin{theorem}[Hasse]
  Let $E/\F_q$ be an elliptic curve. Then $\abs{\#E(\F_q)-(q+1)}\leq 2\sqrt{q}$
\end{theorem}
\begin{proof}
  Let $E$ have Weierstrass equation with coefficients $a_1, \ldots, a_6 \in \F_q$. Define the Frobenius endomorphism $\phi:E \to E; (x,y) \mapsto (x^q, y^q)$, which is an isogeny of degree $q$.

  Then $E(\F_q) = \{P \in E: \phi(P) = P\} = \ker(1-\phi)$.

  $\phi^{\ast}\omega = \phi^\ast\left(\frac{dx}{y}\right) = \frac{dx^q}{y^q} = \frac{qx^{q-1}dx}{y^q} = 0$, since $q \equiv 0 \mod p.$

  So $(1-\phi)^\ast \omega = 1^\ast \omega - \phi^\ast \omega = \omega - 0 = \omega \neq 0$, so $1-\phi$ is separable.

  Hence the size of all but finitely many fibres is $\deg 1-\phi$, and $1-\phi$ is a group homomorphism, so $\#E[\F_q] = \#\ker(1-\phi) = \deg(1-\phi)$.

  By \textbf{5.6}, $\deg :\text{End}(E) \coloneqq \Hom(E,E) \to \Z$ is a positive definite quadratic form.

  By \textbf{7.1}, $|\deg(1-\phi)-1-\deg\phi| \leq 2\sqrt{\deg \phi}$, and hence $|\#E(\F_q) - (q+1)| \leq 2\sqrt{q}$.
\end{proof}

\subsection{Zeta Functions}
For $K$ a number field:
\[\zeta_K(s) = \sum_{\mathfrak{a} \subset \O_K} \frac{1}{(N_{\mathfrak{a}})^s} = \prod_{\mathfrak{p}\subset \O_K \text{ prime}} \left(1-\frac{1}{(N_{\mathfrak{p}})^s}\right)^{-1}\]
For $K$ a function field, e.g. $K = \F_q(C)$ for $C/\F_q$ a smooth projective curve:
\[\zeta_K(s) = \prod_{x\in |C|}\left(1-\frac{1}{(Nx)^s}\right)^{-1}\]
where $|C|$ is the set of closed points (i.e. orbit of action of $\Gal(\bar{\F}_q/\F_q))$ on $C(\bar{\F}_q)$, and $Nx = q^{\deg x}$, where $\deg x$ is the size of the orbit.

We have that $\zeta_K(s) = F(q^{-s})$ for $F \in Q[[T]]$, where
\begin{align*}
  F(T) &= \prod_{x \in |C|} (1-T^{\deg x})^{-1}\\
  \log F(T) &= \sum_{x \in |C|} \sum_{m=1}^\infty \frac{1}{m}T^{m\deg x}\\
  \frac{d}{dT} \log F(T) &= \sum_{x \in |C|}\sum_{m=1}^\infty \deg x T^{m \deg x}\\
  &= \sum_{n=1}^\infty \left(\sum_{\substack{x \in |C|\\\deg x |n}} \deg x\right)T^n\\
  &= \sum_{n=1}^\infty \# C(\F_{q^n})T^n\\
  \implies F(T) &= \exp\left(\sum_{n=1}^\infty \frac{\#C(\F_{q^n})}{n}T^n\right) \eqqcolon Z_C(T)
\end{align*}

For $\phi, \psi \in \Hom(E_1, E_2)$, we put:
\[\angle{\phi, \psi} = \deg(\phi+\psi) - \deg(\phi) - \deg(\psi)\]
We define the \emph{trace map} $\tr: \End(E) \to \Z$; $\psi \mapsto \angle{\psi, 1}$.

\begin{lemma}
  If $\psi \in \End(E)$ then $\psi^2 - [\tr\psi]\psi + [\deg \psi] = 0$, where $[n]$ means the multiplication by $n$ endomorphism.
\end{lemma}
\begin{proof}
  Example sheet 2.
\end{proof}
\textbf{Definition.} The \emph{zeta function of a variety} $V/\F_q$ is
\[Z_v(T) = \exp\left(\sum_{n=1}^\infty \frac{\#V(\F_{q^n})}{n}T^n\right)\]
\begin{lemma}
  Let $E/\F_q$ be an elliptic curve, with $\#E(\F_q) = q+1-a$. Then
  \[Z_E(T) = \frac{1+aT+qT^2}{(1-T)(1-qT)}\]
\end{lemma}
\begin{proof}
  Let $\phi: E \to E$ be the $q$-power Frobenius map. By the proof of Hasse's theorem,
  \[\#E(\F_q) = \deg(1-\phi) = q+1-\tr(\phi)\]
  Then $\tr(\phi) = a, \deg(\phi) = q$.

  Then lemma \textbf{7.3} gives $\phi^2 - a\phi+q = 0$. Composing with $\phi^n$ for $n\geq 0$ gives
  \begin{align*}
    \phi^{n+2} - a \phi^{n+1}+q\phi^n &= 0\\
    \tr(\phi^{n+2}) - a \tr(\phi^{n+1}) + q \tr(\phi^n) &= 0
  \end{align*}
  This second-order difference equation with initial conditions $\tr(\phi^0) = \tr(1) = 2, \tr(\phi^1) = a$ has solutions
  \[\tr(\phi^n) = \alpha^n + \beta^n\]
  where $\alpha, \beta$ are the roots of $x^2-ax+q=0$.

  Hence $\#E(\F_{q^n}) = \deg(1-\phi^n) = 1+ \deg(\phi^n) - \tr(\phi^n) = 1+q^n-\alpha^n-\beta^n$.

  Substituting, we have:
  \begin{align*}
    Z_E(T) &= \exp\left(\sum_{n=1}^\infty \frac{T^n}{n} + \frac{(qT)^n}{n} - \frac{(\alpha T)^n}{n} - \frac{(\beta T)^n}{n}\right)
  \end{align*}
  Since $-\log(1-x) =  \sum_{n=1}^\infty \frac{x^n}{n}$, this can be simplified to:
  \begin{align*}
    Z_E(T) &= \frac{(1-\alpha T)(1-\beta T)}{(1-T)(1-qT)}\\
    &= \frac{1-aT+qT^2}{(1-T)(1-qT)}
  \end{align*}
\end{proof}
Note that Hasse's theorem gives us $|a| \leq 2\sqrt{q}$, and so the discriminant of $x^2-aT+q$ is negative, and so $\alpha = \bar{\beta}, |\alpha|=|\beta| = \sqrt{q}$.

Let $K = \F_q(E)$. Then $\zeta_K(s) = 0 \implies Z_E(q^{-s}) = 0 \implies q^2 = \alpha$ or $\beta$, and hence $\Re(s) = \frac{1}{2}$.

\section{Formal Groups}
Here, $R$ will be a ring with $I \subset R$ an ideal. The \emph{I-adic topology} on $R$ is the topology with basis $\{r+I^n: r\in R, n\geq 1\}$.

A sequence $(x_n)$ in $R$ is \emph{Cauchy} if, for all $k$ there is some $N$ with $x_m-x_n \in I^k$ for all $m, n \geq k$.

$R$ is \emph{complete} if
\begin{enumerate}
  \item $\bigcap_{n\geq 0} I^n = \{0\}$ and
  \item every Cauchy sequence converges.
\end{enumerate}
Note that, if $x \in I$ then $\frac{1}{1-x} = 1+x+x^2+\ldots$, and the sequence of partial sums is Cauchy, and hence converges. So $1-x \in R^\times$.

For example, we could have:
\begin{itemize}
  \item $R = \Z_p, I = p\Z_p$
  \item $R = \Z[[t]], I = (t)$.
\end{itemize}
\begin{lemma}[Hensel's Lemma]
  Let $R$ be an integral domain, complete with respect to $I$. Let $F \in R[x], s \geq 1$. Suppose $a \in R$ satisfies $F(a) \equiv 0 \mod I^s$, and $F'(a) \in R^\times$.

  Then there is a unique $b \in R$ with $F(b) = 0$ and $b \equiv a \mod I^s$.
\end{lemma}
\begin{proof}
  Let $u \in R^\times$ with $F'(a) \equiv u \mod I$, e.g. $u = f'(a)$.

  Replacing $F(x)$ by $\frac{F(x+a)}{u}$, we may assume $a = 0$ and $F'(0) \equiv 1 \mod I$.

  We put $x_0 = 0, x_{n+1} = x_n-F(x_n)$.

  By induction, $x_n \in I_s$ for all $n$.

  $F(x)-F(y) = (x-y)(F'(0)+xG(x,y) +yH(x,y))$ for some polynomials $G, H \in R[x,y]$.

  Now we claim $x_{n+1} \equiv x_n \mod I^{n+s}$ for all $n \geq 0$.

  This can be proven by induction on $n$: in the case where $n=0$, and $x_1 \in I^s$.

  Suppose $x_{n}\equiv x_{n-1} \mod I^{n+s-1}$. Then
  \[F(x_n)-F(x_{n-1})=(x_n-x_{n-1})(1+c)\]
  for some $c \in I$, and hence
  \[F(x_n) - F(x_{n-1}) \equiv x_n-x_{n-1} \mod I^{n+s}\]
  Rearranging, we have $x_{n+1} \equiv x_n \mod I^{n+s}$, which proves the claim.

  Hence $(x_n)$ is Cauchy, and by completeness converges to some $b \in R$. Taking the limit as $n \to \infty$, we have $b = b-F(b)$, and so $F(b)=0$, with $b \in I^s$.

  For uniqueness, we can use the expression for $F(x)-F(y)$ and the assumption that $R$ is an integral domain.
\end{proof}
For example, take $E: Y^2Z + a_1XYZ+a_3YZ^2 = X^3+a_2X^2Z + a_4 XZ^2 + a_6Z^3$

We pass to the affine piece $Y \neq 0, t = X/Y, w = -Z/Y$: Then
\[E : w = t^3+a_1tw + a_2t^2w + a_3w^2+a_4tw^2+a_6w^3 = f(t,w)\]
We can apply Hensel's lemma with $R = \Z[a_1, \ldots, a_6][[t]]$, $I = (t)$, and $F(x) = x-f(t,x)\in R[x]$. Taking $s = 3, a = 0$, we have:
\[F(0) = -f(t, 0) = -t^3 \equiv 0 \mod I^3\;\;\;\;\;\;\;\;
F'(0) = 1-a_t-a_2t^2  \in R^\times\]
So there is a unique root of $F$, $w(t) \in \Z[a_1, \ldots, a_6][[t]]$ such that $w(t) = f(t,w(t))$ and $w(t) \equiv 0 \mod t^3$.

Following the proof of Hensel's lemma with $u = 1$ gives $w(t) = \lim_{n\to \infty} w_n(t)$ where $w_0(t) = 0, w_{n+1}(t)=f(t, w_n(t))$.

In fact, we may write \mbox{$w(t) = \sum_{n=2}^\infty A_{n-2}t^{n-1}$ with $A_1 = a_1, A_2 = a_1^2+a_2, A_3 = a_1^3+2a_1a_2+a_3, \ldots$}

\begin{lemma}
  Let $R$ be an integral domain, complete with respect to $I \trianglelefteq R$, and let $a_1, \ldots, a_6 \in R, K = \Frac(R)$.

  Then $\hat{E}(I) = \{(t,w) \in E(K): t, w \in I\} = \{(t, w(t))\in E(K): t \in I\}$ is a subgroup of $E(K)$.
\end{lemma}
\begin{proof}
  The two descriptions of $\hat{E}(I)$ agree, since given $t \in I$ we can solve for a unique $w \in I$ such that the pair $(t,w)\in E(K)$.

  Taking $(t, w) = (0, 0)$ shows that $O_E \in \hat{E}(I)$. So it suffices to show that, if $P_1, P_2 \in \hat{E}(I)$, then $-P_1-P_2 \in \hat{E}(I)$.

  If $P_1 = (t_1,w_1), P_2 = (t_2,w_2)$ lie on the straight line $\lambda t + \nu$, then $-P_1-P_2$ is the third point of intersection of this line with $E$.

  Then $\lambda = \frac{w(t_2)-w(t_1)}{t_2-t_1}$ if $t_1 \neq t_2$, and $w'(t_1)$ if $t_1=t_2$.

  $P_1, P_2 \in \hat{E}(I) \implies t_1, t_2 \in I$.

  Thus $\lambda = \sum_{n=2}^\infty A_{n-2}(t_1^n + t_1^{n-1}t_2 + \ldots + t_2^n) \in I$, and $\nu = w_1-\lambda t_1 \in I$.

  Substituting $w = \lambda t + \nu$ into $w = f(t,w)$ gives $\lambda t+\nu = t^3 + a_1t(\lambda t+ \nu) + a_2t^2(\lambda t+\nu) + a_3(\lambda t+ \nu)^2 + a_4 t(\lambda t + \nu)^3 + a_6(\lambda t+\nu)^3$.

  Let $A$ be the coefficient of $t^3$, so $A = 1+a_2\lambda+a_4 \lambda^2 + a_6\lambda^3$.

  Let $B$ be the coefficient of $t^2$, so $B = a_1\lambda + a_2\nu + a_3\lambda^2+2a_4\lambda\nu+3a_6\lambda^2\nu$.

  Then $A \in R^\times, B \in I$, and $t_3 = -B/A -t_2 -t_2 \in I$, and $w_3 = \lambda t_3 + \nu \in I$.

  Hence $-P_1-P_2 \in \hat{E}(I)$, and so $\hat{E}(I)$ is a subgroup.
\end{proof}
Taking $R = \Z[a_1, \ldots, a_6][[t]]$, and $I = (t)$, then the previous lemma tells us there is some power series $\iota \in \Z[a_1,\ldots, a_6][[t]]$ with $\iota(0) = 0$ such that $[-1](t, w(t)) = (\iota(t), w(\iota(t)))$

Taking $R = \Z[a_1, \ldots, a_6][[t]]$, and $I=(t_1, t_2)$, then we get that there is some power series $F \in I$ such that $(t_1,w(t_1))+(t_2,w(t_2)) = (F(t_1,t_2),w(F(t_1,t_2))$.

In fact, we can compute
\begin{align*}
  \iota(x) &= -x-a_1x^2-a_2x^3-(a_1^3+a_3)x^4+\ldots\\
  F(x, y) &= x+y-a_1xy-a_2(x^2y+xy^2)+\ldots
\end{align*}
By properties of the group law, we can deduce:
\begin{enumerate}
  \item $F(x, y) = F(y, x)$
  \item $F(x, 0) = x, F(0, y) = y$
  \item $F(x, F(y, z)) = F(F(x, y), z)$
  \item $F(x, \iota(x)) = 0$
\end{enumerate}
This then motivates the following definition:

\textbf{Definition.} Let $R$ be a ring. A \emph{formal group} over $R$ is a power series $F(x, y) \in R[[x, y]]$ satisfying the properties 1, 2, and 3 above.

\textbf{Exercise.} Show that, for any formal group, there is a unique $\iota(x) \in R[[x]]$ such that \mbox{$F(x,\iota(x)) = 0$}.

\underline{Examples:}
\begin{enumerate}
  \item $F(x, y) = x + y$
  \item $F(x, y) = x + y + x y = (1 + x)(1 + y) - 1$
  \item $F$ as above.
\end{enumerate}
We label these formal groups by $\hat{\G}_a, \hat{\G}_m$, and $\hat{E}$ respectively.

\textbf{Definition.} Let $\mathcal{F}$, $\mathcal{G}$ be formal groups over $R$ given by power series $F, G$ respectively. Then:
\begin{enumerate}
  \item A \emph{morphism} $f: \mathcal{F} \to \mathcal{G}$ is a power series $f \in R[[t]]$ such that $f(0)=0$ satisfying $f(F(x, y)) = G(f(x), f(y))$.
  \item $\mathcal{F} \cong \mathcal{G}$ if there is some morphism $f : \mathcal{F} \to \mathcal{G}$, and $g: \mathcal{G} \to \mathcal{F}$ with $f(g(x))=g(f(x)) = x$.
\end{enumerate}
\begin{theorem}
  If $\charr(R) = 0$, then any formal group $\mathcal{F}$ over $R$ is isomorphic to $\hat{\G}_a$ over $R \otimes \Q$.

  More precisely:
  \begin{enumerate}
    \item There is a unique power series $\log: T\mapsto T+\frac{a_2}{2}T^2+\frac{a_3}{3}T^3+\ldots$ with $a_i \in R$, such that \[\log(F(x,y)) = \log(x)+\log(y)\tag{$\ast$}\]
    \item There is a unique power series $\exp: T \mapsto T + \frac{b_2}{2!}T^2 + \frac{b_3}{3!}T^3+\ldots$ with $b_i \in R$ such that \[\exp(\log(T)) = \log(\exp(T)) = T\]
  \end{enumerate}
\end{theorem}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item Notation: $F_1(x, y) = \frac{\partial F}{\partial x}(x, y)$ (via formal differentiation).

    For uniqueness, let $p(T) = \frac{d}{dT} \log(T) = 1 + a_2T + a_3T^2 + \ldots$.

    Differentiating ($\ast$) with respect to $x$, we get: $p(F(x, y))F_1(x, y) = p(x)+0$
    Setting $x = 0$, we get $p(y)F_1(0, y) = 1$, and hence $p(y) = F_1(0, y)^{-1}$, and hence $p$ is uniquely determined, so $a_2, a_3, \ldots$ are uniquely determined. But then $\log$ is uniquely determined.

    For existence, let $p(T) = F_1(0, T)^{-1} = 1 + a_2T + a_3 T^2 + \ldots$, where $a_i \in R$.

    Integrating up, we let $\log(T) = T + \frac{a_2}{2}T^2+\frac{a_3}{3}T^3+\ldots$. We now check it satisfied ($\ast$).
    \begin{align*}
      F(F(x, y), z) &= F(x, F(y, z))\\
      \frac{\partial}{\partial x} F(F(x,y), z) &= \frac{\partial}{\partial x} F(x, F(y, z))\\
      F_1(F(x, y), z) F_1(x,y) &= F_1(x, F(y, z))\\
      F_1(F(0, y), z) F_1(0,y) &= F_1(0, F(y, z))\\
      F_1(y, z) F_1(0, y) &= F_1(0, F(y, z))\\
      F_1(y,z) p(y)^{-1} &= p(F(y, z))^{-1}\\
      F_1(y, z) p(F(y,z)) &= p(y)\\
      \log(F(y, z)) &= \log(y) + h(z)
    \end{align*}
    By symmetry between $y, z$ we see that the constant of integration $h(z)$ must be $\log (z)$.
  \end{enumerate}
  For the second part, we will need the following lemma, which is a generalisation of the statement:
  \begin{lemma}
    Let $f(T) = aT + \ldots \in R[[T]]$ with $a \in R^\times$. Then there is a unique $g(T) = a^{-1}T+  \ldots \in R[[t]]$ such that $f(g(T)) = g(f(T)) = T$.
  \end{lemma}
  \begin{proof}
    We construct polynomials $g_n(T) \in R[T]$ such that $f(g_n(T)) \equiv T \mod T^{n+1}$ and $g_{n+1}(T) \equiv g_n(T) \mod T^{n+1}$. Then we will set $g(T) = \lim_{n\to\infty} g_n(T)$, satisfying $f(g(T)) = T$.

    This is done inductively. To start with, $g_1(T) = a^{-1}T$. Then $f(g_1(T)) = T+T^2(\ldots) \equiv T \mod T^2$.

    Now suppose $n\geq 1$ and $g_{n-1}(T)$ exists.

    Then $f(g_{n-1}(T)) \equiv T + bT^n \mod T^{n+1}$. Let $g_n(T) = g_{n-1}(T) + \lambda T^n$, where $\lambda \in R$ to be chosen later.

    Then $f(g_n(T)) = f(g_{n-1}(T)+\lambda T^n) \equiv f(g_{n-1}(T)) + \lambda aT^{n} \mod T^{n+1} \equiv T + (b+\lambda a)T^{n} \mod T^{n+1}$.

    So pick $\lambda = -ba^{-1}$.

    This gives $g(T)$ with $f(g(T)) = T$.

    Applying the same argument, we get $h(T)$ such that $g(h(T)) = T$.

    Then $f(T) = f(g(h(T))) = h(T)$, and so $g$ is as required.
  \end{proof}
  \begin{enumerate}
    \item[2.] We now only have to show that the $b_n \in R$ (not just in $R \otimes \Q$). See example sheet 2 for this.
  \end{enumerate}
\end{proof}
Let $\mathscr{F}$ be a formal group (e.g. $\hat{\G}_a, \hat{\G}_m, \hat{E}$), given by a power series $F \in R[x,y]$, and suppose that $R$ is $I$-adically complete. Then for $x, y \in I$, put $x \oplus_{\mathscr{F}} y = F(x,y) \in I$. Then $\mathscr{F} = (I, \oplus_{\mathscr{F}})$ is an abelian group.

For example, $\hat{\G}_a(I) = (I, +), \hat{\G}_m(I) = (1+I, \times)$, and in \textbf{8.2}, we saw $\hat{E}(I) \leq E(K)$.

\begin{corollary}
  Let $\mathscr{F}$ be a formal group over $R$, and $n \in \Z$. Suppose $n \in R^\times$. Then:
  \begin{enumerate}
    \item $[n]:\mathscr{F} \to \mathscr{F}$ is an isomorphism.
    \item If $R$ is complete with respect to $I$, then $\mathscr{F}(I) \xrightarrow{\times n} \mathscr{F}(I)$ is an isomorphism.
  \end{enumerate}
  In particular, $\mathscr{F}(I)$ has no $n$-torsion.
\end{corollary}
\begin{proof}
  We have $[1](T) = T, [n](T) = F([n-1]T, T)$ for $n \geq 2$. For $n < 0$, use $[-1](T) = \iota(T)$.

  Induction gives us $[n](T) = nT + \ldots$, and so by \textbf{8.4}, $[n]$ is an isomorphism.
\end{proof}
\section{Elliptic Curves over Local Fields}
Let $K$ be a field, complete with respect to the discrete valuation $v: K^\times \to \Z$. Then we define the valuation ring, or ring of integers, the set:
\[\O_K = \{x \in K^\times : v(x) \geq 0 \} \cup\{0\}\]
Then $\O_K^\times = \{x \in K^\times : v(x) = 0\}$. There is a unique maximal ideal $\pi \O_K$, where $v(\pi) = 1$, and we define the residue field to be $k = \O_K/\pi\O_K$.

We assume $\charr K = 0, \charr k = p$.

For example, if $K = \Q_p, \O_K = \Z_p, \pi = p, k = \F_p$.

Let $E/K$ be an elliptic curve. Then a Weierstrass equation for $E$ with coefficients $a_1, \ldots, a_6 \in K$ is \emph{integral} if $a_i \in \O_K$, and minimal if $v(\Delta)$ is minimal among all integral Weierstrass equations for $E$.

Putting $x = u^2x', y = u^3y'$ give $a_i = u^i a_i'$. So we can clear denominators, and hence every elliptic curve has an integral Weierstrass equation. Moreover, since $a_i \in \O_K, \Delta \in \O_K$, and so $v(\Delta) \geq 0$, and hence we can pick a minimal Weierstrass equation.

If $\charr k \neq 2, 3$ then there is a minimal Weierstrass equation of the form $y^2 = x^3+ax+b$.

\begin{lemma}
  Let $E/K$ have integral Weierstrass equation
  \[y^2+a_1xy+a_3y = x^3+a_2x^2+a_4x+a_6\]
  Let $0 \neq P = (x,y) \in E(K)$. Then either $x, y \in \O_K$ or $v(x) = -2s, v(y) = -3s$ for some $s \geq 1$.
\end{lemma}
Compare this to example sheet 1, question 5.
\begin{proof}
  If $v(x) \geq 0$, then consider $y$.

  If $v(y) < 0$, then $v(LHS) < 0$, but $v(RHS) \geq 0 \contr$, and hence $x, y \in \O_K$.

  Now if $v(x)<0$, then $v(LHS) \geq \min(2v(y), v(x)+v(y), v(y))$\\
  $v(RHS) = v(x^3) = 3v(x)$.

  Hence $v(y) < v(x)$. But then $v(LHS) = 2v(y)$, and hence $3v(x) = 2v(y)$.
\end{proof}
If $K$ is complete, then $\O_K$ is complete with respect to the ideal $\pi^r \O_K$ for any $r \geq 1$.

Fix a minimal Weierstrass equation for $E/K$, and hence a formal group $\hat{E}$ over $\O_K$.

Take $I = \pi^r \O_K$ in \textbf{8.2}, we have
\begin{align*}
  \hat{E}(\pi^r\O_K) &= \left\{(x,y) \in E(K) : -\frac{x}{y}, -\frac{1}{y} \in \pi^r \O_K\right\} \cup \{0\}\\
  &= \left\{(x,y) \in E(K) : v\left(\frac{x}{y}\right)\geq r \& v\left(\frac{1}{y}\right) \geq r\right\}\cup\{0\}\\
  &= \left\{(x,y) \in E(K) : v(x) = -2s, v(y)=-3s, s \geq r\right\}\cup\{0\}\\
  &= \left\{(x,y) \in E(K) : v(x) \leq -2r, v(y)\leq -3r\right\}\cup\{0\}
\end{align*}
By \textbf{8.2}, this is a subgroup of $E(K)$, say $E_r(K)$. We have a chain
\[\ldots \subset E_3(K) \subset E_2(K) \subset E_1(K)\]
More generally, for $\mathscr{F}$ a formal group over $\O_K$, we get
\[\ldots \subset \mathscr{F}(\pi^3\O_K) \subset \mathscr{F}(\pi^2\O_K) \subset \mathscr{F}(\pi\O_K)\]
We will show that $\mathscr{F}(\pi^r \O_K) \cong (\O_K, +)$ for $r$ sufficiently large, and $\mathscr{F}(\pi^r \O_K)/\mathscr{F}(\pi^{r+1}\O_K) \cong (k, +)$.

\begin{theorem}
  Let $\mathscr{F}$ be a formal group over $\O_K$, and let $e = v(p)$. If $r > \frac{e}{p-1}$, then:
  \[\mathscr{F}(\pi^r\O_K) \cong \hat{\G}_a(\pi^r\O_K)\]
  via the $\log$ map, with inverse given by $\exp$.
\end{theorem}
Note that $\hat{\G}_a(\pi^r \O_K) = (\pi^r \O_K, +) \cong (\O_k, +)$.
\begin{proof}
  For $x \in \pi^r \O_K$, we must check that the power series $\exp, \log$ converge.

  Recall $\exp(T) = T+\frac{b_2}{2!}T^2 + \frac{b_3}{3!}T^3 + \ldots$, where $b_i \in \O_K$.

  Claim: $v_p(n!) \leq \frac{n-1}{p-1}$.

  To see this: $v_p(n!) = \sum_{r=1}^{\infty} \floor{\frac{n}{p^r}} < \sum_{r=1}^\infty \frac{n}{p^r} = \frac{n}{p-1}$.

  So $(p-1)v_p(n!) < n$, and as both are integers, $(p-1)v_p(n!) \leq n-1$.

  Now $v(\frac{b_nx^n}{n!})\geq nr - e\frac{n-1}{p-1} = (n-1)\left(r-\frac{e}{p-1}\right) + r$

  This is always $\geq r$ as $r > \frac{e}{p-1}$, and goes to infinity as $n \to \infty$.

  Hence $\exp(x)$ converges, and belongs to $\pi^r \O_K$. A similar argument applies for $\log$.
\end{proof}
\begin{lemma}
  We have $\frac{\mathscr{F}(\pi^r\O_K)}{\mathscr{F}(\pi^{r+1}\O_K)} \cong (k, +)$ for all $r \geq 1$.
\end{lemma}
\begin{proof}
  By definition of a formal group, $F(x, y) = x + y + xy(\ldots)$. So if $x, y \in \O_K$, then:
  \[F(\pi^r x, \pi^r y) = \pi^r(x+y) + \pi^{2r}(xy)(\ldots) \equiv \pi^r(x+y) \mod \pi^{r+1}\]
  So $\mathscr{F}(\pi^r\O_K) \to (k, +); (\pi^r x) \mapsto (x \mod \pi)$ is a surjective group homomorphism, with kernel $\mathscr{F}(\pi^{r+1}\O_K)$, and so apply the first isomorphism theorem.
\end{proof}
So we have a filtration:
\[(\O_K, +) \cong \mathscr{F}(\pi^r\O_K) \supseteq \ldots \supseteq \mathscr{F}(\pi^2\O_K) \supseteq \mathscr{F}(\pi \O_K)\]
where we have equality on the left is $r >\frac{e}{p-1}$, and each quotient is $(k, +)$.

\textbf{Corollary.} If $|k| < \infty$, then $\mathscr{F}(\pi \O_K)$ has a subgroup of finite index isomorphic to $\O_K$ under addition.

As a point of notation, when we have the map $\O_K \to \O_K/\pi\O_K$, we write $x \mapsto \tilde{x}$, and call this reduction mod $\pi$.
\begin{proposition}
  Let $E/K$ be an elliptic curve. The reduction mod $\pi$ of any two minimal Weierstrass equations for $E$ define isomorphic curves over $k$.
\end{proposition}
\begin{proof}
  Say the Weierstrass equations are related by $[u; r,s,t]; u \in K^\times; r,s,t \in K$.

  Then $\Delta_1 = u^{12}\Delta_2$. Both equations are minimal, so $v(\Delta_1) = v(\Delta_2)$, and hence $v(u) = 0, u \in \O_K^\times$.

  Transformation formulae for $a_i$ and $b_i$, together with the fact that the valuation ring is integrally closed, give that $r, s, t \in \O_K$. The Weierstrass equations for the reduction mod $\pi$ are related by $[\tilde{u}; \tilde{r}, \tilde{s}, \tilde{t}]$.
\end{proof}
\textbf{Definition.} The reduction $\tilde{E}/k$ of $E/K$ is defined by the reduction of a minimal Weierstrass equation, and hence is well-defined up to isomorphism by the previous proposition.

We say $E$ has \emph{good reduction} if $\tilde{E}$ is non-singular, i.e. is an elliptic curve. Otherwise, it is $\emph{bad}$.

For an integral Weierstrass equation, $v(\Delta) = 0 \implies$ good reduction.

If $0 <v(\Delta) < 12$, then we must have a minimal Weierstrass equation, and we get bad reduction.

If $v(\Delta) \geq 12$, beware that the equation might not be minimal.

There is a well defined map from $\P^2(K) \to \P^2(k); (x:y:z)\mapsto (\tilde{x}:\tilde{y}:\tilde{z})$, when we choose representatives of $(x:y:z)$ with $\min(v(x),v(y),v(z)) = 0$.

We restrict this map to give a map $E(K) \to \tilde{E}(k); P \to \tilde{P}$. If $P=(x,y) \in E(K)$, then by \textbf{9.1}, either $x,y \in \O_K$ or $v(x) = -2s, v(y) = -3s$. In the first case $\tilde{P} = (\tilde{x}, \tilde{y})$. In the second, we write $P = (\pi^{3s}x:\pi^{3s}y :\pi^{3s})$, so $\tilde{P} = (0:1:0)$.

Therefore $E_1(K) = \hat{E}(\pi\O_K) = \{P \in E(K) : \tilde{P} = 0\}$, and we call it the \emph{kernel of reduction}.

Let $\tilde{E}_{ns} = \begin{cases} \tilde{E} &\text{ if $E$ has good reduction} \\ \tilde{E}\setminus\{p\} & \text{ if $\tilde{E}$ has a singular point $p$}\end{cases}$

The chord and tangent process still defines a group law on $\tilde{E}_{ns}$. In cases of bad reduction, we get $\tilde{E}_{ns} \cong \G_a$ or $\G_m$ over $k$, or possibly only over a quadratic extension of $k$. We call these cases additive and multiplicative reduction.

For simplicity, suppose $\charr(k) \neq 2$. Then $\tilde{E}: y^2 = f(x)$ for $f$ monic cubic. Then $\tilde{E}$ singular $\iff$ $f$ has a repeated root. The cases of double root, triple root correspond to multiplicative, additive reduction respectively.

For multiplicative case, see example sheet 3. Here, we'll illustrate the additive case. We have a triple root, so take $y^2 = x^3$. Then we have an isomorphism
\begin{align*}
  \tilde{E}_{ns} & \to \G_a\\
  (x, y) &\mapsto \frac{x}{y}\\
  (t^{-2}, t^{-3}) &\mapsfrom t\\
  \infty &\mapsfrom 0
\end{align*}
Let $P_1, P_2, P_3$ lie on the line $ax+by=1$. Write $P_i = (x_i, y_i), t_i = \frac{x_i}{y_i}$. Then $x_i^3 = y_i^2 = y_i^2(ax_i+by_i)$, and so $t_1, t_2, t_3$ are the roots of $X^3-aX-b = 0$. Looking at the coefficient of $X^2$, we have $t_1+t_2+t_3 = 0$.

\textbf{Definition.} $E_0(K) \coloneqq \{P \in E(K) : \tilde{P} \in \tilde{E}_{ns}(k)\}$.

\begin{proposition}
  $E_0(K)$ is a subgroup of $E(K)$, and reduction mod $\pi$ is a surjective group homomorphism from $E_0(k) \to \tilde{E}_{ns}(k)$.
\end{proposition}
\begin{proof}
  For the group homomorphism part, a line $\ell$ in $\P^2$ defined over $K$ has equation
  \[\ell: aX+bY+cZ = 0\hspace{2cm} a,b,c \in K\]
  We may assume $\min(v(a), v(b), v(c)) = 0$. Reduction mod $\pi$ gives the line $\tilde{\ell}$ with equation
  \[\tilde{\ell}: \tilde{a}X+\tilde{b}Y+\tilde{c}Z = 0\]
  If $P_1, P_2, P_3 \in E(K)$ with $P_1+P_2+P_3 = 0$, then these points lie on a line $\ell$, and then $\tilde{P}_1, \tilde{P}_2, \tilde{P}_3 \in \tilde{E}(k)$ lie on the line $\tilde{\ell}$.

  If $\tilde{P}_1, \tilde{P}_2 \in \tilde{E}_{ns}(k)$, then $\tilde{P}_3 \in \tilde{E}_{ns}(k)$, and if $P_1, P_2 \in E_0(k)$, then $P_3 \in E_0(k)$, and $\tilde{P}_1+\tilde{P}_2+\tilde{P}_3=0$.

  As an exercise, check this still works if the points are not all distinct.

  For surjectivity, let $f(x, y) = y^2+a_1xy+a_3y-(x^3+\ldots)$. Let $\tilde{P} \in \tilde{E}_{ns}(k) \setminus \{0\}$, say $(\tilde{x}_0, \tilde{y}_0)$ for some $x_0, y_0$ in $\O_K$.

  Since $\tilde{P}$ is non-singular, either
  \begin{align*}
    \text{(i)}&\;\;\; \frac{\partial f}{\partial x}(x_0, y_0) \nequiv 0 \mod \pi\\
    \text{(ii)}&\;\;\; \frac{\partial f}{\partial y}(x_0, y_0) \nequiv 0 \mod \pi
  \end{align*}
  If $(i)$, we put $g(t) = f(t, y_0)\in \O_K[t]$. Then $g(x_0) \equiv 0 \mod \pi, g'(x_0)\in \O_K^\times$. Then Hensel's lemma tells us there is some $b \in \O_K$ with $g(b) = 0, b \equiv x_0 \mod \pi$.

  Then $P = (b, y_0) \in E(K)$ has reduction $\tilde{P}$.

  Case $(ii)$ is similar.
\end{proof}
Recall for $r \geq 1$, we have $E_r(K) = \{(x,y) \in E(K): v(x) \leq -2r, v(y) \leq -3r\}\cup\{0\}$. Then:
\[\O_K \cong E_{\ceil{e/(p-1)}}(K) \supset \ldots \supset E_2(K) \supset E_1(K) \cong \hat{E}(\pi\O_K) \subset E_0(K) \subset E(K)\]
We know the quotients $E_i(K)/E_{i+1}(K) \cong (k, +)$ for $i \geq 1$. The above gives $E_0(K)/E_1(K) \cong \tilde{E}_{ns}(k)$. The only quotient left to understand is $E(K)/E_0(K)$.
\begin{lemma}
  If $|k|<\infty$, then $E_0(K) \subset E(K)$ has finite index.
\end{lemma}
\begin{proof}
  A compactness argument - see below.
\end{proof}
\begin{theorem}
  If $[K:\Q_p]<\infty$, then $E(K)$ contains a subgroup of finite index, isomorphic as a group to $(\O_K, +)$.
\end{theorem}
\begin{proof}
  $|k|<\infty$, so this follows from the above.
\end{proof}
\begin{lemma}
  If $|k|<\infty$, then $\P^n(K)$ is compact with respect to the $\pi$-adic topology.
\end{lemma}
\begin{proof}
  $|k|<\infty$, so $\O_K/\pi^r\O_K$ is also finite for $r \geq 1$. Hence
  \[\O_K \cong \lim_{\xleftarrow[r]{}}\O_K/\pi^r\O_K\]
  is compact.

  $\P^n(K)$ is the union of compact sets of the form
  \[\{(a_0:a_1:\ldots:a_{i-1}:1:a_{i+1}:\ldots:a_n):a_j \in \O_K\}\]
  and hence is compact.
\end{proof}
\begin{proof}[Proof of \textbf{9.6}.]
  $E(K)\subset \P^2(K)$ is a closed subset, so $(E(K), +)$ is a compact topological group.

  If $\tilde{E}$ has a singular point $(\tilde{x}_0, \tilde{y}_0)$ then $E(K)\setminus E_0(K) = \{(x,y) \in E(K):v(x-x_0)\geq 1, v(y-y_0) \geq 1\}$, is a closed subset of $E(K)$, and so $E_0(K)$ is an open subgroup of $E(K)$, so any coset is also open.

  The cosets of $E_0(K)$ form an open cover of $E(K)$, hence have a finite subcover, and so there are only finitely many cosets.

  Hence $[E(K):E_0(K)] < \infty$.
\end{proof}
We call this index $c_K(E)$, the \emph{Tamagawa number}.

\textbf{Remarks.}
\begin{enumerate}
  \item Good reduction $\implies$ $c_K(E) = 1$, but the converse is false.
  \item It can be shown that either $c_K(E) = v(\Delta)$ or $c_K(E) \leq 4$, as long as we work with a minimal Weierstrass equation.
\end{enumerate}
Let $[K:\Q_p]$ be finite, and $L/K$ finite, with residue fields $k', k$ (corresponding to $L, K$ respectively), with $f = [k':k]$ and ramification index $e$. From local fields, we know $[L:K] = ef$.

If $L/K$ is Galois then there is a natural group homomorphism $\Gal(L/K) \to \Gal(k'/k)$, and this map is surjective, with kernel of order $e$. We say the extension is \emph{unramified} if $e=1$, so if these Galois groups are isomorphic.

For each $m \geq 1$, $k$ has a unique extension of degree $m$, called $k_m$ (not standard notation). $K$ has a unique unramified extension of degree $m$, called $K_m$. Note that then the residue field of $K_m$ is $k_m$. These extensions are Galois with cyclic Galois group.

We then define $K^{nr} = \bigcup_{m\geq 1} K_m$ inside $\bar{K}$, the maximal unramified extension.

\begin{theorem}
  Suppose $[K:\Q_p] < \infty$, and $E/K$ has good reduction and $p\nmid n$. If $P \in E(K)$ then $K([n]^{-1}P)/K$ is unramified.
\end{theorem}
Notation: $[n]^{-1}P = \{Q \in E(\bar{K}) : nQ = P\}$, and $K(P_1, \ldots, P_r) = K(x_1, \ldots, x_r, y_1, \ldots, y_r)$, $P_i = (x_i, y_i)$.

\begin{proof}
  For each $m \geq 1$, there is a short exact sequence $0\to E_1(K_m) \to E(K_m) \to \tilde{E}(k_m) \to 0$.

  Taking union over all $m$ gives a commutative diagram:
  \begin{center}
    \begin{tikzcd}
      0 \arrow{r} & E_1(K^{nr}) \arrow{r} \arrow{d}{\times n} & E(K^{nr}) \arrow{r} \arrow{d}{\times n} & \tilde{E}(\bar{k}) \arrow{d}{\times n} \arrow{r} & 0\\
      0 \arrow{r} & E_1(K^{nr}) \arrow{r} & E(K^{nr}) \arrow{r} & \tilde{E}(\bar{k}) \arrow{r} & 0
    \end{tikzcd}
  \end{center}
  The first vertical arrow is an isomorphism by \textbf{8.5}, as $n \in \O_K^\times$.

  The last vertical arrow is surjective by \textbf{2.8}, with kernel $(\Z/n\Z)^2$ by \textbf{6.5}, as $p \nmid n$.

  The snake lemma tells us $E(K^{nr})[n]\cong (\Z/n\Z)^2, E(K^{nr})/nE(K^{nr}) = 0$.

  So if $P \in E(K)$, then multiplication by $n$ is surjective, and there is $Q$ in $E(K^{nr})$ with $nQ = P$, and $[n]^{-1}P = \{Q+T:T\in E[n]\} \subset E(K^{nr})$.

  So $K([n]^{-1}P) \subset K^{nr}$, and $K([n]^{-1}P)/K$ is unramified.
\end{proof}
\begin{corollary}
  Let $E/K$ be an elliptic curve with $[K:\Q_p]<\infty$ Then $E(K)_{\text{tors}}$ is finite.
\end{corollary}
\begin{proof}
  In \textbf{9.7} we saw that $E(K)$ has a subgroup $E_r(K)$ of finite index isomorphic to $(\O_K, +)$. Since $E_r(K)$ is torsion free, $E(K)_{\text{tors}}\injection E(K)/E_r(K)$, an injection into a finite group.
\end{proof}
\section{Elliptic Curves over Number Fields}
\subsection{The Torsion Subgroup}
Let $[K:\Q]<\infty$ and $E/K$ an elliptic curve.

Let $\p$ be a prime of $K$ (i.e. a prime ideal in $\O_K$). We write $K_\p$ for the $\p$-adic completion of $K$, and $k_\p$ for $\O_K/\p$. Note that, upon taking completions, the residue field doesn't change.

\textbf{Definition.} $\p$ is a prime of good reduction for $E/K$ if $E/K_\p$ is has good reduction.

\begin{lemma}
  $E/K$ has only finitely many primes of bad reduction.
\end{lemma}
\begin{proof}
  Take any Weierstrass equation for $E$, with coefficients in $\O_K$. $E$ is non-singular, so $0 \neq \Delta \in \O_K$. We can thus write $\Delta = \p_1^{\alpha_1}\ldots \p_r^{\alpha_r}$ as a unique factorisation into prime ideals, and let $S = \{\p_i\}$ in this factorisation.

  If $\p \notin S$, then $v_\p(\Delta) = 0$, so $E/K_\p$ has good reduction.

  Hence the set of bad primes for $E$ is a subset of $S$, which is finite.
\end{proof}
Note that we'd like to say that $S$ is the set of bad primes. If $K$ has class number 1, e.g. $K=\Q$, then we can always find Weierstrass equation for $E$ with the coefficients in $\O_K$ minimal at all primes $\p$, and then $S$ will be all the bad primes.

\begin{lemma}
  $E(K)_{\text{tors}}$ is finite.
\end{lemma}
\begin{proof}
  Take any prime $\p$ and complete at $\p$. Then $K\subseteq K_\p$, so $E(K)_{\text{tors}} \subseteq E(K_\p)_{\text{tors}}$ is finite by \textbf{9.10}.
\end{proof}
\begin{lemma}
  Let $\p$ be a prime of good reduction, with $\p\nmid n$. Then reduction mod $\p$ gives an injective group homomorphism
  \[E(K)[n] \injection \tilde{E}(k_\p)[n]\]
\end{lemma}
\begin{proof}
  \textbf{9.5} tells us that $E(K_\p) \to \tilde{E}(k_\p)$ is a group homomorphism. Hence it takes $n$-torsion points to $n$-torsion points, as needed. It has kernel $E_1(K_\p)$. Since $\p \nmid n$, \textbf{8.5} tells us $E_1(K_\p)$ has no $n$-torsion, and so the map is injective.
\end{proof}
\textbf{Examples.}
\begin{enumerate}
  \item $E/\Q : y^2+y=x^3-x^2, \Delta = -11$.
  $E$ has good reduction at all primes $p \neq 11$.

  \begin{tabular}{c|ccccccc}
    $p$ & 2 & 3 & 5 & 7 & 11 & 13\\\hline
    $\#\tilde{E}(\F_p)$ & 5 & 5 & 5 & 10 & - & 10
  \end{tabular}

  By \textbf{10.3} looking at $p=2$, $\#E(\Q)_{\text{tors}}|5\cdot 2^a$ for some $a \geq 0$.

  Looking at $p=3$, $\#E(\Q)_{\text{tors}}|5\cdot 3^b$ for some $b \geq 0$.

  Hence $\#E(\Q)_{\text{tors}}|5$, so is 1 or 5.

  Let $T = (0,0) \in E(\Q)$. Calculation gives that $5T = O_E$, and so $E(\Q)_{\text{tors}} \cong \Z/5\Z$.

  \item $E/\Q : y^2+y = x^3+x^2, \Delta = -43$. $E$ has good reduction at all primes $p \neq 43$.

  \begin{tabular}{c|ccccccc}
    $p$ & 2 & 3 & 5 & 7 & 11 & 13\\\hline
    $\#\tilde{E}(\F_p)$ & 5 & 6 & 10 & 8 & 9 & 19
  \end{tabular}

  So $\#E(\Q)_{\text{tors}}|5\cdot 2^a$, some $a\geq 0$, and $\#E(\Q)_{\text{tors}}|9\cdot 11^b$, some $b \geq 0$.

  So $\#E(\Q)_{\text{tors}} = 1$, and $E(\Q)_{\text{tors}} = \{O_E\}$.

  Now, since $P = (0,0)\in E(\Q)$, it has infinite order, and hence infinitely many rational points on $E(\Q)$. This is an example where $\rank E(\Q) \geq 1$.

  \item $E_D : y^2=x^3-D^2x$ for $D \in \Z$ a squarefree integer. Then $\Delta = 2^6D^6$.

  $E_D(\Q)_{\text{tors}} \supset \{0, (0,0), (\pm D, 0)\} \cong (\Z/2\Z)^2$.

  Let $f(x) = x^3-D^2x$. Then if $p$ is prime not dividing $2D$, then it is a prime of good reduction.

  $\#\tilde{E}(\F_p) =1+ \sum_{x\in\F_p}\left(\legendre{f(x)}{p}+1\right)$, where $\legendre{f(x)}{p}$ is the Legendre symbol.

  If $p \equiv 3 \mod 4$, then since $f(x)$ is an odd function:
  \[\legendre{f(-x)}{p} = \legendre{-f(x)}{p} = \legendre{-1}{p}\legendre{f(x)}{p} = -\legendre{f(x)}{p}\]
  and so $\#\tilde{E}_D(\F_p) = p+1$.

  Let $m = \#E(\Q)_{\text{tors}}$. We have $4|m|p+1$ for all sufficiently large primes $p$ congruent to $3$ mod $4$, and hence $m=4$, since otherwise this contradicts Dirichlet's theorem on primes in arithmetic progression.

  Hence $E_D(\Q)_{\text{tors}} \cong (\Z/2\Z)^2$. So $\rank E_D(\Q) \geq 1$ if and only if there are $x, y \in \Q$ with $y \neq 0$ such that $y^2 = x^3-Dx$, which by the first lecture is equivalent to $D$ being a congruent number.
\end{enumerate}
\begin{lemma}
  Let $E/\Q$ be given by a Weierstrass equation with coefficients in $\Z$. Let $0 \neq T \in E(\Q)_\text{tors}$. Then:
  \begin{enumerate}
    \item $4x, 8y \in \Z$.
    \item If $2|a_1$ or $2T \neq O_E$, then $x, y \in \Z$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  The Weierstrass equation defines a formal group $\hat{E}$ over $\Z$. For $r\geq 1$, we have $\hat{E}(p^r\Z_p) = \{(x,y) \in E(\Q_p) : v_p(x)\leq -2r, v_p(y)\leq -3r\}\cup \{0\}$.

  \textbf{9.2} gives $\hat{E}(p^r\Z_p) \cong (\Z_p, +)$ if $r >\frac{1}{p-1}$, and hence $\hat{E}(4\Z_2)$ and $\hat{E}(p\Z_p)$ are torsion free.

  Since $T$ is a nonzero torsion point, it follows that $v_p(x), v_p(y) \geq 0$ for all odd primes $p$, and $v_2(x) \geq -2, v_2(y) \geq -3$. This proves part 1.

  For the second part, suppose that $T \in \hat{E}(2\Z_2)$, i.e. $v_2(x) = -2, v_2(y)=-3$.

  Since $\frac{\hat{E}(2\Z_2)}{\hat{E}(4\Z_2)} \cong (\F_2, +)$ and $\hat{E}(4\Z_2)$ is torsion free, we get $2T = 0$. Also, $(x, y) = T = -T = (x, -y-a_1x-a_3)$, and hence $2y+a_1x+a_3 = 0, 8y+4xa_1+4a_3 = 0$.

  $8y$ is odd, $4x$ is odd, $4a_3$ is even, and hence $a_1$ is odd.

  So if $2T \neq 0$ or $a_1$ is even, then $T \notin \hat{E}(2\Z_2)$, so $x, y \in \Z$.
\end{proof}
For example, if $y^2+xy = x^3+4x+1$, then $(-\frac14, \frac18) \in E(\Q)[2]$.

\begin{theorem}[Lutz-Nagell]
  Let $E/\Q$ be given by $y^2 = x^3+ax+b$, for $a, b \in \Z$.

  Suppose $0 \neq T = (x,y) \in E(\Q)_{\text{tors}}$. Then $x,y \in \Z$, and either $y=0$ or $y^2 |4a^3+27b^2$.
\end{theorem}
Note that this is not an if and only if - we still have to check the answers we get.
\begin{proof}
  \textbf{10.4} gave us $x,y \in \Z$. If $2T = 0$, then $y=0$.

  Otherwise, $0 \neq 2T = (x_2, y_2) \in E(\Q)_{\text{tors}}$, and so \textbf{10.4} gives $x_2, y_2 \in \Z$.

  But $x_2 = \left(\frac{f'(x)}{2y}\right)^2-2x$, and so $y|f'(x)$.

  $E$ non-singular, so $f(x)$ and $f'(x)$ are coprime, and so $f(x)$ and $(f'(x))^2$ are coprime, hence $1 = g(x)f(x)+h(x)(f'(x))^2$ for some $g, h \in \Q[x]$.

  Doing this calculation and clearing denominators, we get
  \[(3x^2+4a)f'(x)^2-27(x^3+ax-b)f(x)=4a^3+27b^2\]
  Since $y|f'(x), y^2=f(x)$, so $y^2$ divides LHS, hence $y^2|4a^3+27b^2$.
\end{proof}
Mazur showed that, if $E/\Q$ is an elliptic curve, then $E(\Q)_{\text{tors}} \cong \begin{cases} \Z/n\Z & 1\leq n \leq 12, n \neq 11\\ \Z/2\Z \times \Z/2n\Z & 1\leq n \leq 4\end{cases}$. Moreover, all 15 possibilities occur.
\section{Kummer Theory}
$K$ is a field, $\charr K \nmid n$, and $\mu_n \subset K$, where $\mu_n$ is the set of $n\th$ roots of unity.
\begin{lemma}
  Let $\Delta \subset K^\times/(K^\times)^n$ be a finite subgroup, and let $L = K(\sqrt[n]{\Delta})$. Then $L/K$ is Galois, and $\Gal(L/K) \cong \Hom(\Delta, \mu_n)$.
\end{lemma}
\begin{proof}
  $L/K$ is Galois since $\mu_n \subset K$, and $\charr K \nmid n$.

  Define the Kummer pairing
  \begin{align*}
    \angle{\cdot, \cdot} : \Gal(L/K)\times \Delta &\to \mu_n\\
    (\sigma, x) &\mapsto \frac{\sigma(\sqrt[n]{x})}{\sqrt[n]{x}}
  \end{align*}
  It is well defined: suppose $\alpha, \beta \in L$ are two different choices of $\sqrt[n]{x}$. Then $(\alpha/\beta)^n = 1$, so $\alpha/\beta \in \mu_n \subset K$, so $\sigma(\alpha/\beta) = \alpha/\beta$. Hence $\sigma(\alpha)/\alpha = \sigma(\beta)/\beta)$.

  It is bilinear: $\angle{\sigma\tau, x} = \frac{\sigma\tau\sqrt[n]{x}}{\tau\sqrt[n]{x}}\frac{\tau\sqrt[n]{x}}{\sqrt[n]{x}} = \angle{\sigma, x}\angle{\tau, x}$, as $\tau \sqrt[n]{x}$ is another choice of $\sqrt[n]{x}$, and\\
  $\angle{\sigma, xy} = \frac{\sigma\sqrt[n]{xy}}{\sqrt[n]{xy}} = \frac{\sigma\sqrt[n]{x}}{\sqrt[n]{x}}\frac{\sigma\sqrt[n]{y}}{\sqrt[n]{y}} = \angle{\sigma, x}\angle{\sigma, y}$.

  It is non-degenerate: Let $\sigma \in \Gal(L/K)$. If $\angle{\sigma, x} = 1$ for all $x \in \Delta$, then $\sigma(\sqrt[n]{x}) = \sqrt[n]{x}$ for all $x \in \Delta$, and so $\sigma$ fixes $L$ pointwise. Hence $\sigma = \id$. Now fix $x \in \Delta$, and suppose $\angle{\sigma, x} = 1$ for all $\sigma \in \Gal(L/K)$. Then $\sigma(\sqrt[n]{x}) = \sqrt[n]{x}$ for all $\sigma \in \Gal(L/K)$, and hence $\sqrt[n]{x} \in K$, and so $x \in (K^\times)^n$, i.e. $x (K^\times)^n$ is trivial in $\Delta$.

  We thus get injective group homomorphisms $\Gal(L/K) \injection \Hom(\Delta, \mu_n)$, $\Delta \injection  \Hom(\Gal(L/K), \mu_n)$.

  Hence $\Gal(L/K)$ is abelian of exponent dividing $n$.

  If $G$ is a finite abelian group of exponent dividing $n$, then $\Hom(G, \mu_n) = G$ (non-canonically).

  So $|\Gal(L/K)| \leq |\Delta|\leq |\Gal(L/K)$, and so $|\Delta| = |\Gal(L/K)|$, and hence the injective homomorphisms are surjective as well, so isomorphisms.
\end{proof}
For example $\Gal(\Q(\sqrt{2}, \sqrt{3}, \sqrt{5})/\Q) \cong (\Z/2\Z)^3$.
\begin{theorem}
  There is a bijection
  \begin{align*}
    \{\text{finite subgroups }\Delta \subseteq K^\times/(K^\times)^n\} &\leftrightarrow \{\text{finite abelian extensions }L/K\text{ of exponent dividing $n$}\}\\
    \Delta &\mapsto K(\sqrt[n]{\Delta})\\
    \frac{(L^\times)^n \cap K^\times}{(K^\times)^n} &\mapsfrom L
  \end{align*}
\end{theorem}
\begin{proof}
  Let $L/K$ be a finite abelian extension of exponent dividing $n$. Let $\Delta = \frac{(L^\times)^n \cap K^\times}{(K^\times)^n}$. Then $K(\sqrt[n]{\Delta}) \subset L$ and we aim to show equality.

  Let $G = \Gal(L/K)$.

  The Kummer pairing gives an injection $\Delta \injection \Hom(G, \mu_n)$. We claim this is a surjection.

  Given the claim, we will then have $\Delta \cong \Hom(G, \mu_n)$, so $[K(\sqrt[n]{\Delta}):K] = |\Delta|$ by \textbf{11.1} $= |G| = [L:K]$, and hence we have the equality.

  To prove the claim, let $\chi:G \to \mu_n$ be a member of $\Hom(G, \mu_n)$. Distinct automorphisms are linearly independent. Then
  \[\exists a \in L \st \underbrace{\sum_{\tau \in G} \chi(\tau)^{-1} \tau(a)}_y \neq 0\]
  Let $\sigma \in G$. Then
  \begin{align*}
    \sigma(y) &= \sum_{\tau \in G} \chi(\tau)^{-1}\sigma\tau(a)\\
    &= \sum_{\tau\in G}\chi(\sigma^{-1}\tau)^{-1}\tau(a)\\
    &= \chi(\sigma)y
  \end{align*}
  So $\sigma(y^n) = y^n$ for all $\sigma \in G$. Then if $x \coloneqq y^n$, we have $x \in K^\times$, and $x \in (L^\times)^n$.

  So $x \in \Delta$, and $\chi(\sigma) = \frac{\sigma(\sqrt[n]{x})}{\sqrt[n]{x}}$, and so $\chi$ is the image of $x$ under the injection, and hence it is a surjection.

  For the other direction, we start with $\Delta \subset K^\times/(K^\times)^n$ a finite subgroup. Let $L = K(\sqrt[n]{\Delta})$, and $\Delta' = \frac{(L^\times)^n\cap K^\times}{(K^\times)^n}$, and we must show that $\Delta' = \Delta$.

  Clearly $\Delta \subseteq \Delta'$. We then compute sizes.

  $L = K(\sqrt[n]{\Delta}) \subset K(\sqrt[n]{\Delta'}) \subset L$, and we have equality throughout. So $K(\sqrt[n]{\Delta}) = K(\sqrt[n]{\Delta'})$.

  \textbf{11.1} gives $|\Delta| = |\Delta'|$, and so $\Delta = \Delta'$.
\end{proof}

\begin{proposition}
  Let $K$ be a number field containing $\mu_n$. Let $S$ be a finite set of primes of $K$. Then there are only finitely many extensions $L/K$ such that:
  \begin{enumerate}
    \item $L/K$ is abelian of exponent dividing $n$.
    \item $L/K$ is unramified at all primes outside $S$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  \textbf{11.2} gives us $L = K(\sqrt[n]{\Delta})$ for some $\Delta \in K^\times/(K^\times)^n$ a finite subgroup. Let $\p$ be a prime of $K$. Then $\p\O_L = \mathcal{P}_1^{e_1} \ldots \mathcal{P}_r^{e_r}$, where $\mathcal{P}_i$ are primes in $\O_L$.

  If $x \in K^\times$ represents an element of $\Delta$. If $x \in K^\times$ represents an element of $\Delta$, then
  \[nv_{\mathcal{P}_i}(\sqrt[n]{x}) = v_{\mathcal{P}_i}(x) = e_i v_\p(x)\]
  If $\p \notin S$, then all $e_i =1$, so $v_\p(x) \equiv 0 \mod n$, and so $\Delta \subset K(S, n)$, where
  \[K(S, n) \coloneqq \{x \in K^\times/(K^\times)^n : v_\p(x) \equiv 0 \mod n \forall \p \notin S\}\]
  The proof is completed by the following lemma.
\end{proof}
\begin{lemma}
  $K(S,n)$ is finite.
\end{lemma}
\begin{proof}
  The map $K(S,n) \to (\Z/n\Z)^{|S|}$, $x \mapsto (v_\p(x) \mod n)$ for $\p \in S$ is group homomorphism with kernel $K(\emptyset, n)$.

  Since $|S|<\infty$, it suffices to prove the lemma with $S = \emptyset$.

  If $x \in K^\times$ represents an element of $K(\emptyset, n)$, then $(x) = \f{a}^n$ for some ideal $\f{a}$.

  There is then an exact sequence:
  \begin{center}
    \begin{tikzcd}
      0 \arrow{r} & \frac{\O_K^\times}{(\O_K^\times)^n} \arrow{r} & K(\emptyset, n) \arrow{r}{} & Cl_K[n] \arrow{r} & 0\\
      & & x(K^\times)^n \arrow[mapsto]{r}{} & \left[\f{a}\right] &
    \end{tikzcd}
  \end{center}
  Now $|Cl_K|<\infty$ and $\O_K^\times$ is finitely generated by Dirichlet's unit theorem, so $K(\emptyset, n)$ is finite.
\end{proof}
\section{Elliptic Curves over Number Fields II}
\subsection{The Mordell-Weil Theorem}
\begin{lemma}
  Let $E/K$ be an elliptic curve. Let $L/K$ be a finite Galois extension. Then the map
  \[E(K)/nE(K) \to E(L)/nE(L)\]
  has finite kernel.
\end{lemma}
\begin{proof}
  For each element in the kernel, we pick a coset representative $P \in E(K)$, and then $Q \in E(L)$ with $nQ = P$.

  Note that, for any $\sigma \in \Gal(L/K)$, $n(\sigma(Q) - Q) = \sigma(P)-P = 0$.

  $\Gal(L/K)$ is finite and $E[n]$ is finite, so there are only finitely many possibilities for the map $\Gal(L/K) \to E[n], \sigma \mapsto \sigma Q-Q$.

  But if $P_1, P_2 \in E(K)$ then $P_i = nQ_i$ for $Q_1, Q_2 \in E(L)$, and $\sigma Q_1 -Q_2 = \sigma Q_2 - Q_2$, and so $\sigma(Q_1-Q_2) = Q_1-Q_2$ for all $\sigma \in \Gal(L/K)$.

  But then $Q_1 - Q_2 \in E(K)$, and so $P_1 -P_2 \in n E(K)$.
\end{proof}
\begin{theorem}[Weak Mordell-Weil]
  If $K$ is a number field and $E/K$ is an elliptic curve, with $n \geq 2$ an integer, then $E(K)/nE(K)$ is finite.
\end{theorem}
\begin{proof}
  \textbf{12.1} tells us we may replace $K$ by a finite Galois extension. So without loss of generality, $\mu_n \subset K$ and $E[n] \subset E(K)$.

  Let $S = \{\p |n\} \cup \{\text{primes of bad reduction for }E/K\}$.

  For each $P \in E(K)$, the extension $K([n]^{-1}P)/K$ is unramified outside $S$, by \textbf{9.9}.

  Let $Q \in [n]^{-1}P$. Since $E[n] \subseteq E(K)$, $K(Q) = K([n]^{-1}P)$, and this is a Galois extension of $K$.

  Then we claim that we have an injective group homomorphism:
  \begin{align*}
    \Gal(K(Q)/K) &\injection E[n]\\
    \sigma &\mapsto \sigma Q - Q
  \end{align*}
  This is a group homomorphism as $\sigma \tau Q - Q = \sigma(\tau Q - Q) + (\sigma Q - Q)$. But $\tau Q - Q$ is an $n$-torsion point, so lies in $K$, so this is $\tau Q - Q + \sigma Q - Q$.

  It is injective, as if $\sigma Q = Q$ then $\sigma$ fixes $K(Q)$, and so $\sigma$ is the identity.

  So $K(Q) / K$ is an abelian extension of exponent dividing $n$, unramified outside of $S$, so \textbf{11.3} tells us there are only finitely many possibilities for $K(Q)/K$ as we vary $P$.

  Let $L$ be the composite of all such extensions of $K$. Then $L/K$ is a finite Galois extension, and
  \[E(K)/nE(K) \to E(L)/nE(L)\]
  is the zero map.

  \textbf{12.1} implies that this has finite kernel, and so $|E(K)/nE(K)| < \infty$.
\end{proof}
If $K = \R$ or $\C$ or $[K:\Q_p] < \infty$, then $|E(K)/nE(K)|<\infty$, yet $E(K)$ is uncountable. Hence $E(K)$ is not finitely generated.

It is a fact that there is a quadratic form called the \emph{canonical height} $\hat{h} : E(K) \to \R_{\geq 0}$ with the property that, for any $B \geq 0$, the set $\{P \in E(K) : \hat{h}(P) \leq B\}$ is finite.

\begin{theorem}[Mordell-Weil]
  Let $K$ be a number field with $E/K$ an elliptic curve. Then $E(K)$ is a finitely generated abelian group.
\end{theorem}
\begin{proof}
  Fix any integer $n \geq 2$. Weak Mordell-Weil gives $|E(K)/nE(K)| < \infty$. Pick coset representatives for $E(K)/nE(K)$, say $P_1, \ldots, P_m$.

  Then let $\Sigma = \{P \in E(K) : \hat{h}(P) \leq \max_{1 \leq i \leq m} \hat{h}(P_i)\}$.

  We claim $\Sigma$ generates $E(K)$.

  If not, then there is $P \in E(K) \setminus \{\text{subgroup generated by }\Sigma\}$ of minimal point (this exists because there are only finitely many ``small points that are too big").

  Then $P = P_i + nQ$ for some $1 \leq i \leq m$, and $Q \in E(K)$.

  Note that $Q \in E(K) \setminus \langle\Sigma\rangle$. The minimal choice of $P$ tells us that $4\hat{h}(P) \leq 4\hat{h}(Q) \leq n^2 \hat{h}(Q) = \hat{h}(nQ) = \hat{h}(P-P_i) \leq \hat{h}(P-P_i) + \hat{h}(P+P_i) = 2\hat{h}(P) + 2\hat{h}(P_i)$. Hence $\hat{h}(P) \leq \hat{h}(P_i)$, and so $P \in \Sigma \contr$.

  Hence $\Sigma$ generates $E(K)$, and is finite, so $E(K)$ is finitely generated.
\end{proof}
Note that the structure theorem for finitely generated abelian groups shows that $E(K)$ is of the form
\[E(K) \cong E(K)_\text{tors} \times \Z^r\]
for some non-negative integer $r$, called the \emph{rank}. There is no known algorithm for computing the rank of $E(K)$ in all cases.

\section{Heights}
For simplicity, we will take $K = \Q$. Write $P \in \P^n(\Q)$ as $P = (a_0:\ldots:a_n)$ are (not necessarily pairwise) coprime integers.

We define the \emph{height} of $P$, $H(P) = \max_{0 \leq i \leq n}|a_i|$.

\begin{lemma}
  Let $f_1, f_2 \in \Q[x_1, x_2]$ be coprime homogeneous polynomials of the same degree $d$. Let $F:\P^1 \to \P^1; (x_1:x_2) \mapsto (f_1(x_1,x_2):f_2(x_1, x_2))$.

  Then there are constants $c_1, c_2 > 0$ such that
  \[c_1H(P)^d \leq H(F(P)) \leq c_2H(P)^d\]
  for all points $P \in \P^1(\Q)$.
\end{lemma}
\begin{proof}
  Without loss of generality, $f_1, f_2 \in \Z[x_1, x_2]$. For the upper bound, write $P = (a:b)$, coprime. Then
  \begin{align*}
    H(F(P)) & \leq \max(|f_1(a,b)|, |f_2(a,b)|)\\
    &\leq c_2 \max (|a|^d, |b|^d)
  \end{align*}
  where $c_2 = \max (\text{ sum of abs. values of coeffs of $f_i$})$.
  So $H(F(P)) \leq c_2 H(P)^d$.

   For lower bound, we claim there are $g_{ij} \in \Z[x_1, x_2]$ homogeneous polynomials of degree $d-1$ and $\kappa \in \Z_{>0}$ such that
   \[\sum_{j=1}^2 g_{ij}f_j = \kappa x_i^{2d-1}\;\;\;\;\;\; i=1,2\tag{$\ast$}\]
   Indeed, running Euclid's algorithm on $f_1(x,1), f_2(x,1)$ give $r, s \in \Q[x]$ of degree $<d$ such that
   \[r(x)f_1(x, 1) + s(x)f_2(x, 1) = 1\]
   Homogenising and clearing denominators gives $(\ast)$ for $i=2$, and likewise for $i=1$.

   Write $P = (a_1:a_2)$ for integers $a_1, a_2$ coprime. Then $(\ast)$ gives that
   \[\sum_{j=1}^2 g_{ij}(a_1, a_2)f_j(a_1, a_2) = \kappa a_i^{2d-1}\]
   and so $\gcd(f_1(a_1, a_2), f_2(a_1,a_2))$ divides $\gcd(\kappa a_1^{2d-1}, \kappa a_2^{2d-1}) = \kappa$.

   But also $|\kappa a_i^{2d-1}| \leq \underbrace{\max_{j=1,2} |f_j(a_1, a_2)|}_{\leq \kappa H(F(P))}\underbrace{\sum_{j=1}^2 |g_{ij}(a_1, a_2)|}_{\leq \gamma_i H(P)^{d-1}}$ where $\gamma_i = \sum_{j=1}^2 ($sum of absolute values of coefficients of $g_{ij}$). Hence we have
   \[\kappa |a_i|^{2d-1} \leq \gamma_i H(F(P))H(P)^{d-1}\]
   and so
   \[\frac{1}{\max (\gamma_1, \gamma_2)}H(P)^{d} \leq H(F(P))\]
\end{proof}
Notation: for $x \in \Q$, we write $H(x) = H((x:1)) = \max(|u|, |v|)$ where $x = \frac{u}{v}$, $u, v$ coprime.

Let $E/\Q$ be an elliptic curve, given by $y^2=x^3+ax+b$.

Then we define the height function:
\begin{align*}
  H:E(\Q) & \to \R_{\geq 1}\\
  P&\mapsto \begin{cases} H(x) & P = (x,y)\\ 1 & P=Q \end{cases}
\end{align*}
and the \emph{logarithmic height}
\begin{align*}
  h:E(\Q) & \to \R_{\geq 0}\\
  P&\mapsto \log(H(P))
\end{align*}
\begin{lemma}
  Let $E, E'$ be elliptic curves over $\Q$, and $\phi:E \to E'$ an isogeny defined over $\Q$.

  Then there is $c>0$ such that
  \[|h(\phi(P)) - \deg(\phi)h(P)| \leq c \forall P \in E(\Q)\]
  Note that $c$ depends on $E, E', \phi$ but not on $P$.
\end{lemma}
\begin{proof}
  Recall \textbf{5.3} that the $x$-coordinate of $\phi(P)$ only depends on the $x$-coordinate of $P$, say $x(\phi(P)) = \xi(x(P))$. Then \textbf{13.1} gives $c_1, c_2> 0$ such that
  \[c_1 H(P)^d \leq H(\phi(P)) \leq c_2 H(P)^d\]
  Taking logs gives the result.
\end{proof}
For example, if $\phi = [2]:E \to E$. Then there is $c>0$ such that
\[|h(2P) - 4h(P)| \leq c \forall P \in E(\Q)\]
\textbf{definition}
  The \emph{canonical height} is defined as follows:
  \[\hat{h}(P ) =\lim_{n\to\infty}\frac{1}{4^n}h(2^n P)\]

We check convergence: let $m \geq n$. Then
\[|\frac{1}{4^m} h(2^m P) - \frac{1}{4^n}h(2^nP)| \leq \sum_{r=n}^{m-1}|\frac{1}{4^{r+1}}h(2^{r+1}P) - \frac{1}{4^r}h(2^r P)| \leq \sum_{r=n}^{\infty}\frac{c}{4^{r+1}} = \frac{c}{3\cdot 4^n} \to 0\]
So the sequence is Cauchy, and $\hat{h}(P)$ exists.
\begin{lemma}
  $|h(P)-\hat{h}(P)|$ is bounded.
\end{lemma}
\begin{proof}
  Put $n=0$ in the above calculation. Then $|\hat{h}(P) - h(P)| \leq \frac{c}{3}$.
\end{proof}
\begin{corollary}
  The set $\{P \in E(\Q) : \hat{h}(P) \leq B\}$ is finite.
\end{corollary}
\begin{proof}
  $\hat{h}(P)$ bounded implies that $h(P)$ is bounded.

  But then there are only finitely many possibilities for $x$, and so finitely many possibilities for $P$.
\end{proof}
\begin{lemma}
  Let $\phi : E \to E'$ be an isogeny. Then $\hat{h}(\phi P) = (\deg \phi)\hat{h}(P)$.
\end{lemma}
\begin{proof}
  \textbf{13.2} gives $c > 0$ such that
  \[|h(\phi P) - (\deg \phi)h(P)| \leq c\]
  Replace $P$ by $2^n P$, divide by $4^n$, and take the limit as $n \to \infty$.
\end{proof}
\textbf{Remarks.}
\begin{enumerate}
  \item $H$ and $h$ depend on a choice of Weierstrass equation. \textbf{13.5} applied in the case where $\phi$ is an isomorphism (so $\deg \phi = 1$) shows that $\hat{h}$ does not.
  \item Taking $\phi = [n]:E \to E$ shows $\hat{h}(nP) = n^2\hat{h}(P)$.
\end{enumerate}
\begin{lemma}
  Let $E/\Q$ be an elliptic curve, with Weierstrass equation $y^2=x^3+ax+b$. Then there is some $c > 0$ such that
  \[H(P+Q)H(P-Q) \leq cH(P)^2 H(Q)^2 \forall P, Q \in E(\Q)\text{ with }P,Q,P\pm Q \neq O_E\]
\end{lemma}
\begin{proof}
  Let $P,Q,P+Q,P-Q$ have $x$ coordinates $x_1, \ldots, x_4$ respectively. By \textbf{5.7} there exist polynomials $W_0, W_1, W_2 \in \Z[x_1,x_2]$ of degree $\leq 2$ in $x_1$ and of degree $\leq 2$ in $x_2$ such that $(1:x_3+x_4:x_3x_4) = (W_0:W_1:W_2)$.

  Write $x_i = r_i/s_i$ for $r_i, s_i \in \Z$ coprime. Then we get
  \[(s_3s_4:r_3s_4+r_4s_3:r_3r_4) = ((r_1s_2-r_2s_1)^2:\ldots:\ldots)\]
  Note that the three integers on the left are coprime.

  Then $H(P+Q)H(P-Q) = \max(|r_3|,|r_3|)\max(|r_4|,|s_4|) \leq 2\max(|s_3s_4|,|r_3s_4+r_4s_3|,|r_3r_4|)$, and, since the three terms on the right are integers, so must be $\geq$ the corresponding coprime terms on the left, we have:
  \begin{align*}
    H(P+Q)H(P-Q) & \leq 2 \max(|r_1s_2-r_2s_1|^2, \ldots)\\
    &\leq c H(P)^2 H(Q)^2
  \end{align*}
  where $c$ depends on $E$ but not on $P,Q$.
\end{proof}
\begin{theorem}
  $\hat{h}:E(\Q) \to \R_{\geq 0}$ is a quadratic form.
\end{theorem}
\begin{proof}
  Take logs in the last lemma gives
  \[h(P+Q) + h(P-Q) \leq 2h(P)+2h(Q) + c\]
  for all $P,Q$ with $P,Q,P+Q,P-Q \neq O_E$. We can remove this last restriction by using the fact that $|h(2P)-4h(P)|$ is bounded.

  Replacing $P,Q$ by $2^nP, 2^nQ$, dividing by $4^n$, and taking the limit as $n \to \infty$, we lose the constant, and so
  \[\hat{h}(P+Q)+\hat{h}(P-Q) \leq 2\hat{h}(P)+2\hat{h}(Q)\]
  Replacing $P, Q$ by $P+Q$, $P-Q$ and using $\hat{h}(2P) = 4\hat{h}(P)$, we get the inequality the other way round, and so we have equality, so $\hat{h}$ is a quadratic form.
\end{proof}
The places of a number field $K$ are the finite places (=primes), so that $|x|_\p = c^{v_\p(x)}$ for some fixed constant $c>1$, and the infinite places (=real \& complex embeddings), so that $|x|_\sigma = |\sigma(x)|^d$ for some fixed $d>0$.

For each place $v$ we may choose a normalisation $\abs{\cdot}_v$ (i.e. make a choice of $c$ and $d$) so that
\[\prod_v |\lambda|_v = 1 \forall \lambda \in K^\times\]
For $K$ a number field, consider $P = (a_0:a_1:\ldots :a_n)\in\P^n(K)$. We define $H(P ) = \prod_v \max_{0 \leq i\leq n} |a_i|_v$, which is well defined because of the product formula.

Let $\pi_i :E\times E \times E \to E$ be the projection maps onto the $i\th$ factor for $i=1,2,3$. Let $\pi_{ij} = \pi_i + \pi_j$, and $\pi_{123} = \pi_1+\pi_2+\pi_3$. There is a result called the theorem of the cube which says that, if $D \in \Div(E)$, then
\[\pi_{123}^\ast D + \pi_1^\ast D + \pi_2^\ast D \thicksim \pi_{12}^\ast D + \pi_{13}^\ast D + \pi_{23}^\ast D\]
This can be used to give alternative proofs of \textbf{5.6} and \textbf{13.7}.

\section{Dual Isogenies \& The Weil Pairing}
Let $K$ be a perfect field and $E/K$ an elliptic curve.
\begin{proposition}
  Let $\Phi \subseteq E(\bar{K})$ be a finite $\Gal(\bar{K}/K)$-stable subgroup. Then there is an elliptic curve $E'/K$ and a separable isogeny $\phi:E \to E'$ defined over $K$ with kernel $\Phi$ such that every isogeny $\psi:E \to E''$ with $\Phi \subseteq \ker \psi$ factors uniquely via $\phi$:
  \begin{center}
    \begin{tikzcd}
      E \arrow{r}{\psi} \arrow[swap]{d}{\phi} & E''\\
      E' \arrow[swap, dashrightarrow]{ur}{\exists !} &
    \end{tikzcd}
  \end{center}
\end{proposition}
\begin{proof}
  Omitted, see Silvermann \textbf{III.4.12}.
\end{proof}
\begin{proposition}
  Let $\phi:E \to E'$ be an isogeny of degree $n$. Then there is a unique isogeny $\hat{\phi}:E'\to E$ such that $\hat{\phi}\phi = [n]$.
\end{proposition}
\begin{proof}
  In the case that $\phi$ is separable, $|\ker \phi| = n \implies \ker \phi \subseteq E[n]$. Then apply \textbf{14.1} with $\psi = [n]$.

  For the case where $\phi$ is inseparable, see Silvermann \textbf{III.6.1}.

  For uniqueness, suppose $\psi_1\phi = \psi_2\phi = [n]$. Then rearrange to get $(\psi_1-\psi_2)\phi = 0$, and so $\psi_1=\psi_2$ as $\phi$ is nonconstant.
\end{proof}
\textbf{Remarks.}
\begin{enumerate}
  \item $E_1 \thicksim E_2 \iff E_1, E_2$ isogenous. Then $\thicksim$ is an equivalence relation.
  \item $\deg [n] = n^2 \implies \deg \hat{\phi} = \deg \phi = n$, and $\hat{[n]} = [n]$.
  \item $\phi\hat{\phi}\phi = \phi[n]_E = [n]_{E'}\phi \implies \phi\hat{\phi} = [n]_{E'}$. In particular, $\hat{\hat{\phi}} = \phi$.
  \item $\hat{\phi\psi} = \hat{\psi}\hat{\phi}$.
  \item If $\phi\in \End(E)$, then $\phi^2-\tr[\phi]+[\deg\phi] = 0$. Rearranging, we see $\hat{\phi} = [\tr\phi] - \phi$, and so $\tr\phi = \phi+\hat{\phi}$.
\end{enumerate}
\begin{lemma}
  If $\phi, \psi \in \Hom(E, E')$, then $\hat{\phi+\psi} = \hat{\phi} + \hat{\psi}$.
\end{lemma}
\begin{proof}
  If $E=E'$, then this follows from $\tr(\phi + \psi) = \tr{\phi}+\tr{\psi}$.

  In general, let $\alpha: E' \to E$ be any isogeny (e.g. $\hat{\phi}$). Then the first part tells us $\hat{\alpha\phi + \alpha\psi} = \hat{\alpha\phi} + \hat{\alpha\psi}$, so $\hat{\alpha}(\hat{\phi+\psi}) = \hat{\alpha}(\hat{\phi}+\hat{\psi})$, and then cancel $\hat{\alpha}$.
\end{proof}
In Silvermann's book, he proves this lemma before knowing that the degree map is a quadratic form, and uses it to show that $\deg$ is a quadratic form.
\subsection{The Weil Pairing}
\textbf{Definition.} $\text{sum}:\Div(E) \to E; \sum n_P(P) \mapsto \sum n_P P$ is the map taking a formal sum of points to the actual summation of the points using the group law on $E$.

Recall that $E \cong \Pic^0(E)$, given by $P \mapsto [(P)-(O_E)]$. Then $\sum n_P P \mapsto [\sum n_P (P) - \sum n_P (O_E)]$, and so $\text{sum} D \mapsto [D]$ for all $D \in \Div^0(E)$.
\begin{lemma}
  Let $D \in \Div(E)$. Then $D\thicksim 0$ if and only if $\deg D = 0$ and $\text{sum}D = O_E$.
\end{lemma}
Let $\phi:E \to E'$ be an isogeny of degree $n$, with dual isogeny $\hat{\phi}:E' \to E$. Assume that $\charr K \nmid n$, so that $\phi, \hat{\phi}$ are separable.

We define the Weil pairing $e_P: E[\phi]\times E'[\hat{\phi}] \to \mu_n$:

Let $T \in E'[\hat{\phi}]$. Then $nT = 0$, and so there exists $f \in \bar{K}(E')^\ast$ such that $\div f = n(T) - n(0)$.

Pick $T_0 \in E(\bar{K})$ with $\phi(T_0) = T$. Then $\phi^\ast(T) - \phi^\ast(0) = \sum_{P \in E[\phi]} (P+T_0) - \sum_{P \in E[\phi]}(P)$ has sum $n T_0 = \hat{\phi}\phi T_0 = \hat{\phi} T = 0$.

So there is some $g \in \bar{K}(E)^\ast$ such that $\div(g) = \phi^\ast(T) - \phi^\ast(0)$.

Now $\div(\phi^\ast f) = \phi^\ast \div f = n(\phi^\ast(T) - \phi^\ast(0)) = n\div g = \div(g^n)$, so $\phi^\ast f = g^n$ up to multiplication by a constant $c \in \bar{K}^\ast$. Rescaling $f$, we can ignore this constant.

If $S \in E[\phi]$, then $\phi \tau_S = \phi$, i.e. $\tau_S^\ast \phi^\ast = \phi^\ast$, so $\tau_S^\ast (\div g) = \div g$, and so $\tau_S^\ast g = \zeta g$ for some constant $\zeta$.

$\zeta = g(X+S)/g(X)$ for all points $X$ by definition for all $X \in E(\bar{K}) \setminus \{\text{zeros/poles of $g$}\}$. Then $\zeta^n = g(X+S)^n/g(X)^n = f(\phi(X+S))/f(\phi(X)) = 1$, since $\phi(S) = 0$ and $\phi$ is an isogeny.

Then we define the Weil pairing $e_\phi(S,T) = \zeta = g(X+S)/g(X)$ for any $X$ not a zero or pole of $g$.

\begin{proposition}
  $e_\phi$ is bilinear and non-degenerate.
\end{proposition}
\begin{proof}
  For linearity in the first argument, we have
  \[e_\phi(S_1+S_2,T) = \frac{g(X+S_1+S_2)}{g(X+S_2)}\frac{g(X+S_2)}{g(X)} = e_\phi(S_1,T)e_\phi(S_2,T)\]
  For linearity in the second argument, let $T_1, T_2 \in E'[\hat{\phi}]$. Then
  \[\div(f_1) = n(T_1)-n(O); \div(f_2) = n(T_2)-n(O)\]
  and then
  \[\phi^\ast f_1 = g_1^n; \phi^\ast f_2 = g_2^n\]
  Then there is $h \in \bar{K}(E')^\ast$ such that $\div(h) = (T_1)+(T_2)-(T_1+T_2)-(O)$.

  Then put $f = \frac{f_1f_2}{h^n}$ and $g = \frac{g_1g_2}{\phi^\ast h}$. We then check: $\div(f) = n(T_1+T_2)-n(O)$, and $\phi^\ast = \frac{\phi^\ast f_1 \phi^\ast f_2}{(\phi^\ast h)^n} = \left(\frac{g_1g_2}{\phi^\ast h}\right)^n = g^n$.

  So $e_\phi(S, T_1+T_2) = \frac{g(X+S)}{g(X)} = \frac{g_1(X+S)}{g_1(X)}\frac{g_2(X+S)}{g_2(X)}\frac{h(\phi(X))}{h(\phi(X+S))} = e_\phi(S,T_1)e_\phi(S,T_2)$ as $S \in \ker \phi$.

  Then to see that $e_\phi$ is nondegenerate, fix $T \in E'[\hat{\phi}]$ and suppose that $e_\phi(S,T)=1$ for all $S \in E[\phi]$. By definition of the Weil pairing, $\tau_S^\ast g = g$ for all $S \in E[\phi]$.

  Then $\bar{K}(E)$ is a Galois field extension of $\phi^\ast \bar{K}(E')$ with Galois group $E[\phi]$ acting as $\tau_S^\ast$. So $g = \phi^\ast h$ for some $h \in \bar{K}(E')$, and hence $\phi^\ast f = g^n = \phi^\ast(h^n)$, and so $f= h^n$. Hence $\div(H) = (T)-(O)$, and so $T = O$.

  We've shown that the map $E'[\hat{\phi}] \injection \Hom(E[\phi], \mu_n); T \mapsto (S \mapsto e_\phi(S,T))$. This map is thus an isomorphism by counting.
\end{proof}
\textbf{Remarks.}
\begin{enumerate}
  \item If $E,E', \phi$ are defined over $K$, then $e_\phi$ is Galois equivariant, i.e. $e_\phi(\sigma S, \sigma T) = \sigma(e_\phi(S,T))$.
  \item Taking $\phi = [n]:E \to E$, so that $\hat{\phi} = [n]$, gives $e_n:E[n]\times E[n] \to \mu_{n^2}$. It can be shown, since $e_n$ is bilinear, that we only actually have image in $\mu_n$.
\end{enumerate}
\begin{corollary}
  If $E[n]\subseteq E(K)$, then $\mu_n \subseteq K$.
\end{corollary}
\begin{proof}
  $e_n$ non-degenerate implies that there are $S,T \in E[n]$ such that $e_n(S,T)$ is a primitive $n\th$ root of unity, say $\zeta_n$. To see this, pick $T \in E[n]$ of order $n$. Then the group homomorphism $E[n] \to \mu_n; S \mapsto e_n(S,T)$ has image $\mu_d$ for some $d |n$. Then $e_n(S,dT) = 1$ for all $S \in E[n]$, and so by nondegeneracy, $dT = 0$, and so $d=n$.

  Then $\sigma(\zeta_n) = e_n(\sigma S, \sigma T)= e_n(S,T)$, and so $\zeta_n \in K$.
\end{proof}
For example, there is no $E/\Q$ with $E(\Q)_\text{tors} = (\Z/3\Z)^2$, since not all of the cube roots of unity are defined over $\Q$.

\textbf{Remark.} In fact, the Weil pairing $e_n$ is alternating, so that $e_n(T,T) = 1$ for all $T$.

In particular, $e_n(S+T,S+T)$, we have $e_n(S,T) = e_n(T,S)^{-1}$.

\section{Galois Cohomology}
Here, $G$ is a group and $A$ is a $G$-module (an abelian group with action of $G$ via group homomorphisms), i.e. a module over $\Z[G]$.
\begin{definition}
  $H^0(G,A) = A^G$, the subgroup of $A$ fixed by all of $G$.

  $C^1(G,A) = \{\text{maps} G \to A\}$, not necessarily group homomorphisms. We call these maps ``cochains''.

  $Z^1(G,A) = \{(a_\sigma)_{\sigma \in G} : a_{\sigma \tau} = \sigma(a_\tau) + a_\sigma\}$, the set of ``cocycles''.

  $B^1(G,A) = \{(\sigma b- b)_{\sigma \in G} : b \in A\}$, the set of ``coboundaries''.

  We have $C^1(G,A) \supset Z^1(G,A) \supset B^1(G,A)$. These are all groups under the pointwise operations. We then define $H^1(G,A) = \frac{Z^1(G,A)}{B^1(G,A)}$.
\end{definition}
\textbf{Remark.} If $G$ acts trivially on $A$, then $H^1(G,A) = Z^1(G,A) = \Hom(G,A)$. We can then go on to define $H^2, H^3, \ldots$, but we won't use these here.

\begin{theorem}
  A short exact sequence of $G$ modules
  \[0 \to A \xrightarrow{\phi} B \xrightarrow{\psi} C \to 0\]
  gives rise to a long exact sequence of abelian groups:
  \[0 \to A^G \xrightarrow{\phi} B^G \xrightarrow{\psi} C^G \xrightarrow{\delta} H^1(G,A) \xrightarrow{\phi_\ast} H^1(G,B) \xrightarrow{\psi_\ast} H^1(G,C) \to \ldots\]
\end{theorem}
\begin{proof}
  Omitted.
\end{proof}
\textbf{Definition of $\delta$.} Let $c \in C^G$. Then there exists $b \in B$ such that $\psi(b) = c$. Then $\psi(\sigma b - b) = \sigma c - c = 0$ for all $\sigma \in G$. Hence $\sigma b - b = \psi(a_\sigma)$ for some $a_\sigma \in A$.

Then $\phi(a_{\sigma \tau} - \sigma(a_\tau) - a_\sigma) = \sigma \tau b - b - \sigma(\tau b -b) - (\sigma b -b) = 0$. $\phi$ is injective, so $a_{\sigma \tau} = \sigma(a_\tau) + a_\sigma$, and hence $(a_\sigma)_{\sigma \in G} \in Z^1(G,A)$.

We define $\delta(c) = \text{class of }(a_\sigma)_{\sigma \in G}$ in $H^1(G,A)$.

\begin{theorem}
  Let $A$ be a $G$-module, and $H \triangleleft G$ a normal subgroup. Then there is an \emph{inflation-restriction} exact sequence:
  \[0 \to H^1(G/H, A^H) \xrightarrow{\text{inf}} H^1(G,A) \xrightarrow{\text{res}} H^1(H,A)\]
\end{theorem}
\begin{proof}
  Omitted.
\end{proof}
Let $K$ be a perfect field. Then $\Gal(\bar{K}/K)$ is a topological group, with basis of open subgroups the $\Gal(\bar{K}/L)$ for $L$ some finite extension of $K$.

If $G = \Gal(\bar{K}/K)$, we modify the definition of $H^1(G,A)$ by insisting on:
\begin{enumerate}
  \item The stabiliser of each $a \in A$ is an open subgroup of $G$.
  \item All cochains $G \to A$ are continuous, where $A$ is given the discrete topology.
\end{enumerate}
Then $H^1(\Gal(\bar{K}/K),A) = \lim\limits_{\xrightarrow[L/K\text{ finite Galois}]{}}H^1(\Gal(L/K), A^{\Gal(\bar{K}/L)})$. The maps used for this direct limit are the inflation maps.
\begin{theorem}[Hilbert's Theorem 90.]
  Let $L/K$ be finite Galois. Then $H^1(\Gal(L/K), L^\ast) = 0$.
\end{theorem}
\begin{proof}
  Let $G = Gal(L/K)$. Let $(a_\sigma)_{\sigma \in G} \in Z^1(G, L^\ast)$. Then distinct automorphisms are linearly independent. Then:
  \begin{align*}
    \exists y \in L \st \underbrace{\sum_{\tau \in G}a_\tau^{-1}\tau(y)}_x \neq 0\
  \end{align*}
  Then for $\sigma \in G$, $\sigma(x) = \sum_{\tau \in G}\sigma(a_\tau)^{-1}\sigma\tau(y) = a_\sigma\sum_{\tau \in G} a_{\sigma\tau}^{-1}\sigma\tau(y) = a_\sigma x$, using the cocycle identity, which after rearranging gives $\sigma(a_\tau)^{-1} = a_\sigma a_{\sigma\tau}^{-1}$.

  So $\sigma(x) = a_\sigma x$, and hence $a_\sigma = \sigma(x)/x$. So $(a_\sigma)_{\sigma \in G} \in B^1(G,L^\ast)$, and so $H^1(G, L^\ast) = 0$.
\end{proof}
\begin{corollary}
  $H^1(\Gal(\bar{K}/K), \bar{K}^\ast) = 0$
\end{corollary}
\textbf{Application.} Assume $\charr K \nmid n$. Then there is an exact sequence of $\Gal(\bar{K}/K)$-modules $0 \to \mu_n \to \bar{K}^\ast \xrightarrow{^\wedge n} \bar{K}^\ast \to 0$.

Then when we take the long exact sequence, we get:
\[K^* \xrightarrow{^\wedge n} K^\ast \to H^1(\Gal(\bar{K}/K), \mu_n) \to H^1(\Gal(\bar{K}/K), \bar{K}^\ast)\]
but this last term is 0 by Hilbert 90. So:
\[H^1(\Gal(\bar{K}/K), \mu_n) \cong K^\ast/(K^\ast)^n\]
If $\mu_n \subset K$, then
\[H^1(\Gal(\bar{K}/K), \mu_n) = \Hom_{\text{cts}}(\Gal(\bar{K}/K), \mu_n) \cong K^\ast/(K^\ast)^n\tag{$\dagger$}\]
if $L/K$ is a finite Galois extension, then we have a projection map $\pi:\Gal(\bar{K}/K) \surjection \Gal(L/K)$, and so
\[\Hom(\Gal(L/K), \mu_n) \injection \Hom_{\text{cts}}(\Gal(\bar{K}/K), \mu_n)\]
via $\chi \mapsto \chi\circ\pi$.

We then claim that every finite subgroup $\Xi$ of $\Hom_{\text{cts}}(\Gal(\bar{K}/K), \mu_n)$ arises uniquely in this way for $L/K$ a finite abelian extension of exponent dividing $n$.

So, from $\dagger$, we recover \textbf{11.2}.

To prove the claim, consider the pairing $\Gal(\bar{K},K)\times \Xi \to \mu_n$ given by $(\sigma, \chi) \mapsto \chi(\sigma)$. This is bilinear, and has trivial right kernel, and the left kernel is
\[\bigcap_{\chi \in \Xi} \ker(\chi)\subset \Gal(\bar{K}/K)\text{ an open normal subgroup}\]
and hence $\Gal(\bar{K}/L)$ for some $L/K$ finite Galois.

We then get a nondegenerate pairing $\Gal(L/K) \times \Xi \to \mu_n$. In particular,
\begin{align*}
  \Gal(L/K) &\injection \Hom(\Xi, \mu_n)\\
  \Xi &\injection \Hom(\Gal(L/K), \mu_n)
\end{align*}
The first tells us $L/K$ is abelian of exponent dividing $n$ and that the second is in fact surjective, so $\Xi = \Hom(\Gal(L/K), \mu_n)$, so we have the claim.

As a point of notation, we will write $H^1(K, \cdot)$ as shorthand for $H^1(\Gal(\bar{K}/K), \cdot)$.
\begin{lemma}
  Let $[K:\Q_p]<\infty$ with $p \nmid n$. Then:
  \[\ker(H^1(K,\mu_n)) \to H^1(K^{nr}, \mu_n) \cong \O_K^\ast/(\O_K^\ast)^n\]
\end{lemma}
\begin{proof}
  By Hilbert 90, it suffices to show that the sequence
  \[\O_K^\ast/(\O_K^\ast)^n \xrightarrow{\alpha} K^\ast/(K^\ast)^n \xrightarrow{\beta} (K^{nr})^\ast/(K^{nr})^{\ast n}\]
  is exact.

  For $\Image(\alpha) \subset \ker(\beta)$, let $a \in \O_K^\ast$. If $f(x) = x^n-a \in \O_K[x]$, then $\tilde{f}(x) = x^n-\tilde{a} \in k[x]$ has distinct roots in $\bar{k}$, as $p \nmid n$.

  Then $K(\sqrt[n]{a})/K$ is unramified, and so $a \in (K^{nr})^{\ast n)}$.

  For $\ker(\beta) \subseteq \Image(\alpha)$, let $x(K^\ast)^n \in \ker \beta$. Write $x = u\pi^r$ with $u \in \O_K^\ast$, $r \in \Z$.

  Since the discrete valuation on $K$ extends to a discrete valuation on $K^{nr}$, we have $r \equiv 0 \mod n$, and so $x(K^\ast)^n = u(K^\ast)^n$.
\end{proof}

Let $\phi:E \to E'$ be an isogeny of elliptic curves over $K$. Then there is a short exact sequence of $\Gal(\bar{K}/K)$-modules
\[0 \to E[\phi] \to E \xrightarrow{\phi} E' \to 0\]
This gives a long exact sequence
\[E(K) \xrightarrow{\phi} E'(K) \xrightarrow{\delta} H^1(K, E[\phi]) \to H^1(K, E) \xrightarrow{\phi_\ast} H^1(K, E')\]
We get a short exact sequence
\begin{center}
  \begin{tikzcd}
    0 \arrow{r} & E'(K)/\phi(E(K)) \arrow{d}\arrow{r} & H^1(K, E[\phi]) \arrow{d}{res_v}\arrow{r}\arrow[red]{dr} & H^1(K,E)[\phi_\ast] \arrow{d}{res_v}\arrow{r} & 0\\
    0 \arrow{r} & \prod_v E'(K_v)/\phi(E(K_v)) \arrow{r} & \prod_v H^1(K_v, E[\phi]) \arrow{r} & \prod_v H^1(K_v, E)[\phi_\ast] \arrow{r} & 0
  \end{tikzcd}
\end{center}
Now take $K$ to be a number field.

For each place $v$, fix an embedding $\bar{K} \subset \bar{K}_v$. Then $\Gal(\bar{K}_c/K_v) \subset \Gal(\bar{K}/K)$.

\textbf{Definition.} The $\phi$-\emph{Selmer group} is $S^{(\phi)}(E/K) = \ker {\textcolor{red} \searrow} = \ker(H^1(K, E[\phi])\to \prod_v H^1(K_v, E))$. Another way to think about it is as the elements $\alpha$ in $H^1(K, E[\phi])$ whose restriction $res_v(\alpha) \in \Image(\delta_v)$.

The \emph{Tate-Shafarevich group} is $\Sha(E/K) = \ker(H^1(K,E) \to \prod_v H^1(K_v, E)).$

We get a short exact sequence
\[0 \to E'(K)/\phi(E/K) \to S^{(\phi)}(E/K) \to \Sha(E/K)[\phi_\ast] \to 0\]
Taking $\phi = [n]$ gives
\[0 \to E(K)/nE(K) \to S^{(n)}(E/K) \to \Sha(E/K)[n] \to 0\]
We can then reorganise the proof of weak Mordell-Weil to get
\begin{theorem}
  $S^{(n)}(E/K)$ is finite.
\end{theorem}
\begin{proof}
  For $L/K$ a finite Galois extension there is an exact sequence
  \[0 \to H^1(\Gal(L/K), E(L)[n]) \xrightarrow{inf} H^1(K, E[n]) \xrightarrow{res} H^1(L, E[n])\]
  We have $H^1(\Gal(L/K), E(L)[n])$ is finite.

  By extending our field we may assume that $E[n] \subset E(K)$, and hence $\mu_n \subset K$.

  So $E[n] \cong \mu_n \times \mu_n$ as Galois modules. Hence $H^1(K, E[n]) \cong H^1(K, \mu_n) \times H^1(K, \mu_n) \cong K^\ast/(K^\ast)^n \times K^\ast/(K^\ast)^n$, by Hilber 90.

  Let $S = \{$primes of bad reduction for $E/K\}\cup\{v|n\}\cup\{v \text{ infinite}\}$. Then $S$ is finite.

  The subgroup of $H^1(K,A)$ unramified outside $S$ is $H^1(K,A; S)\coloneqq \ker(H^1(K,A) \to \prod_{v\notin S} H^1(K_v^{nr}, A))$.

  There is a commutative diagram with exact rows
  \begin{center}
    \begin{tikzcd}
      E(K_v) \arrow{r}{\times n}\arrow[hookrightarrow]{d} & E(K_v) \arrow{r}{\delta_v}\arrow[hookrightarrow]{d} & H^1(K_v, E[n])\arrow{d}{res}\\
      E(K_v^{nr}) \arrow{r}{\times n} & E(K_v^{nr}) \arrow{r} & H^1(K_v^{nr}, E[n])
    \end{tikzcd}
  \end{center}
  The bottom left $\times n$ map is surjective for all $v \notin S$ - see the proof of \textbf{9.9}. Hence $\Image(\delta_v) \subset \ker(res)$.

  Then $S^{(n)}(E/K) = \{\alpha \in H^1(K, E[n]) : res_v(\alpha) \in \Image(\delta_v)\forall v\} \subset H^1(K, E[n]; S) \cong H^1(K, \mu_n; S)\times H^1(K, \mu_n; S) \cong K(S, n)\times K(S,n)$ by \textbf{15.3}.

  But $K(S,n)$ is finite by \textbf{11.4}, and so $S^{(n)}(E/K)$ is finite.
\end{proof}
\textbf{Remark.} $S^{(n)}(E/K)$ is finite and effectively computable. It is conjectured that $\Sha(E/K)$ is finite. This would imply that the rank is effectively computable.

\section{Descent by cyclic isogeny}
$E, E'$ are elliptic curves over $K$ a number field. We have $\phi:E \to E'$ an isogeny of degree $n$. Suppose that $E'[\hat{\phi}]\cong \Z/n\Z$ generated by $T\in E'(K)$. Then $E[\phi] \cong \mu_n$ as Galois modules, via $S \mapsto e_\phi(S,T)$. We then get a short exact sequence of $\Gal(\bar{K}/K)$-modules
\[0 \to \mu_n \to E \xrightarrow{\phi} E' \to 0\]
We then get a long exact sequence
\[E(K) \to E'(K) \xrightarrow{\delta} H^1(K, \mu_n) \to H^1(K, E)\]
By Hilbert 90, $H^1(K, \mu_n) \cong K^\ast/(K^\ast)^n$.
\begin{theorem}
  Let $f \in K(E')$ and $g \in K(E)$ with $\div(f) = n(T) - n(0)$ and $\phi^\ast f = g^n$.

  Then $\alpha(P) = f(P) \mod (K^\ast)^n$ for all $P \in E'(K)\setminus \{0, T\}$.
\end{theorem}
\begin{proof}
  Let $Q \in \phi^{-1}(P)$. Then $\delta(P)$ is represented by the cocycle $\sigma \mapsto \sigma(Q) -Q \in E[\phi] \cong \mu_n$.

  Then $e_\phi(\sigma Q-Q, T) = \frac{g(\sigma Q-Q+X)}{g(X)}$ for any $X \in E$ not a zero or pole of $g$. Taking $X=Q$, we have $\frac{g(\sigma Q)}{g(Q)} = \frac{\sigma(g(Q))}{g(Q)} = \frac{\sigma\sqrt[n]{f(P)}}{\sqrt[n]{f(P)}}$. Hence $\delta(P)$ is represented by the cocycle $\sigma \mapsto \frac{\sigma\sqrt[n]{f(P)}}{\sqrt[n]{f(P)}}$

  But $H^1(K, \mu_n) \cong K^\ast/(K^\ast)^n$ via $(\sigma \mapsto \frac{\sigma \sqrt[n]{x}}{\sqrt[n]{x}})\mapsfrom x$.

  Hence $\alpha(P) = f(P) \mod (K^\ast)^n$.
\end{proof}
\subsection{Descent by 2-isogeny}
Given $E: y^2=x(x^2+ax+b); E':y^2 = x(x^2+a'x+b')$, where $a'=-2a, b'=a^2-4b$. Then we have $\phi:E \to E'; (x,y) \mapsto \left(\left(\frac{y}{x}\right)^2, \frac{y(x^2-b)}{x^2}\right)$. We can think of $E'$ as being the quotient of $E$ by its 2-torsion point $(0,0)$.

If we repeat this procedure, we get $\hat{\phi}: E' \to E; (x,y) \mapsto \left(\frac{1}{4}\left(\frac{y}{x}\right)^2, \frac{y(x^2-b')}{8x^2}\right)$.

It can be checked (see example sheet 4) that $\phi$ and $\hat{\phi}$ are dual.

Then $E[\phi] = \{0,T\}; E'[\hat{\phi}] = \{0, T'\}$ where $T, T'$ are $(0,0)\in E,E'$ respectively.

\begin{proposition}
  There is a group homomorphism $E'(K) \to K^\ast/(K^\ast)^2$ given by
  \[(x,y) \mapsto \begin{cases} x \mod (K^\ast)^2 & x \neq 0\\ b' \mod (K^\ast)^2 & x = 0\end{cases}\]
  with kernel $\phi(E(K))$.
\end{proposition}
\begin{proof}
  Either: apply \textbf{16.1} with $f = x \in K(E'), g = y/x \in K(E)$.

  Or: direct calculation - see example sheet 4.
\end{proof}
We now have an injective group homomorphism $\alpha_{E'} : \frac{E'(K)}{\phi E(K)} \injection K^\ast/(K^\ast)^2$. By swapping $E,E'$, we also get $\alpha_E : \frac{E(K)}{\hat{\phi}(E'(K))}\injection K^\ast/(K^\ast)^2$.

\begin{lemma}
  $2^{\text{rank}(E(K))} = \frac{|\Image \alpha_E||\Image \alpha_{E'}|}{4}$
\end{lemma}
\begin{proof}
  If $A\xrightarrow{f}B\xrightarrow{g}C$ is a homomorphism of abelian groups then there is an exact sequence
  \[0 \to \ker f \to \ker (gf) \xrightarrow{f} \ker g \to \coker f \xrightarrow{g} \coker (gf) \xrightarrow \coker g \to 0\]

  Since $\hat{\phi}\phi = [2]_E$, we get an exact sequence
  \[0 \to \underbrace{E(K)[\phi]}_{\Z/2\Z} \to E(K)[2] \xrightarrow{\phi} \underbrace{E'(K)[\hat{\phi}]}_{\Z/2\Z} \to \underbrace{E'(K)/\phi E(K)}_{\Image \alpha_{E'}} \xrightarrow{\hat{\phi}} E(K)/2E(K) \to \underbrace{E(K)/\hat{\phi} E'(K)}_{\Image \alpha_E} \to 0\]

  Since the alternating product of the orders of the groups along this sequence is 1, we get:
  \[\frac{|E(K)/2E(K)|}{|E(K)[2]|} = \frac{|\Image \alpha_E||\Image \alpha_{E'}|}{4}\]
  The Mordell-Weil theorem says that $E(K) \cong \Delta \times \Z^r$ where $\Delta$ is a finite group and $r$ is the rank of $E(K)$.

  Then $E(K)/2E(K) \cong \Delta/2\Delta \times (\Z/2\Z)^r$, and $E(K)[2] \cong \Delta[2]$. Now $|\Delta/2\Delta| = |\Delta[2]|$ by finiteness, and so the result follows.
\end{proof}
\begin{lemma}
  If $K$ is a number field and $a, b \in \O_K$ then $\Image \alpha_E \subseteq K(S,2)$ where $S = \{$primes dividing $b\}$.
\end{lemma}
\begin{proof}
  We must show that, if $x, y \in K$ are coordinates of a point on $E$, so $y^2=x(x^2+ax+b)$ and $\p$ is a prime outside $S$, so $v_\p(b) = 0$, then $v_\p(x)$ is even.

  Suppose first that $v_\p(x) < 0$. Then \textbf{9.1} tells us $v_\p(x) = -2r, v_\p(y) = -3r$ for some $r \geq 1$, and so $v_\p(x)$ is even.

  If instead $v_\p(x) > 0$, then $x^2+ax+b$ is an algebraic integer and not divisible by $\p$. Hence $v_\p(x^2+ax+b) = 0$, and so $v_\p(x) = v_\p(y^2) = 2v_\p(y)$ is even.
\end{proof}
\begin{lemma}
  If $b_1 b_2 = b$ then $b_1(K^\ast)^2 \in \Image(\alpha_E)$ if and only if \[w^2 = b_1u^4+au^2v^2+b_2v^4\tag{$\ast$}\] is soluble for $u,v,w \in K$ not all zero.
\end{lemma}
\begin{proof}
  If $b_1 \in (K^\ast)^2$ or $b_2 \in (K^\ast)^2$, then both conditions are satisfied. So we may assume $b_1, b_2 \notin (K^\ast)^2$.

  Then $b_1(K^\ast)^2 \in \Image(\alpha_E)$ if and only if there are $(x,y) \in E(K)$ with $x = b_1t^2$ for some $t \in K^\ast$.

  Substituting into the Weierstrass equation, we get $y^2 = b_1t^2((b_1t^2)^2 + ab_1t^2 + b)$. This can be rearranged to get
  \[\left(\frac{y}{b_1t}\right)^2 = b_1t^4 + at^2 + b_2\]
  and so $(\ast)$ has a solution. The converse follows just by reversing the steps.
\end{proof}
Now take $K = \Q$.

\textbf{Example 1.} $E: y^2 = x^3-x$. Here $a = 0, b = -1$. Then $S = \emptyset$, and so $\Image(\alpha_E) \subseteq \Q(S,2) = \angle{-1} \subset \Q^\ast/(\Q^\ast)^2$. Checking the above condition for $-1$ gives $-1 \in \Image(\alpha_E)$, and so we have equality.

Then $E': y^2 = x^3+4x$, and $\Image(\alpha_{E'}) \subseteq \angle{-1,2}$. We then check $b_1 = -1, 2, -2$ in turn using $(\ast)$ in the previous lemma.

E.g. for $b_1 = -1$, we have $w^2 = -u^4-4v^4$, which has no solutions in $\Q$. Checking these gives only $b_1 = 2 \in \Image(\alpha_{E'})$, and so $\Image(\alpha_{E'}) = \angle{2} \subseteq \Q^\ast/(\Q^\ast)^2$.

We can then use $\textbf{16.3}$ to see that $2^r = \frac{2\cdot 2}{4} = 1$, and so the rank of this curve $E(\Q)$ is zero, and hence $1$ is not a congruent number.

\textbf{Example 2.} $E: y^2 = x^3 + px$ where $p$ is prime $\equiv 5 \mod 8$. Then $b_1 = -1$ gives $w^2 = -u^4-pv^4$ insoluble over $\R$. $b_1 = p$ gives a soluble equation and so $\Image(\alpha_E) = \angle{p} \subseteq \Q^\ast/(\Q^\ast)^2$.

$E': y^2 = x^3-4px$. $\Image(\alpha_{E'}) \subseteq \angle{-1,2,p}\subseteq \Q^\ast/(\Q^\ast)^2$.

Note that $\alpha_{E'}(T') = (-4p)(\Q^\ast)^2 = (-p)(\Q^\ast)^2$, and so $-p \in \Image(\alpha_{E'})$.

We then check $b_1 = 2, -2, p$. Using $\legendre{2}{p} = -1$, we get that the equations for $b_1 = 2, -2$ have no solutions.

Hence $\Image(\alpha_{E'}) \subseteq \angle{-1,p}\subseteq \Q^\ast/(\Q^\ast)^2 = -1$, including $p$ if and only if $w^2 = pu^4-4v^4$ has solutions in $\Q$.

Then $\rank E(\Q) = \begin{cases} 0 & \text{equation has solution} \\ 1 & \text{equation has no solutions} \end{cases}$.

It turns out that these computations can be rephrased in terms of computing some Selmer groups: we have a short exact sequence
\[0 \to \frac{E'(\Q)}{\phi E(\Q)} \xrightarrow{\delta} S^{(\phi)}(E/\Q) \to \Sha(E/\Q)[\phi_\ast] \to 0\]
By Hilbert 90, $S^{(\phi)}(E/\Q) \subset \Q^\ast/(\Q^\ast)^2$, and $\alpha_{E'}$ is $\delta$ composed with this inclusion.

Then $\Image(\alpha_{E'}) = \{b_1(\Q^\ast)^2 : (\ast)\text{ is soluble over }\Q\} \subset S^{(\phi)}(E/\Q) = \{b_1(\Q^\ast)^2: (\ast) \text{ is soluble over } \R\text{ and over }\Q_p \forall p\}$.

Fact (uses example sheet 3, q9 + Hensel's Lemma): If $a, b_1, b_2 \in \Z$ and $p\nmid 2b(a^2-4b)$, then $(\ast)$ is soluble over the $p$-adics.

\textbf{Example 2 (contd.)} $E: y^2 = x^3+px$ where $p$ is prime $\equiv 5 \mod 8$. We want to determine if the equation
\[w^2 = pu^4-4v^4\]
is soluble.

It is soluble over $\Q_p$, since $-1$ is a square in $\Q_p$. It is also soluble over $\Q_2$ as $p-4 \equiv 1 \mod 8$, and so $p-4 \in (\Z_2^\ast)^2$. It is clearly soluble over $\R$. Hence $b_1$ is a member of $S^{(\phi)}(E/\Q)$, but we don't know if it's in $\Image(\alpha_{E'})$. We can look for some solutions:

\begin{tabular}{c|ccc}
  p & u & v & w \\\hline
  5 & 1 & 1 & 1 \\
  13 & 1 & 1 & 3\\
  29 & 1 & 1 & 5\\
  37 & 5 & 3 & 151\\
  53 & 1 & 1 & 7
\end{tabular}

It is conjectured that this has a solution for all such $p$, but this is not actually known.

\textbf{Example 3 (Lind):} $E : y^2 = x^3 + 17x$

Then $\Image(\alpha_E) = \angle{17} \subset \Q^\ast/(\Q^\ast)^2$.

$E' : y^2 = x^3-68x$, and we get
\[b_1 = 2\;\;\;\;\;\;\;\;\;\;\;\;\;\; w^2 = 2u^4-34v^4\]
Replacing $w$ by $2w$ and dividing by $2$, we get
\[C: 2w^2 = u^4-17u^4\]
We then write $C(K) = \{(u,v,w)\in K^3\setminus\{0\} : \text{ they satisfy the eqn}\}/\thicksim$, where $(u,v,w)\thicksim (\lambda u, \lambda v, \lambda^2 w)$.

$C(\Q_2) \neq \emptyset$ since $17 \in (\Z_2^\ast)^4$.

$C(\Q_{17})\neq \emptyset$ since $2 \in (\Z_{17}^\times)^2$.

$C(\R) \neq \emptyset$ since $\sqrt{2}\in \R$.

Hence $C(\Q_v) \neq \emptyset$ for all places $v$ of $\Q$.

However, suppose $(u,v,w) \in C(\Q)$, wlog $u,v,w$ integers with $(u,v) = 1, w > 0$.

If $17|w$, then $17|u$ and so $17|v \contr$.

So if $p$ is an odd prime dividing $w$, then $p \neq 17$, and, mod $p$, we get $\legendre{17}{p} = +1$, and so $\legendre{17}{p} = +1$ by quadratic reciprocity. Note that $\legendre{2}{17} = 1$, and so this actually holds for all $p|w$.

Hence $\legendre{w}{17} = +1$. But $2w^2 \equiv u^4 \mod 17$, and so $2$ is a fourth power mod $17$, i.e. $2 \in \{\pm 1, \pm 4\}$ mod $17$, and so we have a contradiction. Hence there are no $\Q$-points on this curve.

I.e., $C$ is a counterexample to the Hasse principle, and represents a nontrivial element of $\Sha(E/\Q)$.

\subsection{Birch Swinnerton-Dyer Conjecture}
Let $E/\Q$ be an elliptic curve.
\begin{definition}
  $L(E,s) = \prod_p L_p(E,s)$ where $L_p(E,s) = \begin{cases}(1-a_p p^{-s} + p^{1-2s})^{-1} & \text{ good reduction}\\ (1-p^{-s})^{-1} & \text{ split mult. reduction}\\ (1+p^{-s})^{-1} & \text{ non-split mult. reduction}\\ 1 & \text{ additive reduction}\end{cases}$ and $\#\tilde{E}(\F_p) = p+1-a_p$.
\end{definition}
Hasse's theorem tells us $|a_p| \leq 2\sqrt{p}$, and so this product converges for all $\Re(s) > 3/2$.

\begin{theorem}[Wiles, Brueil, Condrad, Diamond, Taylor]
  $L(E,s)$ is the $L$-function of a weight 2 modular form, and so has an analytic continuation to all of $\C$, and we get a functional equation relating $L(E,s)$ to $L(E,2-s)$.
\end{theorem}

\begin{conjecture}[Weak BSD]
  $\ord_{s=1} L(E,s) = \text{rank }E(\Q)$.
\end{conjecture}

\begin{conjecture}[Strong BSD]
  $\lim_{s\to 1} \frac{1}{(s-1)^r}L(E,s) = \frac{\Omega_E \text{Reg}E(\Q)|\Sha(E/\Q)|\prod_p c_p}{|E(\Q)_{tors}|^2}$ where:
  \begin{itemize}
    \item $c_p$ is the Tamagawa number of $E(\Q_p)$, i.e. $[E(\Q_p):E_0(\Q_p)]$.
    \item $E(\Q)/E(\Q)_{tors} \cong \angle{P_1, \ldots, P_r}$.
    \item $\text{Reg}E(\Q) = \det([P_i,P_j])_{i,j=1,\ldots, r}$ where $[P,Q] = \hat{h}(P+Q)-\hat{h}(P)-\hat{h}(Q)$.
    \item $\Omega_E = \int_{E(\R)}\frac{dx}{|2y+a_1 x+a_3|}$, where $a_i$ are the coefficients of a globally minimal Weierstrass equation.
  \end{itemize}
\end{conjecture}
\begin{theorem}[Kolyvagin]
  If $\ord_{s=1}L(E,s) = 0$ or $1$, then weak BSD holds and $|\Sha(E/\Q)| < \infty$.
\end{theorem}
\end{document}
