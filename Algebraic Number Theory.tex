\documentclass[10pt,a4paper]{article}
\input{./preamble.tex}

\title{Algebraic Number Theory}
\begin{document}
\maketitle
\tableofcontents
\newpage
\section{Absolute Values and Places}
$K$ is a field. An \emph{absolute value} (AV) on $K$ is a function $\abs{\cdot}:K \to \R_{\geq 0}$ such that, for all $x, y \in K$:
\begin{enumerate}[label=\roman*)]
  \item $|x| = 0 \iff x= 0$
  \item $|xy| = |x||y|$
  \item $|x+y| \leq |x|+|y|$
\end{enumerate}
We will also assume that $\abs{\cdot}$ is not trivial, i.e.
\begin{enumerate}
  \item[iv)] $\exists x \in K : |x|\neq 0,1$
\end{enumerate}
An AV is \emph{non-archimedean} if it satisfies
\begin{enumerate}
  \item[iii-NA)] $|x+y| \leq \max(|x|, |y|)$
\end{enumerate}
and \emph{archimedean} otherwise.

An AV determines a metric $d(x,y) = |x-y|$ which makes $K$ a \emph{topological field}.

\textbf{Remark} It's convenient to weaken iii):
\begin{enumerate}
  \item[iii')] $\exists \alpha > 0 \st \forall x,y, |x+y|^{\alpha} \leq |x|^\alpha+|y|^\alpha$
\end{enumerate}
For non-archimedean AVs, this makes no difference. What this does mean is that if $\abs{\cdot}$ is an AV, then so is $\abs{\cdot}^{\alpha}$ for any $\alpha > 0$. The point of this is that we want $z \mapsto z\bar{z}$ on $\C$ to be an AV - we'll see why later.

Let's suppose $\abs{\cdot}$ is a non-archimedean AV. Then $\{x\in K : |x|\leq 1\} = R$ is a subring of $K$. It is a local ring with unique maximal ideal $\{|x|<1\} = \mathfrak{m}_R$.

It is a \emph{valuation ring} of $K$ (i.e. $x \in K \setminus R \implies x^{-1}\in R$).
\begin{lemma}
  $R$ is a maximal subring of $K$.
\end{lemma}
\begin{proof}
  Let $x \in K\setminus R$, so $|x|>1$. Then if $y \in K$, there is some $n \geq 0$ with $|yx^{-n}| = \frac{|y|}{|x|^n} \leq 1$. So $y \in x^n R$ for $n \gg 0$, and hence $R[x] = K$. Hence $R$ is maximal.
\end{proof}
There is a general notion of valuation (not nec. $\R$-valued). In the more general context, these valuations are called \emph{rank 1 valuations}, and they have this maximality property.

We say two absolute values $\abs{\cdot}$ and $\abs{\cdot}'$ are \emph{equivalent} if there is $\alpha > 0$ with $\abs{\cdot}' =\abs{\cdot}^{\alpha}$. This is an equivalence relation.
\begin{proposition}
  The following are equivalent:
  \begin{enumerate}[label=\roman*)]
    \item $\abs{\cdot}, \abs{\cdot}'$ are equivalent.
    \item $|x| \leq |y| \iff |x|'\leq |y|'$.
    \item $|x| < |y| \iff |x|' < |y|'$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  From local fields, or exercise.
\end{proof}
\begin{corollary}
  Let $\abs{\cdot}, \abs{\cdot}'$ be non-archimedean AVs, with valuation rings $R, R'$. Then $\abs{\cdot}, \abs{\cdot}'$ are equivalent if and only if $R = R'$ if and only if $R \subset R'$.
\end{corollary}
Equivalent AVs define equivalent metrics, hence the same topologies, hence the \emph{completion} of $K$ with respect to $\abs{\cdot}$ depends only on the equivalence class of $\abs{\cdot}$.

Inequivalent AVs determine ``independent'' topologies in the following sense:
\begin{proposition}[Weak Approximation]
  Let $\abs{\cdot}_i$ for $1\leq i\leq n$ be pairwise inequivalent AVs on $K$, and $a_1, \ldots, a_n \in K$, $\delta > 0$.

  Then there is $x \in K$ such that, for all $i$, $|x-a_i|_i < \delta$.
\end{proposition}
\begin{proof}
  Suppose $z_j \in K$ such that $|z_j|_j > 1$, and $|z_j|_i < 1$ for all $i \neq j$. Then $\abs{\frac{z_j^N}{z_j^N + 1}}_i \to 0$ as $N \to \infty$ if $i \neq j$, and to $1$ if $i=j$.

  So then $x = \sum a_j \frac{z_j^N}{z_j^N + 1}$ works for $N$ sufficiently large. So it's enough to find $z_j$, and by symmetry take $j=1$. We then induct on $n$. The case $n=1$ is trivial.

  Suppose we have $y$ with $|y|_1 > 1$, and $|y|_2, \ldots, |y|_{n-1} < 1$. If $|y|_n < 1$, we're finished, otherwise pick $w \in K$ with $|w|_1 > 1 > |w|_n$, by \textbf{1.2}. If $|y|_n=1$, then $z = y^Nw$ works, and if $|y|_n > 1$, then $z = \frac{y^Nw}{y^N+1}$ works.
\end{proof}
\textbf{Remark.} If $K = \Q$, $\abs{\cdot}_1, \ldots, \abs{\cdot}_n$ are the $p_i$-adic AVs for distinct primes $p_i$ and $a_i \in \Z$, then weak approximation says that, for all $n_i \geq 1$, there is $x \in \Q$ which is a $p_i$-adic integer for all $i$, and $x \equiv a_i \mod p_i^{n_i}$ for all $i$. This is weaker than CRT, which guarantees $x \in \Z$.

\textbf{Definition.}  A \emph{place} of $K$ is an equivalence class of AVs on $K$.

\textbf{Example} $K=\Q$. \emph{Ostrowski's Theorem} implies every AV on $\Q$ is equivalent to one of $\abs{\cdot}_p, \abs{\cdot}_\infty$. So places of $\Q$ are the primes, and $\infty$. We write $V_K$ for the set of places of $K$.

We write $V_{K, \infty}$ for the places given by archimedean AVs (the infinite places).

We write $V_{K,f}$ for the places given by non-archimedean AVs (the finite places).

We often use letters $v, w$ denote places. Given $v \in V_K, K_v$ will denote the completion of $K$ at $v$. If $v:K^\times \to \R$ is a \emph{valuation}, we will also use $v$ to denote the corresponding place, i.e. the equivalence class of AVs $x \mapsto \gamma^{-v(x)}$.

We can restate the weak approximation in terms of places:
\addtocounter{theorem}{-1}
\begin{proposition}
  Let $v_1, \ldots, v_n$ be distinct places of $K$. Then the image of the diagonal inclusion
  \[ K \injection \prod_{1\leq i\leq n}K_{v_i}\]
  is dense.
\end{proposition}
\subsection{Extensions and Places}
Let $L/K$ be finite and separable, and let $v, w$ be places of $K, L$ respectively. Say $w$ \emph{lies over} or \emph{divides} $v$ (notation $w|v$) if $v$ is the restriction of $w$ to $K$.

Then there is a unique continuous $K_v\injection L_w$ extending $K \injection L$.
\begin{proposition}
  There is a unique isomorphism of topological rings
  \[L \otimes_K K_v \xrightarrow{\sim} \prod_{w|v}L_w\]
  mapping $x \otimes y$ to $(xy)_w$.
\end{proposition}
\begin{proof}
  Both sides are finite dimensional normed $K_v$-vector spaces. The idea will be to choose a basis of $L/K$ so that $L \otimes_K K_v \cong K_v^{[L:K]}$ (with the $\sup$ norm), and on the RHS we also use the $\sup$ norm. Then we use the fact that any 2 norms on a finite dimensional vector space over a field complete with respect to an absolute value are equivalent (see Cassesl and Fr\"ohlich, Ch. III, section 8).

  Write $L = K(a)$ where $f \in K[T]$ is a minimal polynomial for $a$, and is separable. Factor $f = \prod g_i$ in $K_v$, so that the $g_i \in K_v[T]$ are irreducible and distinct.

  Let $L_i = K_v[T]/(g_i)$. Then $L \otimes_K K_v = K_v[T]/(f) \cong \prod_i L_i$. Now let $w|v$, inducing $i_w:L \injection I_w$. Let $g_w \in K_v[T]$ be the minimal polynomial of $i_w(a)$ over $K_v$. Then $g_w|f$, so $g_w$ is one of the $g_i$s, and $L_w = K_v(i_w(a)) = L_i$.

  Conversely, $K_v$ is complete and $L_i/K_v$ is finite, so there is a unique extension of $v$ to $L_i$, and we get a bijection $\{g_i\}\leftrightarrow \{w|v\}$, and $L\otimes_K K_v \cong \prod L_w$.
\end{proof}
\begin{corollary}\hspace*{0cm}
  \begin{enumerate}
    \item $\{w|v\}$ is finite, nonempty, and $[L:K] = \sum_{w|v} [L_w:K_v]$
    \item $\forall x \in K$, \\$N_{L/K}(x) = \prod_{w|v}N_{L_w/K_v}(x)$\\
    $\Tr_{L/K}(x) = \sum_{w|v}\Tr_{L_w/K_v}(x)$.
  \end{enumerate}
\end{corollary}
If $L/K$ is Galois with Galois group $G$, then $G$ acts on the places $w$ of $L$ lying over a given $v$: if $\abs{\cdot}$ is an AV on $L$ then, for all $g \in G$, the map $x\mapsto \abs{g^{-1}x}$ is an AV on $L$, agreeing with $\abs{\cdot}$ on $K$, and hence gives a (left) action of $G$ on $\{w|v\}$, $g(w) = w \circ g^{-1}$. If $w=v_P$ for a prime $P$, then $gw = v_{g(P)}$.a

We define the \emph{decomposition group} $D_w$ or $G_w$ to be the stabiliser of $w$. This action is transitive. If $g \in D_w$, then it is continuous for the topology induced by $w$ on $L$, so it extends to an automorphism of $L_w$, the completion of $L$ at $w$.
\[G \supset\Gal(L_w/K_v) \supseteq D_w\]
Then we have
\begin{align*}
  \#G &= (G:G_w)\#G_w\\
  &\leq (G:G_w)[L_w:K_v]\\
  &= \sum_{g \in G/G_w} [L_{g(w)}:K_v]\\
  &\leq \sum_{w|v}[L_w:K_v]\\
  &= [L:K] = \#G
\end{align*}
Hence equality holds throughout, and $G_w = \Gal(L_w/K_v)$.

Suppose $v$ is a \emph{discrete valuation} of $L$, i.e. it is a finite place, and the valuation ring is a DVR. Then so is any $w|v$, and we define:
\begin{itemize}
  \item $f(w|v)$, the degree of residue class extension, $= e_{L_w/K_v}$
  \item $e(w|v)$, the ramification degree
\end{itemize}
and $[L_w:K_v] = e(w|v)f(w|v)$.
\section{Number Fields}
A lot of this theory applies to other global fields, e.g. function fields. $K$ will here be a number field (i.e. finite extension of the rationals) with ring of integers $O_K$. We have some basic properties:
\begin{itemize}
  \item $O_K$ is a \emph{Dedekind domain}, i.e.
  \begin{enumerate}
    \item Noetherian (in fact, $O_K$ is a f.g. $\Z$-module).
    \item Integrally closed in $K$ (by definition).
    \item Every non-zero prime ideal is maximal, so has Krull dimension $\leq 1$.
  \end{enumerate}
\end{itemize}
We have some basic results about Dedekind domains:
\begin{theorem}\hspace*{0cm}
  \begin{enumerate}
    \item A local domain is Dedekind if and only if it is a DVR.
    \item For a domain $R$, TFAE:
    \begin{enumerate}
      \item $R$ is Dedekind.
      \item $R$ is Noetherian and for every non-zero prime $\p$, $R_\p$ is a DVR.
      \item Every fractional ideal of $R$ is invertible.
    \end{enumerate}
    \item A Dedekind domain with only finitely many prime ideals (i.e. \emph{semi-local}) is a PID.
  \end{enumerate}
\end{theorem}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item Proved in local fields, $\implies$ is the hardest part.
    \item Let $K = \Frac(R)$. A fractional ideal of $R$ is a non-zero $R$-submodule $I \subset K$ for some $0 \neq x \in R$ where $xI \subset R$ is an ideal. For $(a)\implies (b)$ it is enough to check (exercise) that the basic properties are preserved under localisation.

    For $(b)\implies (c)$, $I$ is invertible if there is a fractional ideal $I^{-1}$ such that $II^{-1} = R$. To prove $(c)$, we may assume $I \subset R$ is an ideal. Then let $I^{-1} = \{x \in K : xI \subset R\}$. If $0 \neq y \in I$, then $R \subset I^{-1} \subset y^{-1}R$, and so $I^{-1}$ is a fractional ideal. Clearly $I^{-1}I \subset R$. Now let $P \subset R$ be prime - it is sufficient to show $I^{-1}I \nsubset P$. Let $I = (a_1, \ldots, a_n)$. WLOG take $v_P(a_1) \leq v_P(a_i)$ for all $i >1$. Then $IR_P = a_1R_P$, as $R_P$ is a DVR.

    Hence $a_i/a_1 = x_i/y_i \in R_P$ where $x_i \in R, y_i \in R\setminus P$. Then $y = \prod y_i \notin P$ as $P$ is prime, and $ya_i/a_1 \in R$ for all $i$, and so $y/a_i \in I^{-1}$, so $y \in II^{-1}\setminus P$.

    For $(c)\implies (a)$, we check the properties. $R$ is Noetherian - let $I \subset R$ be an ideal. Then $II^{-1} =R \implies 1 = \sum_{i=1}^n a_ib_i, a_i \in I, b_i \in I^{-1}$. Let $I' = (a_1, \ldots, a_r) \subset I$. Then $I'I^{-1} = R = II^{-1}$, and so $I' = I$, and $I$ is finitely generated.

    $R$ is integrally closed. Let $x \in K$, integral over $R$. Then $I \coloneqq R[x] = \sum_{0\leq i < d} Rx^i \subset K$ is a fractional ideal. Obviously $I^2 = I$, so $I = I^2I^{-1} = II^{-1} = R$, i.e. $x \in R$.

    Every non-zero prime is maximal. Take $\{0\} \neq Q \subset P \subsetneq R$ where $P,Q$ are prime. Then $R \subsetneq P^{-1} \subset Q{^-1}$, and $Q\subsetneq P^{-1}Q \subset R$, and $P(P^{-1}Q) = Q$, so as $Q$ is prime and $P^{-1}Q \nsubset R$, we must have $P\subset Q$, and so $P= Q$.

    \item Let $R$ be a semi-local Dedekind domain with non-zero primes $P_1, \ldots, P_n$. Choose $x \in R$ with $x \in P_1 \setminus P_1^2, x\in P_2, \ldots, P_n$. Then $P_1 = (x)$ and every ideal is a product of powers of $\{P_i\}$ (see below), hence $R$ is a PID.
  \end{enumerate}
\end{proof}
\begin{theorem}
  Let $R$ be Dedekind. Then:
  \begin{enumerate}
    \item The group of fractional ideals is freely generated by the non-zero prime ideals, and
    \[I = \prod_P P^{v_P(I)}\]
    with $v_P(I) = \inf_{x\in I}(v_P(x))$.
    \item If $(R:I) < \infty$ for all $I \neq (0)$, then for all $I, J$, $(R: IJ) = (R:I)(R:J)$.
  \end{enumerate}
\end{theorem}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item If $I \neq R$, then $I \subset P$ for some prime ideal $P$. Then $I = PI', I' = IP^{-1} \supsetneq I$. Then by Noetherian induction, $I$ is a product of powers of prime ideals, say $I = \prod P^{a_P}$.

    We get the same for fractional ideals $J = x^{-1} I$.

    Consider the homomorphisms $\{$fractional ideals of $R\}\to\{$fractional ideals of $R_P\}\to\Z$ given by $I \mapsto IR_P$, $(\pi^n)\mapsto n$.

    The composition is $I \mapsto v_P(I)$, and if $Q \neq P$ then $v_P(Q) = 0$.

    So $\{$fractional ideals of $R\}\to \bigoplus_P \Z$ maps $\prod P^{a_P}$ to $(a_P)_P$. Hence the $a_P$ are unique and this is an isomorphism.
    \item By unique factorisation of ideals (part 1.), $\prod P^{a_P} \cap \prod P^{b_P} = \prod P^{\max{a_P,b_P}}$. So if $I+J=R$, then $IJ = I \cap J$, and so by CRT, $R/IJ \cong R/I\cap J \cong R/I \times R/J$, and we are done in this case.

    Hence this step reduces to showing that $(R:P^{n+1}) = (R:P)(R:P^n)$.

    Now localising at $P$ gives $P^n \cong R_P/P^nR_P$, so WLOG $R$ is local, hence a DVR, and $P = (\pi)$.

    Then $R/(\pi^n)\cong (\pi)/(\pi^{n+1})$ via multiplication by $\pi$, and hence $(R:P^{n+1}) = (R:P)(P:P^{n+1}) = (R:P)(R:P^n)$.
  \end{enumerate}
\end{proof}
The quotient group $Cl(R) \coloneqq \{\text{fractional ideals of $R$}\}/\{\text{principal fractional ideals of $R$}\}$ is the \emph{class group} (or \emph{Picard group}) of $R$.

If $K$ is a number field, then we write $Cl(K) = Cl(O_K)$, the \emph{ideal class group} of $K$.
\begin{theorem}
  For $K$ a number field, $Cl(K)$ is finite.
\end{theorem}
The proof will come later.

\subsection{Places of Number Fields}
Recall Ostrowski's theorem, which says that $V_\Q = \{p:p\text{ prime}\}\cup\{\infty\}$.

Let $\p \subset \O_K$ be a nonzero prime ideal. Then $\p$ determines a discrete valuation $v_\p$ of $K$, and so a non-archimedean absolute value $\abs{x}_\p = r^{-v_\p(x)}$ where $r>1$.
\begin{theorem}
  This gives a bijection $\{\text{primes of $O_K$}\} \to V_{K,f}$.
\end{theorem}
\begin{proof}
  Let $P\neq Q$. Then there exists $x \in P \setminus Q$, and then $|x|_P < 1 = |x|_Q$, so $|\cdot|_P, |\cdot|_Q$ are inequivalent, and the map is injective.

  Let $\abs{\cdot}$ be a non-archimedean absolute value on $K$, with valuation ring $R = \{x \in K : |x|\leq 1\}$. As $\abs{\cdot}$ is non-archimedean, $\Z\subset R$ and hence $R \supset O_K$ as $R$ is integrally closed. So $R \supset O_{K,P}$ for some prime $P = \mathfrak{m}_R \cap O_K$. Hence $R = O_{K,P}$ because by \textbf{1.1}, $O_{K,P}$ is a maximal subring of $K$.

  Hence $\abs{\cdot}$ and $\abs{\cdot}_P$ are equivalent.
\end{proof}
For $v \in V_{K,f}$, write $P_v$ for the corresponding prime deal of $O_K$. Then $K_v$, the completion of $K$ at $v$, is a complete discretely valued field, with valuation ring $O_v$ or $O_{K_v} \subset K_v$, not to be confused with $O_{K,P_v}$.

The normalised discrete valuation will be the one for which $v:K^\times \surjection \Z$ is surjective. We will denote by $\pi_v \in O_v$ any generator of the maximal ideal. We often assume $\pi_v \in K$. Then $v(\pi_v) = 1$.

We write $k_v = O_K/P_v \cong O_v/(\pi^v)$, is finite, of order $q_v = p^{f_v}$ for a rational prime $p$ divisible by $v$.

We then normalise the absolute value so that $\abs{x}_{v} = q_v^{-v(x)}$, so that $\abs{\pi_v}_v = \frac{1}{q_v}$.

For infinite places, we have the unique infinite place $\infty$ of $\Q$, with $\Q_\infty = \R$. So then $K \otimes_\Q \R \cong \prod_{v \in V_{K,\infty}} K_v$. Each $K_v$ is a finite extension of $\R$, so is one of $\R$ and $\C$. These correspond to the cases where we say $v$ is real or complex respectively.

In the complex case, since $K \subset K_v$ is dense, we cannot have $K \subset \R$. On the other hand, by Galois theory $\Sigma_K = \{\text{homomorphisms }K \injection \C\}$ has order $n = [K:\Q]$, and $K \otimes_\Q \C \cong \prod_{\sigma \in \Sigma_K} \C$. Complex conjugation acts on both sides by $x \otimes z \mapsto x \otimes \bar{z}$ and $(z_\sigma)_\sigma \mapsto (\overline{z_{\bar{\sigma}}})_\sigma$.

Let $\sigma_1, \ldots, \sigma_{r_1} : K \injection \R$, $\sigma_{r_1+1} = \bar{\sigma}_{r_1+r_2+1}, \ldots, \sigma_{r_1+r_2} = \bar{\sigma_n} : K \injection \C$ where $r_1+2r_2 = n$. Then, taking fixed points under complex conjugation,
\[K \otimes_\Q \R \cong \prod_{\sigma \text{ real}} \R \times \prod_{(\sigma, \bar{\sigma})} \{(z,\bar{z}) \in \C \times \C\} \cong \R^{r_1}\times \C^{r_2}\]
Therefore we have:
\begin{theorem}
  There is a bijection
  \[\Sigma_K / (\sigma \thicksim \bar{\sigma}) \xrightarrow{\sim} V_{K,\infty}\]
  given by $\sigma \mapsto |\sigma(\cdot)|$, where $\abs{\cdot}$ is the Euclidean absolute value in $\R$ or $\C$.
\end{theorem}
We write $K_\infty \coloneqq K \otimes_\Q \R$, which is canonically isomorphic to $\prod_{v \in V_{K, \infty}} K_v$ and noncanonically isomorphic to $\R^{\#\{\text{real }v\}}\times \C^{\#\{\text{complex }v\}}$.

We now choose the normalised absolute values such that, if $v$ is real corresponding to $\sigma:K \injection \R$, then $\abs{x}_v = \abs{\sigma(x)}_\infty$, and if $v$ is complex, then $\abs{x}_v = \sigma(x)\bar{\sigma}(x) = |\sigma(x)|^2$.

If $v$ is finite and $w|v$, then $L_w/K_v$ is a finite extension of non-archimedean local fields, and $[L_w:K_v] = e(w|v)f(w|v)$.

If $v$ is infinite and $w|v$, then $L_w/K_v = \begin{cases} \R/\R & f= e=1\\ \C/\C & f=e=1 \\\C/\R & v\text{ ramified, } e=2,f=1\end{cases}$
\begin{proposition}
  Let $x \in L, v \in V_K$. Then:
  \[|N_{L/K}(x)|_v = \prod_{w|v}|x|_w\]
\end{proposition}
\begin{proof}
  $N_{L/K}(x) = \prod_{w|v}N_{L_w/K_v}(x)$, so it is enough to show that $|N_{L_w/K_v}(x)|_v = |x|_w$.

  For $v$ a finite place, it is enough to take $x = \pi_w \in L$. Then:
  \begin{align*}
    |N_{L_w/K_v}(\pi_w)|_v &= |u\pi_v^{f(w|v)}|_v\\
    &= q_v^{-f(w|v)} = q_w^{-1} = |\pi_w|_w
  \end{align*}

  For $v$ an infinite place, we need only consider $L_w/K_v \cong \C/\R$. But $N_{\C/\R}(z) = z\bar{z}$ by definition.
\end{proof}
\begin{theorem}[Product Formula]
  Let $x \in K^\times$. Then:
  \[|x|_v = 1 \text{ for all but finitely many $v$}\]
  and
  \[\prod_{v\in V_K}|x|_v = 1\]
\end{theorem}
\begin{proof}
  Write $x = a/b$ where $a,b \in O_K^\times$. Then $\{v \in V_K: |x|_v \neq 1\}\subset V_{K, \infty} \cup\{v \in V_{K,f} : v(a)\text{ or }v(b) >0\}$, a finite set.

  Now $\prod_{v\in V_K}|x|_v = \prod_{p\leq \infty} \left(\prod_{v|p}|x|_v\right) = \prod_{p\leq \infty}|N_{K/\Q}(x)|_p$, so it is enough to prove this for $K= \Q$.

  By multiplicativity, we reduce to $x = q$, a prime, or $x= -1$. In the former case, $|q|_p = \begin{cases} \frac1q & p =q\\1 & p \neq q, \infty\\ q& p=\infty \end{cases}$, and in the latter, $|-1|_p = 1$ for all $p \leq \infty$. Hence the product over all of these is 1.
\end{proof}
\textbf{Remark.} In $\R$, the standard measure $dx$ transforms under $\R^\times$ as $d(ax) = |a|dx$. In $\C$, the standard measure is $dxdy$. This transforms under $\C^{\times}$ as $dxdy \mapsto |a|^2dxdy$. In both these cases, we see the scaling is the normalised AV of $a$.

Fact: on $K_v$ for any $v$ there is a translation-invariant measure, the ``Haar measure'', $d_v(x)$. Then for all $a \in K_v^\times$, $d_v(ax) = |a|_v d_v(x)$, where $\abs{\cdot}_v$ is a normalised AV.

\section{Different and Discriminant}
Suppose $R \subset S$ are commutative rings with 1, such that $S$ is a free $R$-module of finite rank $n \geq 1$. Then we have a trace map $\Tr_{S/R}:S \to R$, the trace of the $R$-linear map $y \mapsto xy$.

If $x_1, \ldots, x_n$ are elements of $S$, define the discriminant:
\[\disc_{S/R}(x_i) = \disc(x_i) = \det \Tr_{S/R} (x_ix_j) \in R\]

If $y_i = \sum_{j=1}^n r_{ji}x_j$, then $\Tr_{S/R}(y_iy_j) = \sum_{k,\ell} r_{ki}r_{\ell j}\Tr_{S/R}(x_kx_\ell)$.

Hence $\disc(y_i) = \det(r_{ij})^2 \disc(x_i)$.

Writing $S = \bigoplus_{i=1}^n Re_i$, we also define $\disc(S/R) = (\disc(e_i)) \subset R$, an ideal of $R$, independent of basis by the previous line.

This has the following basic properties:
\begin{itemize}
  \item $S = S_1 \times S_2$ implies $\disc(S/R) = \disc(S_1/R)\disc(S_2/R)$
  \item If $f:R \to R'$ is a ring homomorphism, then $\disc(S\otimes_R R'/R') = f(\disc(S/R))\subset R'$.
  \item If $R$ is a field, then $\disc(S/R)$ is an ideal, so is $R$ or $\{0\}$, and is $R$ iff the $R$-bilinear form $(x,y)\mapsto \Tr_{S/R}(sy)$ is non-degenerate.
\end{itemize}
If $L/K$ is a finite field extension, then $\disc(L/K) = K \iff$ the trace form is non-degenerate, which holds $\iff$ there is some $x \in L$ with non-zero trace, i.e. iff $L/K$ is separable. More generally:
\begin{theorem}
  Let $k$ be a field and $A$ a finite dimensional $k$-algebra. Then $\disc(A/k) \neq 0$ (so $=k$) if and only if $A = \prod K_i$ where $K_i/k$ are finite separable field extensions.
\end{theorem}
\begin{proof}
  We can write $A = \prod A_i$ where $A_i$ are indecomposable, so local, $k$-algebras, and so we may assume $A$ is local with maximal ideal $\m$.

  If $\m = 0$, i.e. $A$ is field, then this is reduced to the previous statement.

  If not, then every element of $\m$ is nilpotent, so there is $x \in \m\setminus 0$ nilpotent, and so the endomorphism $y \mapsto xy$ of $A$ is nilpotent, and for all $r \in A$, so is $y\mapsto (rx)y$, and hence for all $r \in A$, $\Tr_{A/k}(rx) = 0$, giving a degenerate trace form so a zero discriminant.
\end{proof}
If $R$ is a Dedekind domain, $K = \Frac(R)$, and $L/K$ is finite separable with $S$ the integral closure of $R$ in $L$, then we say $S/R$ is an \emph{extension of Dedekind domains}. Then $S$ is a finitely generated $R$-module, but needn't be free.
\begin{proposition}
  $S$ is a \emph{locally free} $R$-module of rank $n = [L:K]$ (i.e. for all $P \subset R, S_P \cong R_P^n$).
\end{proposition}
\begin{proof}
  $S \subset L$ so $S$ is torsion free, hence so is $S_P$, and $R_P$ is a PID, so $S_P$ is free. $S$ spans $L$ as a $K$-vector space, so $S$ has rank $\dim_K L = n$.
\end{proof}
\begin{lemma}
  If $x \in S$, $\Tr_{L/K}(x) \in R$.
\end{lemma}
\begin{proof}
  If $R$ is local, then $S$ is a free $R$-module, so $\Tr_{L/K}(x) = \Tr_{S\otimes_R K/K}(x\otimes 1) = \Tr_{S/R}(x) \in R$.

  So, in general, for all $0 \neq P \subset R$, $y = \Tr_{L/K}(x) \in R_P$, and $\cap_P R_P = \{x \in K : v_P(x) \geq 0 \forall P\} = R$.
\end{proof}
Then there are 2 equivalent definitions of $\disc(S/R):$

\textbf{Definition.} $\disc(S/R) \coloneqq$ the ideal of $R$ generated by $\{\disc_{L/K}(x_1, \ldots, x_n) : x_1, \ldots, x_n \in S\}$. If $S$ is free, this gives the previous definition.

As $S \otimes_R K = L$ is separable over $K$, $\disc(L/K) \neq 0$, and so $\disc(S/R) \neq \{0\}$.
\begin{proposition}
  $\disc(S/R) R_P = \disc(S_P/R_P)$ for all $P$.
\end{proposition}
\begin{proof}
  We claim there exist $x_1, \ldots, x_n \in S$ which are an $R_P$-basis for $S_P$. Certainly, there is such a basis in $S_P$, say $e_1, \ldots, e_n$. Now let:
  \[\mathscr{Q} \coloneqq \{\text{primes }Q\subset S : v_Q(e_i) < 0\text{ for some $i$}\}\]
  $\mathscr{Q}$ is finite. Then by the CRT, there are $a_i \in S$ such that $v_Q(a_i) + v_Q(e_i) \geq 0$ for all $Q \in \mathscr{Q}$, and $v_P(a_i) \geq 1$.

  Then $x_i = a_ie_i \in S$, and $x_i\equiv e_i$ mod $PS$. So $(x_i)$ is an $R/P$-basis for $S/PS = S_P/PS_P$. So $(x_i)$ is an $R_P$ basis for $S_P$ (this follows by Nakayama's lemma).

  Hence the discriminant $\disc(S_P/R_P) = \disc(x_i)R_P$, and hence $\disc(x_i) \in \disc(S/R)$. So $\disc(S_P/R_P) \subset \disc(S/R)R_P$, and the other inclusion is obvious.
\end{proof}

The alternate definition of $\disc(S/R)$ is:
\begin{itemize}
  \item if $x_1, \ldots, x_n \in S$ is a $K$-basis for $L$, then $\disc_{L/K}(x_i) \neq 0$.

  Let $\mathcal{P} = \{P \subset R : v_P(\disc_{L/K}(x_i)) > 0\}$, a finite set. So for all $P \notin \mathcal{P}$, $\disc(S_P/R_P) = R_P$. Then we can define $\disc(S/R) = \prod_{P \in \mathcal{P}} P^{v_P(\disc(S_P/R_P))}$.
\end{itemize}
This is equivalent to the previous definition by \textbf{3.4}.
\begin{theorem}
  $v_P(\disc(S/R)) = 0$ if and only if $P$ is unramified in $S$ and for all $Q \subset S$ over $P$, the residue field extension $\frac{S}{Q}/\frac{R}{P}$ is separable.
\end{theorem}
\begin{proof}
  We may assume $R$ is local, so that $S$ is a free $R$-module. We know $PS = \prod_Q Q^{e_Q}$. So:
  \[ S \otimes_R (R/P) \cong S/PS \cong \prod_{Q} S/Q^{e_Q}\]
  So $v_P(\disc(S/R)) = 0$ if and only if $\disc(\frac{S}{PS}/\frac{R}{P}) = \frac{R}{P}$ if and only if each $S/Q^{e_Q}$ is a finite separable field extension of $R/P$, if and only if, for all $Q$, $e_Q = 1$ and $\frac{S}{Q}/\frac{R}{P}$ is separable.
\end{proof}
\begin{corollary}
  In an extension $S/R$ of Dedekind domains (i.e. $S$ is the integral closure of $R$ in a finite separable extension of $\Frac(R)$), only finitely many primes are ramified - precisely the primes such that $v_P(\disc(S/R)) > 0$.
\end{corollary}
\begin{proposition}
  Let $P \subset R$. Then $v_P(\disc(S/R)) = \sum_{Q\supset P}v_P(\disc(\hat{S}_Q/\hat{R}_P))$.
\end{proposition}
\begin{proof}
  By \textbf{3.4} we may assume $R$ is local, so $S$ is a free $R$-module, and then:
  \[S\otimes_R \hat{R} \cong \prod \hat{S}_Q\]
  So $v_P(\disc(S/R)) = v_P(\disc(S\otimes_R \hat{R}/\hat{R})) = \sum_Q v_P(\disc(\hat{S}_Q/\hat{R}))$.
\end{proof}
\textbf{Definition.} The \emph{inverse different} $\mathscr{D}_{S/R}^{-1}$ of an extension $S/R$ of Dedekind domains is:
\[\mathscr{D}_{S/R}^{-1} = \{x \in L : \forall y \in S, \Tr_{L/K}(xy) \in R\}\]
This is the dual of $S$ with respect to the trace form $(x,y) \mapsto \Tr_{L/K}(xy)$.

This is clearly an $S$-submodule of $L$. If $\bigoplus_{i=1}^n Rx_i \subset S$, let $(y_i)$ be the dual basis to $(x_i)$ for the trace form, i.e. $\Tr_{L/K}(x_iy_j) = \delta_{ij}$. Then $S \subset \mathscr{D}_{S/R}^{-1} \subset \bigoplus_{i=1}^n Ry_i$, so $\mathscr{D}_{S/R}^{-1}$ is a fractional ideal (since it is finitely generated), and its inverse $\mathscr{D}_{S/R}$ is an ideal of $S$, called the \emph{different}.
\begin{proposition}\hspace*{0cm}
  \begin{enumerate}
    \item $P\subset R \implies \mathscr{D}_{S_P/R_P} = \mathscr{D}_{S/R}S_P$
    \item $N_{L/K}(\mathscr{D}_{S/R}) = \disc(S/R)$
    \item $Q \subset S$ lying over $P\subset R$. Then $v_Q(\mathscr{D}_{S/R}) = v_Q(\mathscr{D}_{\hat{S}_Q/\hat{R}_P})$
  \end{enumerate}
\end{proposition}
\begin{proof}\hspace*{0cm}
  \begin{enumerate}
    \item Exercise. Same idea as \textbf{3.4}.
    \item By (1) and \textbf{3.4}, we can suppose $R$ is local. Then $S$ is a PID by \textbf{2.1.iii}, so the inverse different $\mathscr{D}^{-1}_{S/R} = x^{-1} S$ for some $0 \neq x \in S$. Let $(e_i)$ be a basis for $S/R$. Then there exists a basis $(e_i')$ for $S/R$ such that
    \[\Tr_{L/K}(e_i x^{-1} e'_j) = \delta_{ij}\]
    Let $x^{-1}e_j = \sum_{k} b_{kj}e_k$ where $b_{kj} \in K$. Then the ideal:
    \begin{align*}
      (1) &= (\det[\Tr_{L/K}(e_ix^{-1}e_j')]) \\
      &= (\det (\Tr_{L/K}(e_ie_j))\det(b_ij)) \\
      &= \det(b_{ij}) \disc(S/R)
    \end{align*}
    But $N_{L/K}(x^{-1}) = u \det(b_{ij})$ for some unit in $R$. So $(1) = (N_{L/K}(x^{-1}))\disc(S/R)$. Since we are in Dedekind domains we can cancel $\disc(S/R)$, giving the result.
    \item Assume $R$ is local, $P = (\pi_P)$. Write $\hat{K} = \Frac(\hat{R})$ for $Q = (\pi_Q) \subset S$, and $\hat{L}_Q = \Frac(\hat{S}_Q)$. So $L \otimes_K \hat{K} \cong \prod_Q \hat{L}_Q$ viea $x \mapsto (x_Q)_Q$, say, and $S \otimes_R \hat{R} \cong \prod_Q \hat{S}_Q$.

    We also have $\Tr_{L \otimes_K \hat{K} / \hat{K}} (x) = \sum_Q \Tr_{\hat{L}_Q/\hat{K}}(x)$.

    Let $S = \bigoplus_{i=1}^n R x_i$, and $\mathscr{D}_{S/R}^{-1} = \prod_Q \pi_Q^{-a_Q} S = \bigoplus_{i=1}^n Ry_i$ for some $a_Q \geq 0$, $y_i \in L$ a dual basis to $x_i$.

    Then, as $S\otimes_R \hat{R} = \bigoplus \hat{R}x_i$ (really $x_i \otimes 1$), we have:
    \begin{align*}
      \mathscr{D}^{-1}_{S\otimes_R \hat{R}/\hat{R}} &\coloneqq \{x \in L\otimes_K \hat{K} : \forall y\in S\otimes_R \hat{R}, \Tr_{L\otimes_K \hat{K}/\hat{K}}(xy) \in \hat{R}\}\\
      &= \bigoplus_{i=1}^n \hat{R}y_i\\
      &= \mathscr{D}^{-1}_{S/R}\cdot S \otimes_R \hat{R} \subset L\otimes_K \hat{K}
    \end{align*}
    On the other hand,
    \[\mathscr{D}^{-1}_{S\otimes_R \hat{R}/\hat{R}} \cong \prod_Q \mathscr{D}^{-1}_{\hat{S}_Q/\hat{R}} \subset \prod_Q \hat{L}_Q\]
    So:
    \begin{align*}
      \mathscr{D}^{-1}_{\hat{S}_Q/\hat{R}} &= (\prod_{Q'}\pi_{Q'}^{-a_{Q'}}) \hat{S}_Q\\
      &= \pi_Q^{-a_Q} \hat{S}_Q
    \end{align*}
    as $v_Q(\pi_{Q'}) = 0$ if $Q' \neq Q$.
  \end{enumerate}
\end{proof}
\begin{theorem}
  Let $\p S = \prod_{i=1}^g Q_i^{e_i} \subset S$. Then $Q_i | \mathscr{D}_{S/R} \iff e_i >1$; and $Q_i^{e_i-1}|\mathscr{D}_{S/R}$.
\end{theorem}
\begin{proof}
  First assume $R$ is complete and local, and $\p = (\pi_R)$. Then $S$ is also local and complete, and there is a unique prime $Q = (\pi_S)$. Then $\mathscr{D}_{S/R} = (\pi_S)^d$ for some $d \geq 0$. By \textbf{3.8.2}, $\disc(S/R) = (N_{L/K}(\pi_s)^d) = (\pi_R)^{df}$. So as $v_P(\disc(S/R)) = 0 \iff \p$ is unramified (\textbf{3.5}), the first statement holds.

  For the second statement, we claim $\Tr_{L/K}(Q) \subset \p$. Let $x \in Q$. Then multiplication by $x$ is a nilpotent endomorphism of $S \otimes (R/\p) \cong S/Q^e$, and so $\Tr_{S \otimes_R (R/\p)/(R/\p)}(x\otimes 1) = 0$, i.e. $\Tr_{L/K}(x) = \Tr_{S/R}(x) \in \p$, and hence the claim.

  Therefore $\Tr_{L/K}(\pi_R^{-1}Q) = \Tr_{L/K}(Q^{1-e}) \subset R$, and hence $Q^{1-e} \subset \mathscr{D}_{S/R}^{-1}$, or $Q^{e-1}| \mathscr{D}_{S/R}$.

  For the general case, apply the above to $\hat{S}_{Q_i}/\hat{R}_P$ and use \textbf{3.8.3}.
\end{proof}
Some facts:
\begin{itemize}
  \item If $p\nmid e_i$, then $v_{Q_i}(\mathscr{D}_{S/R}) = e_i-1$
  \item If $p|e_i$ then $v_{Q_i}(\mathscr{D}_{S/R}) \geq e_i$.
\end{itemize}
More precisely, $v_{Q_i}(\mathscr{D}_{S/R})$ is determined by the orders of the higher ramification groups for a Galois closure of $L/K$. See e.g. Serre `Local Fields', IV.2.4.
\begin{itemize}
  \item If $S = R[x]$ and $x$ has minimal polynomial $f \in R[T]$, then $\mathscr{D}_{S/R} = (f'(x))$ where $f'$ is the derivative.
\end{itemize}
This means that $\mathscr{D}_{S/R}$ is the annihilator of the cyclic $S$-module $\Omega_{S/R}$ of Kahler differentials.

For an extension $L/K$ of number fields, we write $\mathscr{D}_{L/K} = \mathscr{D}_{O_L/O_K}$, and $\delta_{L/K} = \disc(O_L/O_K)$.
\textbf{Remark.} Take $K/\Q$, $(e_i)$ a $\Z$-basis for $O_K$. Then $\delta_{K/\Q} \subset \Z$ is $(\disc(e_i))$, and if $(e_i')$ is another basis, say $e_i' = \sum a_{ji}e_j$, then $\disc(e_i') = (\det a_{ij})^2 \disc(e_i) = \disc(e_i)$.

So the integer $\disc(e_i)$ is independent of the basis (not just the ideal it generates). We call this the absolute discriminant $d_K \in \Z \setminus \{0\}$.
\begin{theorem}[Kummer-Dedekind Criterion]
  Let $S/R$ be an extension of Dedekind domains, and $x \in S$ such that $L=K(x)$. Suppose there is $\p \subset R$ such that $S_\p = R_\p[x]$.

  Let $g \in R[T]$ be the min. poly. of $x$, and $\bar{g} = \prod_i \bar{g}_i^{e_i} \in (R/\p)[T]$ be a factorisation of the reduction of $g$ into powers of distinct irreducibles, where $\bar{g}_i$ are monic. Let $g_i \in R[T]$ be any monic lift of $\bar{g}_i$, and $f_i = \deg(g_i) = \deg(\bar{g}_i)$.

  Then $Q_i= \p S + (g_i(x)) \subset S$ is prime, of residue degree $[S/Q_i : R/\p] = f_i$, $Q_i \neq Q_j$ if $i\neq j$, and $\p S = \prod_i Q_i^{e_i}$.
\end{theorem}
\begin{proof}
  We can assume $R$ is local, so $S = R[x]$. Set $\p = (\pi), R/\p = k$. We claim $Q_i$ is prime, $Q_i \neq Q_j$, with residue degree $f_i$.

  Now $S/Q_i \equiv k[T]/(\bar{g}_i)$, and $\bar{g}_i$ is irreducible of degree $f_i$.

  If $i \neq j$, then there exists $a,b \in R[T]$ such that $\bar{a}\bar{g}_i + \bar{b}\bar{g}_j = 1$, and so $1 = ag_i + bg_j + \pi c$ for some $c \in R[T]$, hence $1 \in Q_i +Q_j = (\pi, g_i(x), g_j(x))$.

  Let $g = \prod g_i^{e_i} + \pi h$ where $h \in R[T]$. Then:
  \[\prod_i Q_i^{e_i} = \prod_i (\pi, g_i(x))^{e_i} \subset \prod_i (\pi, g_i(x)^{e_i}) \subset (\pi, \prod g_i(x)^{e_i}) = (\pi, \pi h(x)) \subset \p S = (\pi)\]
  Now $\dim_k (S/\p S) = n = [L:K]$, and $\dim_k(S/Q_i^{e_i}) = \sum_{j=0}^{e_i-1}\dim_k(Q_i^j/Q_i^{j-1}) = e_i \dim_k(S/Q_i) = e_i f_i$.

  Hence $\prod_i Q_i^{e_i} \subset \p S$ gives $\sum e_i f_i \geq n$. As $\sum e_i f_i = \sum e_i \deg(\bar{g}_i) = \deg(\bar{g}) = n$, we have equality.
\end{proof}
\subsection{Examples}
\textbf{Quadratic Fields}

Let $K = \Q(\sqrt{d})$, where $d \in \Q^\times$ not a square. Multiplying by a square, we may assume $d \in \Z\setminus \{0,1\}$ squarefree.

Then $O_k \supset \Z[\sqrt{d}] = \Z \oplus \Z\sqrt{d}$. Now the multiplication map by $a+b\sqrt{d}$ takes:
\begin{align*}
  (a+b\sqrt{d})\cdot 1 &= a\cdot 1 + b\cdot \sqrt{d}\\
  (a+b\sqrt{d})\cdot \sqrt{d} &= a\sqrt{d} + bd = bd\cdot 1 + a\cdot \sqrt{d}
\end{align*}
so we have:
\[\Tr_{K/\Q}(a+b\sqrt{d}) = \Tr\begin{pmatrix} a & bd \\ b & a\end{pmatrix} = 2a\]
And so $\Tr_{K/\Q}(1) = 2, \Tr_{K/\Q}(\sqrt{d}) = 0, \Tr_{K/\Q}(d) = 2d$. Then for the discriminant, we have:
\[\disc(1, \sqrt{d}) = \det\begin{pmatrix} 2 & 0 \\ 0 & 2d\end{pmatrix} = 4d\]
Hence we have one of 2 cases:
\begin{enumerate}
  \item $d_K = 4d$, and so $O_K = \Z[\sqrt{d}]$, or:
  \item $d_K = d$, and $(O_K:\Z[\sqrt{d}]) = 2$.
\end{enumerate}
We are in the second case iff there are $m, n \in \Z$ not both even with $\frac{m+n\sqrt{d}}{2} \in O_K$ iff $\frac{1+\sqrt{d}}{2} \in O(K)$, since it is obvious that $\frac{1}{2}, \frac{\sqrt{d}}{2} \notin O_K$. The min poly of $\frac{1+\sqrt{d}}{2}$ is $T^2-T-\frac{d-1}{4}$, so we have this precisely when $d \equiv 1 \mod 4$, in which case $O_K = \Z \oplus \Z \frac{1+\sqrt{d}}{2} = \Z[\frac{1+\sqrt{d}}{2}]$.

In case 1, we can then compute $\Tr_{K/\Q}(1\cdot \frac{1}{2}) = 1, \Tr_{K/\Q}(\sqrt{d}\cdot\frac{1}{2\sqrt{d}}) = 1$, so we have a dual basis for the trace form given by $\{\frac12, \frac{1}{2\sqrt{d}}\}$, and hence $\mathscr{D}_{K/\Q}^{-1} = (\frac{1}{2}, \frac{1}{2\sqrt{d}}) = (\frac{1}{2\sqrt{d}}) = (2\sqrt{d})^{-1}$, and so $\mathscr{D}_{K/\Q} = (2\sqrt{d})$

In case 2, our basis is now $\{1, \frac{1+\sqrt{d}}{2}\}$. The dual basis is thus $\{\frac{1}{2}, \frac{1}{1+\sqrt{d}}\}$, so $\mathscr{D}_{K/\Q}^{-1} = (\frac{1}{2}, \frac{1}{1+\sqrt{d}}) = (2, 1+\sqrt{d})^{-1} = (\sqrt{d})^{-1}$, so $\mathscr{D}_{K/\Q} = (\sqrt{d})$.

Alternatively, in case 1, $O_K = \Z[\sqrt{d}]$, and the min. poly. of $\sqrt{d}$ is $f(T) = T^2-d$. Hence $\mathscr{D}_{K/\Q} = (f'(\sqrt{d})) = (2\sqrt{d})$. In case 2, $O_K = \Z[\frac{1+\sqrt{d}}{2}]$, so we have min. poly. $T^2-T-\frac{d-1}{4}$, and so $\mathscr{D}_{K/\Q} = (2\frac{1+\sqrt{d}{2}}{2}-1) = (\sqrt{d})$.

We can now look at the decomposition of $(p)\subset O_K$. Using Kummer-Dedekind:
\begin{itemize}
  \item If $p \neq 2$ or $d \nequiv 1 \mod 4$, then $p \nmid (O_K:\Z[\sqrt{d}])$. So, applying the criterion to $T^2-d$, we see:
  \[(p) = \begin{cases} P^2 & \text{ramified, if $p|d$, $P = (p,\sqrt{d})$}\\ P& \text{inert, if $p \nmid d$, $\legendre{d}{p} = -1$}\\PP' & \text{split, if $p\nmid d, \legendre{d}{p} = +1$}. P = (p, \sqrt{d}-a) \neq P' = (p, \sqrt{d}+a) \end{cases}\]
  \item If $p=2$ and $d \equiv 1 \mod 4$, then we factor $T^2-T-\frac{d-1}{4}$ mod 2 and get:
  \[(2) = \begin{cases} (2) & \text{inert, if $d\equiv 5 \mod 8$} \\ PP' & \text{split, if $d \equiv 1 \mod 8$} P=(2, \frac{\sqrt{d}+1}{2}) \neq P' = (2, \frac{\sqrt{d}-1}{2})\end{cases}\]
\end{itemize}

\textbf{Cyclotomic Fields}

Recall some Galois theory: if $n > 1$, and $K$ is a field of characteristic prime to $n$. Suppose $L = K(\zeta_n)$, where $\zeta_n$ is a primitive $n\th$ root of unity. Equivalently, $\zeta_n$ is a root of the $n\th$ cyclotomic polynomial $\Phi_n$ of degree $\varphi(n)$, defined recursively by
\[T^n-1 = \prod_{d|n}\Phi_d(T)\]
Then $L/K$ is Galois with abelian Galois group, and an injective homomorphism
\[\Gal(L/K) \to (\Z/n\Z)^\times\]
given by
\[g\mapsto a \st g(\zeta_n) = \zeta_n^a\]
\begin{theorem}
  Let $L = \Q(\zeta_n)$. Then:
  \begin{enumerate}
    \item $\Gal(L/\Q) \cong (\Z/n\Z)^\times$.
    \item $p$ ramifies in $L$ iff $p|n$.
    \item $O_L = \Z[\zeta_n]$.
  \end{enumerate}
\end{theorem}
\textbf{Remark.} Condition 1 is equivalent to $\Phi_n$ being irreducible over $\Q$, iff $[L:\Q] = \varphi(n)$.
\begin{proof}
  Let $n = p^r m$ for $r \geq 1$ where $p$ is a prime not dividing $m$. Let $\zeta_m = \zeta_n^{p^r}, \zeta_{p^r} = \zeta_n^m$. Then there exist $a,b \in \Z$ such that $p^r a + mb =1$, so $\zeta_n = \zeta_{pr}^a\zeta_m^b$. Now let $K = \Q(\zeta_m)$. Then $L = K(\zeta_{p^r})$. We will prove:
  \begin{itemize}
    \item $\Phi_{p^r}$ is irreducible over $K$.
    \item If $v \in V_{K, f}$ and $v \nmid p$, then $v$ is unramified in $L/K$.
    \item If $v |p$ then $v$ is totally ramified in $L/K$.
    \item $O_L = O_K[\zeta_{p^r}]$.
  \end{itemize}
  This will prove the theorem by induction on $n$.

  For a place $w$ of $L$, write $x_w \in L_w$ for the image of $\zeta_{p^r}$ under $L \injection L_w$. Now suppose $v|p$. By induction, $v$ is unramified in $K/Q$, so $v(p) = 1$. Then:
  \[\Phi_{p^r}(T+1) = \frac{(T+1)^{p^r} -1 }{(T+1)^{p^{r-1}}-1}\]
  is an Eisenstein polynomial in $O_{K_v}[T]$, congruent to $T^{p^{r-1}(p-1)}$ mod $p$, and the constant coefficient is $p$, so it has valuation 1.

  Then from local fields, $\Phi_{p^r}$ is irreducible over $K_v$ and hence over $K$, and $L/K$ is totally ramified at $v$, and if $w$ is the unique place of $L$ over $v$, then $O_{L_w} = O_{K_v}[\pi_w]$, where $\pi_w = x_w-1$, a root of $\Phi_{p^r}(T+1)$ in $K_w$.

  Now let $v|q \neq p$. Then $\Phi_{p^r}$ is separable mod $q$. We have:
  \[K_v \otimes_K  L \cong \prod_{w|v}L_w = \prod_{w|v}K_v(x_w)\]
  Let $f_w \in O_{K_v}[T]$ be the minimal polynomial of $x_w|K_v$. Then $\prod_{w|v}f_w = \Phi_{p^r}$, so the reduction of $f_w$ at $v$ is separable, and hence $L_w/K_v$ is unramified. Then, by local fields again, $O_{L_w} = O_{K_v}[x_w]$, and $\prod_{w|v}O_{L_w} = \prod_{w|v}O_{K_v}[T]/(f_w) \cong O_{K_v}[T]/(\Phi_{p^r})$.

  Hence, for all $v \in V_{K,f}$,
  \[O_{K_v}\otimes_{O_K} O_K[\zeta_{p^r}] \cong O_{K_v}[T]/(\Phi_{p^r}) \cong \prod_{w|v} O_{L_w} \cong O_{K_v} \otimes_{O_K} O_L\]
  So we must have $O_K[\zeta_{p^r}] = O_L$.
\end{proof}
Given $L/K$ a Galois extension of number fields with $w|v$ finite places, with $G = \Gal(L/K) \supset G_w \cong \Gal(L_w/K_v)$, the decomposition group of $w$, we have a short exact sequence:
\[0 \to I_w \to G_w \to \Gal(\ell_w/k_v) \to 1\]
Suppose $w$ is unramified in $L/K$ (iff $v$ unramified in $L/K$). Then $I_w = \{1\}$. We define the \emph{Frobenius at w} to be the element $\sigma_w \in G_w$ mapping to the generator $x\mapsto x^{q_v}$ of $\Gal(\ell_w/k_v)$.

So the order of $\sigma_w = f(w|v) = [\ell_w:k_v] = [\ell_{w'}:k_v]$ for any other $w'|v$.

In particular, $\sigma_w = 1 \iff v$ splits completely in $L/K$, i.e., there are precisely $[L:K]$ places of $L$ over $v$.

Now suppose $G$ is abelian. Then $G_w, \sigma_w$ are independent of $w$, so depend only on $v$, and so we write $\sigma_v$ or $\sigma_{L/K,v}$ for $\sigma_w$, the \emph{(arithmetic) Frobenius at v}.

\textbf{Remark.} If $L/F/K$ with $L/K$ abelian, then $\sigma_{L/K}|_{F} = \sigma_{F/K}$, by definition.

\textbf{Example.} Take $L = \Q(\zeta_n), K= \Q, n > 2$. We have $(\Z/n\Z)^\times \xrightarrow[\lambda]{\sim} \Gal(L/\Q)$, given by
\[\lambda(a \mod n):\zeta_n \mapsto \zeta_n^a\]
We now claim $\sigma_p = \sigma_{L/\Q, p} = \lambda(p)$ if $p \nmid n$.

Indeed, $\sigma_p$ is characterised by, the following property: for all $v|p$, $\sigma_p$ induces $(x\mapsto x^p)$ on the residue field $\Z[\zeta_n]/\p_v$, whereas $\lambda(p)$ induces $(x\mapsto x^p)$ on $\Z[\zeta_n]/(p)$.

\textbf{Remarks.}
\begin{enumerate}
  \item These elements $\sigma_p$ generate $\Gal(L/\Q)$, since every integer prime to $n$ is a product of $p\nmid n$. This gives with some thought another proof that $\Gal(L/\Q)\cong (\Z/n\Z)^\times$.
  \item If $\sigma: L \injection \C$ is any embedding, then $\overline{\sigma(\zeta_n)} = \sigma(\zeta_n^{-1})$. So $\lambda(-1)$ is complex conjugation for any embedding.
\end{enumerate}
We will now specialise to the case where $n=q$ is a prime $>2$. Then $\Gal(L/\Q) \cong (\Z/q\Z)^\times$, cyclic of order $q-1$. So we have a unique index 2 subgroup $H$, the squares.

Let $K = L^H$ be a quadratic extension of $\Q$. Every $p \neq q$ is unramified in $L$, hence also in $K$. So $K = \Q(\sqrt{\pm q})$, and as $2$ is unramified we must have $K = \Q(\sqrt{q^\ast})$, where $q^{\ast} = \begin{cases} q & q \equiv 1 \mod 4\\ -q& q \equiv 3 \mod 4 \end{cases}$. Note that $d_K = q^\ast$.

Now let $p \neq q$ be an odd prime. Then $\sigma_{K/\Q, p} = 1 \iff \sigma_{L/\Q, p} \in H \iff \legendre{p}{q} = 1$.

But $\sigma_{K/\Q, p} = 1 \iff p$ splits in $K$ which is equivalent to saying that $\legendre{q^\ast}{p} = 1$, and so:
\[\legendre{p}{q} = \legendre{q^\ast}{p}\]
Combining this with $\legendre{-1}{p} = (-1)^{(p-1)/2}$ gives quadratic reciprocity.

In algebraic number theory terms, quadratic reciprocity says that the splitting of $p$ in $K/\Q$ depends only on the congruence class of $p$ mod something. Class field theory tells us that a similar thing holds for any abelian extension of number fields. There is a law describing the decomposition of primes in an abelian extension which is just a congruence condition.

$\llbracket$ Apparently my numbering is off compared to the lecturer - I can't work out where this happened, so we're skipping section numbers 4 and 5$\rrbracket$
\addtocounter{section}{2}
\section{Ideles and Adeles}
To study congruences mod $p^n$, Hensel introduced $\Z, \Q_p, \Q \injection \Q_p$. For congruences to arbitrary moduli or to study ``local-global'' problems in general, it would be nice to simultaneously embed $\Q \injection \Q_p$ for all $p \leq \infty$. The first guess for how to do this would be to embed into $\prod_{p \leq \infty}\Q_p$, but this product is not nice.

Better is to notice that, if $x \in \Q$, then the image of $x$ lies in $\Z_p$ for all but finitely many $p$. So we introduce a small product with better properties. We introduce two objects:
\begin{itemize}
  \item $\A_k$, the ring of adeles of $K$ (or valuation vectors).
  \item $J_k$, the group of ideles of $K$.
\end{itemize}
These are topological rings/groups respectively, and are highly disconnected.

\textbf{Definition of $\A_k$.} Let $K$ be a number field, and $V_K = V_{K,\infty} \sqcup V_{K,f}$. It's completion is $K_v$ and if $v \in V_{K,f}$ then $O_v \subset K_v$.

We then define:
\begin{align*}
  \A_K &\coloneqq \{(x_v) \in \prod_{v \in V_K}K_v : \text{for all but finitely many $v$, $x_v \in O_v$}\}\\
  &= \bigcup_{\text{finite } S \subset V_{K,f}}U_{K,S} \subseteq \prod_{v \in V_K}K_v
\end{align*}
where
\[U_{K,S} = \prod_{v \in V_{K,\infty}}K_v \times \prod_{v \in S} K_v \times \prod_{v \in V_{K,f}\setminus S}O_v\]
We will sometimes refer to $K_{\infty}  =\prod_{v \in V_{K,\infty}}K_v = K\otimes_\Q \R$.

$\A_K$ is a ring. We then put a topology on $\A_K$. It will be generated by all $V \subset U_{K,S}$ open as $S$ varies, where $U_{K,S}$ has the product topology.

This means in particular, every $U_{K,S} \subset \A_K$ is open.
\[U_{K, \emptyset} = K_\infty \times \prod_{v \in V_{K,f}}O_v\]
is open and has the product topology.

For example, take $K=\Q$. Then $\A_\Q = \R \times \{(x_p) \in \prod_{\p < \infty}\Q_p:\text{for all but finitely many $p$, $x_p \in \Z_p$}\}$.

So, letting $m = \prod_p$(denominator $p^i$ of $x_p$)$\in \Z_{>0}$, we see that $m\cdot (x_p)_p \in \prod_{p <\infty} \Z_p = \hat{\Z}$.

I.e., $(x_p)_p \in \frac{1}{m}\hat{\Z} \subset \prod_p \Q_p$.

Let $\hat{\Q} = \bigcup_{m\geq 1}\frac{1}{m}\hat{\Z} \cong \hat{\Z}\otimes_\Z \Q$. Then $\A_\Q = \R \times \hat{\Q}$.
\begin{proposition}
  $\A_K$ is Hausdorff and locally compact (i.e. every point has a compact neighbourhood).
\end{proposition}
\begin{proof}
  $U_{K, \emptyset} = K_\infty \times \prod_{v\nmid\infty}O_v \cong K_\infty \times \hat{O_K}$ is Haudorff and locally compact (as $K_\infty$ is locally compact and $\hat{O_K}$ is compact), and is an open neighbourhood of 0. Then by translation, $\A_K$ is Hausdorff and locally compact.
\end{proof}
We have the diagonal embedding $K \injection \A_K$.
\begin{proposition}
  $K$ is discrete in $\A_K$.
\end{proposition}
\begin{proof}
  We need to find a neighbourhood of $0$ containing only $0 \in K$. Let
  \[U = \{x = (x_v) \in \A_K : \forall v \in V_{K,f} |x_v|_v\leq 1, \forall v \in V_{K, \infty} |x_v|_v <1\}\]
  Then $U \subseteq \A_K$ is open. If $x \in K \cap U$, then the first condition implies $x \in O_K$, and the second implies $|N_{K/\Q}(x)| < 1$, so $x=0$. Hence $K$ is discrete.
\end{proof}
\textbf{Remark.} Intuitively, this must be true - if not, we would have a place-independent topology on $K$.

Let $L/K$ be an extension of number fields. For all $v \in V_K$, we have an inclusion $K_v \injection \prod_{w|v} L_w$. This induces an inclusion of rings $\A_K \injection \A_L$, which is visibly continuous.
\begin{proposition}
  Let $(a_1, \ldots, a_n)$ be a $K$-basis for $L$. Consider:
  \[\A_K^n \xrightarrow{f} \A_K \otimes_K L \xrightarrow{g} \A_L\]
  given by $(x^{(i)})\mapsto \sum x^{(i)}\otimes_K a_i \mapsto \sum a_i x^{(i)}$. Then $g$ is a ring isomorphism, $f$ is an $\A_K$-module isomorphism, and $g \circ f$ is a homeomorphism.

  This then defines a unique topology on $\A_K \otimes_K L$ such that $g$ is an isomorphism of topological rings.
\end{proposition}
\begin{proof}
  Since $L = \bigoplus Ka_i \cong K^n$, $f$ is an $\A_K$-module isomorphism. By definition, $g$ is a ring homomorphism. So it is sufficient to prove that $g \circ f$ is bijective, and that it maps $X^n = (K_\infty \times \hat{O_K})^n$ homeomorphically to an open subgroup of $O_L$.

  Note that multiplication by any $x \in K^\times$ is a self-homeomorphism of $\A_K$ with itself, and so is multiplication by $x^{-1}$. The same is true for $\A_L$. So we may replace $a_i$ by non-zero $K$-multiples, and hence WLOG we may take $a_i \in O_L$.

  Let $S = \{v \in V_{K,f} : v((O_L:\sum a_i O_K)) > 0\}$ - this is a finite subset of $V_{K,f}$. Then for all $v \in V_{K,f} \setminus S$,
  \[O_{K_v}^n \cong \prod_{w|v}O_{L_w} \cong O_{K_v}\otimes_{O_K}O_L\]
  and for all $v \in S$, $\sum a_i O_{K_v} = M_v$ is an open $O_{K_v}$-submodule of $\prod_{w|v}O_{L_w}$.

  Hence $gf((K_\infty \times \hat{O_K})^n)  = L_\infty \times \prod_{v\notin S, v\nmid \infty}\prod_{w|v}O_{L_w} \times \prod_v M_v$ is a homeomorphism onto an open subgroup of $\A_L$.

  Moreover, for any finite $S' \supset S \supset V_{K,\infty}$,
  \[gf:(\prod_{v \in S'} K_V \times \prod_{v\notin S'}O_{K_v})^n \to \prod_{w|v\in S'} L_w \times \prod_{w|v\notin S'} O_{L_w}\]
  so $gf$ is a bijection.
\end{proof}
In particular, $\A_K = \A_\Q \otimes_\Q K$.
\begin{corollary}
  $\A_L$ is a free $\A_K$-module of rank $[L:K]$, and the following diagram commutes:
  \begin{center}
    \includegraphics[width=0.8\textwidth]{algnt1.png}
  \end{center}
\end{corollary}
\begin{proof}
  Exercise.
\end{proof}
\begin{theorem}
  $\A_K/K$ is compact and Hausdorff.
\end{theorem}
\begin{proof}
  $K$ is closed in $\A_K$, and $\A_K$ is Hausdorff, so $\A_K/K$ is Hausdorff.

  By \textbf{6.3}, $\A_K/K \cong (\A_{\Q}/\Q)^{[K:\Q]}$ as topological groups, so we may assume $K = \Q$. Let $X = [0,1]\times \hat{\Z} \subset \A_\Q$. $X$ is compact, so it's enough to show that $X+ \Q = \A_\Q$, as then $X \surjection \A_\Q/\Q$. Let $x = (x_p)_{p\leq \infty} \in \A_\Q$, and let $S = \{p<\infty : x_p \notin \Z_p\}$ - a finite set of finite places.

  Then there is $r_p \in \Z[1/p]$ such that $x_p -r_p \in \Z_p$ for all $p \in S$.

  Let $r = \sum_{p \in S}r_p \in \Q$. For all primes $p < \infty$, $x_p - r \in \Z_p$, i.e. $x-r \in \R \times \hat{\Z}$, and then for suitable $m \in \Z$, $x-(r+m) \in [0,1]\times \hat{\Z}$.
\end{proof}
From \textbf{6.3} we also get
\[\A_K = K_\infty \times \hat{K}\]
where $\hat{K} = \hat{O_K} \otimes_\Z \Q = \hat{O_K} \otimes_{O_K} K$, and $\hat{O_K} = \prod_{P}\hat{O_{K,P}} =\prod_{v\nmid \infty}O_{K_v}$.

\subsection{Ideles}
\begin{definition}
  The \emph{idele group of K} is $J_K = \A_K^\times$, the group of units of $\A_K$. In other words, this is
  \[\{(x_v) \in \prod_{v\in V_K}K_V^\times : \text{for all but finitely many $v$, $x_v \in O_v^\times$}\}\]
\end{definition}
We can write this in a similar way as we did adeles:
\[\bigcup_{S \subset K_{K,f}}\left(K_\infty^\times \times \prod_{v\in S}K_v^\times \times \prod_{v \in V_{K,f}\setminus S}O_v^\times\right)\]
We call this set in the union $J_{K,S}$, and the topology on $J_K$ is generated by open subsets of $J_{K,S}$ where $J_{K,S}$ has the product topology.

In particular, $K_\infty^\times \times \prod_{v\nmid \infty}O_v^\times$ is an open subgroup and has the product topology. We have an embedding $J_K \injection \A_K$ which is continuous, but is not a homomorphism onto its image, as $x \mapsto x^{-1}$ is not continuous for the $\A_K$-topology.

However, $x\mapsto (x, x^{-1})$ is a homeomorphism $J_K \injection \A_k \times \A_K$ onto the closed subset $\{xy = 1\}\subset \A_K^2$.

$K^\times \injection J_K$ since $x \in K^\times \implies |x|_v = 1$ for all but finitely many $v$, and has a discrete image. We define $C_K = J_K/K^\times$, the \emph{idele class group} of $K$. This is a Hausdorff locally compact topological group.

We have 2 important homomorphisms:
\begin{itemize}
  \item The \emph{idele norm}. Let $x = (x_v) \in J_K$. Then for all $v$, $|x_v|_v \neq 0$, and for all but finitely many $v$, $|x_v|_v = 1$. So we can define a homomorphism:
  \[\abs{\cdot}_{\A} : J_K \to \R_{>0}; |(x_v)|_{\A} = \prod_{v\in V_K}|x_v|_v\]
  This is continuous since the restriction to $J_{K,S}$ is.

  If $x \in K^\times$, then $|x|_{\A} = 1$ by the product formula, so $\abs{\cdot}_{\A}:J_K \to C_K \to \R_{>0}$. We define $J_K^{1} = \{x \in J_K : |x|_{\A} = 1\}$, and $C_K^1 = J_K^1/K^\times$. Clearly $\abs{\cdot}_{\A}$ is surjective, as $K_\infty^\times \subset J_K$.

  \begin{proposition}
    $J_K \cong J_K^1 \times \R_{>0}, C_K \cong C_K^1 \times \R_{>0}$
  \end{proposition}
  \begin{proof}
    We have $\abs{\cdot}_{\A}:J_K \surjection \R_{>0}$. Consider $i:\R_{>0} \to K_\infty^\times \subset J_K$ given by $x \mapsto (x^{1/n})_{v|\infty}$. Because $|x|_v$ is $|x|_\infty$ if $v$ is real and $|v|^2$ if $v$ is complex, this homomorphism is a right inverse to $|\cdot|_{\A}$, so defines a splitting $J_K \cong J_K^1 \times \R_{>0}$.

    Since $i(R_{>0}) \cap K^\times =\{1\}$, we also have $C_K \cong C_K^1 \times \R_{>0}$.
  \end{proof}

  \item The \emph{content map}, $c : J_K \to I(K)$, the group of fractional ideals of $K$, which is a free abelian group generated by $V_{K,f}$, given by $(x_v) \mapsto \prod_{v \in V_{K,f}} P_v^{v(x_v)}$, where $P_v$ is the prime ideal corresponding to the finite place $v$. We write $v$ also for the corresponding normalised discrete valuation. This is a continuous homomorphism, since $\ker(c) =J_{K,\emptyset} = K_\infty^\times \times \prod_{v\nmid \infty}O_v^\times$ is open.

  If $x \in K^\times$, then $c(x)$ is the principal fractional ideal $(x)$. So $c$ descends to a homomorphism $c: C_K = J_K/K^\times \to Cl(K) = J(K)/P(K)$, where $P(K)$ is the group of principal fractional ideals. The image of this inclusion $K^\times \injection J_K$ is called the subgroup of principal ideles.

  $c$ is clearly surjective, since $K_v^\times \surjection \Z$, so $C_K \surjection Cl(K)$. As $\R_{>0} \xrightarrow{c\circ i} Cl(K)$ is zero, we have a surjection $C_K^1 \surjection Cl(K)$. We will now prove that $C_K^1 = J_K^1/K^\times$ is compact, and the corollary of this will be that $Cl(K)$ is finite, since it's compact and discrete.
\end{itemize}
Variant: suppose $S \subset V_{K,f}$ is a finite subset, we can define a restricted map $c^S : J_K \to I^S(K)$, the fractional ideals prime to $S$, i.e. $I$ such that, for all $v \in S$, $v(I) = 0$ by $c^S((x_v)) = \prod_{v \in V_{K,f}\setminus S} P_v^{v(x_v)}$. This will be useful later on.

\section{Geometry of Numbers}
Classically, we embed $K \injection K_\infty \cong \R^{r_1}\times \C^{r_2} \cong \R^n$, and study the image $\sigma(I) \subset \R^n$. Let $U$ be a finite dimensional vector space. A \emph{lattice} $\Lambda \subset U$ is a discrete subgroup such that $U/\Lambda$ is compact.
\begin{proposition}
  A subgroup $\Lambda \subseteq U$ is a lattice iff $\Lambda = \bigoplus \Z e_i$ where $(e_i)$ is an $\R$-basis for $U$.
\end{proposition}
\begin{proof}
  Ex. Sheet.
\end{proof}
\begin{theorem}[Minkowski]
  Let $\Lambda \subset \R^n$ be a lattice, and let $\mu_{\Lambda} = \text{vol}(\R^n/\Lambda)$ be the covolume of $\Lambda$. Let $X \subset \R^n$ be a compact subset, which is convex (so that given $x, y \in X, t \in [0,1]$, we have $tx + (1-t)y \in X$) and symmetric about 0 (so that $x \in X \implies -x \in X$).

  If $\text{vol}(X) > 2^n \mu_{\Lambda}$, then $X \cap \Lambda \neq \emptyset$.
\end{theorem}
\begin{proof}
  We have $\pi:\R^n \to \R^n/2\Lambda$. Then $\text{vol}(\pi(X)) \leq \text{vol}(\R^n/2\Lambda) = 2^n \text{vol}(\R^n/\Lambda) < \text{vol}(X)$. So $\pi$ is not injective, so there are $x \neq y$ such that $x - y = 2 \lambda \in 2\Lambda$. But then $\lambda \neq 0$, so $\lambda = \frac12 x + \frac12(-y) \in X$ by symmetry and convexity.
\end{proof}
\begin{theorem}
  There is a constant $r_K > 0$ such that, if $(d_v)_{v\in K}$ is the positive reals with $d_v \in |K_v^\times|_v = \{|x|_v : x \in \K_v^\times\}\subset \R_{>0}$, $d_v = 1$ for all but finitely many $v$, and $\prod_{v \in V_K}d_v > r_K$. Then $\{x \in K:\forall v, |x|_v \leq d_v\} \neq \{0\}$.
\end{theorem}
\begin{proof}
  For all $v \nmid \infty$, we can write $d_v = q_v^{-n_v}$, where $n_v \in \Z$. $I = \{X \in K : \forall v \nmid \infty, |x|_v \leq d_v\} = \prod P_v^{n_v}$ is a fractional ideal of $K$.

  Then $\mu_{\sigma(I)} = m^{-n}\mu_{\sigma(mI)} = m^{-n}\mu_{\sigma(O_K)}(\sigma(O_K):\sigma(mI)) = m^{-n}\mu_{\sigma(O_K)} N(mI) = \mu_{\sigma(O_K)} \prod q_v^{n_v}$, and $\sigma(I)$ is a lattice in $\R^n$.

  Let
  \[X = \{x \in \prod_{v\mid \infty}K_v \cong \R^n : \forall v, |x_v|_v \leq d_v\} = \prod_{v \text{ real}} [-d_v,d_v] \times \prod_{v \text{ complex}} \{|z|^2 \leq d_v\}\]
  which is convex, compact, symmetric, with volume $2^{r_1}\pi^{r_2}\prod_{v|\infty}d_v > 2^n \mu_{\sigma(I)} = 2^n \prod{v \nmid \infty} d_v^{-1} \mu_{\sigma(O_K)}$, provided that $\prod_{\text{all }v}d_v > r_K = (4/\pi)^{r_2}\mu_{\sigma(O_K)}$. Then apply Minkowski.
\end{proof}
\end{document}
